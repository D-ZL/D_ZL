# 命令

## 定时任务

- `crontab` 命令的一般形式为：
- `crontab [-u user] -e -l -r`
  - `-u` 用户名
  - `-e` 编辑 `crontab` 文件
  - `-l` 列出 `crontab` 文件中的内容
  - `-r` 删除 `crontab` 文件

## 执行多个命令

- `;` 每个命令之间用 `;` 隔开，各命令的执行结果，不会影响其它命令的执行。
- `&&` 每个命令之间用 `&&` 隔开，若前面的命令执行成功，才会去执行后面的命令。
- `||` 每个命令之间用 `||` 隔开，`||` 是或的意思，只有前面的命令执行失败后才去执行下一条命令，直到执行成功一条命令为止。
 
## Linux Shell echo log 1>/dev/null 2>&1 含义

命令的结果可以通过 `%>` 的形式来定义输出

- `/dev/null` 代表空设备文件
- `>` 代表重定向到哪里，例如：`echo '123' >/home/123.txt`
- `1` 表示 stdout 标准输出，系统默认值是 `1`，所以 `>/dev/null` 等同于 `1>/dev/null`
- `2` 表示 stderr 标准错误
- `&` 表示等同于的意思，`2>&1`，表示 `2` 的输出重定向等同于 `1`

## 命令后台运行

- `&` 将指令丢到后台去执行，关掉终端会停止运行
- `[ctrl]+Z` 将前台任务等到后台中暂停
- `jobs -l` 查看后台的工作状态
- `fg %jobnumber` 将后台的任务拿到前台来处理
- `bg %jobnumber` 将后台任务入到后台中去处理
- `kill` 管理后台的任务
- `nohup` 后台运行，关掉终端也会继续运行

## SSH Key

`ssh-keygen -t rsa -C "email"`

## SCP

`scp` 用于在 Linux 下进行远程拷贝文件的命令。

**命令格式**

`scp [参数] [原路径] [目标路径]`

**命令参数**

- `-1` 强制 `scp` 命令使用协议 ssh1  
- `-2` 强制 `scp` 命令使用协议 ssh2  
- `-4` 强制 `scp` 命令只使用 IPv4 寻址  
- `-6` 强制 `scp` 命令只使用 IPv6 寻址  
- `-B` 使用批处理模式（传输过程中不询问传输口令或短语）  
- `-C` 允许压缩。（将 -C 标志传递给 ssh，从而打开压缩功能）  
- `-p` 保留原文件的修改时间，访问时间和访问权限。  
- `-q` 不显示传输进度条。  
- `-r` 递归复制整个目录。  
- `-v` 详细方式显示输出。scp 和 ssh(1) 会显示出整个过程的调试信息。这些信息用于调试连接，验证和配置问题。   
- `-c` cipher 以 cipher 将数据传输进行加密，这个选项将直接传递给 ssh。   
- `-F` ssh_config 指定一个替代的 ssh 配置文件，此参数直接传递给 ssh。  
- `-i` identity_file 从指定文件中读取传输时使用的密钥文件，此参数直接传递给 ssh。    
- `-l` limit 限定用户所能使用的带宽，以 Kbit/s 为单位。     
- `-o` ssh_option 如果习惯于使用 ssh_config(5) 中的参数传递方式，   
- `-P` port 注意是大写的 P， port 是指定数据传输用到的端口号   
- `-S` program 指定加密传输时所使用的程序。此程序必须能够理解 ssh(1) 的选项。

**例子**

```sh
#获取远程服务器上的文件
scp root@localhost:/root/test.txt ~/test.txt
#获取远程服务器上的目录
scp -r root@localhost:/root/test ~/test
#将本地文件上传到服务器上
scp ~/test.txt root@localhost:/root/test.txt
#将本地目录上传到服务器上
scp ~/test root@localhost:/root/test
```

## 提取

```sh
tar xjf    *.tar.bz2
tar xzf    *.tar.gz
bunzip2    *.bz2
unrar e    *.rar
gunzip     *.gz
tar xf     *.tar
tar xjf    *.tbz2
tar xzf    *.tgz
unzip      *.zip
uncompress *.Z
7z x       *.7z
tar xvJf   *.tar.xz 
```

## source

`source` 命令也称为 “点命令”，也就是一个点符号（.）。`source` 命令通常用于重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录。

```sh
source filename
. filename
```

## ls 显示时间

```sh
ls -lc #最后更改时间
ls -u  #最后存取时间
ls -l  #最后修改时间
ls --time-style '+%Y/%m/%d %H:%M:%S'  #时间格式
```

## 创建多级目录

```sh
mkdir -p /tmp/tmp1/tmp2
```

## 生成指定大小的文件

```sh
* 生成一个 5G 文件
dd if=/dev/zero of=tmp.5G bs=1G count=5
* if=FILE : 指定输入文件，若不指定则从标注输入读取。这里指定为 /dev/zero 是 Linux 的一个伪文件，它可以产生连续不断的 null 流（二进制的 0）
* of=FILE : 指定输出文件，若不指定则输出到标准输出
* bs=BYTES : 每次读写的字节数，可以使用单位 K、M、G 等等。另外输入输出可以分别用 ibs、obs 指定，若使用 bs，则表示是 ibs 和 obs 都是用该参数
* count=BLOCKS : 读取的 block 数，block 的大小由 ibs 指定（只针对输入参数）
```

## SSH

`ssh -o ServerAliveInterval=60 user@host`

## tail

命令从指定点开始将文件写到标准输出

```sh
tail[必要参数][选择参数][文件]
```

**参数**

- `-f` 循环读取
- `-q` 不显示处理信息
- `-v` 显示详细的处理信息
- `-c` <数目> 显示的字节数
- `-n` <行数> 显示行数
- `--pid=PID` 与 `-f` 合用, 表示在进程 ID,PID 死掉之后结束. 
- `-q`, `--quiet`, `--silent` 从不输出给出文件名的首部 
- `-s`, `--sleep-interval=S` 与 `-f` 合用, 表示在每次反复的间隔休眠 S 秒 

## chmod

改变文件或目录的访问权限

```sh
chmod [-cfvR] [--help] [--version] mode file
```

**参数**

- `-c` 当发生改变时，报告处理信息
- `-f` 错误信息不输出
- `-R` 处理指定目录以及其子目录下的所有文件
- `-v` 运行时显示详细处理信息
- `--reference=<目录或者文件>` 设置成具有指定目录或者文件具有相同的权限
- `--version` 显示版本信息
- `<权限范围>+<权限设置>` 使权限范围内的目录或者文件具有指定的权限
- `<权限范围>-<权限设置>` 删除权限范围的目录或者文件的指定权限
- `<权限范围>=<权限设置>` 设置权限范围内的目录或者文件的权限为指定的值

**权限范围**

- `u` 目录或者文件的当前的用户
- `g` 目录或者文件的当前的群组
- `o` 除了目录或者文件的当前用户或群组之外的用户或者群组
- `a` 所有的用户及群组

**权限代号**

- `r` 读权限，用数字 4 表示
- `w` 写权限，用数字 2 表示
- `x` 执行权限，用数字 1 表示
- `-` 删除权限，用数字 0 表示
- `s` 特殊权限 

## chown

改变文件的拥有者和群组

```sh
chown [选项] [所有者][:[组]] 文件
```

**参数**

- `-c` 显示更改的部分的信息
- `-f` 忽略错误信息
- `-h` 修复符号链接
- `-R` 处理指定目录以及其子目录下的所有文件
- `-v `显示详细的处理信息
- `-deference `作用于符号链接的指向，而不是链接文件本身
- `--reference=<目录或文件> `把指定的目录/文件作为参考，把操作的文件/目录设置成参考文件/目录相同拥有者和群组
- `--from=<当前用户：当前群组> `只有当前用户和群组跟指定的用户和群组相同时才进行改变
- `--help `显示帮助信息
- `--version `显示版本信息

## test

检查某个条件是否成立

```sh
test [选项] [文件|数值|字符串]
```

**参数**

- 文件
  - `-e` 如果文件存在则为真
  - `-r` 如果文件存在且可读则为真
  - `-w` 如果文件存在且可写则为真
  - `-x` 如果文件存在且可执行则为真
  - `-s` 如果文件存在且至少有一个字符则为真
  - `-d` 如果文件存在且为目录则为真
  - `-f` 如果文件存在且为普通文件则为真
  - `-c` 如果文件存在且为字符型特殊文件则为真
  - `-b` 如果文件存在且为块特殊文件则为真
- 数值
  - `-eq` 等于则为真
  - `-ne` 不等于则为真
  - `-gt` 大于则为真
  - `-ge` 大于等于则为真
  - `-lt` 小于则为真
  - `-le` 小于等于则为真
- 字符串
  - `=`  等于则为真
  - `!=` 不相等则为真
  - `-z` 字符串的长度为零则为真
  - `-n` 字符串的长度不为零则为真

## expect

处理交互命令

- `send` 向进程发送字符串
- `expect` 从进程接收字符串
- `spawn` 启动新的进程
- `interact` 允许用户交互

## find

```
find <指定目录> <指定条件> <指定动作>
```

## 文件夹挂载

```
# 手动挂载
mount [-t vfstype] [-o options] device dir
# 取消挂载
umount -f dir
```

- 光盘或光盘镜像：`iso9660`
- DOS fat16文件系统：`msdos`
- Windows 9x fat32文件系统：`vfat `
- Windows NT ntfs文件系统：`ntfs`
- Mount Windows文件网络共享：`smbfs`
- UNIX(LINUX) 文件网络共享：`nfs`

## grep

```
-a                        不要忽略二进制数据。
-A<显示列数>              除了显示符合范本样式的那一行之外，并显示该行之后的内容。
-b                        在显示符合范本样式的那一行之外，并显示该行之前的内容。
-c                        计算符合范本样式的列数。
-C<显示列数>或-<显示列数> 除了显示符合范本样式的那一列之外，并显示该列之前后的内容。
-d<进行动作>              当指定要查找的是目录而非文件时，必须使用这项参数，否则grep命令将回报信息并停止动作。
-e<范本样式>              指定字符串作为查找文件内容的范本样式。
-E                        将范本样式为延伸的普通表示法来使用，意味着使用能使用扩展正则表达式。
-f<范本文件>              指定范本文件，其内容有一个或多个范本样式，让grep查找符合范本条件的文件内容，格式为每一列的范本样式。
-F                        将范本样式视为固定字符串的列表。
-G                        将范本样式视为普通的表示法来使用。
-h                        在显示符合范本样式的那一列之前，不标示该列所属的文件名称。
-H                        在显示符合范本样式的那一列之前，标示该列的文件名称。
-i                        忽略字符大小写的差别。
-l                        列出文件内容符合指定的范本样式的文件名称。
-L                        列出文件内容不符合指定的范本样式的文件名称。
-n                        在显示符合范本样式的那一列之前，标示出该列的编号。
-q                        不显示任何信息。
-R/-r                     此参数的效果和指定“-d recurse”参数相同。
-s                        不显示错误信息。
-v                        反转查找。
-w                        只显示全字符合的列。
-x                        只显示全列符合的列。
-y                        此参数效果跟“-i”相同。
-o                        只输出文件中匹配到的部分。
```

## 用户

### 创建用户

#### adduser

会自动为创建的用户指定主目录、系统 shell 版本，会在创建时输入用户密码

```
adduser username
```

#### useradd

需要使用参数选项指定上述基本设置，如果不使用任何参数，则创建的用户无密码、无主目录、没有指定 shell 版本

```
useradd [option] username
```

**[option]**

- `-d <登入目录>` 指定用户登入时的目录。
- `-g <群组>`     初始群组。
- `-G <群组>`     非初始群组。
- `-m`            自动创建用户的家目录。
- `-M`            不要创建用户的家目录。
- `-N`            不要创建以用户名称为名的群组。
- `-s`            指定用户登入后所使用的shell。

### 删除用户

#### userdel

```
# 只删除用户名
userdel username
# 连同用户主目录一块删除
userdel -r username
```

## 时间

```
# 时间戳转时间
date -d @时间戳

# 时间转时间戳
date -d '时间' +%s
```
