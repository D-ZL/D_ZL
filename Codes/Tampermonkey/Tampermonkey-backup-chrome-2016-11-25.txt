{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Google: Bypass Result Page Redirect","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["/^https?://(?:encrypted|www)\\.google\\.[^/]+/(?:$|[#?]|search|webhp|imgres)/"],"orig_matches":["https://news.google.com/*","https://cse.google.com/cse/*"],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1475148528069,"data":{}},"enabled":true,"position":1,"file_url":"https://greasyfork.org/scripts/14150-google-%E7%BB%95%E8%BF%87%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E7%BD%91%E9%A1%B5%E9%93%BE%E6%8E%A5%E9%87%8D%E5%AE%9A%E5%90%91/code/Google%EF%BC%9A%E7%BB%95%E8%BF%87%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E7%BD%91%E9%A1%B5%E9%93%BE%E6%8E%A5%E9%87%8D%E5%AE%9A%E5%90%91.user.js","uuid":"c65f0816-cf1f-429d-a2a7-50681993d6f3","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWVzcGFjZSAgIFZBX2kKLy8gQHZlcnNpb24gICAgIDUuMC4yLjIwMTYwNTAzCi8vIEBncmFudCAgICAgICBub25lCi8vIEBpbmNsdWRlICAgICAvXmh0dHBzPzovLyg/OmVuY3J5cHRlZHx3d3cpXC5nb29nbGVcLlteL10rLyg/OiR8WyM/XXxzZWFyY2h8d2ViaHB8aW1ncmVzKS8KLy8gQG1hdGNoICAgICAgIGh0dHBzOi8vbmV3cy5nb29nbGUuY29tLyoKLy8gQG1hdGNoICAgICAgIGh0dHBzOi8vY3NlLmdvb2dsZS5jb20vY3NlLyoKLy8gQHJ1bi1hdCAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBuYW1lICAgICAgICBHb29nbGU6IEJ5cGFzcyBSZXN1bHQgUGFnZSBSZWRpcmVjdAovLyBAbmFtZTp6aC1DTiAgR29vZ2xl77ya57uV6L+H5pCc57Si57uT5p6c572R6aG16ZO+5o6l6YeN5a6a5ZCRCi8vIEBuYW1lOnpoLVRXICBHb29nbGXvvJrnuZ7pgY7mkJzlsIvntZDmnpzntrLpoIHpj4jmjqXph43lrprlkJEKLy8gQGRlc2NyaXB0aW9uIEF2b2lkIEdvb2dsZSByZWRpcmVjdCBmb3Igc2VhcmNoIHJlc3VsdCBwYWdlcy4KLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOS7pCBHb29nbGUg55u05o6l6ZO+5o6l6Iez5pCc57Si57uT5p6c572R6aG177yM5peg6aG76YeN5a6a5ZCR44CCCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyDku6QgR29vZ2xlIOebtOaOpemPiOaOpeiHs+aQnOWwi+e1kOaenOe2sumgge+8jOeEoemgiOmHjeWumuWQkeOAggovLyA9PS9Vc2VyU2NyaXB0PT0KCnZhciBkZWJ1ZyA9IGZhbHNlOwp2YXIgY291bnQgPSAwOwoKLy8gd2ViIHBhZ2VzOiB1cmw/dXJsPQovLyBjdXN0b20gc2VhcmNoIGVuZ2luZTogdXJsP3E9CnZhciByZSA9IC9cYnVybFw/Lio/XGIoPzp1cmx8cSk9KGh0dHBzP1xiW14mI10rKS9pOwp2YXIgcmVzdG9yZSA9IGZ1bmN0aW9uIChsaW5rLCB1cmwpIHsKICB1cmwgPSB1cmwgfHwgbGluay5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCAnJzsKICB2YXIgbWF0Y2hlcyA9IHVybC5tYXRjaChyZSk7CiAgbGluay5zZXRBdHRyaWJ1dGUoJ2hyZWYnLCBtYXRjaGVzID8gZGVjb2RlVVJJQ29tcG9uZW50KG1hdGNoZXNbMV0pIDogdXJsKTsKfTsKCnZhciBmYWtlTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKdmFyIG5vcm1hbGl6ZVVybCA9IGZ1bmN0aW9uICh1cmwpIHsKICBmYWtlTGluay5ocmVmID0gdXJsOwogIHJldHVybiBmYWtlTGluay5ocmVmOwp9OwoKdmFyIHNldHRlciA9IGZ1bmN0aW9uICh2KSB7CiAgdiA9IFN0cmluZyh2KTsgIC8vIGluIGNhc2UgYW4gb2JqZWN0IGlzIHBhc3NlZCBieSBjbGV2ZXIgR29vZ2xlCiAgZGVidWcgJiYgY29uc29sZS5sb2coJ3NldCcsIHRoaXMuX3hfaWQsIHRoaXMuZ2V0QXR0cmlidXRlKCdocmVmJyksIHYpOwogIHJlc3RvcmUodGhpcywgdik7Cn07CnZhciBnZXR0ZXIgPSBmdW5jdGlvbiAoKSB7CiAgZGVidWcgJiYgY29uc29sZS5sb2coJ2dldCcsIHRoaXMuX3hfaWQsIHRoaXMuZ2V0QXR0cmlidXRlKCdocmVmJykpOwogIHJldHVybiBub3JtYWxpemVVcmwodGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSk7Cn07CnZhciBibG9ja2VyID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgcmVzdG9yZSh0aGlzKTsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnYmxvY2snLCB0aGlzLl94X2lkLCB0aGlzLmdldEF0dHJpYnV0ZSgnaHJlZicpKTsKfTsKCnZhciBoYW5kbGVyID0gZnVuY3Rpb24gKGEpIHsKICBpZiAoYS5feF9pZCkgewogICAgcmV0dXJuOwogIH0KICBhLl94X2lkID0gZGVidWcgPyArK2NvdW50IDogdHJ1ZTsKICBpZiAoT2JqZWN0LmRlZmluZVByb3BlcnR5KSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIHByb3BlcnR5JywgYS5feF9pZCk7CiAgICByZXN0b3JlKGEpOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsICdocmVmJywge2dldDogZ2V0dGVyLCBzZXQ6IHNldHRlcn0pOwogIH0gZWxzZSBpZiAoYS5fX2RlZmluZVNldHRlcl9fKSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIGdldHRlcicsIGEuX3hfaWQpOwogICAgcmVzdG9yZShhKTsKICAgIGEuX19kZWZpbmVTZXR0ZXJfXygnaHJlZicsIHNldHRlcik7CiAgICBhLl9fZGVmaW5lR2V0dGVyX18oJ2hyZWYnLCBnZXR0ZXIpOwogIH0gZWxzZSB7CiAgICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnZGVmaW5lIGxpc3RlbmVyJywgYS5feF9pZCk7CiAgICByZXN0b3JlKGEpOwogICAgYS5vbm1vdXNlZW50ZXIgPSBhLm9ubW91c2Vtb3ZlID0gYS5vbm1vdXNldXAgPSBhLm9ubW91c2Vkb3duID0KICAgICAgYS5vbmRiY2xpY2sgPSBhLm9uY2xpY2sgPSBhLm9uY29udGV4dG1lbnUgPSBibG9ja2VyOwogIH0KfTsKCnZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgW10uc2xpY2UuY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdhW2hyZWZdJykpLmZvckVhY2goaGFuZGxlcik7Cn07Cgp2YXIgdGlkID0gbnVsbDsKdmFyIHByZXYgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwp2YXIgY2hlY2sgPSBmdW5jdGlvbiAobXV0YXRpb24pIHsKICByZXR1cm4gbXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggPiAwOwp9Owp2YXIgY2hlY2tOZXdOb2RlcyA9IGZ1bmN0aW9uIChtdXRhdGlvbnMpIHsKICBtdXRhdGlvbnMuZm9yRWFjaCAmJiBtdXRhdGlvbnMuZm9yRWFjaChjaGVja0F0dHJpYnV0ZSk7CiAgdmFyIG5leHQgPSAobmV3IERhdGUoKSkuZ2V0VGltZSgpOwogIGlmIChuZXh0IC0gcHJldiA+IDEwMDApIHsgIC8vIERvbid0IGxldCBtZSB3YWl0IHRvbyBsb25nLgogICAgcHJldiA9IG5leHQ7CiAgICBjbGVhclRpbWVvdXQodGlkKTsKICAgIHVwZGF0ZSgpOyAgLy8gVGhyb3R0bGUgaXMgd2hhdD8KICB9IGVsc2UgaWYgKCFtdXRhdGlvbnMuc29tZSB8fCBtdXRhdGlvbnMuc29tZShjaGVjaykpIHsKICAgIGNsZWFyVGltZW91dCh0aWQpOwogICAgdGlkID0gc2V0VGltZW91dCh1cGRhdGUsIDIwMCk7CiAgfQp9Owp2YXIgY2hlY2tBdHRyaWJ1dGUgPSBmdW5jdGlvbiAobXV0YXRpb24pIHsKICB2YXIgdGFyZ2V0ID0gbXV0YXRpb24udGFyZ2V0OwogIGlmICh0YXJnZXQgJiYgdGFyZ2V0Lm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdBJyAmJgogICAgICAobXV0YXRpb24uYXR0cmlidXRlTmFtZSB8fCBtdXRhdGlvbi5hdHRyTmFtZSkgPT09ICdocmVmJyAmJgogICAgICByZS50ZXN0KHRhcmdldC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSkpIHsKICAgIGRlYnVnICYmIGNvbnNvbGUubG9nKCdyZXN0b3JlIGF0dHJpYnV0ZScsIHRhcmdldC5feF9pZCwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgnaHJlZicpKTsKICAgIHJlc3RvcmUodGFyZ2V0KTsKICB9Cn07Cgp2YXIgTXV0YXRpb25PYnNlcnZlciA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwoKaWYgKE11dGF0aW9uT2JzZXJ2ZXIpIHsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnTXV0YXRpb25PYnNlcnZlcjogdHJ1ZScpOwogIG5ldyBNdXRhdGlvbk9ic2VydmVyKGNoZWNrTmV3Tm9kZXMpLm9ic2VydmUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCB7CiAgICBjaGlsZExpc3Q6IHRydWUsCiAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgYXR0cmlidXRlRmlsdGVyOiBbJ2hyZWYnXSwKICAgIHN1YnRyZWU6IHRydWUKICB9KTsKfSBlbHNlIHsKICBkZWJ1ZyAmJiBjb25zb2xlLmxvZygnTXV0YXRpb25FdmVudDogdHJ1ZScpOwogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUF0dHJNb2RpZmllZCcsIGNoZWNrQXR0cmlidXRlLCBmYWxzZSk7CiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgY2hlY2tOZXdOb2RlcywgZmFsc2UpOwp9"},{"name":"gwdang","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":["http://*.jd.com/*","https://*.jd.com/*","http://*.taobao.com/*","https://*.taobao.com/*","http://*.tmall.com/*","https://*.tmall.com/*","http://*.yixun.com/*","http://*.51buy.com/*","http://*.amazon.cn/*","http://*.yhd.com/*","http://*.suning.com/*","http://*.dangdang.com/*","http://*.gome.com.cn/*","http://*.newegg.cn/*","http://*.paipai.com/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1475936798635},"enabled":true,"position":2,"file_url":"https://greasyfork.org/scripts/14466-%E8%B4%AD%E7%89%A9%E5%85%9A%E6%AF%94%E4%BB%B7%E5%B7%A5%E5%85%B7/code/%E8%B4%AD%E7%89%A9%E5%85%9A%E6%AF%94%E4%BB%B7%E5%B7%A5%E5%85%B7.user.js","uuid":"5798ff4f-8510-459c-ac62-e880469923c8","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgIGd3ZGFuZwovLyBAbmFtZTp6aC1DTiAgIOi0reeJqeWFmuavlOS7t+W3peWFtwovLyBAbmFtZXNwYWNlICAgbm8KLy8gQGRlc2NyaXB0aW9uIOS6rOS4nC7mt5jlrp0u5aSp54yrLuaYk+i/hS7kuprpqazpgIrkuK3lm70u5LiA5Y+35bqXLuiLj+WugeaYk+i0rS7lvZPlvZPnvZEu5Zu9576O5Zyo57q/LuaWsOibi+e9keS4reWbvS7mi43mi43nvZHoh6rliqjmr5Tku7fjgILkuI3kvJrooqvliKDnmoTniYjmnKzvvIjlpKfmpoIKLy8gQGRlc2NyaXB0aW9uOnpoLUNOIOS6rOS4nC7mt5jlrp0u5aSp54yrLuaYk+i/hS7kuprpqazpgIrkuK3lm70u5LiA5Y+35bqXLuiLj+WugeaYk+i0rS7lvZPlvZPnvZEu5Zu9576O5Zyo57q/LuaWsOibi+e9keS4reWbvS7mi43mi43nvZHoh6rliqjmr5Tku7fjgILkuI3kvJrooqvliKDnmoTniYjmnKzvvIjlpKfmpoLlkKcKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmpkLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwczovLyouamQuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLnRhb2Jhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cHM6Ly8qLnRhb2Jhby5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoudG1hbGwuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHBzOi8vKi50bWFsbC5jb20vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWl4dW4uY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLjUxYnV5LmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5hbWF6b24uY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoueWhkLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5zdW5pbmcuY29tLyoKLy8gQGluY2x1ZGUgICAgIGh0dHA6Ly8qLmRhbmdkYW5nLmNvbS8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5nb21lLmNvbS5jbi8qCi8vIEBpbmNsdWRlICAgICBodHRwOi8vKi5uZXdlZ2cuY24vKgovLyBAaW5jbHVkZSAgICAgaHR0cDovLyoucGFpcGFpLmNvbS8qCi8vIEB2ZXJzaW9uICAgICAxLjEKLy8gQGdyYW50IAkJbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KKGZ1bmN0aW9uKCl7CnZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7cy5zZXRBdHRyaWJ1dGUoJ3NyYycsJ2h0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8xNDQ2NC1nd2QvY29kZS9nd2QuanM/dmVyc2lvbj0xNDkyNjEnKTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHMpOwp9KSgp"},{"name":"為什麼你們就是不能加個空格呢？","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1475150539885,"data":{}},"enabled":true,"position":3,"file_url":"https://greasyfork.org/scripts/2185-%E7%82%BA%E4%BB%80%E9%BA%BC%E4%BD%A0%E5%80%91%E5%B0%B1%E6%98%AF%E4%B8%8D%E8%83%BD%E5%8A%A0%E5%80%8B%E7%A9%BA%E6%A0%BC%E5%91%A2/code/%E7%82%BA%E4%BB%80%E9%BA%BC%E4%BD%A0%E5%80%91%E5%B0%B1%E6%98%AF%E4%B8%8D%E8%83%BD%E5%8A%A0%E5%80%8B%E7%A9%BA%E6%A0%BC%E5%91%A2%EF%BC%9F.user.js","uuid":"1b09c190-b99f-4e0f-b1dd-7a459943f088","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICDngrrku4DpurzkvaDlgJHlsLHmmK/kuI3og73liqDlgIvnqbrmoLzlkaLvvJ8KLy8gQG5hbWVzcGFjZSAgICBodHRwOi8vdmludGEud3MvCi8vIEBkZXNjcmlwdGlvbiAg6Ieq5YuV5Zyo57ay6aCB5Lit5omA5pyJ55qE5Lit5paH5ZKM5Y2K5b2i55qE6Iux5paH44CB5pW45a2X44CB56ym6Jmf5LmL6ZaT5o+S5YWl56m655m944CC77yI5pSk5omL77yJ5rKS6L6m5rOV77yM6JmV5aWz5bqn6YO95pyJ5by36L+r55eH44CCCi8vIEB2ZXJzaW9uICAgICAgMi41LjYKLy8gQGluY2x1ZGUgICAgICAqCi8vCi8vIEBhdXRob3IgICAgICAgVmludGEKLy8gQGhvbWVwYWdlICAgICBodHRwczovL2dpdGh1Yi5jb20vdmludGEvcGFyYW5vaWQtYXV0by1zcGFjaW5nCi8vIEBjb250cmlidXRvciAgaHR0cHM6Ly9naXRodWIuY29tL3ZpbnRhL3BhcmFub2lkLWF1dG8tc3BhY2luZy9ncmFwaHMvY29udHJpYnV0b3JzCi8vIEBsaWNlbnNlICAgICAgVGhlIE1JVCBMaWNlbnNlIChNSVQpOyBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUCi8vID09L1VzZXJTY3JpcHQ9PQoKdmFyIGlzX3NwYWNpbmcgPSBmYWxzZTsKCiFmdW5jdGlvbihhKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gYihhKXtmb3IodmFyIGI9YS5wYXJlbnROb2RlO2ImJmIubm9kZU5hbWUmJi0xPT09Yi5ub2RlTmFtZS5zZWFyY2goL14oaHRtbHxoZWFkfGJvZHl8I2RvY3VtZW50KSQvaSk7KXtpZigidHJ1ZSI9PT1iLmdldEF0dHJpYnV0ZSgiY29udGVudGVkaXRhYmxlIil8fCJ0cnVlIj09PWIuZ2V0QXR0cmlidXRlKCJnX2VkaXRhYmxlIil8fGIubm9kZU5hbWUuc2VhcmNoKGcpPj0wKXJldHVybiEwO2I9Yi5wYXJlbnROb2RlfXJldHVybiExfWZ1bmN0aW9uIGMoYSxiKXtmb3IodmFyIGM9YS5jaGlsZE5vZGVzLGQ9MDtkPGMubGVuZ3RoO2QrKyl7dmFyIGU9Y1tkXTtpZig4IT09ZS5ub2RlVHlwZSYmZS50ZXh0Q29udGVudClyZXR1cm4gZT09PWJ9fWZ1bmN0aW9uIGQoYSxiKXtmb3IodmFyIGM9YS5jaGlsZE5vZGVzLGQ9Yy5sZW5ndGgtMTtkPi0xO2QtLSl7dmFyIGU9Y1tkXTtpZig4IT09ZS5ub2RlVHlwZSYmZS50ZXh0Q29udGVudClyZXR1cm4gZT09PWJ9fWZ1bmN0aW9uIGUoYSl7dmFyIGIsYz1hO3JldHVybiBhPWEucmVwbGFjZSgvKFtcdTJlODAtXHUyZWZmXHUyZjAwLVx1MmZkZlx1MzA0MC1cdTMwOWZcdTMwYTAtXHUzMGZmXHUzMTAwLVx1MzEyZlx1MzIwMC1cdTMyZmZcdTM0MDAtXHU0ZGJmXHU0ZTAwLVx1OWZmZlx1ZjkwMC1cdWZhZmZdKShbIl0pL2dpLCIkMSAkMiIpLGE9YS5yZXBsYWNlKC8oWyJdKShbXHUyZTgwLVx1MmVmZlx1MmYwMC1cdTJmZGZcdTMwNDAtXHUzMDlmXHUzMGEwLVx1MzBmZlx1MzEwMC1cdTMxMmZcdTMyMDAtXHUzMmZmXHUzNDAwLVx1NGRiZlx1NGUwMC1cdTlmZmZcdWY5MDAtXHVmYWZmXSkvZ2ksIiQxICQyIiksYT1hLnJlcGxhY2UoLyhbIidcKFxbXHs8XHUyMDFjXSspKFxzKikoLis/KShccyopKFsiJ1wpXF1cfT5cdTIwMWRdKykvZ2ksIiQxJDMkNSIpLGE9YS5yZXBsYWNlKC8oW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pKCApKCcpKFthLXpdKS9naSwiJDEkMyQ0IiksYT1hLnJlcGxhY2UoLyhbXHUyZTgwLVx1MmVmZlx1MmYwMC1cdTJmZGZcdTMwNDAtXHUzMDlmXHUzMGEwLVx1MzBmZlx1MzEwMC1cdTMxMmZcdTMyMDAtXHUzMmZmXHUzNDAwLVx1NGRiZlx1NGUwMC1cdTlmZmZcdWY5MDAtXHVmYWZmXSkoIyhcUyspKS9naSwiJDEgJDIiKSxhPWEucmVwbGFjZSgvKChcUyspIykoW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pL2dpLCIkMSAkMyIpLGE9YS5yZXBsYWNlKC8oW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pKFtcK1wtXCpcLz0mXFx8PD5dKShbYS16MC05XSkvZ2ksIiQxICQyICQzIiksYT1hLnJlcGxhY2UoLyhbYS16MC05XSkoW1wrXC1cKlwvPSZcXHw8Pl0pKFtcdTJlODAtXHUyZWZmXHUyZjAwLVx1MmZkZlx1MzA0MC1cdTMwOWZcdTMwYTAtXHUzMGZmXHUzMTAwLVx1MzEyZlx1MzIwMC1cdTMyZmZcdTM0MDAtXHU0ZGJmXHU0ZTAwLVx1OWZmZlx1ZjkwMC1cdWZhZmZdKS9naSwiJDEgJDIgJDMiKSxjPWEsYj1jLnJlcGxhY2UoLyhbXHUyZTgwLVx1MmVmZlx1MmYwMC1cdTJmZGZcdTMwNDAtXHUzMDlmXHUzMGEwLVx1MzBmZlx1MzEwMC1cdTMxMmZcdTMyMDAtXHUzMmZmXHUzNDAwLVx1NGRiZlx1NGUwMC1cdTlmZmZcdWY5MDAtXHVmYWZmXSkoW1woXFtcezxcdTIwMWNdKyguKj8pW1wpXF1cfT5cdTIwMWRdKykoW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pL2dpLCIkMSAkMiAkNCIpLGE9YixjPT09YiYmKGE9YS5yZXBsYWNlKC8oW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pKFtcKFxbXHs8XHUyMDFjPl0pL2dpLCIkMSAkMiIpLGE9YS5yZXBsYWNlKC8oW1wpXF1cfT5cdTIwMWQ8XSkoW1x1MmU4MC1cdTJlZmZcdTJmMDAtXHUyZmRmXHUzMDQwLVx1MzA5Zlx1MzBhMC1cdTMwZmZcdTMxMDAtXHUzMTJmXHUzMjAwLVx1MzJmZlx1MzQwMC1cdTRkYmZcdTRlMDAtXHU5ZmZmXHVmOTAwLVx1ZmFmZl0pL2dpLCIkMSAkMiIpKSxhPWEucmVwbGFjZSgvKFtcKFxbXHs8XHUyMDFjXSspKFxzKikoLis/KShccyopKFtcKVxdXH0+XHUyMDFkXSspL2dpLCIkMSQzJDUiKSxhPWEucmVwbGFjZSgvKFtcdTJlODAtXHUyZWZmXHUyZjAwLVx1MmZkZlx1MzA0MC1cdTMwOWZcdTMwYTAtXHUzMGZmXHUzMTAwLVx1MzEyZlx1MzIwMC1cdTMyZmZcdTM0MDAtXHU0ZGJmXHU0ZTAwLVx1OWZmZlx1ZjkwMC1cdWZhZmZdKShbfiE7OixcLlw/XHUyMDI2XSkoW2EtejAtOV0pL2dpLCIkMSQyICQzIiksYT1hLnJlcGxhY2UoLyhbXHUyZTgwLVx1MmVmZlx1MmYwMC1cdTJmZGZcdTMwNDAtXHUzMDlmXHUzMGEwLVx1MzBmZlx1MzEwMC1cdTMxMmZcdTMyMDAtXHUzMmZmXHUzNDAwLVx1NGRiZlx1NGUwMC1cdTlmZmZcdWY5MDAtXHVmYWZmXSkoW2EtejAtOWBcJCVcXiZcKlwtPVwrXFxcfC9AXHUwMGExLVx1MDBmZlx1MjAyMlx1MjAyN1x1MjE1MC1cdTIxOGZdKS9naSwiJDEgJDIiKSxhPWEucmVwbGFjZSgvKFthLXowLTlgflwkJVxeJlwqXC09XCtcXFx8LyE7OixcLlw/XHUwMGExLVx1MDBmZlx1MjAyMlx1MjAyNlx1MjAyN1x1MjE1MC1cdTIxOGZdKShbXHUyZTgwLVx1MmVmZlx1MmYwMC1cdTJmZGZcdTMwNDAtXHUzMDlmXHUzMGEwLVx1MzBmZlx1MzEwMC1cdTMxMmZcdTMyMDAtXHUzMmZmXHUzNDAwLVx1NGRiZlx1NGUwMC1cdTlmZmZcdWY5MDAtXHVmYWZmXSkvZ2ksIiQxICQyIil9ZnVuY3Rpb24gZihhLGYpe2Y9Znx8ZG9jdW1lbnQ7Zm9yKHZhciBrLGw9ITEsbT1kb2N1bWVudC5ldmFsdWF0ZShhLGYsbnVsbCxYUGF0aFJlc3VsdC5PUkRFUkVEX05PREVfU05BUFNIT1RfVFlQRSxudWxsKSxuPW0uc25hcHNob3RMZW5ndGgsbz1uLTE7bz4tMTstLW8pe3ZhciBwPW0uc25hcHNob3RJdGVtKG8pO2lmKGIocCkpaz1wO2Vsc2V7dmFyIHE9ZShwLmRhdGEpO2lmKHAuZGF0YSE9PXEmJihsPSEwLHAuZGF0YT1xKSxrKXtpZihwLm5leHRTaWJsaW5nJiZwLm5leHRTaWJsaW5nLm5vZGVOYW1lLnNlYXJjaChpKT49MCl7az1wO2NvbnRpbnVlfXZhciByPXAuZGF0YS50b1N0cmluZygpLnN1YnN0cigtMSkray5kYXRhLnRvU3RyaW5nKCkuc3Vic3RyKDAsMSkscz1lKHIpO2lmKHIhPT1zKXtsPSEwO2Zvcih2YXIgdD1rO3QucGFyZW50Tm9kZSYmLTE9PT10Lm5vZGVOYW1lLnNlYXJjaChoKSYmYyh0LnBhcmVudE5vZGUsdCk7KXQ9dC5wYXJlbnROb2RlO2Zvcih2YXIgdT1wO3UucGFyZW50Tm9kZSYmLTE9PT11Lm5vZGVOYW1lLnNlYXJjaChoKSYmZCh1LnBhcmVudE5vZGUsdSk7KXU9dS5wYXJlbnROb2RlO2lmKHUubmV4dFNpYmxpbmcmJnUubmV4dFNpYmxpbmcubm9kZU5hbWUuc2VhcmNoKGkpPj0wKXtrPXA7Y29udGludWV9aWYoLTE9PT11Lm5vZGVOYW1lLnNlYXJjaChqKSlpZigtMT09PXQubm9kZU5hbWUuc2VhcmNoKGgpKS0xPT09dC5ub2RlTmFtZS5zZWFyY2goZykmJi0xPT09dC5ub2RlTmFtZS5zZWFyY2goaikmJihrLnByZXZpb3VzU2libGluZz8tMT09PWsucHJldmlvdXNTaWJsaW5nLm5vZGVOYW1lLnNlYXJjaChpKSYmKGsuZGF0YT0iICIray5kYXRhKTpiKGspfHwoay5kYXRhPSIgIitrLmRhdGEpKTtlbHNlIGlmKC0xPT09dS5ub2RlTmFtZS5zZWFyY2goaCkpcC5kYXRhPXAuZGF0YSsiICI7ZWxzZXt2YXIgdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwYW5ndSIpO3YuaW5uZXJIVE1MPSIgIix0LnByZXZpb3VzU2libGluZz8tMT09PXQucHJldmlvdXNTaWJsaW5nLm5vZGVOYW1lLnNlYXJjaChpKSYmdC5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh2LHQpOnQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodix0KSx2LnByZXZpb3VzRWxlbWVudFNpYmxpbmd8fHYucGFyZW50Tm9kZSYmdi5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHYpfX19az1wfX1yZXR1cm4gbH12YXIgZz0vXihjb2RlfHByZXx0ZXh0YXJlYSkkL2ksaD0vXihhfGRlbHxwcmV8c3xzdHJpa2V8dSkkL2ksaT0vXihicnxocnxpfGltZ3xwYW5ndSkkL2ksaj0vXihkaXZ8aDF8aDJ8aDN8aDR8aDV8aDZ8cCkkL2k7YS50ZXh0X3NwYWNpbmc9ZnVuY3Rpb24oYSl7cmV0dXJuIGUoYSl9LGEucGFnZV90aXRsZV9zcGFjaW5nPWZ1bmN0aW9uKCl7dmFyIGE9Ii9odG1sL2hlYWQvdGl0bGUvdGV4dCgpIixiPWYoYSk7cmV0dXJuIGJ9LGEucGFnZV9zcGFjaW5nPWZ1bmN0aW9uKCl7dmFyIGI9YS5wYWdlX3RpdGxlX3NwYWNpbmcoKSxjPSIvaHRtbC9ib2R5Ly8qL3RleHQoKVtub3JtYWxpemUtc3BhY2UoLildIjtbInNjcmlwdCIsInN0eWxlIiwidGV4dGFyZWEiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe2MrPSdbdHJhbnNsYXRlKG5hbWUoLi4pLCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiIsImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IikhPSInK2ErJyJdJ30pO3ZhciBkPWYoYyk7cmV0dXJuIGJ8fGR9LGEubm9kZV9zcGFjaW5nPWZ1bmN0aW9uKGEpe3ZhciBiPSIuLy8qL3RleHQoKVtub3JtYWxpemUtc3BhY2UoLildIjtbInNjcmlwdCIsInN0eWxlIiwidGV4dGFyZWEiXS5mb3JFYWNoKGZ1bmN0aW9uKGEpe2IrPSdbdHJhbnNsYXRlKG5hbWUoLi4pLCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiIsImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IikhPSInK2ErJyJdJ30pO3ZhciBjPWYoYixhKTtyZXR1cm4gY30sYS5lbGVtZW50X3NwYWNpbmc9ZnVuY3Rpb24oYSl7dmFyIGI7aWYoMD09PWEuaW5kZXhPZigiIyIpKXt2YXIgYz1hLnNsaWNlKDEpO2I9J2lkKCInK2MrJyIpLy90ZXh0KCknfWVsc2UgaWYoMD09PWEuaW5kZXhPZigiLiIpKXt2YXIgZD1hLnNsaWNlKDEpO2I9Jy8vKltjb250YWlucyhjb25jYXQoIiAiLCBub3JtYWxpemUtc3BhY2UoQGNsYXNzKSwgIiAiKSwgIicrZCsnIildLy90ZXh0KCknfWVsc2V7dmFyIGU9YTtiPSIvLyIrZSsiLy90ZXh0KCkifXZhciBnPWYoYik7cmV0dXJuIGd9fSh3aW5kb3cucGFuZ3U9d2luZG93LnBhbmd1fHx7fSk7CgpmdW5jdGlvbiBnb19zcGFjaW5nKCkgewogICAgaXNfc3BhY2luZyA9IHRydWU7CiAgICBwYW5ndS5wYWdlX3NwYWNpbmcoKTsKICAgIGlzX3NwYWNpbmcgPSBmYWxzZTsKfQoKZ29fc3BhY2luZygpOwoKZnVuY3Rpb24gaW5zZXJ0ZWRfZ29fc3BhY2luZyhub2RlKSB7CiAgICBpc19zcGFjaW5nID0gdHJ1ZTsKICAgIHBhbmd1Lm5vZGVfc3BhY2luZyhub2RlKTsKICAgIGlzX3NwYWNpbmcgPSBmYWxzZTsKfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgZnVuY3Rpb24oZSkgewogICAgaWYgKCFpc19zcGFjaW5nKSB7CiAgICAgICAgaW5zZXJ0ZWRfZ29fc3BhY2luZyhlLnRhcmdldCk7CiAgICB9Cn0sIGZhbHNlKTsK"},{"name":"Bypass Wait, Code & Login on Websites","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":["http://d.119g.com/*","http://123564.com/*","http://m.123564.com/*","http://www.5xfile.com/*","http://7958.com/*","http://*.7958.com/*","http://qjwm.com/*","http://*.qjwm.com/*","http://www.9pan.net/*","http://*.www.9pan.net/*","http://yun.baidu.com/*","http://*.yun.baidu.com/*","http://pan.baidu.com/*","http://*.pan.baidu.com/*","http://bx0635.com/*","http://*.bx0635.com/*","http://colayun.com/*","http://*.colayun.com/*","http://colafile.com/*","http://*.colafile.com/*","http://coladrive.com/*","http://*.coladrive.com/*","http://400gb.com/*","http://*.400gb.com/*","http://ctdisk.com/*","http://*.ctdisk.com/*","http://pipipan.com/*","http://*.pipipan.com/*","http://bego.cc/*","http://*.bego.cc/*","http://ctfile.com/*","http://*.ctfile.com/*","http://t00y.com/*","http://*.t00y.com/*","http://dlkoo.com/*","http://*.dlkoo.com/*","http://howfile.com/*","http://*.howfile.com/*","http://www.lepan.cc/*","http://www.sx566.com/*","http://rayfile.com/*","http://*.rayfile.com/*","http://sudupan.com/*","http://*.sudupan.com/*","http://vdisk.cn/*","http://*.vdisk.cn/*","http://yimuhe.com/*","http://*.yimuhe.com/*","http://douban.fm/*","http://jing.fm/*","http://moe.fm/*","http://fm.qq.com/*","http://music.163.com/*","http://www.1ting.com/*","http://www.565656.com/*","http://5sing.com/*","http://*.5sing.com/*","http://5sing.kugou.com/*","http://*.5sing.kugou.com/*","http://www.9ku.com/*","http://music.baidu.com/*","http://play.baidu.com/*","http://*.play.baidu.com/*","http://yinyueyun.baidu.com/*","http://www.djcc.com/*","http://www.djkk.com/*","http://www.djye.com/*","http://music.douban.com/*","http://www.duole.com/*","http://ear.duomi.com/*","http://web.kugou.com/*","http://kugou.com/*","http://www.kugou.com/*","http://oyinyue.com/*","http://*.oyinyue.com/*","http://y.qq.com/*","http://*.y.qq.com/*","http://i.y.qq.com/*","http://*.i.y.qq.com/*","http://fm.qq.com/*","http://*.fm.qq.com/*","http://y.qq.com/*","http://soso.music.qq.com/*","http://songtaste.com/*","http://*.songtaste.com/*","http://www.xiami.com/*","http://yinyuetai.com/*","http://*.yinyuetai.com/*","http://79pan.com/*","http://*.79pan.com/*","http://03xg.com/*","http://*.03xg.com/*","http://7mv.cc/*","http://*.7mv.cc/*","http://pan.52zz.org/*","http://*.pan.52zz.org/*","http://258pan.com/*","http://*.258pan.com/*","http://huimeiku.com/*","http://*.huimeiku.com/*","http://wpan.cc/*","http://*.wpan.cc/*","http://ypan.cc/*","http://*.ypan.cc/*","http://azpan.com/*","http://*.azpan.com/*","http://gxdisk.com/*","http://*.gxdisk.com/*","http://2kuai.com/*","http://*.2kuai.com/*","http://1wp.me/*","http://*.1wp.me/*","http://77pan.cc/*","http://*.77pan.cc/*","http://vvpan.com/*","http://*.vvpan.com/*","http://fmdisk.com/*","http://*.fmdisk.com/*","http://bx0635.com/*","http://*.bx0635.com/*","http://10pan.cc/*","http://*.10pan.cc/*","http://1pan.cc/*","http://*.1pan.cc/*","http://123wzwp.com/*","http://*.123wzwp.com/*","http://wwp5.com/*","http://*.wwp5.com/*","http://fydisk.com/*","http://*.fydisk.com/*","https://jixunmoe.github.io/cuwcl4c/config/"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{},"ts":1475936798678},"enabled":true,"position":4,"file_url":"https://greasyfork.org/scripts/2600-%E8%B7%B3%E8%BF%87%E7%BD%91%E7%AB%99%E7%AD%89%E5%BE%85-%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%8A%E7%99%BB%E5%BD%95/code/%E8%B7%B3%E8%BF%87%E7%BD%91%E7%AB%99%E7%AD%89%E5%BE%85%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81%E5%8F%8A%E7%99%BB%E5%BD%95.user.js","uuid":"b11f85fc-9f3f-43c3-b1b6-3671fe3d4695","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQGdyYW50ICAgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAZ3JhbnQgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QKLy8gQGdyYW50ICAgICAgICAgIEdNX29wZW5JblRhYgovLyBAZ3JhbnQgICAgICAgICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAZ3JhbnQgICAgICAgICAgR01fZ2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICAgICBHTV9pbmZvCgovLyBAcnVuLWF0ICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQG5hbWU6ZW4gICAgICAgIEJ5cGFzcyBXYWl0LCBDb2RlICYgTG9naW4gb24gV2Vic2l0ZXMKLy8gQG5hbWUgICAgICAgICAgIOi3s+i/h+e9keermeetieW+heOAgemqjOivgeeggeWPiueZu+W9lQovLyBAbmFtZTp6aC1DTiAgICAg6Lez6L+H572R56uZ562J5b6F44CB6aqM6K+B56CB5Y+K55m75b2VCi8vIEBuYW1lOnpoLVRXICAgICDnuZ7pgY7nq5npu57nrYnlvoXjgIHorZjliKXnorzlj4rnmbvpjIQKCi8vIEBkZXNjcmlwdGlvbiAgICAgICDnp7vpmaTlkITnsbvnvZHnq5npqozor4HnoIHjgIHnmbvlvZXjgIHlgJLorqHml7blj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjp6aC1DTiDnp7vpmaTlkITnsbvnvZHnq5npqozor4HnoIHjgIHnmbvlvZXjgIHlgJLorqHml7blj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyDnp7vpmaTlkITpoZ7nq5npu57orZjliKXnorzjgIHnmbvpjITjgIHlgJLoqIjmmYLlj4rmm7TlpJohCi8vIEBkZXNjcmlwdGlvbjplbiAgICBSZW1vdmUgdmVyaWZ5IGNvZGUsIGxvZ2luIHJlcXVpcmVtZW50LCBjb3VudGluZyBkb3duLi4uIGFuZCBtb3JlIQoKCi8vIEBjb3B5cmlnaHQgICAgICAyMDE0KywgWXVsZWksIE1vZCBieSBKaXh1bi4KLy8vLyAgICAgICAgICAgICAgIEJhc2VkIG9uIFtDcmFjayBVcmwgV2FpdCBDb2RlIExvZ2luXSBCeSBZdWxlaQoKLy8g6YG/5YWNIFNvdXJjZSBNYXAg5paH5Lu25om+5LiN5Yiw55qE6ZSZ6K+vCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS9qcXVlcnkvMi4xLjQvanF1ZXJ5LmpzCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS91bmRlcnNjb3JlLmpzLzEuOC4zL3VuZGVyc2NvcmUuanMKCi8vLyBDcnlwdG9KUyDnm7jlhbPlupMKLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vY2RuLmJvb3Rjc3MuY29tL2NyeXB0by1qcy8zLjEuMi9jb21wb25lbnRzL2NvcmUtbWluLmpzCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2Nkbi5ib290Y3NzLmNvbS9jcnlwdG8tanMvMy4xLjIvY29tcG9uZW50cy9lbmMtYmFzZTY0LW1pbi5qcwovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9jZG4uYm9vdGNzcy5jb20vY3J5cHRvLWpzLzMuMS4yL2NvbXBvbmVudHMvbWQ1LW1pbi5qcwovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzY2OTYvY29kZS9DcnlwdG9KUy1CeXRlQXJyYXkuanMKCi8vLyDpnZ7lkIzmraXmnprkuL4KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy8zNTg4LWludGVydmFsLWxvb3Blci9jb2RlL0ludGVydmFsLUxvb3Blci5qcwoKLy8vIOWFvOWuuSBHTSAxLngsIDIueAovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzI1OTkvY29kZS9nbTItcG9ydC12MTA0LmpzCgovLy8gQXJpYTIgUlBDCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvNTY3Mi9jb2RlL0FyaWEyLVJQQy1idWlsZC0xMC5qcwoKLy8gQGF1dGhvciAgICAgICAgIEppeHVuLk1vZTxZZWxsb3cgWW9zaGk+Ci8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vaml4dW4ub3JnLwovLyBAdmVyc2lvbiAgICAgICAgMy4wLjU3NQoKLy8g5bCd6K+V5L2/55So6ISa5pys55Sf5oiQ5Yy56YWN6KeE5YiZCgovLyBAaW5jbHVkZSBodHRwOi8vZC4xMTlnLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8xMjM1NjQuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL20uMTIzNTY0LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuNXhmaWxlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly83OTU4LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjc5NTguY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3Fqd20uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoucWp3bS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LjlwYW4ubmV0LyoKLy8gQGluY2x1ZGUgaHR0cDovLyoud3d3LjlwYW4ubmV0LyoKLy8gQGluY2x1ZGUgaHR0cDovL3l1bi5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi55dW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3Bhbi5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wYW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2J4MDYzNS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5ieDA2MzUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2NvbGF5dW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY29sYXl1bi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vY29sYWZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY29sYWZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2NvbGFkcml2ZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5jb2xhZHJpdmUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzQwMGdiLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjQwMGdiLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9jdGRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouY3RkaXNrLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9waXBpcGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnBpcGlwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2JlZ28uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi5iZWdvLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL2N0ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5jdGZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3QwMHkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudDAweS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vZGxrb28uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouZGxrb28uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2hvd2ZpbGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouaG93ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmxlcGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5zeDU2Ni5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vcmF5ZmlsZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5yYXlmaWxlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zdWR1cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnN1ZHVwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3ZkaXNrLmNuLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudmRpc2suY24vKgovLyBAaW5jbHVkZSBodHRwOi8veWltdWhlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnlpbXVoZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vZG91YmFuLmZtLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ppbmcuZm0vKgovLyBAaW5jbHVkZSBodHRwOi8vbW9lLmZtLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9tdXNpYy4xNjMuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy4xdGluZy5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LjU2NTY1Ni5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vNXNpbmcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouNXNpbmcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzVzaW5nLmt1Z291LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjVzaW5nLmt1Z291LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuOWt1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9tdXNpYy5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vcGxheS5iYWlkdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wbGF5LmJhaWR1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95aW55dWV5dW4uYmFpZHUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5kamNjLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cuZGpray5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmRqeWUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL211c2ljLmRvdWJhbi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vd3d3LmR1b2xlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9lYXIuZHVvbWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3dlYi5rdWdvdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8va3Vnb3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3d3dy5rdWdvdS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vb3lpbnl1ZS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5veWlueXVlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95LnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnkucXEuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2kueS5xcS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5pLnkucXEuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLmZtLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly95LnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zb3NvLm11c2ljLnFxLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9zb25ndGFzdGUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouc29uZ3Rhc3RlLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cueGlhbWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3lpbnl1ZXRhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi55aW55dWV0YWkuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzc5cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjc5cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8wM3hnLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjAzeGcuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzdtdi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjdtdi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9wYW4uNTJ6ei5vcmcvKgovLyBAaW5jbHVkZSBodHRwOi8vKi5wYW4uNTJ6ei5vcmcvKgovLyBAaW5jbHVkZSBodHRwOi8vMjU4cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjI1OHBhbi5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vaHVpbWVpa3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouaHVpbWVpa3UuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL3dwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi53cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL3lwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vKi55cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovL2F6cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLmF6cGFuLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly9neGRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouZ3hkaXNrLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8ya3VhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi4ya3VhaS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vMXdwLm1lLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouMXdwLm1lLyoKLy8gQGluY2x1ZGUgaHR0cDovLzc3cGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouNzdwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vdnZwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLyoudnZwYW4uY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2ZtZGlzay5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5mbWRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2J4MDYzNS5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5ieDA2MzUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovLzEwcGFuLmNjLyoKLy8gQGluY2x1ZGUgaHR0cDovLyouMTBwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vMXBhbi5jYy8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLjFwYW4uY2MvKgovLyBAaW5jbHVkZSBodHRwOi8vMTIzd3p3cC5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi4xMjN3endwLmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3A1LmNvbS8qCi8vIEBpbmNsdWRlIGh0dHA6Ly8qLnd3cDUuY29tLyoKLy8gQGluY2x1ZGUgaHR0cDovL2Z5ZGlzay5jb20vKgovLyBAaW5jbHVkZSBodHRwOi8vKi5meWRpc2suY29tLyoKLy8gQGluY2x1ZGUgaHR0cHM6Ly9qaXh1bm1vZS5naXRodWIuaW8vY3V3Y2w0Yy9jb25maWcvCgovLyBHTV94bWxIdHRwUmVxdWVzdCDov5znq6/mnI3liqHlmajliJfooagKLy8gQGNvbm5lY3QgZG93bi5sZXBhbi5jYwovLyBAY29ubmVjdCBtdXNpYy5iYWlkdS5jb20KLy8gQGNvbm5lY3QgeWlueXVleXVuLmJhaWR1LmNvbQovLyBAY29ubmVjdCBtZWRpYS5zdG9yZS5rdWdvdS5jb20KLy8gQGNvbm5lY3QgdHJhY2tlcmNkbi5rdWdvdS5jb20KLy8gQGNvbm5lY3QgeWlueXVldGFpLmNvbQovLyBAY29ubmVjdCBpdHd1c3VuLmNvbQoKLy8gPT0vVXNlclNjcmlwdD09CgoKKGZ1bmN0aW9uICgpIHsKCS8vIOWIneWni+WMlgp2YXIgY3JlYXRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZCAoZG9jdW1lbnQpOwoKdmFyIEggPSB7CglzY3JpcHROYW1lOiAnQ1VXQ0w0QycsCglzY3JpcHRIb21lOiAnaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy96aC1DTi9zY3JpcHRzLzI2MDAnLAoJcmVwb3J0VXJsOiAgJ2h0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZm9ydW0vcG9zdC9kaXNjdXNzaW9uP0Rpc2N1c3Npb24vU2NyaXB0SUQ9MjYwMCcsCglpc0ZyYW1lOiAoZnVuY3Rpb24gKCkgewoJCXRyeSB7CgkJCXJldHVybiB1bnNhZmVXaW5kb3cudG9wICE9IHVuc2FmZVdpbmRvdy5zZWxmOwoJCX0gY2F0Y2ggKGUpIHsKCQkJcmV0dXJuIHRydWU7CgkJfQoJfSkoKSwKCgl2ZXJzaW9uOiAgICBHTV9pbmZvLnNjcmlwdC52ZXJzaW9uLAoJY3VycmVudFVybDogbG9jYXRpb24uaHJlZi5zcGxpdCAoJyMnKVswXSwKCWxvd2VySG9zdDogIGxvY2F0aW9uLmhvc3RuYW1lLnRvTG93ZXJDYXNlKCksCglkaXJlY3RIb3N0OiBsb2NhdGlvbi5ob3N0bmFtZS5tYXRjaCgvXHcrXC4/XHcrPyQvKVswXS50b0xvd2VyQ2FzZSgpLAoKCWRlZmF1bHREbEljb246ICAgJ2p4X2RsJywKCWRlZmF1bHREbENsYXNzOiAnLmp4X2RsJywKCglub3A6IGZ1bmN0aW9uICgpIHt9LAoKCW1lcmdlOiBmdW5jdGlvbiAocGFyZW50KSB7CgkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKQoJCQlyZXR1cm4gcGFyZW50IHx8IHt9OwoKCQl2YXIgYXJncyA9IGFyZ3VtZW50czsKCQlmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewoJCQlpZiAoYXJndW1lbnRzW2ldKSB7CgkJCQlPYmplY3Qua2V5cyAoYXJndW1lbnRzW2ldKS5mb3JFYWNoIChmdW5jdGlvbiAoa2V5KSB7CgkJCQkJcGFyZW50W2tleV0gPSBhcmdzW2ldW2tleV07CgkJCQl9KTsKCQkJfQoJCX0KCgkJcmV0dXJuIHBhcmVudDsKCX0sCgoJZXh0cmFjdDogZnVuY3Rpb24gKGZvbykgewoJCXJldHVybiBmb28udG9TdHJpbmcoKS5tYXRjaCgvXC9cKihbXHNcU10rKVwqXC8vKVsxXS5yZXBsYWNlKC9ccyotLS4rL2csICcnKTsKCX0sCgoJc0Zvcm1hdDogZnVuY3Rpb24gKHNvdXJjZVN0cikgewoJCXZhciBhcmdzID0gYXJndW1lbnRzLAoJCQlhcmdMZW4gPSBhcmdzLmxlbmd0aDsKCgkJaWYgKGFyZ0xlbiA8PSAxKSByZXR1cm4gc291cmNlU3RyOyAvLyDml6DmlYjmiJbml6Dlj4LmlbAKCgkJZm9yICh2YXIgaSA9IGFyZ0xlbjsgaS0tOyApCgkJCXNvdXJjZVN0ciA9IHNvdXJjZVN0ci5yZXBsYWNlIChuZXcgUmVnRXhwKCclJyArIGkgKyAnKFteXFxkXXwkKScsJ2cnKSwgYXJnc1tpXSk7CgoJCXJldHVybiBzb3VyY2VTdHI7Cgl9LAoKCXNwcmludGY6IGZ1bmN0aW9uIChzb3VyY2VTdHIpIHsKCQl2YXIgYXJncyA9IGFyZ3VtZW50cywKCQkJYXJnTGVuID0gYXJncy5sZW5ndGg7CgoJCWlmIChhcmdMZW4gPD0gMSkgcmV0dXJuIHNvdXJjZVN0cjsgLy8g5peg5pWI5oiW5peg5Y+C5pWwCgoJCWZvciAodmFyIGkgPSAxOyBpIDwgYXJnTGVuOyBpKyspCgkJCXNvdXJjZVN0ciA9IHNvdXJjZVN0ci5yZXBsYWNlICgvJVtzZF0vaSwgYXJnc1tpXSk7CgoJCXJldHVybiBzb3VyY2VTdHI7Cgl9LAoKCWJlZ2luV2l0aDogZnVuY3Rpb24gKHN0ciwgd2hhdCkgewoJCXJldHVybiBzdHIuaW5kZXhPZiAod2hhdCkgPT09IDA7Cgl9LAoKCWNvbnRhaW5zOiBmdW5jdGlvbiAoc3RyLCB3aGF0KSB7CgkJcmV0dXJuIHN0ci5pbmRleE9mICh3aGF0KSAhPSAtMTsKCX0sCgoJYWRkRG93bmxvYWQ6IGZ1bmN0aW9uICh1cmwsIGZpbGUpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT0gMikgewoJCQlILmFkZFRvQXJpYSh1cmwsIGZpbGUpOwoJCX0gZWxzZSB7CgkJCUdNX29wZW5JblRhYiAoSC51cmkodXJsLCBmaWxlKSwgdHJ1ZSk7CgkJfQoJfSwKCgl1cmk6IGZ1bmN0aW9uICh1cmwsIGZpbGVuYW1lLCByZWYpIHsKCQlzd2l0Y2ggKEguY29uZmlnLmRVcmlUeXBlKSB7CgkJCWNhc2UgMToKCQkJCXJldHVybiAnY3V3Y2w0YzovL3wxfCcgKyBbCgkJCQkJdXJsLAoJCQkJCWZpbGVuYW1lLnRvU3RyaW5nKCkucmVwbGFjZSgvWyciXC9cXDp8XS9nLCAnXycpLAoJCQkJCShyZWYgfHwgbG9jYXRpb24uaHJlZikudG9TdHJpbmcoKS5yZXBsYWNlKC8jLiovLCAnJykKCQkJCV0uam9pbignfCcpOwoKCQkJY2FzZSAyOgoJCQkJLy8g5aaC5p6c6ISa5pys5rKh5pyJ5omL5Yqo57uR5a6aIEFyaWEg6L+e5o6lCgkJCQkvLyDmraTlpITov5vooYzlhajlsYDov57mjqXmjqXnrqEKCQkJCWlmICghSC5oYXNBcmlhQ2FwdHVyZSkKCQkJCQlILmNhcHR1cmVBcmlhICgpOwoKCQkJCXJldHVybiAnYXJpYTI6Ly98JyArIFsKCQkJCQl1cmwsCgkJCQkJZmlsZW5hbWUudG9TdHJpbmcoKS5yZXBsYWNlKC9bJyJcL1xcOnxdL2csICdfJyksCgkJCQkJKHJlZiB8fCBsb2NhdGlvbi5ocmVmKS50b1N0cmluZygpLnJlcGxhY2UoLyMuKi8sICcnKQoJCQkJXS5qb2luKCd8Jyk7CgoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuIHVybDsKCQl9Cgl9LAoKCXNldHVwQXJpYTogZnVuY3Rpb24gKGJGb3JjZU5ldykgewoJCWlmIChiRm9yY2VOZXcgfHwgIUguYXJpYSkgewoJCQlILmFyaWEyID0gbmV3IEFyaWEyKHsKCQkJCWF1dGg6IHsKCQkJCQl0eXBlOiBILmNvbmZpZy5kQXJpYV9hdXRoLAoJCQkJCXVzZXI6IEguY29uZmlnLnNBcmlhX3VzZXIsCgkJCQkJcGFzczogSC5jb25maWcuc0FyaWFfcGFzcwoJCQkJfSwKCQkJCWhvc3Q6IEguY29uZmlnLnNBcmlhX2hvc3QsCgkJCQlwb3J0OiBILmNvbmZpZy5kQXJpYV9wb3J0CgkJCX0pOwoJCX0KCgkJcmV0dXJuIEguYXJpYTI7Cgl9LAoKCWFkZFRvQXJpYTogZnVuY3Rpb24gKHVybCwgZmlsZW5hbWUsIHJlZmVyZXIsIGNvb2tpZSwgaGVhZGVycykgewoJCXZhciBhcmlhUGFyYW0gPSB7CgkJCW91dDogZmlsZW5hbWUsCgkJCXJlZmVyZXI6IHJlZmVyZXIgfHwgbG9jYXRpb24uaHJlZiwKCQkJZGlyOiBILmNvbmZpZy5zQXJpYV9kaXIsCgkJCSd1c2VyLWFnZW50JzogbmF2aWdhdG9yLnVzZXJBZ2VudCwKCQkJaGVhZGVyOiBoZWFkZXJzIHx8IFtdCgkJfTsKCgkJaWYgKGNvb2tpZSA9PT0gdHJ1ZSkKCQkJY29va2llID0gZG9jdW1lbnQuY29va2llOwoKCQlpZiAoY29va2llKQoJCQlhcmlhUGFyYW0uaGVhZGVyLnB1c2ggKCdDb29raWU6ICcgKyBjb29raWUpOwoKCQlILmFyaWEyLmFkZFVyaSAoW3VybF0sIGFyaWFQYXJhbSwgSC5ub3AsIGZ1bmN0aW9uIChyKSB7CgkJCXZhciBzRXJyb3JNc2c7CgkJCWlmIChyLmVycm9yKSB7CgkJCQlzRXJyb3JNc2cgPSBILnNwcmludGYgKCfplJnor6/ku6PnoIEgJXM6ICVzJywgci5lcnJvci5jb2RlLCByLmVycm9yLm1lc3NhZ2UpOwoJCQl9IGVsc2UgewoJCQkJc0Vycm9yTXNnID0gJ+S4jiBBcmlhMiDlkI7lj7DpgJrkv6HlpLHotKUsIOacjeWKoeacquW8gOWQrz8nOwoJCQl9CgoJCQlhbGVydCAoSC5zcHJpbnRmKCdbJXNdIOaPkOS6pOS7u+WKoeWPkeeUn+mUmeivryFcblxuJXMnLCBILnNjcmlwdE5hbWUsIHNFcnJvck1zZykpOwoJCX0pOwoJfSwKCgljYXB0dXJlQXJpYTogZnVuY3Rpb24gKGVsKSB7CgkJaWYgKEguY29uZmlnLmRVcmlUeXBlICE9PSAyKQoJCQlyZXR1cm4gOwoKCQlILmhhc0FyaWFDYXB0dXJlID0gdHJ1ZTsKCQlILnNldHVwQXJpYSAoKTsKCQkKCQkkKGVsIHx8IGRvY3VtZW50KS5jbGljayhmdW5jdGlvbiAoZSkgewoJCQl2YXIgbGlua0VsID0gZS50YXJnZXQ7CgkJCXZhciAkZWwgPSAkKGUudGFyZ2V0KTsKCQkJaWYgKCEkZWwuaXMoJ2EnKSkgewoJCQkJbGlua0VsID0gJGVsLnBhcmVudHMoJ2EnKVswXTsKCQkJfQoKCQkJaWYgKGxpbmtFbCAmJiBsaW5rRWwudGFnTmFtZSA9PSAnQScgJiYgSC5iZWdpbldpdGgobGlua0VsLmhyZWYsICdhcmlhMjovL3wnKSkgewoJCQkJZS5zdG9wUHJvcGFnYXRpb24gKCk7CgkJCQllLnByZXZlbnREZWZhdWx0ICAoKTsKCgkJCQl2YXIgbGluayA9IGxpbmtFbC5ocmVmLnNwbGl0KCd8Jyk7CgkJCQlILmFkZFRvQXJpYShsaW5rWzFdLCBkZWNvZGVVUklDb21wb25lbnQobGlua1syXSksIGxpbmtbM10sIGxpbmtFbC5jbGFzc0xpc3QuY29udGFpbnMoJ2FyaWEtY29va2llJykpOwoJCQl9CgkJfSk7Cgl9LAoKCWJ1aWxkQXJpYVBhcmFtOiBmdW5jdGlvbiAob3B0cykgewoJCWlmIChvcHRzLmNvb2tpZSkgewoJCQlvcHRzLmhlYWRlciA9IG9wdHMuaGVhZGVyIHx8IFtdOwoJCQlvcHRzLmhlYWRlci5wdXNoICgnQ29va2llOiAnICsgKG9wdHMuY29va2llIHx8IGRvY3VtZW50LmNvb2tpZSkpOwoJCQlkZWxldGUgb3B0cy5jb29raWU7CgkJfQoJCXJldHVybiBILm1lcmdlICh7CgkJCXJlZmVyZXI6IGxvY2F0aW9uLmhyZWYsCgkJCWRpcjogSC5jb25maWcuc0FyaWFfZGlyLAoJCQkndXNlci1hZ2VudCc6IG5hdmlnYXRvci51c2VyQWdlbnQKCQl9LCBvcHRzKTsKCX0sCgoJYmF0Y2hEb3dubG9hZDogZnVuY3Rpb24gKGZDYWxsYmFjaywgcmVmLCBhcnJEb3dubG9hZHMpIHsKCQlILnNldHVwQXJpYSAoKTsKCgkJcmV0dXJuIEguYXJpYTIuYmF0Y2hBZGRVcmkuYXBwbHkgKAoJCQkvLyB0aGlzCgkJCUguYXJpYTIsIAoKCQkJLy8gZkNhbGxiYWNrLCBmaWxlMSwgZmlsZTIsIC4uLgoJCQlbIGZDYWxsYmFjayBdLmNvbmNhdCAoCgkJCQlhcnJEb3dubG9hZHMubWFwIChmdW5jdGlvbiAoYXJnKSB7CgkJCQkJYXJnLm9wdGlvbnMgPSBILmJ1aWxkQXJpYVBhcmFtIChILm1lcmdlKHsgcmVmZXJlcjogcmVmIH0sIGFyZy5vcHRpb25zKSk7CgkJCQkJcmV0dXJuIGFyZzsKCQkJCX0pCgkJCSkKCQkpOwoJfQp9OwoKSC5tZXJnZSAoSCwgewoJX2xvZzogY29uc29sZS5sb2cuYmluZCAoY29uc29sZSksCglfaW5mOiBjb25zb2xlLmluZm8uYmluZCAoY29uc29sZSksCglfd2FyOiBjb25zb2xlLndhcm4uYmluZCAoY29uc29sZSksCglfZXJyOiBjb25zb2xlLmVycm9yLmJpbmQgKGNvbnNvbGUpLAoKCWxvZzogZnVuY3Rpb24gKF9wcmVmaXgsIG1zZykgewoJCXZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCQlpZiAodHlwZW9mIG1zZyA9PSAnc3RyaW5nJykgewoJCQkvLyBUT0RPOiBTaW1wbGlmeSB0aGlzPwoJCQlILl9sb2cuYXBwbHkgKDAsIFtdLmNvbmNhdC5hcHBseSAoW19wcmVmaXggKyBtc2ddLCBhcmdzLnNsaWNlKDEpKSk7CgkJfSBlbHNlIHsKCQkJSC5fbG9nLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoW19wcmVmaXhdLCBhcmdzKSk7CgkJfQoJfS5iaW5kIChILCBILnNwcmludGYgKCdbJXNdW+aXpeW/l10gJywgSC5zY3JpcHROYW1lKSksCgoJaW5mbzogZnVuY3Rpb24gKF9wcmVmaXgsIG1zZykgewoJCXZhciBhcmdzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoKCQlpZiAodHlwZW9mIG1zZyA9PSAnc3RyaW5nJykgewoJCQkvLyBUT0RPOiBTaW1wbGlmeSB0aGlzPwoJCQlILl9pbmYuYXBwbHkgKDAsIFtdLmNvbmNhdC5hcHBseSAoW19wcmVmaXggKyBtc2ddLCBhcmdzLnNsaWNlKDEpKSk7CgkJfSBlbHNlIHsKCQkJSC5faW5mLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoW19wcmVmaXhdLCBhcmdzKSk7CgkJfQoJfS5iaW5kIChILCBILnNwcmludGYgKCdbJXNdW+S/oeaBr10gJywgSC5zY3JpcHROYW1lKSksCgoJZXJyb3I6IGZ1bmN0aW9uIChfcHJlZml4LCBtc2cpIHsKCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKS5jb25jYXQgKCdcblxu6ZSZ6K+v6L+96LiqJyArIG5ldyBFcnJvcigpLnN0YWNrKTsKCgkJaWYgKHR5cGVvZiBtc2cgPT0gJ3N0cmluZycpIHsKCQkJSC5fZXJyLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkgKFtfcHJlZml4ICsgbXNnXSwgYXJncy5zbGljZSgxKSkpOwoJCX0gZWxzZSB7CgkJCUguX2Vyci5hcHBseSAoMCwgW10uY29uY2F0LmFwcGx5KFtfcHJlZml4XSwgYXJncykpOwoJCX0KCX0uYmluZCAoSCwgSC5zcHJpbnRmICgnWyVzXVvplJnor69dICcsIEguc2NyaXB0TmFtZSkpLAoKCXdhcm46IGZ1bmN0aW9uIChfcHJlZml4LCBtc2cpIHsKCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKCgkJaWYgKHR5cGVvZiBtc2cgPT0gJ3N0cmluZycpIHsKCQkJLy8gVE9ETzogU2ltcGxpZnkgdGhpcz8KCQkJSC5faW5mLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkgKFtfcHJlZml4ICsgbXNnXSwgYXJncy5zbGljZSgxKSkpOwoJCX0gZWxzZSB7CgkJCUguX2luZi5hcHBseSAoMCwgW10uY29uY2F0LmFwcGx5KFtfcHJlZml4XSwgYXJncykpOwoJCX0KCX0uYmluZCAoSCwgSC5zcHJpbnRmICgnWyVzXVvorablkYpdICcsIEguc2NyaXB0TmFtZSkpCn0pOwoKSC5jb25maWcgPSBILm1lcmdlICh7CiAgICB2ZXJzaW9uOiAxLAogICAgYkRpYXBsYXlMb2c6IHRydWUsCiAgICBiWWVsbG93RWFzZUludGVybmF0aW9uYWw6IGZhbHNlLAogICAgYlllbGxvd0Vhc2VVc2VPbGRBcGk6IGZhbHNlLAogICAgYlllbGxvd0Vhc2VVc2VUaHJpZE9uRmFpbDogZmFsc2UsCiAgICBiVXNlQ3VzdG9tUnVsZXM6IGZhbHNlLAogICAgCiAgICBkQXJpYV9hdXRoOiBBcmlhMi5BVVRILm5vQXV0aCwKICAgIGRBcmlhX3BvcnQ6IDY4MDAsCiAgICBkVXJpVHlwZTogMCwKICAgIAogICAgc0FyaWFfZGlyOiAiRDpcXERvd25sb2FkXFwiLAogICAgc0FyaWFfaG9zdDogIjEyNy4wLjAuMSIsCiAgICBzQXJpYV9wYXNzOiAiIiwKICAgIHNBcmlhX3VzZXI6ICIiLAogICAgCiAgICBzQ3VzdG9tUnVsZTogIiIKfSwgKGZ1bmN0aW9uIChjb25mKSB7CglpZiAoIWNvbmYpIHJldHVybiB7fTsKCgl0cnkgewoJCXJldHVybiBKU09OLnBhcnNlIChjb25mKTsKCX0gY2F0Y2ggKGUpIHsKCQlILmluZm8gKCfphY3nva7mlofku7YgWyVzXSDml6DmlYgsIOeOsOWcqOS9v+eUqOepuueZvemFjee9ri4nLCBjb25mKTsKCQlyZXR1cm4ge307Cgl9Cn0pKEdNX2dldFZhbHVlIChILnNjcmlwdE5hbWUpKSk7Cgpjb25zdCBfX2xhdGVzdF92ZXJzaW9uID0gMTsKaWYgKEguY29uZmlnLnZlcnNpb24gIT0gX19sYXRlc3RfdmVyc2lvbikgewogICAgc3dpdGNoIChDb25maWcudmVyc2lvbikgewogICAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgSC5pbmZvKCfljYfnuqcgdjAg6YWN572u5paH5Lu2Li4uJyk7CiAgICAgICAgICAgIENvbmZpZy52ZXJzaW9uID0gMTsKCiAgICAgICAgICAgIENvbmZpZy5iWWVsbG93RWFzZUludGVybmF0aW9uYWwgPSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbDsKICAgICAgICAgICAgQ29uZmlnLmJZZWxsb3dFYXNlVXNlT2xkQXBpID0gSC5jb25maWcuYlByb3h5SW5zdGFsbGVkOwogICAgICAgICAgICBDb25maWcuYlllbGxvd0Vhc2VVc2VUaHJpZE9uRmFpbCA9IEguY29uZmlnLmJVc2VUaHJpZE9uRmFpbDsKCiAgICAgICAgICAgIGRlbGV0ZSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbDsKICAgICAgICAgICAgZGVsZXRlIEguY29uZmlnLmJVc2VUaHJpZE9uRmFpbDsKICAgICAgICAgICAgZGVsZXRlIEguY29uZmlnLmJQcm94eUluc3RhbGxlZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgCiAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBicmVhazsKICAgIH0KCiAgICBHTV9zZXRWYWx1ZSAoSC5zY3JpcHROYW1lLCBKU09OLnN0cmluZ2lmeShILmNvbmZpZykpOwp9CgovLyAyMDE0LjExLjMwOiDkuI3mmL7npLrml6Xlv5cKaWYgKCFILmNvbmZpZy5iRGlhcGxheUxvZyB8fCBILmlzRnJhbWUpIHsKCS8vIOWxj+iUveaXpeW/l+WHveaVsAoJSC5ub0xvZyA9IHRydWU7CglbJ2xvZycsICdpbmZvJ10ubWFwKGZ1bmN0aW9uIChmb29OYW1lKSB7CgkJSFsnXycgKyBmb29OYW1lLnNsaWNlKDAsIDMpXSA9IEhbZm9vTmFtZV0gPSBILm5vcDsKCX0pOwp9CgpILm1lcmdlIChILCB7Cglob29rUmVxdWlyZTogZnVuY3Rpb24gKG5hbWVzcGFjZSwgZm9vLCBjYWxsYmFjaykgewoJCS8vIFRoZSBmaXJzdCBvbmUgaXMgYHRoaXNgLCBzbyBub3QgZ29pbmcgdG8gYmUgdXNlZC4KCQl2YXIgYXJncyA9IFtdLnNsaWNlLmNhbGwgKGFyZ3VtZW50cywgMik7CgkJYXJnc1swXSA9IG51bGw7CgoJCXZhciBob29rUmVxID0gY3JlYXRlRWxlbWVudCAoJ3NjcmlwdCcpOwoJCWhvb2tSZXEudGV4dENvbnRlbnQgPSAnOygnICsgZnVuY3Rpb24gKG5hbWVzcGFjZSwgZm9vLCBjdXN0b20pIHsKCQkJdmFyICRucywgJGZvbzsKCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5ICh3aW5kb3csIG5hbWVzcGFjZSwgewoJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgkJCQkJcmV0dXJuICRuczsKCQkJCX0sCgkJCQlzZXQ6IGZ1bmN0aW9uIChuKSB7CgkJCQkJJG5zID0gbjsKCgkJCQkJJGZvbyA9IG5bZm9vXTsKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkgKCRucywgZm9vLCB7CgkJCQkJCWdldDogZnVuY3Rpb24gKCkgewoJCQkJCQkJcmV0dXJuIGZ1bmN0aW9uICgpIHsKCQkJCQkJCQl2YXIgcmV0ID0gY3VzdG9tLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoWyRucywgJGZvby5iaW5kICgkbnMpXSwgYXJndW1lbnRzKSk7CgkJCQkJCQkJaWYgKHJldCkgcmV0dXJuIHJldDsKCQkJCQkJCQlyZXR1cm4gJGZvby5hcHBseSAoJG5zLCBhcmd1bWVudHMpOwoJCQkJCQkJfTsKCQkJCQkJfSwKCQkJCQkJc2V0OiBmdW5jdGlvbiAoZm5OZXcpIHsKCQkJCQkJCSRmb28gPSBmbk5ldzsKCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQl9KTsKCQl9ICsgJykoIicgKyBuYW1lc3BhY2UgKyAnIiwgIicgKyBmb28gKyAnIiwgRnVuY3Rpb24uYmluZC5hcHBseSAoJwoJCQkrIGNhbGxiYWNrICsgJywgJyArIEpTT04uc3RyaW5naWZ5IChhcmdzKSArICcpKTsnOwoJCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQgKGhvb2tSZXEpOwoJCXJldHVybiBob29rUmVxOwoJfSwKCglob29rRGVmaW5lOiBmdW5jdGlvbiAoZm9vTmFtZSwgY2FsbGJhY2spIHsKCQkvLyBUaGUgZmlyc3Qgb25lIGlzIGB0aGlzYCwgc28gbm90IGdvaW5nIHRvIGJlIHVzZWQuCgkJdmFyIGFyZ3MgPSBbXS5zbGljZS5jYWxsIChhcmd1bWVudHMsIDEpOwoJCWFyZ3NbMF0gPSBudWxsOwoKCQl2YXIgaG9va0RlZiA9IGNyZWF0ZUVsZW1lbnQgKCdzY3JpcHQnKTsKCQlob29rRGVmLnRleHRDb250ZW50ID0gJzsoJyArIGZ1bmN0aW9uIChmb29OYW1lLCBjdXN0b20pIHsKCQkJdmFyICRkZWZpbmU7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSAod2luZG93LCBmb29OYW1lLCB7CgkJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCQkJCQlyZXR1cm4gZnVuY3Rpb24gKCkgewoJCQkJCQl2YXIgcmV0ID0gY3VzdG9tLmFwcGx5ICgwLCBbXS5jb25jYXQuYXBwbHkoWyRkZWZpbmVdLCBhcmd1bWVudHMpKTsKCQkJCQkJaWYgKHJldCkgcmV0dXJuIHJldDsKCQkJCQkJcmV0dXJuICRkZWZpbmUuYXBwbHkgKHdpbmRvdywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJfSwKCQkJCXNldDogZnVuY3Rpb24gKG4pIHsKCQkJCQkkZGVmaW5lID0gbjsKCQkJCX0KCQkJfSk7CgkJfSArICcpKCInICsgbmFtZXNwYWNlICsgJyIsICInICsgZm9vICsgJyIsIEZ1bmN0aW9uLmJpbmQuYXBwbHkgKCcKCQkJKyBjYWxsYmFjayArICcsICcgKyBKU09OLnN0cmluZ2lmeSAoYXJncykgKyAnKSk7JzsKCQlkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkIChob29rRGVmKTsKCQlyZXR1cm4gaG9va0RlZjsKCX0sCgoJYmFzZTY0RGVjb2RlOiBmdW5jdGlvbiAoc3RyKSB7CgkJcmV0dXJuIENyeXB0b0pTLmVuYy5VdGY4LnN0cmluZ2lmeShDcnlwdG9KUy5lbmMuQmFzZTY0LnBhcnNlKHN0cikpOwoJfSwKCQoJZ2V0Rmxhc2hWYXJzOiBmdW5jdGlvbiAoZWxlKSB7CgkJLy8galF1ZXJ5IGVsZW1lbnQgZml4LgoJCWlmICghZWxlKSByZXR1cm4ge307CgkJaWYgKGVsZS5qcXVlcnkpIGVsZSA9IGVsZVswXTsKCgkJLy8gQ2hlY2sgaWYgaXMgYSBmbGFzaCBvYmplY3QKCQlpZiAoZWxlLnR5cGUuaW5kZXhPZignZmxhc2gnKSA9PSAtMSkgcmV0dXJuIHt9OwoKCQlmb3IodmFyIGZsYXNoT2JqZWN0LCBmbGFzaFZhcnMgPSB7fSwgaSA9IGVsZS5jaGlsZE5vZGVzLmxlbmd0aDsgaS0tOykKCQkJaWYgKGVsZS5jaGlsZE5vZGVzW2ldLm5hbWUgPT0gJ2ZsYXNodmFycycpIHsKCQkJCWZsYXNoT2JqZWN0ID0gZWxlLmNoaWxkTm9kZXNbaV07CgkJCQlicmVhazsKCQkJfQoKCQlpZiAoZmxhc2hPYmplY3QpIHsKCQkJZmxhc2hPYmplY3QudmFsdWUucmVwbGFjZSgvJmFtcDsvZywgJyYnKS5yZXBsYWNlKC8oW1xzXFNdKz8pPShbXHNcU10rPykoJnwkKS9nLCBmdW5jdGlvbiAobiwga2V5LCB2YWx1ZSkgewoJCQkJLy8g5Yip55So5q2j5YiZ55qE5om56YeP5pu/5o2i5Yqf6IO95oqT5Y+W5pWw5o2uIF5eCgkJCQlmbGFzaFZhcnMgW2tleV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwoJCQl9KTsKCQl9CgoJCXJldHVybiBmbGFzaFZhcnM7Cgl9LAoKCWdldEZpcnN0S2V5OiBmdW5jdGlvbiAob2JqKSB7CgkJcmV0dXJuIE9iamVjdC5rZXlzKG9iailbMF07Cgl9LAoJZ2V0Rmlyc3RWYWx1ZTogZnVuY3Rpb24gKG9iaikgewoJCXRyeSB7CgkJCXJldHVybiBvYmpbSC5nZXRGaXJzdEtleShvYmopXTsKCQl9IGNhdGNoIChlKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCX0sCgoJZ2V0TGlua0V4dDogZnVuY3Rpb24gKHVybCkgewoJCXJldHVybiB1cmwubWF0Y2goLy4rXC8oPzpbXi5dKyhcLi4rPykpKD86XD98JCkvKVsxXTsKCX0sCgoJZ2V0TGlua0V4dEZyb21RdWVyeTogZnVuY3Rpb24gKHVybCkgewoJCWlmIChILmNvbnRhaW5zKHVybCwgJz8nKSkgewoJCQl2YXIgcGFydHMgPSBsaW5rMy5zbGljZShsaW5rMy5pbmRleE9mKCc/JykgKyAxKS5yZXBsYWNlKC9bXj1dKz89KC4rPygmfCQpKS9nLCAnJDEnKS5zcGxpdCgnJicpOwoJCQlmb3IgKHZhciBpID0gcGFydHMubGVuZ3RoLCBleHRzOyBpLS07ICkgewoJCQkJaWYgKGV4dHMgPSBwYXJ0c1tpXS5tYXRjaCgvXC4oPzpbYS16MC05XXsyLDl9KS8pKSB7CgkJCQkJcmV0dXJuIGV4dHNbMF07CgkJCQl9CgkJCX0KCQl9CgkJcmV0dXJuIEguZ2V0TGlua0V4dCAodXJsKTsKCX0sCgoJcGFyc2VRdWVyeVN0cmluZzogZnVuY3Rpb24gKHJhd1VybCkgewoJCXZhciB1cmxQYXJhbXMgPSAoSC5jb250YWlucyAocmF3VXJsLCAnPycpCgkJCT8gcmF3VXJsLnNsaWNlIChyYXdVcmwuaW5kZXhPZignPycpICsgMSkKCQkJOiByYXdVcmwpLnNwbGl0KCcmJyk7CgoJCXZhciByZXQgPSB7fTsKCQlmb3IgKHZhciBpID0gMCwgcXVlcnlTdHIsIHBvc0VxdWFsOyBpIDwgdXJsUGFyYW1zLmxlbmd0aDsgaSsrKSB7CgkJCXF1ZXJ5U3RyID0gdXJsUGFyYW1zW2ldLnRvU3RyaW5nKCk7CgkJCXBvc0VxdWFsID0gcXVlcnlTdHIuaW5kZXhPZignPScpOwoJCQlpZiAocG9zRXF1YWwgPT0gLTEpIGNvbnRpbnVlOwoKCQkJcmV0W2RlY29kZVVSSUNvbXBvbmVudChxdWVyeVN0ci5zbGljZSAoMCwgcG9zRXF1YWwpKV0gPQoJCQkJZGVjb2RlVVJJQ29tcG9uZW50KHF1ZXJ5U3RyLnNsaWNlIChwb3NFcXVhbCArIDEpKTsKCQl9CgoJCXJldHVybiByZXQ7Cgl9LAoKCXdvcmRwcmVzc0F1ZGlvOiBmdW5jdGlvbiAoKSB7CgkJSC5sb2coJ1dvcmRQcmVzcyBBdWRpbyDmj5Lku7bpgJrnlKjku6PnoIEg5ZCv5YqoJyk7CgoJCXZhciBmaXhFbWJlZCA9IGZ1bmN0aW9uIChvYmopIHsKCQkJaWYgKG9iai50YWdOYW1lICE9ICdPQkpFQ1QnIHx8IG9iai5oYXNBdHRyaWJ1dGUoSC5zY3JpcHROYW1lKSkgcmV0dXJuOwoKCQkJdmFyIHNvbmdPYmogID0gSC5nZXRGbGFzaFZhcnMob2JqKTsKCQkJdmFyIHNvbmdBZGRyID0gSC5iYXNlNjREZWNvZGUoc29uZ09iai5zb3VuZEZpbGUpOwoJCQkkKCc8YT4nKS5odG1sKCfkuIvovb3jgIwnICsgc29uZ09iai50aXRsZXMgKyAn44CNPGJyPicpCgkJCQkuYXR0ciAoewoJCQkJCWhyZWY6IEgudXJpIChzb25nQWRkciwgc29uZ09iai50aXRsZXMgKyBzb25nQWRkci5zbGljZSgtNCkpLAoJCQkJCXRhcmdldDogJ19ibGFuaycKCQkJCX0pLmluc2VydEJlZm9yZSAob2JqKTsKCgkJCW9iai5zZXRBdHRyaWJ1dGUgKEguc2NyaXB0TmFtZSwgJ15eJyk7CgkJfTsKCgkJbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uIChldmUpIHsKCQkJZm9yICh2YXIgaT0wOyBpPGV2ZS5sZW5ndGg7IGkrKykKCQkJCWlmIChldmVbaV0udGFyZ2V0LmNsYXNzTmFtZSA9PSAnYXVkaW9wbGF5ZXJfY29udGFpbmVyJyAmJiBldmVbaV0uYWRkZWROb2Rlcy5sZW5ndGgpCgkJCQkJZml4RW1iZWQoZXZlW2ldLmFkZGVkTm9kZXNbMF0pOwoJCX0pLm9ic2VydmUgKCQoJy5wb3N0ID4gLmVudHJ5JylbMF0sIHsKCQkJY2hpbGRMaXN0OiB0cnVlLAoJCQlzdWJ0cmVlOiB0cnVlCgkJfSk7CgoJCS8vIEZpcmVmb3ggZml4Li4gPSA9CgkJJCgnb2JqZWN0W2lkXj0iYXVkaW9wbGF5ZXJfIl0nKS5lYWNoKGZ1bmN0aW9uICgpIHsgZml4RW1iZWQodGhpcyk7IH0pOwoJCUgubG9nKCdXb3JkUHJlc3MgQXVkaW8g5o+S5Lu26YCa55So5Luj56CBIOe7k+adnycpOwoJfSwKCgl3YWl0VW50aWw6IGZ1bmN0aW9uIChjaGVja0NvbmQsIGZDYWxsYmFjaywgblRpbWVPdXQsIG5UaW1lSW50ZXJ2YWwpIHsKCQlpZiAodHlwZW9mIGZDYWxsYmFjayAhPSAnZnVuY3Rpb24nKQoJCQkvLyBSZXF1aXJlZC4KCQkJcmV0dXJuIDsKCgkJaWYgKCdzdHJpbmcnID09IHR5cGVvZiBjaGVja0NvbmQgJiYgY2hlY2tDb25kLmluZGV4T2YgKCcuJykgIT09IC0xKSB7CgkJCWNoZWNrQ29uZCA9IGNoZWNrQ29uZC5zcGxpdCAoJy4nKTsKCQl9CgkJaWYgKGNoZWNrQ29uZCBpbnN0YW5jZW9mIEFycmF5KSB7CgkJCWNoZWNrQ29uZCA9IGZ1bmN0aW9uICh2YXJzKSB7CgkJCQlmb3IgKHZhciBpID0gMCwgciA9IHVuc2FmZVdpbmRvdzsgaSA8IHZhcnMubGVuZ3RoOyBpKyspIHsKCQkJCQlyID0gclt2YXJzW2ldXTsKCQkJCQlpZiAoIXIpCgkJCQkJCXJldHVybiA7CgkJCQl9CgoJCQkJcmV0dXJuIHRydWU7CgkJCX0uYmluZCAobnVsbCwgY2hlY2tDb25kLnNsaWNlKCkpOwoJCX07CgoJCXZhciB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKCQkJaWYgKCdmdW5jdGlvbicgPT0gdHlwZW9mIGNoZWNrQ29uZCkgewoJCQkJdHJ5IHsKCQkJCQlpZiAoIWNoZWNrQ29uZCgpKSByZXR1cm47CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJLy8gTm90IHJlYWR5IHlldC4KCQkJCQlyZXR1cm4gOwoJCQkJfQoJCQl9IGVsc2UgaWYgKCdzdHJpbmcnID09IHR5cGVvZiBjaGVja0NvbmQpIHsKCQkJCWlmICh0eXBlb2YgKHVuc2FmZVdpbmRvd1tjaGVja0NvbmRdKSA9PSAndW5kZWZpbmVkJykKCQkJCQlyZXR1cm4gOwoJCQl9CgkJCWNsZWFySW50ZXJ2YWwodGltZXIpOwoJCQl0cnkgewoJCQkJZkNhbGxiYWNrLmNhbGwodGhpcyk7CgkJCX0gY2F0Y2ggKGUpIHsKCQkJCUguZXJyb3IgKCdbSC53YWl0VW50aWxdIENhbGxiYWNrIGZvciAlcyBoYWQgYW4gZXJyb3I6ICVzJywgSC52ZXJzaW9uLCBlLm1lc3NhZ2UpOwoJCQl9CgkJfSwgblRpbWVJbnRlcnZhbCB8fCAxNTApOwoKCQkvLyDlpoLmnpwgblRpbWVPdXQg55qE5Lyg5YWl5YC85Li6IHRydWUsIOWImeaXoOmZkOWItuetieW+hS4KCQlpZiAoblRpbWVPdXQgIT09IHRydWUpIHsKCQkJc2V0VGltZW91dCAoZnVuY3Rpb24gKCkgewoJCQkJLy8gVGltZW91dAoJCQkJY2xlYXJJbnRlcnZhbCh0aW1lcik7CgkJCX0sIG5UaW1lT3V0IHx8IDEwMDAwKTsKCQl9Cgl9LAoKCW1ha2VGaW5lQ3NzOiBmdW5jdGlvbiAobmFtZSwgcGFyYW0pIHsKCQl2YXIgcmV0ID0ge307CgkJcmV0W25hbWVdID0gcGFyYW07CgkJWydtb3onLCAnd2Via2l0J10uZm9yRWFjaCAoZnVuY3Rpb24gKGUpIHsKCQkJcmV0WyctJyArIGUgKyAnLScgKyBuYW1lXSA9IHBhcmFtOwoJCX0pOwoJCXJldHVybiByZXQ7Cgl9LAoKCW1ha2VEZWxheUNzczogZnVuY3Rpb24gKHRyYW5zaXRpb25UZXh0KSB7CgkJcmV0dXJuIEgubWFrZUZpbmVDc3MoJ3RyYW5zaXRpb24nLCB0cmFuc2l0aW9uVGV4dCB8fCAnYWxsIC4ycycpOwoJfSwKCgltYWtlUm90YXRlQ3NzOiBmdW5jdGlvbiAoZGVnKSB7CgkJcmV0dXJuIEgubWFrZUZpbmVDc3MoJ3RyYW5zZm9ybScsICdyb3RhdGUoJyArIChkZWcgfHwgMTgwKSArICdkZWcpJyk7Cgl9LAoKCWNyZWF0ZU51bVBhZDogZnVuY3Rpb24gKG1heExlbiwgdGFyZ2V0SW5wdXQsIGZpbmlzaENhbGxiYWNrLCBjb2RlUmVzZXRDYWxsYmFjaykgewoJCWlmICghY29kZVJlc2V0Q2FsbGJhY2spCgkJCWNvZGVSZXNldENhbGxiYWNrID0gZUZ1bmM7CgoJCXZhciB0YWJsZSA9IGNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyksCgkJCXJjZGUgPSAkKHRhcmdldElucHV0KVswXTsKCQkkKHRhYmxlKS5jc3MoewoJCQknYmFja2dyb3VuZC1jb2xvcic6ICcjZmZjYzk5JywKCQkJJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywKCQkJJ2JvdHRvbSc6ICcxNjRweCcsCgkJCSdsZWZ0JzogJzE3MHB4JwoJCX0pOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgNDsgaSsrKSB7CgkJCXZhciB0ciA9IGNyZWF0ZUVsZW1lbnQoJ3RyJyk7CgkJCWZvciAodmFyIGogPSAwOyBqIDwgMzsgaisrKSB7CgkJCQl2YXIgdGQgPSBjcmVhdGVFbGVtZW50KCd0ZCcpOwoJCQkJdGQuaW5uZXJIVE1MID0gJCh0ZCkuYXR0cignaycsICcxMjM0NTY3ODlDMOKGkCdbaSAqIDMgKyBqXSkuYXR0cignaycpOwoJCQkJdHIuYXBwZW5kQ2hpbGQodGQpOwoJCQl9CgkJCXRhYmxlLmFwcGVuZENoaWxkKHRyKTsKCQl9CgkJJCh0YWJsZSkuZmluZCgndGQnKS5jbGljayhmdW5jdGlvbiAoKSB7CgkJCXZhciB2YWwgPSByY2RlLnZhbHVlLAoJCQkJbGVuID0gdmFsLmxlbmd0aCwKCQkJCWtleSA9ICQodGhpcykuYXR0cignaycpIHx8ICcnOwoJCQkkKHJjZGUpLmZvY3VzKCk7CgoJCQlzd2l0Y2ggKGtleSkgewoJCQkJY2FzZSAn4oaQJzoKCQkJCQlyY2RlLnZhbHVlID0gdmFsLnNsaWNlKDAsIC0xKTsKCQkJCQlicmVhazsKCQkJCWNhc2UgJ0MnOgoJCQkJCXJjZGUudmFsdWUgPSAnJzsKCQkJCQljb2RlUmVzZXRDYWxsYmFjayAoKTsKCQkJCQlicmVhazsKCQkJCWRlZmF1bHQ6CgkJCQkJcmNkZS52YWx1ZSArPSBrZXk7CgkJCQkJbGVuICsrOwoJCQkJCWlmIChsZW4gPj0gbWF4TGVuKSB7CgkJCQkJCWlmIChmaW5pc2hDYWxsYmFjayhyY2RlLnZhbHVlKSkgewoJCQkJCQkJJCh0YWJsZSkuaGlkZSgpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJY29kZVJlc2V0Q2FsbGJhY2soKTsKCQkJCQkJCXJjZGUudmFsdWUgPSAnJzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlicmVhazsKCQkJfQoJCX0pLmNzcyh7CgkJCWZvbnQ6ICdib2xkIDI1cHggVGFob21hJywKCQkJY29sb3I6ICdyZWQnLAoJCQljdXJzb3I6ICdwb2ludGVyJywKCQkJdmVydGljYWxBbGlnbjogJyBtaWRkbGUnLAoJCQl0ZXh0QWxpZ246ICcgY2VudGVyJywKCQkJYm9yZGVyOiAnMXB4IHNvbGlkICNEREREREQnLAoJCQlwYWRkaW5nOiAnNnB4JywKCQkJd2lkdGg6ICc0MHB4JywKCQkJaGVpZ2h0OiAnNDBweCcKCQl9KTsKCQlyZXR1cm4gdGFibGU7Cgl9LAoJcmVEaXJXaXRoUmVmOiBmdW5jdGlvbiAodGFyZ2V0VXJsKSB7CgkJaWYgKCF0YXJnZXRVcmwpIHJldHVybiA7CgkJSC5pbmZvICgnUmVkaXJlY3QgdG8gJXMuLi4nLCB0YXJnZXRVcmwpOwoJCQoJCXZhciBsaW5rID0gJCgnPGE+JykKCQkJLmF0dHIoJ2hyZWYnLCB0YXJnZXRVcmwpCgkJCS50ZXh0KCfmraPlnKjot7PovawgWycgKyB0YXJnZXRVcmwgKyAnXSwg6K+356iN5ZCOLi4gJykKCQkJLnByZXBlbmRUbyhkb2N1bWVudC5ib2R5KQoJCQkuY3NzICh7Zm9udFNpemU6IDEyLCBjb2xvcjogJ2luaGVyaXQnfSk7CgkJCgkJbGlua1swXS5jbGljaygpOwoJCXJldHVybiB0cnVlOwoJfSwKCgkvLyDnvZHnm5jlnLDlnYDoh6rliqjlr7zlkJEgW+WfuuS6jiBwaHBEaXNrIOeahOe9keebmF0KCXBocERpc2tBdXRvUmVkaXI6IGZ1bmN0aW9uIChmQ2FsbGJhY2spewoJCWlmICghZkNhbGxiYWNrKSB7CgkJCWZDYWxsYmFjayA9IGRvY3VtZW50LmJvZHkgPyBILnJlRGlyV2l0aFJlZiA6IGZ1bmN0aW9uIChwKSB7CgkJCQlILndhaXRVbnRpbCgnZG9jdW1lbnQuYm9keScsIEgucmVEaXJXaXRoUmVmLmJpbmQobnVsbCwgcCkpOwoJCQl9OwoJCX0KCgkJdmFyIHJDaGVja1BhdGggPSAvXC8oZmlsZSk/KGZpbGV8dmlldykoW1wvLlwtX10uKikvOwoJCS8vIEJlY2F1c2UgbG9jYXRpb24ueHggPSB4eCBkb2VzIG5vdCBwYXNzIHRoZSByZWZlciwgc28gd2UncmUgZ29pbmcgdG8gbWFrZSBhIGR1bW15IGZvcm0uCgkJaWYgKHJDaGVja1BhdGgudGVzdCAobG9jYXRpb24ucGF0aG5hbWUpKSB7CgkJCWZDYWxsYmFjayAobG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSAockNoZWNrUGF0aCwgJy8kMWRvd24kMycpKTsKCQl9IGVsc2UgaWYgKEguYmVnaW5XaXRoKGxvY2F0aW9uLnBhdGhuYW1lLCAnL3ZpZXdmaWxlJykpIHsKCQkJZkNhbGxiYWNrIChsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKCcvdmlld2ZpbGUnLCAnL2Rvd25sb2FkJykpOwoJCX0gZWxzZSB7IHJldHVybiBmYWxzZTsgfQoKCQlyZXR1cm4gdHJ1ZTsKCX0sCgoJLy8g5o+S5YWl5qC35byP6KGoCglpbmplY3RTdHlsZTogZnVuY3Rpb24gKCkgewoJCXZhciBzdHlsZUJsb2NrID0gKHRoaXMgJiYgdGhpcy50YWdOYW1lID09ICdTVFlMRScpID8gdGhpcyA6IChILnN0eWxlQmxvY2sgfHwgY3JlYXRlRWxlbWVudCgnc3R5bGUnKSk7CgkJc3R5bGVCbG9jay50ZXh0Q29udGVudCArPSBbXS5qb2luLmNhbGwoYXJndW1lbnRzLCAnXG4nKTsKCQlILnN0eWxlQmxvY2sgPSBzdHlsZUJsb2NrOwoJCWRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVCbG9jayk7CgkJcmV0dXJuIHN0eWxlQmxvY2s7Cgl9LAoKCS8vIOW8uuWItumakOiXjy/mmL7npLrmn5DkupvlhYPntKAKCWZvcmNlSGlkZTogZnVuY3Rpb24gKCkgewoJCXJldHVybiBILmluamVjdFN0eWxlLmNhbGwgKHRoaXMsIFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzKS5qb2luICgnLCAnKSArICd7IGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudCB9JyAgKTsKCX0sCglmb3JjZVNob3c6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gSC5pbmplY3RTdHlsZS5jYWxsICh0aGlzLCBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cykuam9pbiAoJywgJykgKyAneyBkaXNwbGF5OiBibG9jayAhaW1wb3J0YW50IH0nICk7Cgl9LAoJLy8g5by65Yi26ZqQ6JeP5qGG5p62Cglmb3JjZUhpZGVGcmFtZXM6IGZ1bmN0aW9uICgpewoJCXJldHVybiBmb3JjZUhpZGUoJ2lmcmFtZSwgZnJhbWVzZXQsIGZyYW1lJyk7Cgl9LAoKCS8vIOmAmueUqCBqUGxheWVyIOazqOWFpQoJalBsYXllclBhdGNoZXI6IGZ1bmN0aW9uIChjYWxsYmFjaywgbmFtZXNwYWNlKSB7CgkJLy8g6buY6K6k5Li6IGpQbGF5ZXIKCQlpZiAoIW5hbWVzcGFjZSkgbmFtZXNwYWNlID0gJ2pQbGF5ZXInOwoKCQlILmluZm8gKCfnrYnlgJkgalBsYXllciDlsLHnu6ogLi4nKTsKCQlILndhaXRVbnRpbCgnJC4nICsgbmFtZXNwYWNlICsgJy5wcm90b3R5cGUuc2V0TWVkaWEnLCBmdW5jdGlvbiAoKSB7CgkJCUguaW5mbyAoJ+W8gOWni+e7keWumuWHveaVsCAuLicpOwoJCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQkJc2V0TWVkaWE6IGZ1bmN0aW9uIChuZXdNZWRpYSkgewoJCQkJCUguaW5mbyAoJ+atjOabsuaVsOaNrjogJywgbmV3TWVkaWEpOwoJCQkJCWNhbGxiYWNrIChuZXdNZWRpYSk7CgkJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcygpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cuJFtuYW1lc3BhY2VdLnByb3RvdHlwZSwgJy4kLicgKyBuYW1lc3BhY2UgKyAnLnByb3RvdHlwZScpOwoJCQlILmluZm8gKCfnu5Hlrprlrozmr5UsIGVuam95ficpOwoJCX0pOwoJfSwKCglmaXhTdHlsZU9yZGVyOiBmdW5jdGlvbiAoZWxTdHlsZSkgewoJCSQoJ2hlYWQnKS5hcHBlbmQgKGVsU3R5bGUpOwoJfSwKCgkvLyBGaXNoZXItWWF0ZXMgU2h1ZmZsZSBieSBjb21tdW5pdHkgd2lraSg/KQoJLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNjI3NDM5OAoJc2h1ZmZsZTogZnVuY3Rpb24gKGFycmF5KSB7CgkJdmFyIGNvdW50ZXIgPSBhcnJheS5sZW5ndGgsIHRlbXAsIGluZGV4OwoKCQkvLyBXaGlsZSB0aGVyZSBhcmUgZWxlbWVudHMgaW4gdGhlIGFycmF5CgkJd2hpbGUgKGNvdW50ZXIgPiAwKSB7CgkJCS8vIFBpY2sgYSByYW5kb20gaW5kZXgKCQkJaW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjb3VudGVyKTsKCgkJCS8vIERlY3JlYXNlIGNvdW50ZXIgYnkgMQoJCQljb3VudGVyLS07CgoJCQkvLyBBbmQgc3dhcCB0aGUgbGFzdCBlbGVtZW50IHdpdGggaXQKCQkJdGVtcCA9IGFycmF5W2NvdW50ZXJdOwoJCQlhcnJheVtjb3VudGVyXSA9IGFycmF5W2luZGV4XTsKCQkJYXJyYXlbaW5kZXhdID0gdGVtcDsKCQl9CgoJCXJldHVybiBhcnJheTsKCX0KfSk7CgovLyDnroDljZXlsY/olL3lub/lkYoKdW5zYWZlV2luZG93LmFudGlhZHN2MiA9IDA7CnVuc2FmZURlZmluZUZ1bmN0aW9uICgnQ05aWl9BRF9CQVRDSCcsIGZ1bmN0aW9uICgpIHt9KTsKCi8vIOepuueZveWHveaVsCwg6YCC5ZCI6IW+56m66aG16Z2i5Ye95pWw44CCCnZhciBlRnVuYyA9IGZ1bmN0aW9uICgpIHt9LAoJdEZ1bmMgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyAgfSwKCWZGdW5jID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gZmFsc2U7IH07Cgp2YXIgJF9HRVQgPSBILnBhcnNlUXVlcnlTdHJpbmcgKEguY3VycmVudFVybCk7CgpILmxvZyAoJ+iEmuacrOW8gOWni+aJp+ihjOOAgicpOwpILmxvZyAoJ+Wfn+WQjTogJXM7IOWujOaVtOWcsOWdgDogJXM7IOivt+axguWPguaVsDogJXMnLCBILmRpcmVjdEhvc3QsIEguY3VycmVudFVybCwgSlNPTi5zdHJpbmdpZnkgKCRfR0VUKSk7CkgubG9nICgn6ISa5pys54mI5pysIFsgJXMgXSAsIOWmguaenOWPkeeOsOiEmuacrOmXrumimOivt+aPkOS6pOWIsCBbICVzIF0g6LCi6LCi44CCJywgSC52ZXJzaW9uLCBILnJlcG9ydFVybCk7CgoKCXZhciBzaXRlcyA9IFsgLyogQ29tcGlsZWQgZnJvbSBBQS5jb25maWcuanMgKi8KewoJaWQ6ICdpbnRlcm5hbC5jb25maWcnLAoJbmFtZTogJ+iEmuacrOmFjee9rumhtemdoicsCglob3N0OiBbJ2xvY2FsaG9zdCcsICdqaXh1bm1vZS5naXRodWIuaW8nXSwKCXBhdGg6IFsnL2NvbmYvJywgJy9jdXdjbDRjL2NvbmZpZy8nXSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdW5zYWZlV2luZG93LnJTY3JpcHRWZXJzaW9uID0gSC52ZXJzaW9uOwoJCXVuc2FmZVdpbmRvdy5yU2NyaXB0Q29uZmlnICA9IEpTT04uc3RyaW5naWZ5IChILmNvbmZpZyk7CgkJSC5pbmZvIChILmNvbmZpZyk7CgoJCXZhciBfYyA9IGNvbmZpcm07CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoJ1NhdmVDb25maWcnLCBmdW5jdGlvbiAoZSkgewoJCQl0cnkgewoJCQkJdmFyIGNvbmZpZyA9IEpTT04uc3RyaW5naWZ5IChKU09OLnBhcnNlIChlLmRldGFpbCkpOwoJCQkJaWYgKF9jIChILnNwcmludGYgKCfnoa7lrprlgqjlrZjorr7lrproh7MgJXM/JywgSC5zY3JpcHROYW1lKSkpCgkJCQkJR01fc2V0VmFsdWUgKEguc2NyaXB0TmFtZSwgY29uZmlnKTsKCQkJfSBjYXRjaCAoZSkgewoJCQkJYWxlcnQgKCfop6PmnpDorr7lrprlgLzlh7rplJkhJyk7CgkJCX0KCQl9KTsKCX0sCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKICAgICAgICBILmNhcHR1cmVBcmlhKGRvY3VtZW50LmJvZHkpOwoJfQp9CiwKLyogQ29tcGlsZWQgZnJvbSBhcGkubXVzaWMuc3B5LmpzICovCi8qKgogKiDnrKzkuInmlrkgLSAi6Z+z5LmQ6Ze06LCNIiDop6PmnpDmjqXlj6MKICogVFlQRV9TVUJfTU9EVUxFCiAqLwooewoJaWQ6ICdhcGkubXVzaWMuc3B5JywKCglzdG9yYWdlS2V5OiAnX01VU0lDX1NQWScsCglyZWxvYWRDYWNoZTogdHJ1ZSwKCgkvLyDliJ3lp4vljJbnm5HlkKzkuovku7YKCWluaXQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgZnVuY3Rpb24gKGUpIHsKCQkJc3dpdGNoIChlLmtleSkgewoJCQkJY2FzZSBzZWxmLnN0b3JhZ2VLZXk6CgkJCQkJc2VsZi5yZWxvYWRDYWNoZSA9IHRydWU7CgkJCQkJYnJlYWs7CgkJCX0KCQl9LCBmYWxzZSk7CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSC5zY3JpcHROYW1lICsgJy1ORS1TUFknLCBmdW5jdGlvbiAoZSkgewoJCQl2YXIgZGF0YSA9IEpTT04ucGFyc2UoZS5kZXRhaWwpOwoJCQl2YXIgaWQgPSBkYXRhLmlkOwoJCQlzZWxmLmdldE5ldEVhc2UoaWQsIHVuc2FmZVdpbmRvd1tkYXRhLmNhbGxiYWNrXSk7CgkJfSk7Cgl9LAoKCS8vIOi/m+ihjOe8k+WtmOmHjei9vQoJZG9SZWxvYWRDYWNoZTogZnVuY3Rpb24gKCkgewoJCXRyeSB7CgkJCXRoaXMuY2FjaGUgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZVt0aGlzLnN0b3JhZ2VLZXldKTsKCQl9IGNhdGNoIChleCkgewoJCQl0aGlzLmNhY2hlID0ge307CgkJfQoKCQl0aGlzLnJlbG9hZENhY2hlID0gZmFsc2U7Cgl9LAoKCS8vIOivu+WFpee8k+WtmAoJY2FjaGVSZWFkOiBmdW5jdGlvbiAoc29uZ0lkKSB7CgkJaWYgKHRoaXMucmVsb2FkQ2FjaGUpCgkJCXRoaXMuZG9SZWxvYWRDYWNoZSgpOwoKCQlpZiAoIXRoaXMuY2FjaGUuaGFzT3duUHJvcGVydHkoc29uZ0lkKSkKCQkJcmV0dXJuIG51bGw7CgoJCXJldHVybiB0aGlzLmNhY2hlW3NvbmdJZF07Cgl9LAoKCS8vIOWCqOWtmOe8k+WtmAoJY2FjaGVTYXZlOiBmdW5jdGlvbiAoKSB7CgkJbG9jYWxTdG9yYWdlW3RoaXMuc3RvcmFnZUtleV0gPSBKU09OLnN0cmluZ2lmeSh0aGlzLmNhY2hlKTsKCX0sCgoJLy8g5YWs5byA5o6l5Y+jOiDojrflj5bpu4TmmJPnmoTpn7PkuZDlnLDlnYAKCS8vIOS8mOWFiOivu+WPlue8k+WtmCwg6Ziy5q2i6KKr5p+l5p2ACglnZXROZXRFYXNlOiBmdW5jdGlvbiAoc29uZ0lkLCBjYWxsYmFjaykgewoJCXZhciBzZWxmID0gdGhpczsKCgkJdmFyIGNhY2hlU29uZyA9IHRoaXMuY2FjaGVSZWFkKHNvbmdJZCk7CgkJaWYgKGNhY2hlU29uZykgewoJCQljYWxsYmFjayhjYWNoZVNvbmcudXJsKTsKCQkJcmV0dXJuIDsKCQl9CgoJCUdNX3htbGh0dHBSZXF1ZXN0KHsKCQkJbWV0aG9kOiAiR0VUIiwKCQkJdXJsOiAnaHR0cDovL2l0d3VzdW4uY29tL3NlYXJjaC93eS8nICsgc29uZ0lkICsgJz9wPTEmZj1qc29uJnNpZ249aXR3dXN1bicsCgkJCW9ubG9hZDogZnVuY3Rpb24ocmVzcG9uc2UpIHsKCQkJCS8vIOino+aekOaVsOaNrgoJCQkJdmFyIGRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7CgkJCQlpZiAoZGF0YS5sZW5ndGggPT09IDApIHsKCQkJCQljYWxsYmFjayhudWxsKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCS8vIOeOsOWcqOWwneivleivu+WPluatjOabsuaVsOaNrgoJCQkJdmFyIHNvbmcgPSBkYXRhLmZpbHRlcihmdW5jdGlvbiAoc29uZykgewoJCQkJCXJldHVybiBzb25nLlR5cGUgPT0gInd5IiAmJiBzb25nLlNvbmdJZCA9PSBzb25nSWQ7CgkJCQl9KS5wb3AoKTsKCgkJCQkvLyDmsqHmnInmib7liLAKCQkJCWlmICghc29uZykgewoJCQkJCWNhbGxiYWNrKG51bGwpOwoJCQkJCXJldHVybiA7CgkJCQl9CgoJCQkJLy8g5LyY5YWI6I635Y+W6auY5riF6Z+z6LSoCgkJCQl2YXIgdXJsID0gc29uZy5TcVVybCB8fCBzb25nLkhxVXJsIHx8IHNvbmcuTHFVcmw7CgoJCQkJLy8g5YKo5a2YCgkJCQl2YXIgc29uZ09iaiA9IHsKCQkJCQl0aW1lOiBEYXRlLm5vdygpLAoJCQkJCXVybDogdXJsLAoJCQkJfTsKCgkJCQlzZWxmLmNhY2hlW3NvbmdJZF0gPSBzb25nT2JqOwoJCQkJc2VsZi5jYWNoZVNhdmUoKTsKCQkJCWNhbGxiYWNrKHVybCk7CgkJCX0KCQl9KTsKCX0KfSksCi8qIENvbXBpbGVkIGZyb20gZGwuMTE5Zy5qcyAqLwp7CglpZDogJ2RsLjExOWcnLAoJbmFtZTogJzExOWcg572R55uYJywKCWhvc3Q6IFsnZC4xMTlnLmNvbSddLAoJbm9TdWJIb3N0OiB0cnVlLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5iZWdpbldpdGggKGxvY2F0aW9uLnBhdGhuYW1lLCAnL2YvJykgJiYgIUguY29udGFpbnMgKGxvY2F0aW9uLnBhdGhuYW1lLCAnX2JhaycpKSB7CgkJCWxvY2F0aW9uLnBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgvKF8uKyk/XC4vLCAnX2Jhay4nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuMTIzNTY0LmpzICovCnsKCWlkOiAnZGwuMTIzNTY0JywKCW5hbWU6ICcxMjM1NjQg572R55uYJywKCWhvc3Q6IFsnMTIzNTY0LmNvbScsICdtLjEyMzU2NC5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCgljc3M6ICcuYWQxe2hlaWdodDoxcHggIWltcG9ydGFudH0nLAoJaGlkZTogWycjbG9hZGluZycsICcjeXptJ10sCglzaG93OiAnI2Rvd25sb2FkJywKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVXaW5kb3cua2lsbHBhbmFkcyA9IDE7Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJJCgnI2Rvd25sb2FkID4gYScpLmNsaWNrKCk7Cgl9Cn0KLAovKiBDb21waWxlZCBmcm9tIGRsLjV4ZmlsZS5qcyAqLwovKioKICogNXhmaWxlLmNvbQogKiAgIOS6lOaYn+e9keebmCAoPykKICovCih7CglpZDogJ2RsLjV4ZmlsZScsCgluYW1lOiAn5LqU5pif572R55uYJywKCWhvc3Q6IFsnd3d3LjV4ZmlsZS5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCgloaWRlOiBbCgkJJy5mYl9yJywgJ2lmcmFtZScsICdbaWRePSJfXyJdJywgJyNhZGRyX2JveCcKCV0sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCW9wZW46IHRGdW5jCgkJfSk7CgkJSC5waHBEaXNrQXV0b1JlZGlyICgpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQl2YXIgZmlsZSA9IGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cZCsvKTsKCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChmaWQpIHsKCQkJaWYgKHR5cGVvZiBsb2FkX2Rvd25fYWRkcjEgPT0gJ2Z1bmN0aW9uJykKCQkJCWxvYWRfZG93bl9hZGRyMShmaWQpOwoJCX0sIGZpbGVbMF0pOwoJfQp9KSwKLyogQ29tcGlsZWQgZnJvbSBkbC43OTU4LmpzICovCnsKCWlkOiAnZGwuNzk1OCcsCgluYW1lOiAn5Y2D5Yab5LiH6ams572R55uY57O75YiXJywKCWhvc3Q6IFsnNzk1OC5jb20nLCAncWp3bS5jb20nXSwKCWhpZGU6IFsKCQknI2Rvd250YycsICdbaWRePSJjcHJvXyJdJywgJy5kb3dubG9hZF9hbGVydCcsICcjaW5wdXR5em0nLAoJCScjaG91c2UnLCAnI3VwdG93bicsICdhW2hyZWYkPSJtb25leS5odG1sIl0nLCAnYVtocmVmJD0icmVnLmh0bWwiXScKCV0sCglzaG93OiBbJyNkb3dudGMyJywgJy5uZXdfZG93biddLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguY29udGFpbnMgKGxvY2F0aW9uLnBhdGhuYW1lLCAnZG93bl8nKSkgewoJCQlsb2NhdGlvbi5wYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoJ18nLCAnbG9hZF8nKTsKCQl9CgoJCUgud2FpdFVudGlsKCdhdXRoYWQnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZURlZmluZUZ1bmN0aW9uICgnYXV0aGFkJywgdEZ1bmMpOwoJCX0pOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLjlwYW4uanMgKi8KewoJaWQ6ICdkbC45cGFuJywKCW5hbWU6ICc555uYJywKCWhvc3Q6ICd3d3cuOXBhbi5uZXQnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoIC9cL1xkLy50ZXN0ICggbG9jYXRpb24ucGF0aG5hbWUgKSApIHsKCQkJbG9jYXRpb24ucGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlICgnLycsICcvZG93bi0nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuYmFpZHUuanMgKi8KewoJaWQ6ICdkbC5iYWlkdScsCgluYW1lOiAn55m+5bqm55uY5YWN5LiL6L29566h5a62JywKCWhvc3Q6IFsneXVuLmJhaWR1LmNvbScsICdwYW4uYmFpZHUuY29tJ10sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC53YWl0VW50aWwgKCdyZXF1aXJlJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoKSB7CgkJCQl2YXIgc2VydmljZSA9IHJlcXVpcmUoJ2Rpc2stc3lzdGVtOndpZGdldC9wbHVnaW4vZG93bmxvYWQvdXRpbC9kb3dubG9hZENvbW1vblV0aWwuanMnKTsKCQkJCXNlcnZpY2UuaXNQbGF0Zm9ybVdpbmRvd3MgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZTsgfTsKCQkJfSk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwuYngwNjM1LmpzICovCnsKCWlkOiAnZGwuYngwNjM1JywKCW5hbWU6ICfmmrTpm6rnm5gnLAoJaGlkZTogJyNiMj46bm90KCNkb3duX2JveCksIC50aXQgKyBkaXYsIC5jbGVhcitkaXYsIC5sb2dvX3InLAoJaG9zdDogJ2J4MDYzNS5jb20nLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXVuc2FmZVdpbmRvdy5vcGVuID0gbnVsbDsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5jb2xhZmlsZS5qcyAqLwp7CglpZDogJ2RsLmNvbGFmaWxlJywKCW5hbWU6ICflj6/kuZDnm5gnLAoJaG9zdDogWydjb2xheXVuLmNvbScsICdjb2xhZmlsZS5jb20nLCAnY29sYWRyaXZlLmNvbSddLAoJaGlkZTogWwoJCScudGFibGVfcmlnaHQnLCAnI2Rvd25fbGluazMnLCAnLnR1aScsICcuYWQxID4gLmFkMSA+ICo6bm90KC5kb3duYm94KScsCgoJCS8vIOiuoeaXtuS4i+i9vemhteeahOW5v+WRigoJCScuaG90cmVjLWVsZScsICcudmlld3NoYXJlLWNvcHktb3V0ZXInCgldLAoJZ2VuRGlnaXQ6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gTWF0aC5jZWlsKE1hdGgucmFuZG9tKCkgKiAyNTUpOwoJfSwKCWdlblZhbGlkSXA6IGZ1bmN0aW9uICgpIHsKCQlyZXR1cm4gWzAsMCwwLDBdLm1hcCh0aGlzLmdlbkRpZ2l0KS5qb2luKCcuJyk7Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGZpbGVfaWQgPSBsb2NhdGlvbi5wYXRobmFtZS5tYXRjaCgvXGQrLylbMF07CgoJCSQuYWpheCh7CgkJCXVybDogJy8vJyArIGxvY2F0aW9uLmhvc3RuYW1lICsgJy9hamF4LnBocD9hY3Rpb249ZG93bmFkZHJlc3MmZmlsZV9pZD0nICsgZmlsZV9pZCwKCQkJaGVhZGVyczogewoJCQkJJ1gtRm9yd2FyZGVkLUZvcic6IHRoaXMuZ2VuVmFsaWRJcCgpCgkJCX0sCgkJCWRhdGFUeXBlOiAndGV4dCcKCQl9KS5zdWNjZXNzIChmdW5jdGlvbiAocikgewoJCQl2YXIgJGRsID0gci5tYXRjaCAoL2Rvd25sb2FkRmlsZVwoIiguKz8pIi8pWzFdLnJlcGxhY2UoJy9kbC5waHAnLCAnL3RkLnBocCcpOwoJCQl2YXIgbGlua1RleHQgPSBILnNwcmludGYoJyVzIOS4k+eUqOS4i+i9vScsIEguc2NyaXB0TmFtZSk7CgoJCQkvLyDmlrDniYgKCQkJJCgnPGE+JykuYWRkQ2xhc3MgKCduZXctZGJ0bicpCgkJCQkuYXR0ciAoJ2hyZWYnLCAkZGwpCgkJCQkuYXBwZW5kICgkKCc8ZW0+JykuYWRkQ2xhc3MgKCdpY29uLWRvd25sb2FkJykpCgkJCQkuYXBwZW5kICgkKCc8Yj4nKS50ZXh0IChsaW5rVGV4dCkpCgkJCQkuYXBwZW5kVG8gKCQoJy5zbGlkZS1oZWFkZXItZnVuY3MnKSk7CgoJCQkvLyDml6fniYgKCQkJJCgnPGE+JykuYWRkQ2xhc3MgKCdidXR0b24gYnRuLWdyZWVuJykKCQkJCS5hdHRyICgnaHJlZicsICRkbCkKCQkJCS5hcHBlbmQgKCQoJzxpPicpLmFkZENsYXNzICgnaWNvbicpKQoJCQkJLmFwcGVuZCAobGlua1RleHQpCgkJCQkuYXBwZW5kVG8gKCQoJyNkb3duX3ZlcmlmeV9ib3ggPiBsaScpKQoJCQkJLmNzcyAoewoJCQkJCXdpZHRoOiAzMDAsCgkJCQkJbWFyZ2luOiAnMmVtIDAnCgkJCQl9KTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5jdGRpc2suanMgKi8KewoJaWQ6ICdkbC5jdGRpc2snLAoJbmFtZTogJ+WfjumAmue9keebmOezu+WIlycsCglob3N0OiBbCgkJJzQwMGdiLmNvbScsICdjdGRpc2suY29tJywgJ3BpcGlwYW4uY29tJywgJ2JlZ28uY2MnLAoJCSdjdGZpbGUuY29tJywgJ3QwMHkuY29tJwoJXSwKCXBhdGg6ICcvZmlsZS8nLAoJaGlkZTogWycuY2FwdGNoYScsICcua2tfeHNob3cnLCAnZGl2LnNwYW42OmZpcnN0LWNoaWxkJywgJyN0b3AgPiAuYWxlcnQnXSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkvLyBGaXggQW50aS1BQlAgYXMgaXQgZG9lc24ndCBjaGVjayB0aGUgY29kZS4KCQlILndhaXRVbnRpbCAoJ2d1ZXN0dmlld2Noa2Zvcm0nLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkJd2luZG93Lmd1ZXN0dmlld2Noa2Zvcm0gPSBmdW5jdGlvbiAoZm9ybSkgewoJCQkJCXJldHVybiBmb3JtLnJhbmRjb2RlICYmIGZvcm0ucmFuZGNvZGUudmFsdWUubGVuZ3RoID09IDQ7CgkJCQl9OwoJCQl9KTsKCQl9KTsKCgkJdmFyIGtleUZvcm0gPSBkb2N1bWVudC51c2VyX2Zvcm07CgkJdmFyICRrZiA9ICQoa2V5Rm9ybSk7CgkJCgkJdHJ5IHsKCQkJa2V5Rm9ybS5oYXNoX2tleS52YWx1ZSA9IEguYmFzZTY0RGVjb2RlKGtleUZvcm0uaGFzaF9pbmZvLnZhbHVlKTsKCQl9IGNhdGNoIChlKSB7CgkJCUguaW5mbyAoJ+e8uuWkseaIluaXoOaViOeahCBoYXNoX2tleSDlsZ7mgKflgLwsIOi3s+i/h+KApicpOwoJCX0KCgkJJGtmLmF0dHIoJ2FjdGlvbicsICRrZi5hdHRyKCdhY3Rpb24nKS5yZXBsYWNlKC8oVilcZC9pLCAnJDEyJykpOwoKCQkkKCcuY2FwdGNoYV9yaWdodCcpLmNzcygnZmxvYXQnLCAnbGVmdCcpOwoJCQoJCS8qIOWfjumAmueOsOWcqOeahOmqjOivgeeggeaYr+a3t+WQiOaVsOWtl+OAgeWtl+avjQoJCSQoJyN2ZmNvZGU6Zmlyc3QnKS5wYXJlbnQoKQoJCQkuYXBwZW5kKEguY3JlYXRlTnVtUGFkKDQsICQoJyNyYW5kY29kZScpWzBdLCBmdW5jdGlvbiAoKSB7CgkJCQkka2Yuc3VibWl0KCk7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSkpOwoJCSovCgoJCSQoJyNwYWdlX2NvbnRlbnQnKQoJCQkuYXR0cignaWQnLCAnXl9eJykKCQkJLnZhbCgnY3Byb0lmcmFtZXUxMjU4MTMwMnxodHRwdWJtY21tYmFpZHVzdGF0aWNjb21jcHJvbWVkaWFzbWFsbHBuZycpOwoKCQlILmxvZyAoJ+WfjumAmuWwsee7qi4nKTsKCX0sCgkKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCSQoJyNtb2RhbF9jYXB0Y2hhJykuYWRkQ2xhc3MoJ2luJykuc2hvdygpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLmRsa29vLmpzICovCnsKCWlkOiAnZGwuZGxrb28nLAoJbmFtZTogJ+Wkp+i/nueUn+a0u+e9kScsCglleGFtcGxlOiAnaHR0cDovL3d3dy5kbGtvby5jb20vZG93bi82LzIwMTEvMjIyNjg2NzU0Lmh0bWwnLAoJaG9zdDogWydkbGtvby5jb20nXSwKCXBhdGg6ICcvZG93bi9kb3duZmlsZS5hc3AnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlkb2N1bWVudC53cml0ZSA9IChmdW5jdGlvbiAoKSB7fSkuYmluZChudWxsKTsKCQkKICAgICAgICB2YXIgX2NlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQuYmluZChkb2N1bWVudCk7CiAgICAgICAgdGhpcy5jcmVhdGVFbGVtZW50ID0gX2NlbDsKCQlkb2N1bWVudC5jcmVhdGVFbGVtZW50ID0gKGZ1bmN0aW9uICh0YWcpIHsKCQkJaWYgKHRhZy50b0xvd2VyQ2FzZSgpID09ICdzY3JpcHQnKQoJCQkJdGFnID0gJ2Rpdic7CgkJCXJldHVybiBfY2VsKHRhZyk7CgkJfSkuYmluZChudWxsKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGZpcnN0RWwgPSBkb2N1bWVudC5ib2R5LmNoaWxkcmVuWzBdOwoJCWlmICghZmlyc3RFbCkgZmlyc3RFbCA9IGRvY3VtZW50LmJvZHk7CgoJCXZhciBmaXJzdFR4dCA9IGZpcnN0RWwudGV4dENvbnRlbnQ7CgkJaWYgKEguYmVnaW5XaXRoKGZpcnN0VHh0LCAn6Ziy55uX6ZO+5o+Q56S6JykgfHwgSC5iZWdpbldpdGgoZmlyc3RUeHQsICfpqozor4HnoIEnKSkgewoJCQlILnJlRGlyV2l0aFJlZihsb2NhdGlvbi5ocmVmKTsKCQkJcmV0dXJuIDsKCQl9IGVsc2UgaWYgKEguYmVnaW5XaXRoKGZpcnN0VHh0LCAn6Ziy5Yi35pawJykpIHsKCQkJZmlyc3RFbC5zdHlsZS53aGl0ZVNwYWNlID0gJ3ByZSc7CgkJCWZpcnN0RWwudGV4dENvbnRlbnQgKz0gJ1xuXG7or7fnqI3lkI4sIDXnp5LlkI7oh6rliqjliLfmlrDigKYnOwoJCQlzZXRUaW1lb3V0KEgucmVEaXJXaXRoUmVmLCA1NTAwLCBsb2NhdGlvbi5ocmVmKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXZhciBidG5EbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidHN1Ym1pdCcpOwoJCWlmIChidG5EbCkgewoJCQlidG5EbC5pZCA9IG51bGw7CgkJCWJ0bkRsLnZhbHVlID0gJ+W8gOWni+S4i+i9vSc7CgkJCWJ0bkRsLmRpc2FibGVkID0gZmFsc2U7CgoJCQl2YXIgZmFrZUJ0biA9IHRoaXMuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKCQkJZmFrZUJ0bi5pZCA9ICdidHN1Ym1pdCc7CgkJCSQoZmFrZUJ0bikuaGlkZSgpLmFwcGVuZFRvKCdib2R5Jyk7CgkJfQoJfQp9LAovKiBDb21waWxlZCBmcm9tIGRsLmhvd2ZpbGUuanMgKi8KewoJaWQ6ICdkbC5ob3dmaWxlJywKCW5hbWU6ICflpb3nm5gnLAoJaG9zdDogJ2hvd2ZpbGUuY29tJywKCQoJaGlkZTogWycjZmxvYXRkaXYgZGl2JywgJy5yb3cxX3JpZ2h0J10sCgljc3MgOiAnI2Zsb2F0ZGl2IHsgdG9wOiAxNTBweDsgei1pbmRleDogOTk5OTk7IGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7IH0nCn0sCi8qIENvbXBpbGVkIGZyb20gZGwubGVwYW4uY2MuanMgKi8KewoJaWQ6ICdjYy5sZXBhbicsCgluYW1lOiAn5LmQ55uY6Ieq5Yqo5LiL6L295Zyw5Z2AJywKCWhvc3Q6IFsnd3d3LmxlcGFuLmNjJywgJ3d3dy5zeDU2Ni5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCXNob3c6ICcjZG93bl9ib3gnLAoJaGlkZTogWycud2lkZ2V0LWJveCcsICdhW2hyZWY9InZpcC5waHAiXSddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCS8vIOegtOWdj+W5v+WRigoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh1bnNhZmVXaW5kb3csICdnb29nbGUnLCB7CgkJCXNldDogZnVuY3Rpb24gKCkgeyB9LAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKCk7IH0KCQl9KTsKCQkKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodW5zYWZlV2luZG93LCAnYWRzYnlnb29nbGUnLCB7CgkJCXNldDogZnVuY3Rpb24gKCkgeyB9LAoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsgdGhyb3cgbmV3IEVycm9yKCk7IH0KCQl9KTsKCQkKCQlILnJ1bGUuZXhlYygncGhwZGlzay56JywgJ29uU3RhcnQnKTsKCX0sCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkkKCcjZG93bl9ib3ggLndpZGdldC1ib3gnKS5yZW1vdmVDbGFzcygnd2lkZ2V0LWJveCcpOwoJCSQoJ1tocmVmKj0iZG93bi5sZXBhbi5jYy8/ZG93bnVybCJdJykuZWFjaChmdW5jdGlvbihpLCBlbCl7CgkJCWVsLnJlbW92ZUF0dHJpYnV0ZSgnb25jbGljaycpOwoJCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCQltZXRob2Q6ICJHRVQiLAoJCQkJdXJsOiBlbC5ocmVmLAoJCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJCXZhciB1cmwgPSByLnJlc3BvbnNlVGV4dC5tYXRjaCgvZGVsYXlVUkxcKCIoLis/KSIvKVsxXTsKCQkJCQljb25zb2xlLmluZm8oJ0ZpeCBsaW5rIHRvICVzJywgdXJsKTsKCQkJCQllbC5ocmVmID0gdXJsOwoJCQkJfQoJCQl9KTsKCQl9KTsKCX0KfQosCi8qIENvbXBpbGVkIGZyb20gZGwucmF5ZmlsZS5qcyAqLwp7CglpZDogJ2RsLnJheWZpbGUnLAoJbmFtZTogJ+mjnumAn+e9kScsCglob3N0OiAncmF5ZmlsZS5jb20nLAoJaGlkZTogWydkaXYubGVmdCddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCWlmICh1bnNhZmVXaW5kb3cudmtleSkgewoJCQlsb2NhdGlvbi5wYXRobmFtZSArPSB1bnNhZmVXaW5kb3cudmtleTsKCQl9IGVsc2UgewoJCQl1bnNhZmVXaW5kb3cuZmlsZXNpemUgPSAxMDA7CgkJCXVuc2FmZVdpbmRvdy5zaG93RG93bmxvYWQgKCk7CgkJCXVuc2FmZVdpbmRvdy5zaG93RG93bmxvYWQgPSBlRnVuYzsKCQkJCgkJCSQoJyNkb3dubG9hZGxpbmsnKS5hZGRDbGFzcygnYnRuX2Rvd25Ob3dfemgtY24nKTsKCQkJJCgnI3ZvZGxpbmsnKS5hZGRDbGFzcygnYnRuX2Rvd25Ub29sc196aC1jbicpOwoJCX0KCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBkbC5zdWR1cGFuLmpzICovCnsKCWlkOiAnZGwuc3VkdXBhbicsCgluYW1lOiAn6YCf5bqm55uYJywKCWhvc3Q6IFsnc3VkdXBhbi5jb20nXSwKCXNob3c6IFsnI3NkcHh6bGonLCAnI3NkcHh6bGogPiB0ZCddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmJlZ2luV2l0aChsb2NhdGlvbi5wYXRobmFtZSwgJy9kb3duXycpKSB7CgkJCWxvY2F0aW9uLnBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSAoJy9kb3duXycsICcvc2RwL3hpYXphaV8nKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZGwudmRpc2suanMgKi8KewoJaWQ6ICdkbC52ZGlzaycsCgluYW1lOiAn5aiB55uYJywKCWhvc3Q6IFsndmRpc2suY24nXSwKCWhpZGU6IFsnI2xvYWRpbmdib3gnLCAnI3lhbnpoZW5nYm94JywgJyN5em1ib3gnLCAnI2dldGJveCA+IC5idG46Zmlyc3QtY2hpbGQnXSwKCXNob3c6IFsnI2J0bmJveCddCn0sCi8qIENvbXBpbGVkIGZyb20gZGwueWltdWhlLmpzICovCnsKCWlkOiAnZGwueWltdWhlJywKCW5hbWU6ICfkuIDmnKjnpr7nvZHnm5gnLAoJaG9zdDogJ3lpbXVoZS5jb20nLAoKCWhpZGU6IFsnI2xvYWRpbmcnLCAnLmdnYW8nLCAnLmt1YW4nXSwKCXNob3c6IFsnI3l6bSddLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlILnBocERpc2tBdXRvUmVkaXIoKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguYmVnaW5XaXRoICggbG9jYXRpb24ucGF0aG5hbWUsICcvbl9kZC5waHAnICkpIHsKCQkJSC5yZURpcldpdGhSZWYoJCgnI2Rvd25zJykuYXR0cignaHJlZicpKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXZhciBkbENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkICgnZG93bmxvYWQnKTsKCQlpZiAoIWRsQ29udGFpbmVyKSByZXR1cm4gOwoKCQkvLyDlvZPkuIvovb3moYbnmoQgc3R5bGUg5bGe5oCn6KKr5pu05pS55ZCOLCDmqKHmi5/kuIvovb3mjInpkq7ljZXlh7suCgkJdmFyIG1vID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uICgpIHsKCQkJJCgnYScsIGRsQ29udGFpbmVyKVsxXS5jbGljaygpOwoJCX0pOwoJCW1vLm9ic2VydmUgKGRsQ29udGFpbmVyLCB7IGF0dHJpYnV0ZXM6IHRydWUgfSk7CgoJCSQoJyN5em0+Zm9ybScpCgkJCS5hcHBlbmQoSC5jcmVhdGVOdW1QYWQoNCwgJyNjb2RlJywgZnVuY3Rpb24gKCkgewoJCQkJZG9jdW1lbnQueXpjb2RlLlN1Ym1pdC5jbGljaygpOwoJCQkJcmV0dXJuIHRydWU7CgkJCX0sIGZ1bmN0aW9uICgpIHsKCQkJCSQoJyN2Y29kZV9pbWcnKVswXS5jbGljaygpOwoJCQl9KSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gZm0uZG91YmFuLmpzICovCnsKCWlkOiAnZm0uZG91YmFuJywKCW5hbWU6ICfosYbnk6PnlLXlj7AnLAoJaG9zdDogJ2RvdWJhbi5mbScsCglub1N1Ykhvc3Q6IHRydWUsCgljc3M6IC8qIFJlc291cmNlOiBmbS5kb3ViYW4uZGwuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCmEjanhfZG91YmFuX2RsIHsKCWJhY2tncm91bmQ6ICM5REQ2QzU7CglwYWRkaW5nOiAzcHggNXB4OwoJY29sb3I6ICNmZmYKfQoKYSNqeF9kb3ViYW5fZGw6aG92ZXIgewoJbWFyZ2luLWxlZnQ6IDVweDsKCXBhZGRpbmctbGVmdDogMTBweDsKCWJhY2tncm91bmQ6ICNCQUUyRDY7Cn0KCmRpdiNqeF9kb3ViYW5fZGxfd3JhcCB7CglmbG9hdDogcmlnaHQ7CgltYXJnaW4tdG9wOiAtMjMwcHg7CgltYXJnaW4tcmlnaHQ6IC0zMnB4OwoJZm9udC13ZWlnaHQ6IGJvbGQ7Cglmb250LWZhbWlseTogJ01pY3Jvc29mdCBKSGVuZ0hlaSBVSScsICflvq7ova/pm4Xpu5EnLCBzZXJpZi1zYW5zOwp9CiovfSksCgoJLy8g5Y+C6ICD5Luj56CBIOixhuiXpCwgVVNPOiA0OTkxMQoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdmFyIGxpbmtEb3dubG9hZCA9ICQoJzxhPicpLmNzcyhILm1ha2VEZWxheUNzcygpKQoJCQkuYXR0ciAoJ3RhcmdldCcsICdfYmxhbmsnKQoJCQkuYXR0ciAoJ2lkJywgJ2p4X2RvdWJhbl9kbCcpCgkJCS50ZXh0ICgn5LiL6L29Jyk7CgoJCSQoJzxkaXY+JykKCQkJLmF0dHIgKCdpZCcsICdqeF9kb3ViYW5fZGxfd3JhcCcpCgkJCS5hcHBlbmQobGlua0Rvd25sb2FkKQoJCQkuaW5zZXJ0QWZ0ZXIoJy5wbGF5ZXItd3JhcCcpOwoJCQoJCUgubG9nICgn562J5b6F6LGG55Oj55S15Y+w5Yqg6L29IC4uJyk7CgkJCgkJSC53YWl0VW50aWwoJ2V4dFN0YXR1c0hhbmRsZXInLCBmdW5jdGlvbiAoKSB7CgkJCUgubG9nICgn57uR5a6a5Ye95pWwIC4uJyk7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlleHRTdGF0dXNIYW5kbGVyOiBmdW5jdGlvbiAoanNvblNvbmdPYmopIHsKCQkJCQl2YXIgc29uZ09iaiA9IEpTT04ucGFyc2UoanNvblNvbmdPYmopOwoJCQkJCWlmICgnc3RhcnQnID09IHNvbmdPYmoudHlwZSAmJiBzb25nT2JqLnNvbmcpIHsKCQkJCQkJbGlua0Rvd25sb2FkCgkJCQkJCQkuYXR0cignaHJlZicsIEgudXJpIChzb25nT2JqLnNvbmcudXJsLCBzb25nT2JqLnNvbmcudGl0bGUgKyBzb25nT2JqLnNvbmcudXJsLnNsaWNlKC00KSkpCgkJCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zb25nLnRpdGxlKTsKCQkJCQkJCgkJCQkJCUguaW5mbyAoJyVzID0+ICVzJywgc29uZ09iai5zb25nLnRpdGxlLCBzb25nT2JqLnNvbmcudXJsKTsKCQkJCQl9CgoJCQkJCXRocm93IG5ldyBFcnJvclVuc2FmZVN1Y2Nlc3MgKCk7CgkJCQl9CgkJCX0pOwoKCQkJSC5sb2cgKCflh73mlbDnu5Hlrprlrozmr5UsIEVuam95ficpOwoJCQkKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBmbS5qaW5nLmpzICovCnsKCWlkOiAnZm0uamluZycsCgluYW1lOiAnSmluZy5mbScsCglob3N0OiAnamluZy5mbScsCglub1N1Ykhvc3Q6IHRydWUsCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxCb3ggPSAkKCc8YT4nKS5jc3MoewoJCQlwb3NpdGlvbjogJ2Fic29sdXRlJywKCQkJcmlnaHQ6IDAsCgkJCXpJbmRleDogOQoJCX0pLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKS50ZXh0KCfkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdGhpcy5kbEJveAoJCQkJLmF0dHIgKCAnaHJlZicsIEguZ2V0Rmlyc3RWYWx1ZSAoc29uZ09iaikucmVwbGFjZSgvXD8uKy8sICcnKSApCgkJCQkuYXR0ciAoICd0aXRsZScsICQoJyNtc2NQbHIgPiAudGl0JykudGV4dCAoKSApOwoJCX0uYmluZCAodGhpcykpOwoKCQlILndhaXRVbnRpbCAoJ1BsYXllci5sb2FkJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQkJbG9hZDogZnVuY3Rpb24gKCkgewoJCQkJCXNldFRpbWVvdXQgKGZ1bmN0aW9uICgpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAoIG5ldyBDdXN0b21FdmVudCAoJ2p4X2ppbmdfZm1fcGxheWVyX2xvYWRlZCcpICk7CgkJCQkJfSwgMTAwKTsKCgkJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcygpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cuUGxheWVyLCAnLlBsYXllcicpOwoJCX0pOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICgnanhfamluZ19mbV9wbGF5ZXJfbG9hZGVkJywgZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCdKaW5nLmZtIOaSreaUvuWZqOWKoOi9veWujOavlScpOwoJCQl0aGlzLmRsQm94LmFwcGVuZFRvKCQoJyNtc2NQbHInKSk7CgkJfS5iaW5kICh0aGlzKSwgZmFsc2UpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIGZtLm1vZS5qcyAqLwovKioKICog6JCM5ZCm6Z+z5LmQ55S15Y+wCiAqIDIwMTYuMDQuMDg6IOS/ruWkjeS7pemAguW6lOaWsOeJiOaSreaUvuWZqOS7o+eggeOAggogKi8KKHsKCWlkOiAnZm0ubW9lJywKCW5hbWU6ICfokIznlLXlj7AgW21vZS5mbV0nLAoJaG9zdDogJ21vZS5mbScsCglub1N1Ykhvc3Q6IHRydWUsCglwYXRoOiAnL2xpc3Rlbi9oNScsCgloaWRlOiBbJyNwcm9tb3Rpb25fbHMnXSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlILndhaXRVbnRpbCgnc2VhanMnLCBmdW5jdGlvbiAoKSB7CgkJCS8vIOeZu+W9leegtOinowoJCQl1bnNhZmVXaW5kb3cuaXNfbG9naW4gPSB0cnVlOwoJCQkKCQkJLy8g5LiL6L295oyJ6ZKuCgkJCXZhciBkbExpbmsgPSAkKCc8YT4nKS5hZGRDbGFzcygncGxheWVyLWJ1dHRvbiBsZWZ0JykuY3NzKEgubWFrZVJvdGF0ZUNzcyg5MCkpLmNzcyh7CgkJCQknd2lkdGgnOiAnMjZweCcsCgkJCQknYmFja2dyb3VuZC1wb3NpdGlvbic6ICctMTlweCAtOTZweCcKCQkJfSkuaW5zZXJ0QWZ0ZXIgKCQoJ2Rpdi5wbGF5ZXItYnV0dG9uLmJ1dHRvbi12b2x1bWUnKS5maXJzdCgpKTsKCQkJCgkJCS8vIOebkeWQrAoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoJCQkJSC5pbmZvKHNvbmdPYmopOwoKCQkJCWRsTGluawoJCQkJCS5hdHRyKCdocmVmJywgSC51cmkoc29uZ09iai51cmwsIHNvbmdPYmouc3ViX3RpdGxlICsgJy5tcDMnKSkKCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zdWJfdGl0bGUpOwoJCQl9LCBmYWxzZSk7CgoJCQkvLyDmjILovb3lpJbmjILmqKHnu4QKCQkJdW5zYWZlRXhlYyAoZnVuY3Rpb24gKHNjcmlwdE5hbWUpIHsKCQkJCWZ1bmN0aW9uIG5vdGlmeVVwZGF0ZSAoY2xpcCkgewoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUsIHtkZXRhaWw6IGNsaXAgfSkgKTsKCQkJCX0KCgkJCQlkZWZpbmUoJ3BsdWdpbi9qaXh1bicsIGZ1bmN0aW9uKHJlcXVpcmUsIGV4cG9ydHMpIHsKCQkJCQljb25zb2xlLmluZm8oJ1tDVVdDTDRDXSDlvIDlp4vms6jlhaUgLi4uJyk7CgkJCQkJdmFyIGxpc3RlbiA9IHJlcXVpcmUoJy9wdWJsaWMvanMvZm0vcGFnZS9saXN0ZW4uanMnKTsKCQkJCQl2YXIgcGxheWVyID0gcmVxdWlyZSgncGxheWVyL3BsYXllcicpOwoKCQkJCQl2YXIgX2luaXRQbGF5ZXIgPSBwbGF5ZXIuaW5pdFBsYXllcjsKCQkJCQlwbGF5ZXIuaW5pdFBsYXllciA9IGZ1bmN0aW9uIChjbGlwKSB7CgkJCQkJCW5vdGlmeVVwZGF0ZShjbGlwKTsKCQkJCQkJX2luaXRQbGF5ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCWNvbnNvbGUuaW5mbygnW0NVV0NMNENdIOazqOWFpee7k+adnyAuLi4nKTsKCQkJCX0pOwoJCQkJCgkJCQkvLyDopoHmsYLovb3lhaXlpJbmjILmqKHnu4QKCQkJCXNlYWpzLnVzZSgncGx1Z2luL2ppeHVuJyk7CgkJCX0sIEguc2NyaXB0TmFtZSk7CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIGZtLnFxLmpzICovCnsKCWlkOiAnZm0ucXEnLAoJbmFtZTogJ1FRIOeUteWPsOS4i+i9veino+aekCcsCglob3N0OiAnZm0ucXEuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgubG9nICgnV2FpdGluZyBmb3IgZm1RUS4uLicpOwoJCUgud2FpdFVudGlsKCckLnFQbGF5ZXIucGxheWVyLnBsYXlVcmwnLCBmdW5jdGlvbiAoKSB7CgkJCUgubG9nICgnZm1RUSBIb29rIHN0YXJ0IScpOwoJCQkKCQkJLy8gQ3JlYXRlRExCdXR0b24KCQkJdmFyIGRsTGluayA9ICQoJzxhPicpLmNzcyhILm1ha2VSb3RhdGVDc3MoOTApKS5jc3MoewoJCQkJJ2JhY2tncm91bmQtcG9zaXRpb24nOiAnLTI0cHggLTczcHgnCgkJCX0pOwoJCQkkKCcuYnRuX2RlbCcpLmFmdGVyKGRsTGluayk7CgkJCQoJCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoKCQkJCWRsTGluawoJCQkJCS5hdHRyKCdocmVmJywgSC51cmkoc29uZ09iai5zb25ndXJsLCBzb25nT2JqLm1zb25nICsgJy5tcDMnKSkKCQkJCQkuYXR0cigndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5tc29uZyk7CgkJCX0sIGZhbHNlKTsKCgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uICgpIHsKCQkJCXZhciBfcGxheXVybCA9IHdpbmRvdy4kLnFQbGF5ZXIucGxheWVyLnBsYXlVcmwuYmluZCh3aW5kb3cuJC5xUGxheWVyLnBsYXllcik7CgkJCQl2YXIgX3VwZGF0ZVVybCA9IGZ1bmN0aW9uICgpIHsKCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHtkZXRhaWw6ICQucVBsYXllci5wbGF5TGlzdC5nZXRTb25nSW5mb09iaigpIH0pICk7CgkJCQl9CgkJCQl3aW5kb3cuJC5xUGxheWVyLnBsYXllci5wbGF5VXJsID0gZnVuY3Rpb24gKCkgewoJCQkJCV91cGRhdGVVcmwgKCk7CgkJCQkJcmV0dXJuIF9wbGF5dXJsLmFwcGx5ICgwLCBhcmd1bWVudHMpOwoJCQkJfTsKCgkJCQlfdXBkYXRlVXJsICgpOwoJCQl9KTsKCgkJCUgubG9nICgnZm1RUSBIb29rIGZpbmlzaCEnKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy4xNjMuanMgKi8KLyoqCiAqIOe9keaYk+mfs+S5kOS4i+i9veino+aekCBCeSBKaXh1bgogKiAg4oCU4oCUIOWPl+WkoOS6hiBDb2ZmZWUgU2NyaXB0IOS6hgogKi8KKHsKCWlkOiAnbXVzaWMuMTYzJywKCW5hbWU6ICfnvZHmmJPpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogJ211c2ljLjE2My5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJbm9GcmFtZTogZmFsc2UsCglkbF9pY29uOiB0cnVlLAoJY3NzOiAvKiBSZXNvdXJjZTogY29tLjE2My5tdXNpYy5kbC5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKLm0tcGJhciwgLm0tcGJhciAuYmFyYmcgewoJd2lkdGg6IGNhbGMoIDQ1NXB4IC0gMi41ZW0gKTsKfQoKLm0tcGxheWJhciAucGxheSB7Cgl3aWR0aDogY2FsYyggNTcwcHggLSAyLjVlbSApOwp9CgoubS1wbGF5YmFyIC5vcGVyIHsKCXdpZHRoOiBpbml0aWFsOwp9CgouanhfZGw6aG92ZXIgewoJY29sb3I6IHdoaXRlOwp9CgotLSDlupXpg6jljZXmm7LkuIvovb0KLm0tcGxheWJhciAub3BlciAuanhfYnRuIHsKCXRleHQtaW5kZW50OiAwOwoJZm9udC1zaXplOiAxLjVlbTsKCW1hcmdpbjogMTNweCAycHggMCAwOwoJZmxvYXQ6IGxlZnQ7Cgljb2xvcjogI2NjYzsKCXRleHQtc2hhZG93OiAxcHggMXB4IDJweCBibGFjaywgMCAwIDFlbSBibGFjaywgMCAwIDAuMmVtICNhYWE7CglsaW5lLWhlaWdodDogMS42ZW07Cglmb250LXNpemU6IDEuMmVtOwp9CgoubS1wbGF5YmFyIC5vcGVyIC5qeF9kbDo6YmVmb3JlIHsKCXBhZGRpbmctcmlnaHQ6IC4yNWVtOwp9CgouanhfYnRuOmhvdmVyIHsKCWNvbG9yOiB3aGl0ZTsKfQoKLS0g5pKt5pS+5YiX6KGo5LiL6L29Ci5tLXBsYXliYXIgLmxpc3RoZGMgLmp4X2RsLmFkZGFsbCB7CglsZWZ0OiAzMDZweDsKCWxpbmUtaGVpZ2h0OiAxZW07CgktLSDlpJrkuIDkuKogcHgsIOWvuem9kOaWh+WtlwoJdG9wOiAxM3B4Owp9CgoubS1wbGF5YmFyIC5saXN0aGRjIC5saW5lLmp4X2RsX2xpbmUgewoJbGVmdDogMzg1cHg7Cn0KKi99KSwKCV9fTVAzX0JMQU5LOiAnaHR0cHM6Ly9qaXh1bm1vZS5naXRodWIuaW8vY3V3Y2w0Yy9ibGFuay5tcDMnLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmNvbmZpZy5iVXNlVGhyaWRPbkZhaWwpIHsKCQkJSC5ydWxlLmdldCgnYXBpLm11c2ljLnNweScpLmluaXQoKTsKCQl9CgoJCXRoaXMuYlByb3h5TG9jYWwgPSBILmNvbmZpZy5iSW50ZXJuYXRpb25hbCAmJiBILmNvbmZpZy5iUHJveHlJbnN0YWxsZWQ7CgoJCWlmIChILmNvbmZpZy5iSW50ZXJuYXRpb25hbCkKCQkJdGhpcy5nZW5lcmF0ZUNkbigpOwoKCQlpZiAobG9jYWxTdG9yYWdlLl9fSElERV9CQU5ORVIpIHsKCQkJSC5mb3JjZUhpZGUoJyNpbmRleC1iYW5uZXInKTsKCQl9CgoJCXRoaXMucmVnUGxheWVyKCk7CgoJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkvLyDkvJjlhYjkvb/nlKggSFRNTDUg5pKt5pS+5ZmoCgkJCS8vIOWmguaenOayoeacieWGjeiAg+iZkSBGbGFzaCDmlK/mj7QKCQkJCgkJCS8vIOaEn+inieW5tuayoeacieS7gOS5iOWNteeUqOS6hj8KCQkJdmFyIGZha2VQbGF0Rm9ybSA9IG5hdmlnYXRvci5wbGF0Zm9ybSArICItLUZha2UtbWFjIjsKCQkJT2JqZWN0LmRlZmluZVByb3BlcnR5KG5hdmlnYXRvciwgInBsYXRmb3JtIiwgewoJCQkJZ2V0OiBmdW5jdGlvbigpeyByZXR1cm4gZmFrZVBsYXRGb3JtOyB9LAoJCQkJc2V0OiBmdW5jdGlvbigpe30KCQkJfSk7CgoKCQkJLy8g6aCG5L6/LCDop6PpjpblhajnkIPpmZDliLYKCQkJd2luZG93LkdSZXN0cmljdGl2ZSA9IGZhbHNlOwoJCX0pOwoJfSwKCglnZW5lcmF0ZUNkbjogZnVuY3Rpb24gKCkgewoJCS8vIFRPRE86CgkJLy8gKyDnlKjmiLfmj5DkvpsgQ0ROIOWIl+ihqAoJCS8vICsg55So5oi35oyH5a6a5L2/55So55qEIElQIOe8k+WtmOiKgueCuSAo5aW95YOP5Lya6ZqP5py6PykKCQkvLyDpmo/kvr8gcGluZyDkuoblh6DkuKoKCQl2YXIgY2RucyA9IFsKCQkJLy8g55S15L+hCgkJCSIxMjUuOTAuMjA2LjMyIiwgCgkJCSIyMjIuMTg2LjEzMi4xMDMiLCAKCQkJIjExNy4yMy42Ljg5IiwgCgkJCSIxMTkuMTQ1LjIwNy4xNyIsIAoJCQkiMTgwLjk3LjE4MC43MSIsIAoJCQkiMTE2LjU1LjIzNi45MyIsIAoJCQkiMjE4Ljc2LjEwNS40MiIsIAoJCQkiMTI1LjY0LjIzMi4xNSIsIAoJCQkiMTE1LjIzMS44Ny4zNyIsIAoJCQkiNTguMjIxLjc4LjY4IiwgCgkJCSIyMjAuMTEyLjE5NS4xNDgiLCAKCQkJIjIxOC42NC45NC42NyIsIAoJCQkiMzYuNDIuMzIuNzYiLCAKCQkJIjYxLjEzNi4yMTEuMTYiLCAKCQkJIjIxOC42NC45NC42OCIsIAoJCQkiMjE5LjEzOC4yMS43MSIsIAoJCQkiNDkuNzkuMjMyLjU4IiwgCgkJCSIxMjIuMjI4LjI0LjMwIiwgCgkJCSIxODIuMTA2LjE5NC44NSIsIAoJCQkiMjE4LjU5LjE4Ni45OCIsIAoJCQkiNjEuMTU4LjEzMy4yMSIsIAoJCQkiMTE3LjI3LjI0MS4yMCIsIAoJCQkiNTguNTEuMTUwLjEzMyIsIAoJCQkiMjE4LjI5LjQ5LjEzMiIsIAoJCQkiNjAuMjE1LjEyNS43NiIsIAoJCQkiMTgzLjYxLjIyLjE3IiwgCgkJCSIxODMuMTM0LjE0LjI2IiwgCgkJCSI1OC4yMjAuNi4xNDIiLCAKCQkJIjExNS4yMzEuMTU4LjQ0IiwgCgkJCSI2MS4xNjQuMjQxLjEwNSIsIAoJCQkiMTI1LjQ2LjIyLjEyNCIsIAoJCQkiMjIyLjI4LjE1Mi4xMzkiLCAKCQkJIjEyNC4xNjUuMjE2LjI0NCIsIAoJCQkiMjE4LjYwLjEwNi4xMTUiLCAKCQkJIjIwMi4xMDcuODUuODEiLCAKCQkJIjYxLjE3OS4xMDcuMTE2IiwgCgkJCSIxNzUuNDMuMjAuNjkiLCAKCQkJIjIyMC4xOTQuMjAzLjg2IiwgCgkJCSI2MS4xNjAuMjA5LjI3IiwgCgkJCSIxMjAuMjA5LjE0MS43OSIsIAoJCQkiMTIwLjIwOS4xNDIuMTM4IiwgCgkJCSIyMTkuMTM4LjIxLjcyIiwgCgkJCSI1OC4yMTYuMjEuMTMyIiwKCQkJJzE0LjIxNS4yMjguMTAnLAoJCQknMjE4Ljg3LjExMS44MycsCgoJCQkvLyDljJfkuqznlLXkv6EKCQkJJzIwMy4xMzAuNTkuOCcsCgkJCScyMDMuMTMwLjU5LjknLAoJCQknMjAzLjEzMC41OS4xMCcsCgkJCScyMDMuMTMwLjU5LjExJywKCQkJJzIwMy4xMzAuNTkuMTInCgkJXTsKCQl0aGlzLmNkbl9pcCA9IEguc2h1ZmZsZShjZG5zKTsKCX0sCgoJLyoqCgkgKiDnp7vpmaTntrLnq5nnmoTpmZDliLYKCSAqLwoJX2RvUmVtb3ZhbDogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ueCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIENSMSA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5lai5lLCAnbmVqLmUnLCAnLmRhdGFzZXQ7aWYnKTsKCQkJdmFyIENSMiA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5tLngsICdubS54JywgICcuY29weXJpZ2h0SWQ9PScpOwoJCQl2YXIgQ1IzID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubm0ueCwgJ25tLngnLCAgJy5wcml2aWxlZ2U7aWYnKTsKCQkJc2VsZi5mbHVzaExvZ1RhYmxlKCk7CgoJCQkvLyBDUjIg5L2N572u55qE5YWn5a655ZyoIENSMSDlh73mlbjlkI7liqDovIkKCQkJSC53YWl0VW50aWwoJ25tLnguJyArIENSMiwgZnVuY3Rpb24gKCkgewoJCQkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoYklzRnJhbWUsIENSMSwgQ1IyLCBDUjMpIHsKCQkJCQl2YXIgX0NSMSA9IG5lai5lW0NSMV07CgkJCQkJbmVqLmVbQ1IxXSA9IGZ1bmN0aW9uICh6LCBuYW1lKSB7CgkJCQkJCWlmIChuYW1lID09ICdjb3B5cmlnaHQnIHx8IG5hbWUgPT0gJ3Jlc0NvcHlyaWdodCcpIHsKCQkJCQkJCXJldHVybiAxOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gX0NSMS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCX07CgoJCQkJCW5tLnhbQ1IyXT0gZnVuY3Rpb24gKCkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfTsKCgkJCQkJbm0ueFtDUjNdPSBmdW5jdGlvbiAoKSB7CgkJCQkJCXZhciBzb25nRGV0YWlsID0gYXJndW1lbnRzWzBdOwoJCQkJCQlzb25nRGV0YWlsLnN0YXR1cyA9IDA7CgoJCQkJCQlpZiAoc29uZ0RldGFpbC5wcml2aWxlZ2UpIHsKCQkJCQkJCXNvbmdEZXRhaWwucHJpdmlsZWdlLnBsID0gMzIwMDAwOwoJCQkJCQkJc29uZ0RldGFpbC5wcml2aWxlZ2Uuc3RhdHVzID0gMDsKCQkJCQkJfQoJCQkJCQkKCQkJCQkJcmV0dXJuIDA7CgkJCQkJfTsKCQkJCX0sIEguaXNGcmFtZSwgQ1IxLCBDUjIsIENSMyk7CgkJCX0sIDcwMDAsIDUwMCk7CgkJfSk7Cgl9LAoKCWFkZExvZ0l0ZW06IGZ1bmN0aW9uIChsb2dJdGVtKSB7CgkJaWYgKCF0aGlzLmxvZ0l0ZW1zKQoJCQl0aGlzLmxvZ0l0ZW1zID0gW107CgoJCXRoaXMubG9nSXRlbXMucHVzaChsb2dJdGVtKTsKCX0sCgoJZmx1c2hMb2dUYWJsZTogZnVuY3Rpb24gKCkgewoJCXZhciBsb2dJdGVtcyA9IHRoaXMubG9nSXRlbXM7CgkJdGhpcy5sb2dJdGVtcyA9IFtdOwoKCQlpZiAoIUgubm9Mb2cgJiYgbG9nSXRlbXMubGVuZ3RoID4gMCkKCQkJY29uc29sZS50YWJsZShsb2dJdGVtcyk7Cgl9LAoKCXNlYXJjaEZ1bmN0aW9uOiBmdW5jdGlvbihiYXNlLCBuYW1lLCBrZXkpIHsKCQl2YXIgaXNSZWcgPSBrZXkgaW5zdGFuY2VvZiBSZWdFeHA7CgoJCWZvciAodmFyIGJhc2VOYW1lIGluIGJhc2UpIHsKCQkJdmFyIGZuID0gYmFzZVtiYXNlTmFtZV07CgkJCWlmIChmbiAmJiB0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIHsKCQkJCXZhciBmblN0ciA9IGZuLnRvU3RyaW5nKCk7CgkJCQlpZiAoaXNSZWcgPyBrZXkudGVzdChmblN0cikgOiBmblN0ci5pbmRleE9mKGtleSkgIT09IC0xKSB7CgkJCQkJaWYgKCFILm5vTG9nKSB7CgkJCQkJCXRoaXMuYWRkTG9nSXRlbSh7CgkJCQkJCQknS2V5d29yZCc6IGtleSwKCQkJCQkJCSdGb3VuZCc6IG5hbWUgKyAnLicgKyBiYXNlTmFtZQoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCXJldHVybiBiYXNlTmFtZTsKCQkJCX0KCQkJfQoJCX0KCQlILmluZm8oJ1NlYXJjaCAlcywgZm91bmQgbm90aGluZy4nLCBrZXkpOwoJCXJldHVybiBudWxsOwoJfSwKCgkvKioKCSAqIOiou+WGiuS4i+i8ieS6i+S7tgoJICogQHJldHVybiB7W3R5cGVdfSBbZGVzY3JpcHRpb25dCgkgKi8KCXJlZ1BsYXllcjogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKEguc2NyaXB0TmFtZSwgZnVuY3Rpb24oZSkgewoJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoKCQkJc2VsZi5saW5rRG93bmxvYWQuYXR0cih7CgkJCQlocmVmOiBILnVyaShzb25nT2JqLnNvbmdfdXJsIHx8IHNlbGYuZ2V0VXJpKEpTT04ucGFyc2Uoc29uZ09iai5zb25nKSksIHNvbmdPYmoubmFtZSArICIgWyIgKyBzb25nT2JqLmFydGlzdCArICJdLm1wMyIpLAoJCQkJdGl0bGU6ICfkuIvovb06ICcgKyBzb25nT2JqLm5hbWUKCQkJfSk7CgkJfSk7Cgl9LAoKCXJhbmRvbUNETjogZnVuY3Rpb24gKCkgewoJCXZhciBpcCA9IHRoaXMuY2RuX2lwLnNoaWZ0KCk7CgkJdGhpcy5jZG5faXAucHVzaChpcCk7CgkJcmV0dXJuIGlwOwoJfSwKCgl1cGRhdGVDRE46IGZ1bmN0aW9uIChjZG4pIHsKCQlpZiAoIWNkbikgY2RuID0gdGhpcy5yYW5kb21DRE4oKTsKCgkJaWYgKHRoaXMuY2hhbmdlQ0ROKQoJCQl0aGlzLmNoYW5nZUNETi5hdHRyKCd0aXRsZScsICfmm7TmjaIgQ0ROIFvlvZPliY06ICcgKyBjZG4gKyAnXSA9PiDliIfmrYzlkI7nlJ/mlYgnKTsKCgkJLy8g6YCa55+l5omA5pyJ5qCH562+6aG15pu05o2iIENETgoJCXRoaXMud3NfY2RuX21lZGlhID0gY2RuOwoJCWxvY2FsU3RvcmFnZS53c19jZG5fbWVkaWEgPSBjZG47CgkJR01fc2V0VmFsdWUoJ193c19jZG5fbWVkaWEnLCBjZG4pOwoKCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChILnNjcmlwdE5hbWUgKyAnLWNkbicsIHsKCQkJZGV0YWlsOiBjZG4KCQl9KSk7Cgl9LAoKCWhvb2tQbGF5ZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCWV4cG9ydEZ1bmN0aW9uKGZ1bmN0aW9uIChvYmopIHsKCQkJcmV0dXJuIHNlbGYuZ2V0VXJpKG9iaik7CgkJfSwgdW5zYWZlV2luZG93LCB7CgkJCWRlZmluZUFzOiAnX19qeF9nZXRTb25nVXJsJwoJCX0pOwoKCQkvLyDku47mkq3mlL7lmaggSG9vayDmlLnkuLrov5znq68gSG9vawoJCS8vIOWboOS4uueOsOWcqOavj+asoeaSreaUvumDveS8muivt+axguS4gOasoee9kee7nAoJCUgud2FpdFVudGlsKCduZWouaicsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIGhvb2tOYW1lID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubmVqLmosICduZWouaicsICcucmVwbGFjZSgiYXBpIiwid2VhcGknKTsKCQkJdmFyIGhvb2tRdWV1ZVVwZGF0ZSA9IHNlbGYuc2VhcmNoRnVuY3Rpb24odW5zYWZlV2luZG93Lm5tLncucFAucHJvdG90eXBlLCAnbm0udy5wUC5wcm90b3R5cGUnLCAvcmV0dXJuIHRoaXNcLlx3K1xbdGhpc1wuXHcrXF0vKTsKCQkJc2VsZi5mbHVzaExvZ1RhYmxlKCk7CgoJCQl2YXIgY3VycmVudENETjsKCQkJaWYgKEguY29uZmlnLmJJbnRlcm5hdGlvbmFsICYmICFILmNvbmZpZy5iUHJveHlJbnN0YWxsZWQpIHsKCQkJCS8vIOaPkOWPluS/neWtmOeahCBDRE4KCQkJCXZhciBjaGFuZ2VDRE4gPSAkKCc8YT4nKS5hZGRDbGFzcygnanhfYnRuIGp4X2NkbicpLmluc2VydEFmdGVyKHNlbGYubGlua0Rvd25sb2FkKS50ZXh0KCfmjaInKTsKCQkJCXNlbGYuY2hhbmdlQ0ROID0gY2hhbmdlQ0ROOwoJCQkJY2hhbmdlQ0ROLmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJCQlzZWxmLnVwZGF0ZUNETigpOwoJCQkJfSk7CgoJCQkJY3VycmVudENETiA9IEdNX2dldFZhbHVlKCdfd3NfY2RuX21lZGlhJywgc2VsZi5yYW5kb21DRE4oKSk7CgkJCQlpZiAoIUguY29udGFpbnMoc2VsZi5jZG5faXAsIGN1cnJlbnRDRE4pKSB7CgkJCQkJY3VycmVudENETiA9IHNlbGYucmFuZG9tQ0ROKCk7CgkJCQl9CgkJCQlzZWxmLnVwZGF0ZUNETihjdXJyZW50Q0ROKTsKCgkJCQkvLyDmmoLml7bpmpDol48KCQkJCS8vIHNlbGYubGlua0Rvd25sb2FkLmhpZGUoKTsKCQkJfQoKCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oCgkJCQlzY3JpcHROYW1lLCBob29rTmFtZSwgaG9va1F1ZXVlVXBkYXRlLCBiSW50ZXJuYXRpb25hbCwKCQkJCWNkbl9pcCwgYlByb3h5SW5zdGFsbGVkLCBfX01QM19CTEFOSywKCQkJCWJVc2VUaHJpZE9uRmFpbAoJCQkpIHsKCQkJCXZhciBRVUVVRV9LRVkgPSAidHJhY2stcXVldWUtY2FjaGUiOwoJCQkJdmFyIENETl9LRVkgICA9ICdfd3NfY2RuX21lZGlhJzsKCgkJCQkvLyDlu7rnq4vnvJPlrZgKCQkJCXZhciBfY2FjaGUgPSB7fTsKCgkJCQkvKioKCQkJCSAqIOmHjei9vee8k+WtmO+8jOmYsuatoueUqOaIt+W8gOWQr+S4pOS4quagh+etvumhteWvvOiHtOabsuebrue8k+WtmOS4jeWQjOatpeOAggoJCQkJICovCgkJCQlmdW5jdGlvbiByZWxvYWRDYWNoZSAoKSB7CgkJCQkJdHJ5IHsKCQkJCQkJX2NhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2VbUVVFVUVfS0VZXSk7CgkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCWxvY2FsU3RvcmFnZVtRVUVVRV9LRVldID0gJ3t9JzsKCQkJCQl9CgkJCQl9CgoJCQkJLyoqCgkJCQkgKiDlgqjlrZjnvJPlrZjoh7MgbG9jYWxTdG9yYWdlCgkJCQkgKi8KCQkJCWZ1bmN0aW9uIHNhdmVDYWNoZSAoKSB7CgkJCQkJbG9jYWxTdG9yYWdlW1FVRVVFX0tFWV0gPSBKU09OLnN0cmluZ2lmeShfY2FjaGUpOwoJCQkJfQoKCQkJCS8vIOebkeWQrOe8k+WtmOOAgUNETiDlkIzmraXkuovku7YKCQkJCXZhciBfbmVlZF9yZWxvYWQgPSB0cnVlOwoJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBmdW5jdGlvbiAoZSkgewoJCQkJCXN3aXRjaCAoZS5rZXkpIHsKCQkJCQkJY2FzZSBRVUVVRV9LRVk6CgkJCQkJCQlfbmVlZF9yZWxvYWQgPSB0cnVlOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIENETl9LRVk6CgkJCQkJCQljZG5faXAgPSBsb2NhbFN0b3JhZ2VbQ0ROX0tFWV07CgkJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9LCBmYWxzZSk7CgoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihzY3JpcHROYW1lICsgJy1jZG4nLCBmdW5jdGlvbihlKSB7CgkJCQkJY2RuX2lwID0gZS5kZXRhaWw7CgkJCQl9KTsKCgkJCQlmdW5jdGlvbiBjaGVja0FuZFJlbG9hZCAoKSB7CgkJCQkJaWYgKF9uZWVkX3JlbG9hZCkKCQkJCQkJcmVsb2FkQ2FjaGUoKTsKCQkJCX0KCgkJCQkvKioKCQkJCSAqIOWFi+mahuS4gOS7veWvueixoQoJCQkJICogQHBhcmFtICB7T2JqZWN0fSBvYmog5a+56LGhCgkJCQkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICDlhYvpmoblkI7nmoTlr7nosaEKCQkJCSAqLwoJCQkJZnVuY3Rpb24gcmVidWlsZF9vYmplY3QgKG9iaikgewoJCQkJCXJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIGdlbmVyYXRlU2NyaXB0UHJvdG9jb2wgKHNvbmdPYmopIHsKCQkJCQlyZXR1cm4gewoJCQkJCQlhcnRpc3Q6IChzb25nT2JqLmFydGlzdHMgfHwgc29uZ09iai5hcikubWFwKGZ1bmN0aW9uKGFydGlzdCkgewoJCQkJCQkJcmV0dXJuIGFydGlzdC5uYW1lOwoJCQkJCQl9KS5qb2luKCfjgIEnKSwKCQkJCQkJbmFtZTogc29uZ09iai5uYW1lLAoJCQkJCQlzb25nOiBKU09OLnN0cmluZ2lmeShzb25nT2JqKQoJCQkJCX07CgkJCQl9CgoJCQkJLyoqCgkJCQkgKiDlsIbmm7Lnm67lhajpg6jovazmjaLkuLrpu4TmmJPmkq3mlL7lmajog73or4bliKvnmoTmoLzlvI/jgIIKCQkJCSAqIEBwYXJhbSAge0FycmF5fSBzb25ncyDmm7Lnm67liJfooagKCQkJCSAqIEByZXR1cm4ge09iamVjdH0gICAgICDmtYHph4/mqKHmi58KCQkJCSAqLwoJCQkJZnVuY3Rpb24gc29uZ3NfdG9fZGF0YSAoc29uZ3MpIHsKCQkJCQl2YXIgc29uZ09iaiA9IHNvbmdzWzBdOwoKCQkJCQl2YXIgZXZlU29uZ09iaiA9IGdlbmVyYXRlU2NyaXB0UHJvdG9jb2woc29uZ09iaik7CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gewoJCQkJCQljb2RlOiAyMDAsCgkJCQkJCWRhdGE6IHNvbmdzLm1hcChmdW5jdGlvbiAoc29uZykgewoJCQkJCQkJdmFyIHNvbmdfb2JqID0gcmVidWlsZF9vYmplY3Qoc29uZyk7CgkJCQkJCQlpZiAoc29uZ19vYmoubXAzVXJsKSB7CgkJCQkJCQkJaWYgKGJJbnRlcm5hdGlvbmFsKSB7CgkJCQkJCQkJCXNvbmdfb2JqLm1wM1VybCA9IHNvbmdfb2JqLm1wM1VybC5yZXBsYWNlKCdodHRwOi8vJywgJ2h0dHA6Ly8xMjcuMC4wLjE6NDAwMy8nKTsKCQkJCQkJCQl9CgkJCQkJCQkJc29uZ19vYmoudXJsID0gc29uZ19vYmoubXAzVXJsOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlzb25nX29iai51cmwgPSBfX2p4X2dldFNvbmdVcmwoc29uZ19vYmopOwoJCQkJCQkJfQoJCQkJCQkJc29uZ19vYmouZXhwaSA9IDFlMTM7CgkJCQkJCQlyZXR1cm4gc29uZ19vYmo7CgkJCQkJCX0pLAoJCQkJCQlfcmF3OiBzb25ncwoJCQkJCX07CgkJCQl9CgoJCQkJdmFyIGFqYXggPSBuZWoualtob29rTmFtZV07CgkJCQlmdW5jdGlvbiBhamF4UGF0Y2hNYWlubGFuZCAodXJsLCBwYXJhbXMpIHsKCQkJCQlpZiAoLTEgIT09IHVybC5pbmRleE9mKCdsb2cvJykpIHsKCQkJCQkJc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CgkJCQkJCQlwYXJhbXMub25sb2FkKHsgY29kZTogMjAwIH0pOwoJCQkJCQl9LCAxMDApOwoJCQkJCQlyZXR1cm4gOwoJCQkJCX0KCgkJCQkJaWYgKHVybCA9PSAnL2FwaS9zb25nL2VuaGFuY2UvcGxheWVyL3VybCcpIHsKCQkJCQkJdXJsID0gJy9hcGkvdjMvc29uZy9kZXRhaWwnOwoKCQkJCQkJaWYgKHBhcmFtcy5xdWVyeS5icikKCQkJCQkJCWRlbGV0ZSBwYXJhbXMucXVlcnkuYnI7CgoJCQkJCQkvLyDmo4Dmn6XnvJPlrZgsIOWHj+Wwkea1gemHjwoJCQkJCQl2YXIgX2lkcyA9IEpTT04ucGFyc2UocGFyYW1zLnF1ZXJ5Lmlkcyk7CgkJCQkJCXZhciBfcmVxX2lkcyA9IFtdOwoJCQkJCQljaGVja0FuZFJlbG9hZCgpOwoJCQkJCQlfaWRzID0gX2lkcy5tYXAoZnVuY3Rpb24gKGlkKSB7CgkJCQkJCQlpZiAoaWQgaW4gX2NhY2hlKSB7CgkJCQkJCQkJcmV0dXJuIF9jYWNoZVtpZF07CgkJCQkJCQl9CgoJCQkJCQkJX3JlcV9pZHMucHVzaChpZCk7CgkJCQkJCQlyZXR1cm4gaWQ7CgkJCQkJCX0pOwoKCQkJCQkJaWYgKF9yZXFfaWRzLmxlbmd0aCA9PT0gMCkgewoJCQkJCQkJLy8g55u05o6l6L+U5Zue5oiR5Lus55qE57yT5a2Y5pWw5o2uCgkJCQkJCQljb25zb2xlLmluZm8oJ1slc11bSU5GT10gTG9hZCBmcm9tIGNhY2hlOiAnLCBzY3JpcHROYW1lLCBwYXJhbXMucXVlcnkuaWRzKTsKCQkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCl7CgkJCQkJCQkJcGFyYW1zLm9ubG9hZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQkJfSwgMSwgc29uZ3NfdG9fZGF0YShfaWRzKSk7CgkJCQkJCQlyZXR1cm4gOwoJCQkJCQl9CgoJCQkJCQkvLyDnvLrlsJHmlbDmja4sIOivt+axguacjeWKoeWZqAoJCQkJCQljb25zb2xlLmluZm8oJ1slc11bSU5GT10gUmVxdWVzdCBmcm9tIHNlcnZlcjogJywgc2NyaXB0TmFtZSwgX3JlcV9pZHMpOwoKCQkJCQkJLy8gdjMgYXBpCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gX3JlcV9pZHMubWFwKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgaWQ6IGlkIH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YV9zdHIgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS5jID0gZGF0YV9zdHI7CgkJCQkJCXBhcmFtcy5xdWVyeSA9IGRhdGE7CgoJCQkJCQkvLyDmioogb25sb2FkIOe8k+WtmOaIkeS7rOeahOWHveaVsO+8jOaWueS+v+e8k+WtmOOAggoJCQkJCQl2YXIgX29ubG9hZCA9IHBhcmFtcy5vbmxvYWQ7CgkJCQkJCXBhcmFtcy5vbmxvYWQgPSBmdW5jdGlvbiAoZGF0YSkgewoJCQkJCQkJLy8g6aaW5YWI6YeN5paw5Yqg6L2957yT5a2YLCDpmLLmraLlhrLnqoEKCQkJCQkJCWNoZWNrQW5kUmVsb2FkKCk7CgoJCQkJCQkJLy8g5ou85o6l5pWw5o2u6Iez57yT5a2YCgkJCQkJCQlkYXRhLnNvbmdzLmZvckVhY2goZnVuY3Rpb24gKHNvbmcpIHsKCQkJCQkJCQl2YXIgaSA9IF9pZHMuaW5kZXhPZihzb25nLmlkKTsKCgkJCQkJCQkJaWYgKGkgPT0gLTEpIHsgZGVidWdnZXI7IC8vIGkg5LiN5b6X5bCP5LqOIDAgIQoJCQkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoJ+WPluW+l+e0ouW8leWksei0peOAgicpOwoJCQkJCQkJCX0KCgkJCQkJCQkJX2lkc1tpXSA9IHNvbmc7CgkJCQkJCQkJX2NhY2hlW3NvbmcuaWRdID0gc29uZzsKCQkJCQkJCX0pOwoKCQkJCQkJCS8vIOWCqOWtmAoJCQkJCQkJc2F2ZUNhY2hlKCk7CgoJCQkJCQkJc2V0VGltZW91dChfb25sb2FkLCAxLCBzb25nc190b19kYXRhKF9pZHMpKTsKCQkJCQkJfTsKCQkJCQl9CgoJCQkJCXJldHVybiBhamF4KHVybCwgcGFyYW1zKTsKCQkJCX0KCgkJCQkvLyDlvLrliLbliLfmlrDmkq3mlL7lmagKCQkJCS8vIOeUqOS6juino+aekOS4i+i9vSAvIOa1t+WkluWkhOeQhuOAggoJCQkJZnVuY3Rpb24gbmV4dFNvbmcgKCkgewoJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ueHQnKS5jbGljaygpOwoJCQkJfQoJCQkJbmV4dFNvbmcoKTsKCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcnYnKS5jbGljaygpOwoJCQkJfSwgMzAwKTsKCgkJCQl2YXIgc29uZ0luZm8gPSB7fTsKCQkJCXZhciBicl9saXN0ID0gWzEyODAwMCwgOTYwMDAsIDE5MjAwMCwgMzIwMDAwXTsKCgkJCQlmdW5jdGlvbiBhamF4UGF0Y2hJbnRlcm5hdGlvbmFsICh1cmwsIHBhcmFtcywgdHJ5X2JyKSB7CgkJCQkJdmFyIF9ub25jZSA9IHNvbmdJbmZvLl9ub25jZTsKCgkJCQkJaWYgKC0xICE9PSB1cmwuaW5kZXhPZignbG9nLycpKSB7CgkJCQkJCXNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewoJCQkJCQkJcGFyYW1zLm9ubG9hZCh7IGNvZGU6IDIwMCB9KTsKCQkJCQkJfSwgMTAwKTsKCQkJCQkJcmV0dXJuIDsKCQkJCQl9CgoJCQkJCWlmICh1cmwgPT0gJy9hcGkvc29uZy9lbmhhbmNlL3BsYXllci91cmwnKSB7CgkJCQkJCXZhciBzZWxmID0gdGhpczsKCgkJCQkJCWlmICghcGFyYW1zLmhlYWRlcnMpCgkJCQkJCQlwYXJhbXMuaGVhZGVycyA9IHt9OwoKCQkJCQkJcGFyYW1zLmhlYWRlcnNbJ1gtUmVhbC1JUCddID0gJzExOC44OC44OC44OCc7CgoJCQkJCQl2YXIgX29ubG9hZCA9IHBhcmFtcy5vbmxvYWQ7CgkJCQkJCXBhcmFtcy5vbmxvYWQgPSBmdW5jdGlvbiAoZGF0YSkgewoJCQkJCQkJaWYgKGRhdGEuZGF0YVswXS51cmwpIHsKCQkJCQkJCQlvblBhcnNlU3VjY2VzcyhkYXRhLmRhdGFbMF0udXJsKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8g6Kej5p6Q5LiN5Yiw6Z+z5LmQLCDlubbkuJTkuI3lnKjph43or5XpmLbmrrU6CgkJCQkJCQkJLy8g5bCd6K+V5L2/55So56ys5LiJ5pa55pCc5q2MCgkJCQkJCQkJaWYgKGJVc2VUaHJpZE9uRmFpbCAmJiAhdHJ5X2JyKSB7CgkJCQkJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUgKyAnLU5FLVNQWScsIHsKCQkJCQkJCQkJCWRldGFpbDogSlNPTi5zdHJpbmdpZnkoewoJCQkJCQkJCQkJCWlkOiBKU09OLnBhcnNlKHBhcmFtcy5xdWVyeS5pZHMpWzBdLAoJCQkJCQkJCQkJCWNhbGxiYWNrOiBnZW5lcmF0ZUNhbGxiYWNrKG9uUmVjdlNweURhdGEpCgkJCQkJCQkJCQl9KQoJCQkJCQkJCQl9KSk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJLy8g6Kej5p6Q5LiN5Yiw6Z+z5LmQOiDoh6rliqjkuIvkuIDpppYKCQkJCQkJCQkJZmFpbFRyeU5leHQoKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkJcmV0dXJuIDsKCQkJCQkJfTsKCQkJCQl9CgoJCQkJCXJldHVybiBhamF4KHVybCwgcGFyYW1zKTsKCgkJCQkJZnVuY3Rpb24gZ2VuZXJhdGVDYWxsYmFjayAoY2IpIHsKCQkJCQkJdmFyIG5hbWUgPSAnX2NiXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKCkuc2xpY2UoMykgKyAnXycgKyBEYXRlLm5vdygpOwoJCQkJCQl3aW5kb3dbbmFtZV0gPSBmdW5jdGlvbiAoKSB7CgkJCQkJCQl2YXIgciA9IGNiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCQlkZWxldGUgd2luZG93W25hbWVdOwoJCQkJCQkJcmV0dXJuIHI7CgkJCQkJCX07CgkJCQkJCXJldHVybiBuYW1lOwoJCQkJCX0KCgkJCQkJZnVuY3Rpb24gb25QYXJzZVN1Y2Nlc3MgKHVybCkgewoJCQkJCQkvLyDlt7Lnu4/mmK/liKvnmoTmrYzmm7LlnKjop6PmnpDkuK3kuoYhCgkJCQkJCWlmIChfbm9uY2UgIT0gc29uZ0luZm8uX25vbmNlKSByZXR1cm4gOwoKCQkJCQkJLy8gbTEwIOWfn+WQjeeahOmfs+S5kOaWh+S7tuWPr+S7pemAmui/h+WJjee9riBjZG4gaXAg57uV6L+HLgoJCQkJCQl2YXIgc29uZ191cmwgPSB1cmw7CgkJCQkJCWlmICgvbVxkK1wubXVzaWNcLjEyNlwubmV0Ly50ZXN0KHNvbmdfdXJsKSkgewoJCQkJCQkJc29uZ191cmwgPSBzb25nX3VybC5yZXBsYWNlKCdodHRwOi8vJywgJ2h0dHA6Ly8nICsgY2RuX2lwICsgJy8nKTsKCQkJCQkJfQoKCgkJCQkJCS8vIOaehOW7uuS4i+i9veS/oeaBrwoJCQkJCQl2YXIgX2luZm8gPSByZWJ1aWxkX29iamVjdChzb25nSW5mbyk7CgkJCQkJCXZhciBldmVTb25nT2JqID0gZ2VuZXJhdGVTY3JpcHRQcm90b2NvbChfaW5mbyk7CgkJCQkJCWV2ZVNvbmdPYmouc29uZ191cmwgPSBzb25nX3VybDsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoc2NyaXB0TmFtZSwgewoJCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJCX0pKTsKCgkJCQkJCXJldHVybiBfb25sb2FkKHsKCQkJCQkJCWRhdGE6IFt7CgkJCQkJCQkJaWQ6IHNvbmdJbmZvLmlkLAoJCQkJCQkJCXVybDogc29uZ191cmwsCgkJCQkJCQkJYnI6IDE5MjAwMCwKCQkJCQkJCQlzaXplOiAwLAoJCQkJCQkJCW1kNTogbnVsbCwKCQkJCQkJCQljb2RlOiAyMDAsCgkJCQkJCQkJZXhwaTogMTIwMCwKCQkJCQkJCQl0eXBlOiAnbXAzJywKCQkJCQkJCQlnYWluOiAwLAoJCQkJCQkJCWZlZTogMCwKCQkJCQkJCQl1ZjogbnVsbCwKCQkJCQkJCQlwYXllZDogMCwKCQkJCQkJCQljYW5FeHRlbmQ6IGZhbHNlCgkJCQkJCQl9XSwKCQkJCQkJCWNvZGU6IDIwMAoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCWZ1bmN0aW9uIGZhaWxUcnlOZXh0ICgpIHsKCQkJCQkJY29uc29sZS53YXJuKCdbJXNdIOi9veWFpemfs+S5kOaVsOaNruWksei0pSwg5YeG5aSH5LitLi4nLCBzY3JpcHROYW1lKTsKCgkJCQkJCWlmICghdHJ5X2JyKSB7CgkJCQkJCQl0cnlfYnIgPSBwYXJzZUludChwYXJhbXMucXVlcnkuYnIpOwoJCQkJCQl9CgoJCQkJCQl2YXIgaSA9IGJyX2xpc3QuaW5kZXhPZih0cnlfYnIpICsgMTsKCQkJCQkJaWYgKGkgPCBicl9saXN0Lmxlbmd0aCkgewoJCQkJCQkJY29uc29sZS5pbmZvICgnWyVzXSDlsJ3or5XnoIHnjocgJWRrYnBzJywgc2NyaXB0TmFtZSwgYnJfbGlzdFtpXSAvIDEwMDApOwoJCQkJCQkJcGFyYW1zLm9ubG9hZCA9IF9vbmxvYWQ7CgkJCQkJCQlhamF4UGF0Y2hJbnRlcm5hdGlvbmFsKHVybCwgcGFyYW1zLCBicl9saXN0W2ldKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWNvbnNvbGUuaW5mbyAoJ1slc10g5pS+5byDLCDot7Poh7PkuIvkuIDpppYnLCBzY3JpcHROYW1lKTsKCQkJCQkJCW5leHRTb25nKCk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCWZ1bmN0aW9uIG9uUmVjdlNweURhdGEgKHVybCkgewoJCQkJCQlpZiAoIXVybCkgewoJCQkJCQkJY29uc29sZS5pbmZvKCfpgJrov4fnrKzkuInmlrnojrflj5bpn7PkuZDlnLDlnYDlpLHotKUsIOatjOabsuS4jeWPr+eUqC4nKTsKCQkJCQkJCWZhaWxUcnlOZXh0KCk7CgkJCQkJCQlyZXR1cm4gOwoJCQkJCQl9CgoJCQkJCQlvblBhcnNlU3VjY2Vzcyh1cmwpOwoJCQkJCX0KCQkJCX0KCgkJCQl2YXIgcHVyZUludGVybmF0aW9uYWwgPSBiSW50ZXJuYXRpb25hbCAmJiAhYlByb3h5SW5zdGFsbGVkOwoJCQkJbmVqLmpbaG9va05hbWVdID0gcHVyZUludGVybmF0aW9uYWwgPyBhamF4UGF0Y2hJbnRlcm5hdGlvbmFsIDogYWpheFBhdGNoTWFpbmxhbmQ7CgkJCQlpZiAocHVyZUludGVybmF0aW9uYWwpIHsKCQkJCQl2YXIgX3F1ZXVlVXBkYXRlID0gbm0udy5wUC5wcm90b3R5cGVbaG9va1F1ZXVlVXBkYXRlXTsKCQkJCQlubS53LnBQLnByb3RvdHlwZVtob29rUXVldWVVcGRhdGVdID0gZnVuY3Rpb24gKCkgewoJCQkJCQl2YXIgciA9IF9xdWV1ZVVwZGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQlzb25nSW5mbyA9IHJlYnVpbGRfb2JqZWN0KHIpOwoJCQkJCQlzb25nSW5mby5fbm9uY2UgPSBNYXRoLnJhbmRvbSgpOwoJCQkJCQlyZXR1cm4gcjsKCQkJCQl9OwoJCQkJfQoKCQkJfSwKCQkJCUguc2NyaXB0TmFtZSwgaG9va05hbWUsIGhvb2tRdWV1ZVVwZGF0ZSwgSC5jb25maWcuYkludGVybmF0aW9uYWwsIAoJCQkJY3VycmVudENETiwgSC5jb25maWcuYlByb3h5SW5zdGFsbGVkLCBzZWxmLl9fTVAzX0JMQU5LLAoJCQkJSC5jb25maWcuYlVzZVRocmlkT25GYWlsCgkJCSk7CgkJfSk7Cgl9LAoKCS8qKgoJICog5aSW6ZO+5pKt5pS+5Zmo6JmV55CGCgkgKi8KCWhvb2tQbGF5ZXJPdXRjaGFpbjogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ubS5EbScsIGZ1bmN0aW9uKCkgewoJCQlzZWxmLmxpbmtEb3dubG9hZCA9ICQoJzxhPicpCgkJCQkuaW5zZXJ0QmVmb3JlKCcub3ByQm94ID4gLmJnLm9wZW4nKQoJCQkJLmFkZENsYXNzKCdiZyBuZXh0JykKCQkJCS5jc3MoewoJCQkJCXRyYW5zZm9ybTogJ3JvdGF0ZSg5MGRlZyknLAoJCQkJCXBvc2l0aW9uOiAnYWJzb2x1dGUnLAoJCQkJCXJpZ2h0OiAnMjFweCcsCgkJCQkJdG9wOiAnM3B4JywKCQkJCQlvcGFjaXR5OiAwLjYKCQkJCX0pOwoKCQkJLy8g5bCL5om+5rOo5YWl5Ye95pW4CgkJCXZhciBmblBsYXlBdEluZGV4ID0gc2VsZi5zZWFyY2hGdW5jdGlvbih1bnNhZmVXaW5kb3cubm0ubS5EbS5wcm90b3R5cGUsCgkJCQknbm0ubS5EbS5wcm90b3R5cGUnLCAnLm1wM1VybCk7Jyk7CgkJCXNlbGYuZmx1c2hMb2dUYWJsZSgpOwoKCQkJaWYgKCFmblBsYXlBdEluZGV4KQoJCQkJcmV0dXJuIDsKCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oc2NyaXB0TmFtZSwgZm5QbGF5QXRJbmRleCwgYkludGVybmF0aW9uYWwsIGJQcm94eUluc3RhbGxlZCwgY2RuX2lwLCBjc3NUaXRsZSwgY3NzU3VidGl0bGUpIHsKCQkJCXZhciBDRE5fS0VZID0gJ193c19jZG5fbWVkaWEnOwoJCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBmdW5jdGlvbiAoZSkgewoJCQkJCXN3aXRjaCAoZS5rZXkpIHsKCQkJCQkJY2FzZSBDRE5fS0VZOgoJCQkJCQkJY2RuX2lwID0gbG9jYWxTdG9yYWdlW0NETl9LRVldOwoJCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfSwgZmFsc2UpOwoJCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihzY3JpcHROYW1lICsgJy1jZG4nLCBmdW5jdGlvbihlKSB7CgkJCQkJY2RuX2lwID0gZS5kZXRhaWw7CgkJCQl9KTsKCgkJCQlmdW5jdGlvbiBpbnNlcnRBZnRlcihuZXdOb2RlLCByZWYpIHsKCQkJCQlyZWYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3Tm9kZSwgcmVmLm5leHRTaWJsaW5nKTsKCQkJCX0KCgkJCQl2YXIgc3ViVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzbWFsbCcpOwoJCQkJdmFyIHBhZ2VUaXRsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0aXRsZScpOwoJCQkJaWYgKHBhZ2VUaXRsZSkgewoJCQkJCWluc2VydEFmdGVyKHN1YlRpdGxlLCBwYWdlVGl0bGUpOwoJCQkJCXBhZ2VUaXRsZS5zdHlsZS5jc3NUZXh0ID0gY3NzVGl0bGU7CgkJCQkJc3ViVGl0bGUuc3R5bGUuY3NzVGV4dCA9IGNzc1N1YnRpdGxlOwoJCQkJfQoKCgkJCQl2YXIgX2Jha1BsYXllclVwZGF0ZVVJID0gbm0ubS5EbS5wcm90b3R5cGVbZm5QbGF5QXRJbmRleF07CgoJCQkJdmFyIG0gPSBfYmFrUGxheWVyVXBkYXRlVUkudG9TdHJpbmcoKS5tYXRjaCgvPXRoaXMuKFx3KylcWy8pOwoJCQkJaWYgKCFtKSByZXR1cm4gOwoKCQkJCXZhciB0cmFja3MgPSBtWzFdOwoJCQkJbm0ubS5EbS5wcm90b3R5cGVbZm5QbGF5QXRJbmRleF0gPSBmdW5jdGlvbihzb25nSW5kZXgpIHsKCQkJCQl2YXIgaSA9IHBhcnNlSW50KHNvbmdJbmRleCkgfHwgMDsKCQkJCQl2YXIgbGVuID0gdGhpc1t0cmFja3NdLmxlbmd0aDsKCQkJCQlpZiAoaSA+PSBsZW4pIHsKCQkJCQkJaSA9IDA7CgkJCQkJfSBlbHNlIGlmIChpIDwgMCkgewoJCQkJCQlpID0gbGVuIC0gMTsKCQkJCQl9CgoJCQkJCXZhciB0cmFjayA9IHRoaXNbdHJhY2tzXVtpXTsKCQkJCQl0cmFjay5mZWUgPSB0cmFjay5zdGF0dXMgPSAwOwoKCQkJCQlzdWJUaXRsZS50ZXh0Q29udGVudCA9ICdcdTI1YjYgJyArIHRyYWNrLm5hbWU7CgkJCQkJc3ViVGl0bGUudGl0bGUgPSB0cmFjay5uYW1lOwoKCQkJCQkvLyDlnIvpmpvnlKjmiLbovYnmj5vlnLDlnYAKCQkJCQlpZiAoYkludGVybmF0aW9uYWwpIHsKCQkJCQkJaWYgKGJQcm94eUluc3RhbGxlZCkgewoJCQkJCQkJdHJhY2subXAzVXJsID0gdHJhY2subXAzVXJsLnJlcGxhY2UoJ2h0dHA6Ly8nLCAnaHR0cDovLzEyNy4wLjAuMTo0MDAzLycpOwoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXZhciBzb25nX3VybCA9IHRyYWNrLm1wM1VybDsKCQkJCQkJCWlmICgvbVxkK1wubXVzaWNcLjEyNlwubmV0Ly50ZXN0KHNvbmdfdXJsKSkgewoJCQkJCQkJCXNvbmdfdXJsID0gc29uZ191cmwucmVwbGFjZSgnaHR0cDovLycsICdodHRwOi8vJyArIGNkbl9pcCArICcvJyk7CgkJCQkJCQl9CgkJCQkJCQl0cmFjay5tcDNVcmwgPSBzb25nX3VybDsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJdmFyIGV2ZVNvbmdPYmogPSB7CgkJCQkJCWFydGlzdDogKHRyYWNrLmFydGlzdHMgfHwgdHJhY2suYXIpLm1hcChmdW5jdGlvbihhcnRpc3QpIHsKCQkJCQkJCXJldHVybiBhcnRpc3QubmFtZTsKCQkJCQkJfSkuam9pbign44CBJyksCgkJCQkJCW5hbWU6IHRyYWNrLm5hbWUsCgkJCQkJCXNvbmc6IEpTT04uc3RyaW5naWZ5KHRyYWNrKQoJCQkJCX07CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gX2Jha1BsYXllclVwZGF0ZVVJLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQkJCgkJCX0sIEguc2NyaXB0TmFtZSwgZm5QbGF5QXRJbmRleCwgSC5jb25maWcuYkludGVybmF0aW9uYWwsIEguY29uZmlnLmJQcm94eUluc3RhbGxlZCwgc2VsZi5jZG5faXAsIEguZXh0cmFjdChmdW5jdGlvbiAoKSB7LyoKCQkJCXBhZGRpbmctdG9wOiAuMmVtOwoJCQkJb3ZlcmZsb3c6IGhpZGRlbjsKCQkJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQkJKi99KSwgSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsvKgoJCQkJcGFkZGluZy1sZWZ0OiAuNXJlbTsKCQkJCWNvbG9yOiAjYWFhOwoJCQkJZGlzcGxheTogYmxvY2s7CgkJCQltYXJnaW4tdG9wOiAtMC41cmVtOwoJCQkJb3ZlcmZsb3c6IGhpZGRlbjsKCQkJCXdoaXRlLXNwYWNlOiBub3dyYXA7CgkJCQl0ZXh0LW92ZXJmbG93OiBlbGxpcHNpczsKCQkJKi99KSk7CgkJfSk7Cgl9LAoKCWhvb2tQbGF5ZXJGbTogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQlILndhaXRVbnRpbCgnbm0ubS5mTycsIGZ1bmN0aW9uKCkgewoJCQl2YXIgaG9vayA9IHNlbGYuc2VhcmNoRnVuY3Rpb24oCgkJCQl1bnNhZmVXaW5kb3cubm0ubS5mTy5wcm90b3R5cGUsICdubS5tLmZPOjonLCAnLm1wM1VybCx0cnVlJyk7CgkJCXNlbGYuZmx1c2hMb2dUYWJsZSgpOwoKCQkJc2VsZi5saW5rRG93bmxvYWQgPSAkKCc8YT4nKQoJCQkJLnByZXBlbmRUbygnLm9wdHMuZi1jYj4uZi1mcicpCgkJCQkuYWRkQ2xhc3MoJ2ljb24gaWNvbi1uZXh0JykKCQkJCS5odG1sKCcmbmJzcDsnKQoJCQkJLmNzcygndHJhbnNmb3JtJywgJ3JvdGF0ZSg5MGRlZyknKTsKCQkJCgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24oc2NyaXB0TmFtZSwgaG9vaykgewoJCQkJdmFyIF9iYWtQbGF5U29uZyA9IG5tLm0uZk8ucHJvdG90eXBlW2hvb2tdOwoKCQkJCW5tLm0uZk8ucHJvdG90eXBlW2hvb2tdID0gZnVuY3Rpb24oc29uZ09iaikgewoJCQkJCXZhciBldmVTb25nT2JqID0gewoJCQkJCQlhcnRpc3Q6IChzb25nT2JqLmFydGlzdHMgfHwgc29uZ09iai5hcikubWFwKGZ1bmN0aW9uKGFydGlzdCkgewoJCQkJCQkJcmV0dXJuIGFydGlzdC5uYW1lOwoJCQkJCQl9KS5qb2luKCfjgIEnKSwKCQkJCQkJbmFtZTogc29uZ09iai5uYW1lLAoJCQkJCQlzb25nOiBKU09OLnN0cmluZ2lmeShzb25nT2JqKQoJCQkJCX07CgoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KHNjcmlwdE5hbWUsIHsKCQkJCQkJZGV0YWlsOiBldmVTb25nT2JqCgkJCQkJfSkpOwoKCQkJCQlyZXR1cm4gX2Jha1BsYXlTb25nLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQl9LCBILnNjcmlwdE5hbWUsIGhvb2spOwoJCX0pOwoJfSwKCgkvLyDmnI3liqHlmaggMSB+IDg7IOS9huaYr+iyjOS8vCAxIH4gMiDnmoTmnIDnqLPlrpoKCWdldFVyaTogZnVuY3Rpb24oc29uZykgewoJCXZhciBkc2ZJZDsKCQl2YXIgcSA9IChzb25nLmggfHwgc29uZy5oTXVzaWMgfHwgc29uZy5tIHx8IHNvbmcubU11c2ljIHx8IHNvbmcubCB8fCBzb25nLmxNdXNpYyB8fCBzb25nLmEgfHwgc29uZy5hTXVzaWMpOwoJCWlmIChxKSBkc2ZJZCA9IHEuZmlkIHx8IHEuZHNmSWQ7CgkJaWYgKCFkc2ZJZCkgewoJCQljb25zb2xlLmluZm8oJ+atjOabsiAlc1slZF0g5bey5LiL5p6277yM5peg5rOV6I635Y+W6Z+z5LmQ5Zyw5Z2AIScsIHNvbmcubmFtZSwgc29uZy5pZCk7CgkJCXJldHVybiB0aGlzLl9fTVAzX0JMQU5LOwoJCX0KCQl2YXIgcmFuZFNlcnZlciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpICsgMTsKCgoJCXZhciBjZG5QcmVmaXggPSAnJzsKCQl2YXIgY2RuU2VydmVyID0gJ20nOwoJCWlmIChILmNvbmZpZy5iSW50ZXJuYXRpb25hbCkgewoJCQlpZiAoSC5jb25maWcuYlByb3h5SW5zdGFsbGVkKSB7CgkJCQljZG5QcmVmaXggPSAnMTI3LjAuMC4xOjQwMDMvJzsKCQkJfSBlbHNlIHsKCQkJCWNkblByZWZpeCA9IHRoaXMud3NfY2RuX21lZGlhICsgJy8nOwoJCQkJY2RuU2VydmVyID0gJ3AnOwoJCQl9CgkJfQoKCQlyZXR1cm4gImh0dHA6Ly8iICsgY2RuUHJlZml4ICsgY2RuU2VydmVyICsgcmFuZFNlcnZlciArICIubXVzaWMuMTI2Lm5ldC8iICsgKHRoaXMuZGZzSGFzaChkc2ZJZCkpICsgIi8iICsgZHNmSWQgKyAiLm1wMyI7Cgl9LAoKCS8qKgoJICog5bCL5om+IERGUyDlk4jluIwKCSAqIEBwYXJhbSAge0ludGVnZXJ9IGRmc2lkICAg5ZOI5biM5YC8CgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgIOino+aekOWQjueahOWFp+WuueeahOWAvAoJICovCglkZnNIYXNoOiBmdW5jdGlvbihkZnNpZCkgewoJCWZ1bmN0aW9uIHN0clRvS2V5Q29kZXMgKHN0cikgewoJCQlyZXR1cm4gU3RyaW5nKHN0cikuc3BsaXQoJycpLm1hcChmdW5jdGlvbihlKSB7CgkJCQlyZXR1cm4gZS5jaGFyQ29kZUF0KCk7CgkJCX0pOwoJCX0KCgkJLy8g6L+Y5Y6fOgoJCS8vIGFyci5tYXAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZSkgfSkuam9pbignJyk7CgkJLy8g5LiN6IO955u05o6l5LygIFN0cmluZy5mcm9tQ2hhckNvZGUgISEg5Y+C5pWwMiDnmoQgaW5kZXgg5Lya546p5Z2P6L+U5Zue5YC8CgkJCgkJdmFyIGtleXMgPSBbCgkJCTUxLCAxMDMsIDExMSwgNTYsIDM4LCAzNiwKCQkJNTYsIDQyLCA1MSwgNDIsIDUxLCAxMDQsCgkJCTQ4LCAxMDcsIDQwLCA1MCwgNDEsIDUwCgkJXTsKCgkJdmFyIGZpZHMgPSBzdHJUb0tleUNvZGVzKGRmc2lkKS5tYXAoZnVuY3Rpb24oZmlkLCBpKSB7CgkJCXJldHVybiAoZmlkIF4ga2V5c1tpICUga2V5cy5sZW5ndGhdKSAmIDB4RkY7CgkJfSk7CgoJCXJldHVybiBDcnlwdG9KUwoJCQkJCQkuTUQ1KENyeXB0b0pTLmxpYi5CeXRlQXJyYXkoZmlkcykpCgkJCQkJCS50b1N0cmluZyhDcnlwdG9KUy5lbmMuQmFzZTY0KQoJCQkJCQkucmVwbGFjZSgvXC8vZywgIl8iKQoJCQkJCQkucmVwbGFjZSgvXCsvZywgIi0iKTsKCX0sCgoJZW5jX2FqYXg6IGZ1bmN0aW9uICh1cmwsIHJlcU9iaiwgY2IpIHsKCQl2YXIgX2Nyc2YgPSB1bnNhZmVXaW5kb3cuTkVKX0NPTkYucF9jc3JmLnBhcmFtOwoJCXZhciBfdG9rZW4gPSBkb2N1bWVudC5jb29raWUubWF0Y2gobmV3IFJlZ0V4cCh1bnNhZmVXaW5kb3cuTkVKX0NPTkYucF9jc3JmLmNvb2tpZSArICc9KFxcdyspJykpWzFdOwoJCXJlcU9ialtfY3JzZl0gPSBfdG9rZW47CgoJCS8vIOaehOW7uiB1cmwKCQl1cmwgKz0gdXJsLmluZGV4T2YoJz8nKSA9PT0gLTEgPyAnPycgOiAnJic7CgkJdXJsICs9IF9jcnNmICsgJz0nICsgX3Rva2VuOwoKCQl2YXIgZW5jcnlwdGVkRGF0YSA9IHVuc2FmZVdpbmRvdy5hc3JzZWEoSlNPTi5zdHJpbmdpZnkocmVxT2JqKSwgIjAxMDAwMSIsIjAwZTBiNTA5ZjYyNTlkZjg2NDJkYmMzNTY2MjkwMTQ3N2RmMjI2NzdlYzE1MmI1ZmY2OGFjZTYxNWJiN2I3MjUxNTJiM2FiMTdhODc2YWVhOGE1YWE3NmQyZTQxNzYyOWVjNGVlMzQxZjU2MTM1ZmNjZjY5NTI4MDEwNGUwMzEyZWNiZGE5MjU1N2M5Mzg3MDExNGFmNmM5ZDA1YzRmN2YwYzM2ODViN2E0NmJlZTI1NTkzMjU3NWNjZTEwYjQyNGQ4MTNjZmU0ODc1ZDNlODIwNDdiOTdkZGVmNTI3NDFkNTQ2YjhlMjg5ZGM2OTM1YjNlY2UwNDYyZGIwYTIyYjhlNyIsICIwQ29KVW02UXl3OFc4anVkIik7CgkJdmFyIHBvc3REYXRhID0gewoJCQlwYXJhbXM6IGVuY3J5cHRlZERhdGEuZW5jVGV4dCwKCQkJZW5jU2VjS2V5OiBlbmNyeXB0ZWREYXRhLmVuY1NlY0tleQoJCX07CgoJCXZhciBhamF4ID0gJC5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCW1ldGhvZDogJ1BPU1QnLAoJCQlkYXRhOiBwb3N0RGF0YSwKCQkJZGF0YVR5cGU6ICdqc29uJwoJCX0pOwoKCQlpZiAoY2IpIGFqYXguZG9uZShjYik7CgoJCXJldHVybiBhamF4OwoJfSwKCglmZXRjaFNvbmc6IGZ1bmN0aW9uIChpZHMsIGNiKSB7CgkJcmV0dXJuIHRoaXMuZW5jX2FqYXgoJy93ZWFwaS9zb25nL2RldGFpbC8nLCB7CgkJCWlkczogaWRzCgkJfSwgY2IpOwoJfSwKCglnZXRNdklkOiBmdW5jdGlvbiAoc29uZ0lkLCBjYikgewoJCXZhciBfY2FjaGU7CgkJdHJ5IHsKCQkJX2NhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UubXZfY2FoY2UpOwoJCX0gY2F0Y2ggKGUpIHsKCQkJX2NhY2hlID0ge307CgkJfQoKCQlpZiAoc29uZ0lkIGluIF9jYWNoZSkgewoJCQljYihfY2FjaGVbc29uZ0lkXSk7CgkJCXJldHVybiA7CgkJfQoKCQl0aGlzLmZldGNoU29uZyhbJF9HRVQuaWRdLCBmdW5jdGlvbiAoZGF0YSkgewoJCQlpZiAoZGF0YS5jb2RlID09IDIwMCkgewoJCQkJdmFyIG12aWQgPSBfY2FjaGVbc29uZ0lkXSA9IGRhdGEuc29uZ3NbMF0ubXZpZDsKCQkJCWxvY2FsU3RvcmFnZS5tdl9jYWhjZSA9IEpTT04uc3RyaW5naWZ5KF9jYWNoZSk7CgkJCQljYihtdmlkKTsKCQkJfQoJCX0pOwoJfSwKCglwYXJzZU12OiBmdW5jdGlvbiAoKSB7CgkJdmFyICRmbGFzaEJveCA9ICQoJyNmbGFzaF9ib3gnKTsKCQlpZiAoJGZsYXNoQm94Lmxlbmd0aCkgewoJCQl2YXIgaHRtbCA9ICRmbGFzaEJveC5odG1sKCk7CgkJCXZhciBwYXJhbXMgPSBILnBhcnNlUXVlcnlTdHJpbmcoaHRtbC5tYXRjaCgvZmxhc2h2YXJzPSIoW1xzXFNdKz8pIi8pWzFdLnJlcGxhY2UoLyZhbXA7L2csICcmJykpOwoKCQkJdmFyIHEgPSB7CgkJCQlodXJsOiAn6auY5riFJywKCQkJCW11cmw6ICfmoIfmuIUnLAoJCQkJbHVybDogJ+a4o+eUu+i0qCcKCQkJfTsKCgkJCXZhciAkZGxIb2xkZXIgPSAkKCc8cD4nKS5jc3MoewoJCQkJdGV4dEFsaWduOiAncmlnaHQnCgkJCX0pLnRleHQoJ01WIOS4i+i9vTogJykuaW5zZXJ0QWZ0ZXIoJGZsYXNoQm94KTsKCQkJT2JqZWN0LmtleXMocSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CgkJCQlpZiAocGFyYW1zW2tleV0pIHsKCQkJCQl2YXIgJGRsID0gJCgnPGE+JykuYXR0cih7CgkJCQkJCWhyZWY6IEgudXJpKHBhcmFtc1trZXldLCBILnNwcmludGYoJyVzWyVzTVZdLm1wNCcsIHBhcmFtcy50cmFja05hbWUsIHFba2V5XSkpLAoJCQkJCQl0aXRsZTogSC5zcHJpbnRmKCfkuIvovb0gJXMg55qEICVzIE12JywgcGFyYW1zLnRyYWNrTmFtZSwgcVtrZXldKQoJCQkJCX0pLnByb3AoJ2Rvd25sb2FkJywgdHJ1ZSkudGV4dChxW2tleV0pOwoKCQkJCQkvLyDkv67mraMgMTYzIOiHquW3seeahOi3s+i9rC4KCQkJCQlILmNhcHR1cmVBcmlhKCRkbCk7CgkJCQkJJGRsSG9sZGVyLmFwcGVuZCgkZGwpOwoJCQkJCSRkbEhvbGRlci5hcHBlbmQoJyB8ICcpOwoJCQkJfQoJCQl9KTsKCQkJJGRsSG9sZGVyLmFwcGVuZChILnNwcmludGYgKCfmj5Dkvps6ICVzICVzICcsIEguc2NyaXB0TmFtZSwgSC52ZXJzaW9uKSk7CgoJCQlpZiAoSC5jb25maWcuYkludGVybmF0aW9uYWwpIHsKCQkJCSRmbGFzaEJveC5odG1sKGh0bWwucmVwbGFjZSgvcmVzdHJpY3Q9dHJ1ZS9nLCAncmVzdHJpY3Q9JykpOwoKCQkJCS8vIOiHquWKqOWFs+mXreW8ueWHuueahOaPkOekuuahhgoJCQkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoKSB7CgkJCQkJdmFyIHQgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CgkJCQkJCXZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3pjbHMnKVswXTsKCQkJCQkJaWYgKGVsKSB7CgkJCQkJCQllbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnbW91c2Vkb3duJykpOwoJCQkJCQkJY2xlYXJJbnRlcnZhbCh0KTsKCQkJCQkJfQoJCQkJCX0sIDEwMCk7CgkJCQl9KTsKCQkJfQoJCX0KCX0sCgoJZW5hYmxlU29uZ1BsYXlCdXR0b246IGZ1bmN0aW9uICgpIHsKCQl2YXIgZW5hYmxlUGxheUJ1dHRvbk9uU29uZ1BhZ2UgPSBmdW5jdGlvbigpIHsKCQkgIC8vIFRyeSB0byBmaW5kIGEgbm9ybWFsIGJ1dHRvbi4gSWYgaXQgY291bGQgYmUgZm91bmQsIGRvIG5vdGhpbmcuCgkJICB2YXIgcGxheUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3UtYnRuaS1hZGRwbHknKTsKCQkJaWYgKHBsYXlCdXR0b24ubGVuZ3RoID09IDEpIHsKCQkJCXdpbmRvdy5jbGVhckludGVydmFsKGVuYWJsZVBsYXlCdXR0b25JbnRlcnZhbCk7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIE90aGVyd2lzZSBpdCBzaG91bGQgYmUgYSBkaXNhYmxlZCBidXR0b24uCgkJCXBsYXlCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd1LWJ0bmktcGxheS1kaXMnKTsKCQkJaWYgKHBsYXlCdXR0b24ubGVuZ3RoID09IDEpIHsKCQkJCXdpbmRvdy5jbGVhckludGVydmFsKGVuYWJsZVBsYXlCdXR0b25JbnRlcnZhbCk7CgkJCQl2YXIgc29uZ0lkID0gJCgnI2NvbnRlbnQtb3BlcmF0aW9uJykuZGF0YSgncmlkJyk7CgkJCQlwbGF5QnV0dG9uWzBdLm91dGVySFRNTCA9ICc8YSBkYXRhLXJlcy1hY3Rpb249InBsYXkiIGRhdGEtcmVzLWlkPSIjU09OR0lEIyIgZGF0YS1yZXMtdHlwZT0iMTgiIGhyZWY9ImphdmFzY3JpcHQ6OyIgY2xhc3M9InUtYnRuMiB1LWJ0bjItMiB1LWJ0bmktYWRkcGx5IGYtZmwiIGhpZGVmb2N1cz0idHJ1ZSIgdGl0bGU9IuaSreaUviI+PGk+PGVtIGNsYXNzPSJwbHkiPjwvZW0+5pKt5pS+PC9pPjwvYT48YSBkYXRhLXJlcy1hY3Rpb249ImFkZHRvIiBkYXRhLXJlcy1pZD0iI1NPTkdJRCMiIGRhdGEtcmVzLXR5cGU9IjE4IiBocmVmPSJqYXZhc2NyaXB0OjsiIGNsYXNzPSJ1LWJ0bmkgdS1idG5pLWFkZCIgaGlkZWZvY3VzPSJ0cnVlIiB0aXRsZT0i5re75Yqg5Yiw5pKt5pS+5YiX6KGoIj48L2E+Jy5yZXBsYWNlKC8jU09OR0lEIy9nLCBzb25nSWQpOwoJCQl9CgkJfTsKCQl2YXIgZW5hYmxlUGxheUJ1dHRvbkludGVydmFsID0gd2luZG93LnNldEludGVydmFsKGVuYWJsZVBsYXlCdXR0b25PblNvbmdQYWdlLCAxMDAwKTsKCX0sCgoJZW5hYmxlUGxheWxpc3RQbGF5QnV0dG9uOiBmdW5jdGlvbiAoKSB7CgkJdmFyIGVuYWJsZVBsYXlCdXR0b25PblBsYXlsaXN0UGFnZSA9IGZ1bmN0aW9uKCkgewoJCQkvLyBGaW5kIG91dCBkaXNhYmxlZCBzb25ncy4KCQkJdmFyIGRpc2FibGVkU29uZ3NJblBsYXlsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtZGlzJyk7CgkJCWlmIChkaXNhYmxlZFNvbmdzSW5QbGF5bGlzdC5sZW5ndGggPT09IDApewoJCQkJd2luZG93LmNsZWFySW50ZXJ2YWwoZW5hYmxlUGxheUJ1dHRvbkludGVydmFsKTsKCQkJfQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IGRpc2FibGVkU29uZ3NJblBsYXlsaXN0Lmxlbmd0aDsgKXsKCQkJCWRpc2FibGVkU29uZ3NJblBsYXlsaXN0W2ldLmNsYXNzTmFtZSA9IGRpc2FibGVkU29uZ3NJblBsYXlsaXN0W2ldLmNsYXNzTmFtZS5yZXBsYWNlKCdqcy1kaXMnLCAnJyk7CgkJCX0KCQl9OwoJCXZhciBlbmFibGVQbGF5QnV0dG9uSW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZW5hYmxlUGxheUJ1dHRvbk9uUGxheWxpc3RQYWdlLCAxMDAwKTsKCX0sCgoJb25Cb2R5RnJhbWU6IGZ1bmN0aW9uICgpIHsKCQlzd2l0Y2gobG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKVsxXSkgewoJCQljYXNlICdtdic6IAkJCS8vIE1WCgkJCQl0aGlzLnBhcnNlTXYoKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnb3V0Y2hhaW4nOiAJLy8g5aSW6ZO+CgkJCQl0aGlzLmhvb2tQbGF5ZXJPdXRjaGFpbigpOwoJCQkJYnJlYWs7CgoJCQljYXNlICdzb25nJzogCQkvLyDljZXmm7IKCQkJCXRoaXMuZW5hYmxlU29uZ1BsYXlCdXR0b24oKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnYWxidW0nOiAJCS8vIOS4k+i+kQoJCQljYXNlICdhcnRpc3QnOiAJCS8vIOiJuuacr+WutgoJCQljYXNlICdwbGF5bGlzdCc6IAkvLyDmkq3mlL7liJfooagKCQkJY2FzZSAnZGlzY292ZXInOiAJLy8g6aaW6aG1CgkJCQl0aGlzLmVuYWJsZVBsYXlsaXN0UGxheUJ1dHRvbigpOwoJCQkJYnJlYWs7CgkJfQoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQl0aGlzLl9kb1JlbW92YWwoKTsKCQl1bnNhZmVXaW5kb3cuR0Ficm9hZCA9IGZhbHNlOwoKCQkvLyDkuI3lnKjmoYbmnrbln7fooYwKCQlpZiAoSC5pc0ZyYW1lKSB7CgkJCXRoaXMub25Cb2R5RnJhbWUoKTsKCQkJcmV0dXJuOwoJCX0KCgkJdGhpcy5saW5rRG93bmxvYWQgPSAkKCc8YT4nKS5hcHBlbmRUbygkKCcubS1wbGF5YmFyIC5vcGVyJykpLmF0dHIoewoJCQl0aXRsZTogJ+aSreaUvumfs+S5kCwg5Y2z5Yi76Kej5p6QJwoJCX0pLmNsaWNrKGZ1bmN0aW9uKGUpIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9KS5hZGRDbGFzcyhILmRlZmF1bHREbEljb24pLmFkZENsYXNzKCdqeF9idG4nKTsKCgkJdGhpcy5saW5rRG93bmxvYWRBbGwgPSAkKCc8YT4nKS5hZGRDbGFzcyhILmRlZmF1bHREbEljb24pLmFkZENsYXNzKCdhZGRhbGwnKS50ZXh0KCflhajpg6jkuIvovb0nKS5hdHRyKHsKCQkJdGl0bGU6ICfkuIvovb3liJfooajph4znmoTmiYDmnInmrYzmm7InCgkJfSkuY2xpY2soZnVuY3Rpb24oZSkgewoJCQllLnN0b3BQcm9wYWdhdGlvbigpOwoKCQkJdmFyIHRyYWNrUXVldWUgPSBsb2NhbFN0b3JhZ2VbJ3RyYWNrLXF1ZXVlJ107CgkJCXZhciBhcmlhMiA9IG5ldyBBcmlhMi5CQVRDSChILmFyaWEyLCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiBILmluZm8oYXJndW1lbnRzKTsKCQkJfSk7CgoJCQl2YXIgdHJhY2tzID0gSlNPTi5wYXJzZSh0cmFja1F1ZXVlKTsKCQkJdmFyIHBhZHMgPSB+fk1hdGgubG9nMTAodHJhY2tzLmxlbmd0aCk7CgoJCQl0cmFja3MuZm9yRWFjaChmdW5jdGlvbiAodHJhY2ssIGkpIHsKCQkJCXZhciBhcnRpc3RzID0gKHRyYWNrLmFydGlzdHMgfHwgdHJhY2suYXIpLm1hcChnZXROYW1lKS5qb2luKCfjgIEnKTsKCgkJCQl2YXIgcGFyYW0gPSBILmJ1aWxkQXJpYVBhcmFtKHsKCQkJCQlvdXQ6IHBhZFplcm8oaSkgKyAiLiAiICsgdHJhY2submFtZSArICIgWyIgKyBhcnRpc3RzICsgIl0ubXAzIgoJCQkJfSk7CgoJCQkJYXJpYTIuYWRkKEFyaWEyLmZuLmFkZFVyaSwgW3NlbGYuZ2V0VXJpKHRyYWNrKV0sIHBhcmFtKTsKCQkJfSk7CgkJCWFyaWEyLnNlbmQodHJ1ZSk7CgoJCQlmdW5jdGlvbiBnZXROYW1lICh4KSB7CgkJCQlyZXR1cm4geC5uYW1lOwoJCQl9CgoJCQlmdW5jdGlvbiBwYWRaZXJvIChzdHIpIHsKCQkJCWZvciAodmFyIGkgPSBzdHIubGVuZ3RoOyBpIDwgcGFkczsgaSsrKSB7CgkJCQkJc3RyID0gJzAnICsgc3RyOwoJCQkJfQoKCQkJCXJldHVybiBzdHI7CgkJCX0KCQl9KS5oaWRlKCk7CgoJCS8vIOaaguaXtuemgeeUqOaJuemHj+S4i+i9veWKn+iDveOAggoKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT09IDIvKiBVUklfVVNFX0FSSUEgKi8pIHsKCQkJSC5jYXB0dXJlQXJpYSh0aGlzLmxpbmtEb3dubG9hZCk7CgkJfSBlbHNlIHsKCQkJdGhpcy5saW5rRG93bmxvYWRBbGwuYWRkQ2xhc3MoJ2p4X2hpZGUnKTsKCQl9CgoJCXN3aXRjaCAobG9jYXRpb24ucGF0aG5hbWUpIHsKCQkJY2FzZSAnL2RlbW8vZm0nOgoJCQkJdGhpcy5ob29rUGxheWVyRm0oKTsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCUgud2FpdFVudGlsKGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiAkKCcubGlzdGhkYyA+IC5hZGRhbGwnKS5sZW5ndGg7CgkJCQl9LCBmdW5jdGlvbigpIHsKCQkJCQlzZWxmLmxpbmtEb3dubG9hZEFsbC5pbnNlcnRCZWZvcmUoJCgnLm0tcGxheWJhciAubGlzdGhkYyAuYWRkYWxsJykpLmFmdGVyKCQoJzxhPicpLmFkZENsYXNzKCdsaW5lIGp4X2RsX2xpbmUnKSk7CgkJCQl9LCB0cnVlLCA1MDApOwoJCQkJdGhpcy5ob29rUGxheWVyKCk7CgkJfQoKCQkvLyDmjqfliLblj7DmiafooYw6IGxvY2FsU3RvcmFnZS5fUExFQVNFX0FVVE9fU0lHTiA9IDEKCQkvLyDljbPlj6/lkK/nlKjoh6rliqjnrb7liLDlip/og70gKOS4jeS8muiuoeeul+aXtuW3rikgOkQKCQlpZihsb2NhbFN0b3JhZ2UuX1BMRUFTRV9BVVRPX1NJR04pCgkJCXNldFRpbWVvdXQodGhpcy5hdXRvX3NpZ24uYmluZCh0aGlzKSwgMzAwMCk7CgoJCS8vIOaOp+WItuWPsOaJp+ihjDogbG9jYWxTdG9yYWdlLl9fSElERV9CQU5ORVIgPSAxCgkJLy8g5Y2z5Y+v56e76Zmk6aaW6aG15qiq5bmF5LiO5a6i5oi356uv5YWl5Y+j6ZO+5o6lIDpECgkJaWYgKGxvY2FsU3RvcmFnZS5fX0hJREVfQkFOTkVSKSB7CgkJCXZhciAkbHN0ID0gJCgnLm0tbmF2ID4gLmxzdCcpOwoJCQkkbHN0LnByZXYoKS5hZGRDbGFzcygnbHN0Jyk7CgkJCSRsc3QucmVtb3ZlKCk7CgkJfQoJfSwKCglhdXRvX3NpZ246IGZ1bmN0aW9uICgpIHsKCQl2YXIgZCA9IG5ldyBEYXRlKCk7CgkJdmFyIGRhdGVfc3RyID0gZC5nZXRGdWxsWWVhcigpICsgJy8nICsgZC5nZXRNb250aCgpICsgJy8nICsgZC5nZXREYXkoKTsKCQlpZiAobG9jYWxTdG9yYWdlLl9fU0lHTl9EQVRFICE9IGRhdGVfc3RyKSB7CgkJCWxvY2FsU3RvcmFnZS5fX1NJR05fREFURSA9IGRhdGVfc3RyOwoKCQkJdGhpcy5lbmNfYWpheCgnL2FwaS9wb2ludC9kYWlseVRhc2s/dHlwZT0xJywgeyAgfSwgZnVuY3Rpb24gKHIpIHsKCQkJCWlmIChyLmNvZGUgPT0gMjAwKSB7CgkJCQkJSC5pbmZvKCfnrb7liLDmiJDlip86IOiOt+W+lyAlYyVkJWMg54K556ev5YiGLicsICdjb2xvcjpibHVlJywgci5wb2ludCwgJ2NvbG9yOmluaXRpYWwnKTsKCQkJCX0gZWxzZSB7CgkJCQkJSC5pbmZvKCfnrb7liLDlpLHotKUgKCVjJWQlYyk6ICVzJywgJ2NvbG9yOmJsdWUnLCByLmNvZGUsICdjb2xvcjppbml0aWFsJywgci5tc2cpOwoJCQkJfQoJCQl9KTsKCQl9Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLjF0aW5nLmpzICovCnsKCWlkOiAnbXVzaWMuMXRpbmcnLAoJbmFtZTogJ+S4gOWQrOmfs+S5kCcsCglob3N0OiBbJ3d3dy4xdGluZy5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6IFsnL3BsYXllci8nLCAnL2FsYnVtXyddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxCdG4gPSAkKCcuc29uZ2FjdCBhLmRvd24nKQoJCQkudGV4dCAoJ+ebtOaOpeS4i+i9vScpCgkJCS5yZW1vdmVBdHRyKCdvbmNsaWNrJyk7CgoJCUgud2FpdFVudGlsICgneWl0aW5nLnBsYXllci5lbnRpdHkuc3JjJywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoKSB7CgkJCQl2YXIgcGxheVRyaWdnZXIgPSBmdW5jdGlvbiAoKSB7CgkJCQkJLy8gZGxCdG4uYXR0cignaHJlZicsIHdpbmRvdy55aXRpbmcucGxheWVyLmVudGl0eS5zcmMpOwoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKEguc2NyaXB0TmFtZSkgKTsKCQkJCX07CgoJCQkJd2luZG93LnlpdGluZy5wbGF5ZXIuaG9vaygncGxheScsIHBsYXlUcmlnZ2VyKTsKCQkJCXBsYXlUcmlnZ2VyICgpOwoJCQl9KTsKCQl9KTsKCgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCB0aGlzLmV2ZW50SGFuZGxlci5iaW5kICh0aGlzKSwgZmFsc2UpOwoJCXRoaXMuZXZlbnRIYW5kbGVyICgpOwoJfSwKCglldmVudEhhbmRsZXI6IGZ1bmN0aW9uICgpIHsKCQl2YXIgc29uZ1RpdGxlID0gJCgnLnNvbmcgLnNvbmd0aXRsZSA+IGEnKS50ZXh0ICgpOwoJCXRoaXMuZGxCdG4uYXR0ciAoewoJCQlocmVmOiBILnVyaSAodW5zYWZlV2luZG93LnlpdGluZy5wbGF5ZXIuZW50aXR5LnNyYywgc29uZ1RpdGxlICsgJy5tcDMnKSwKCQkJdGl0bGU6ICfkuIvovb06ICcgKyBzb25nVGl0bGUKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy41NjU2NTYuanMgKi8KewoJaWQ6ICdtdXNpYy41NjU2NTYnLAoJbmFtZTogJzU2NTY1NiDpn7PkuZAnLAoJaG9zdDogJ3d3dy41NjU2NTYuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6IFsnL3BsdXMvcGxheWVyLmFzaHgnLCAnL3RpbmcvJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCUgualBsYXllclBhdGNoZXIgKGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCXZhciBzb25nQWRkciA9IHNvbmdPYmoubXAzIHx8IHNvbmdPYmoubTRhOwoJCQkkKCcucGxheS1pbmZvLW90aGVyb3B0ID4gYTpsYXN0JykKCQkJCS5hdHRyKCdocmVmJywgSC51cmkgKHNvbmdBZGRyLCBzb25nT2JqLnNvbmduYW1lICsgc29uZ09iai5tNGEuc2xpY2UoLTQpKSkKCQkJCS5maW5kKCdzcGFuJykudGV4dCgn5LiL6L29OiAnICsgc29uZ09iai5zb25nbmFtZSArICcgLSAnICsgc29uZ09iai5zaW5nZXJuYW1lKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy41c2luZy5qcyAqLwp7CglpZDogJ211c2ljLjVzaW5nJywKCW5hbWU6ICc1c2luZyDkuIvovb3op6PmnpAnLAoJaG9zdDogWyc1c2luZy5jb20nLCAnNXNpbmcua3Vnb3UuY29tJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCWlmIChILmJlZ2luV2l0aChsb2NhdGlvbi5wYXRobmFtZSwgJy9mbS8nKSkgewoJCQkvLyBlLmcuIGh0dHA6Ly81c2luZy5rdWdvdS5jb20vZm0vbS8KCQkJdGhpcy5fZm1Ib29rICgpOwoJCX0KCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguY29udGFpbnMobG9jYXRpb24ucGF0aG5hbWUsICcvZG93bi8nKSkgewoJCQl0aGlzLl9kbFBhZ2UgKCk7CgkJCXJldHVybiA7CgkJfQoKCQkvLyDml6fniYjljZXmm7Lmkq3mlL7pobXpnaIKCQlILndhaXRVbnRpbCAoJ3BhZ2VPcHRpb25zLnRpY2tldCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIHNvbmdPYmogPSBKU09OLnBhcnNlKEguYmFzZTY0RGVjb2RlKHVuc2FmZVdpbmRvdy5wYWdlT3B0aW9ucy50aWNrZXQpKTsKCQkJJCgnLmZ1bmNfaWNvbjM+YScpLmF0dHIgKHsKCQkJCWhyZWY6IEgudXJpKHNvbmdPYmouZmlsZSwgc29uZ09iai5zb25nTmFtZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+WNleWHu+S4i+i9vTogJyArIHNvbmdPYmouc29uZ05hbWUsCgkJCX0pLmh0bWwoJzxiLz7nm7Tpk77kuIvovb0nKTsKCgkJCSQoJyNwbGF5JykuY3NzICh7CgkJCQl0b3A6ICdpbml0aWFsJwoJCQl9KTsKCQkJJCgnLnNvbmdfcGxheScpLmNzcyAoewoJCQkJbWFyZ2luVG9wOiAnMWVtJwoJCQl9KTsKCQkJJCgnLnJ0MicpLmhpZGUoKTsKCQkJJCgnI3JlcG9ydCcpLnBhcmVudCgpLmhpZGUoKTsKCQl9KTsKCgkJLy8g5paw54mI5Y2V5puy5pKt5pS+6aG16Z2iCgkJSC53YWl0VW50aWwgKCdnbG9iYWxzLnRpY2tldCcsIGZ1bmN0aW9uICgpIHsKCQkJdmFyIHNvbmdPYmogPSBKU09OLnBhcnNlKEguYmFzZTY0RGVjb2RlKHVuc2FmZVdpbmRvdy5nbG9iYWxzLnRpY2tldCkpOwoJCQkkKCcudmlld19pbmZvPnVsOmxhc3Q+bGk6Zmlyc3QnKS5yZXBsYWNlV2l0aCgkKCc8bGk+JykuYXBwZW5kICgKCQkJCSQoJzxhPicpLnRleHQoJ+eCueaIkeS4i+i9vScpLmF0dHIoewoJCQkJCWhyZWY6IEgudXJpKHNvbmdPYmouZmlsZSwgc29uZ09iai5zb25nTmFtZSArICcubXAzJyksCgkJCQkJdGl0bGU6ICfljZXlh7vkuIvovb06ICcgKyBzb25nT2JqLnNvbmdOYW1lLAoJCQkJCXRhcmdldDogJ19ibGFuaycKCQkJCX0pLmNzcyAoJ2NvbG9yJywgJyNGODc4NzcnKQoJCQkpKTsKCQl9KTsKCX0sCgoJX2RsUGFnZTogZnVuY3Rpb24gKCkgewoJCXZhciAkZGwgPSAkKCc8cD4nKS5wcmVwZW5kVG8gKCQoJy5zaW5nX3ZpZXcnKSkudGV4dCgn5q2j5Zyo6Kej5p6Q6Z+z5LmQ5Zyw5Z2A4oCmJyk7CgoJCSQuZ2V0KCQoJy5tYWluID4gaDEgPiBhJykuYXR0cignaHJlZicpKS5zdWNjZXNzIChmdW5jdGlvbiAocmVzKSB7CgkJCXZhciBzb25nQWRkcmVzcyA9IHJlcy5tYXRjaCgvInRpY2tldCJccyo6XHMqXCIoLis/KSIvKTsKCQkJaWYgKHNvbmdBZGRyZXNzKSB7CgkJCQl2YXIgc29uZ09iaiA9IEpTT04ucGFyc2UoSC5iYXNlNjREZWNvZGUoc29uZ0FkZHJlc3NbMV0pKTsKCQkJCXNvbmdBZGRyZXNzID0gSC51cmkoc29uZ09iai5maWxlLCBzb25nT2JqLnNvbmdOYW1lICsgJy5tcDMnKTsKCQkJfSBlbHNlIGlmIChzb25nQWRkcmVzcyA9IHJlcy5tYXRjaCgvLFxzKmZpbGVccyo6XHMqXCIoLis/KSIvKSkgewoJCQkJLy8g5p2l5rqQ6K+35rGCCgkJCQlzb25nQWRkcmVzcyA9IHNvbmdBZGRyZXNzWzFdOwoJCQl9IGVsc2UgewoJCQkJJGRsIC50ZXh0ICgnKiDkuIvovb3op6PmnpDlpLHotKXvvIzor7forr/pl67mrYzmm7LpobXop6PmnpDjgIInKQoJCQkJCS5jc3MgKCdjb2xvcicsICdyZWQnKTsKCQkJCXJldHVybiA7CgkJCX0KCgkJCSRkbC50ZXh0KCfop6PmnpDlrozmr5U6ICcpLmFwcGVuZCAoJCgnPGE+JykuYXR0cih7CgkJCQlocmVmOiBzb25nQWRkcmVzcywKCQkJCXRhcmdldDogJ19ibGFuaycKCQkJfSkudGV4dCgn54K55oiR5LiL6L29JykpOwoJCX0pLmVycm9yIChmdW5jdGlvbiAoKSB7CgkJCSRkbCAudGV4dCAoJyog572R57uc6ZSZ6K+v77yM6K+356iN5YCZ6YeN6K+V5oiW6K6/6Zeu5q2M5puy6aG16Kej5p6Q44CCJykKCQkJCS5jc3MgKCdjb2xvcicsICdyZWQnKTsKCQl9KTsKCX0sCgoJX2ZtSG9vazogZnVuY3Rpb24gKCkgewoJCWlmICh0aGlzLmZtSG9va2VkKSByZXR1cm4gOwoJCXRoaXMuZm1Ib29rZWQgPSB0cnVlOwoKCQlILmhvb2tEZWZpbmUgKCdkZWZpbmUnLCBmdW5jdGlvbiAoc2NyaXB0TmFtZSwgX2RlZmluZSwgbW9kdWxlTmFtZSwgcmVxdWlyZXMsIGZDYWxsYmFjaykgewoJCQlpZiAoJ3BsYXllci9zaW5nbGUnID09PSBtb2R1bGVOYW1lKSB7CgkJCQlyZXR1cm4gX2RlZmluZSAobW9kdWxlTmFtZSwgcmVxdWlyZXMsIGZ1bmN0aW9uIChyZXF1aXJlLCBleHBvcnRzLCBtb2R1bGUpIHsKCQkJCQl2YXIgcmV0ID0gZkNhbGxiYWNrLmNhbGwgKG51bGwsIHJlcXVpcmUsIGV4cG9ydHMsIG1vZHVsZSk7CgoJCQkJCXZhciAkd3NwID0gbW9kdWxlLmV4cG9ydHM7CgkJCQkJdmFyIE1lZGlhRWxlbWVudCA9ICR3c3AubWVkaWFFbGVtZW50OwoJCQkJCSR3c3AubWVkaWFFbGVtZW50ID0gZnVuY3Rpb24gKHBsYXllckJveElkLCBvcHRpb25zKSB7CgkJCQkJCW9wdGlvbnMuc3RhdHMuZW5hYmxlID0gZmFsc2U7CgkJCQkJCXZhciBtUGxheWVyID0gbmV3IE1lZGlhRWxlbWVudCAocGxheWVyQm94SWQsIG9wdGlvbnMpOwoJCQkJCQl2YXIgX3BsYXkgPSBtUGxheWVyLnBsYXk7CgkJCQkJCW1QbGF5ZXIucGxheSA9IGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBzb25nT2JqfSkgKTsKCQkJCQkJCXJldHVybiBfcGxheS5jYWxsIChtUGxheWVyLCBzb25nT2JqKTsKCQkJCQkJfTsKCQkJCQkJcmV0dXJuIG1QbGF5ZXI7CgkJCQkJfTsKCQkJCQlyZXR1cm4gcmV0OwoJCQkJfSk7CgkJCX0KCQl9LCBILnNjcmlwdE5hbWUpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBzb25nT2JqID0gZS5kZXRhaWw7CgkJCXNldFRpbWVvdXQgKGZ1bmN0aW9uICgpIHsKCQkJCSQoJy5qcC1kb3dubG9hZCcpLmF0dHIgKHsKCQkJCQlocmVmOiBILnVyaShzb25nT2JqLmZpbGUsIHNvbmdPYmouc29uZ05hbWUgKyAnLm1wMycpLAoJCQkJCXRpdGxlOiAn5LiL6L29OiAnICsgc29uZ09iai5zb25nTmFtZQoJCQkJfSk7CgkJCX0sIDEpOwoJCX0sIGZhbHNlKTsKCX0sCgp9LAovKiBDb21waWxlZCBmcm9tIG11c2ljLjlrdS5qcyAqLwp7CglpZDogJ211c2ljLjlrdScsCgluYW1lOiAnOemFt+mfs+S5kCcsCglob3N0OiAnd3d3LjlrdS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJaGlkZTogWycjTFIyJywgJyNMUjMnLCAnI3NlZWdjJywgJy5kb25nRG93biddLAoJcGF0aDogWycvcGxheS8nLCAnL3BsYXkuaHRtJ10sCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuZGxMaW5rID0gJCgnPGE+JykKCQkJLmF0dHIgKCd0YXJnZXQnLCAnX2JsYW5rJykKCQkJLmF0dHIgKCd0aXRsZScsICAn5q2j5Zyo5oqT5Y+W5q2M5puy5pWw5o2uIC4uJykKCQkJLnRleHQgKCfkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdmFyIHNvbmdVcmwgID0gc29uZ09iai5tcDMgfHwgc29uZ09iai5tNGEsCgkJCQlzb25nTmFtZSA9ICQoJyNwbGF5X211c2ljbmFtZScpLnRleHQoKTsKCgkJCXRoaXMuZGxMaW5rCgkJCQkuYXR0ciAoJ2hyZWYnLCBILnVyaSAoc29uZ1VybCwgc29uZ05hbWUgKyBzb25nVXJsLnNsaWNlKC00KSkpCgkJCQkuYXR0ciAoJ3RpdGxlJywgJ+S4i+i9vTogJyArIHNvbmdOYW1lKTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJJCgnLnJpbmdEb3duJykuY3NzICh7CgkJCWZsb2F0OiAnbm9uZScsCgkJCWRpc3BsYXk6ICdibG9jaycsCgkJCXRleHRBbGlnbjogJ2NlbnRlcicKCQl9KS5odG1sICh0aGlzLmRsTGluayk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuYmFpZHUuanMgKi8KewoJaWQ6ICdtdXNpYy5iYWlkdScsCgluYW1lOiAn55m+5bqm6Z+z5LmQJywKCWhvc3Q6ICdtdXNpYy5iYWlkdS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJcGF0aDogL15cL3NvbmdcL1xkK1wvZG93bmxvYWQvLAoKCWhpZGU6ICcuZm9yZWlnbi10aXAnLAoJX3NldFRleHQ6IGZ1bmN0aW9uICh0ZXh0KSB7CgkJaWYgKHRleHRbMF0gPT0gJysnKSB7CgkJCXRoaXMuYnRuRG93bmxvYWQudGl0bGUuYXBwZW5kKHRleHQuc2xpY2UoMSkpOwoJCX0gZWxzZSB7CgkJCXRoaXMuYnRuRG93bmxvYWQudGl0bGUudGV4dCh0ZXh0KTsKCQl9Cgl9LAoJX3NldExpbms6IGZ1bmN0aW9uICh1cmwpIHsKCQl0aGlzLmJ0bkRvd25sb2FkLmJ0bi5hdHRyKCdocmVmJywgdXJsKTsKCX0sCglfYnRuOiBmdW5jdGlvbiAodGV4dCwgb3V0ZXJJY29uLCBpbm5lckljb24pIHsKCQl2YXIgYnRuID0gJCgnPGE+PHNwYW4gY2xhc3M9ImlubmVyIj48aSBjbGFzcz0iaWNvbiBidG4taWNvbi0nICsgaW5uZXJJY29uICsgJyI+JykKCQkJLmFkZENsYXNzKCdidG4gYnRuLScgKyBvdXRlckljb24gKyAnIGFjdGl2ZWQnKQoJCQkuYXR0cigndGFyZ2V0JywgJ19ibGFuaycpCgkJCS5hdHRyKCdocmVmJywgJyMnKQoJCQkuYXBwZW5kVG8odGhpcy5wKTsKCgkJcmV0dXJuICh7CgkJCWJ0bjogYnRuLAoJCQl0aXRsZTogJCgnPHNwYW4+JykuYXBwZW5kVG8oJCgnLmlubmVyJywgYnRuKSkudGV4dCh0ZXh0KQoJCX0pOwoJfSwKCglfaW5pdERsOiBmdW5jdGlvbiAoZSkgewoJCXRoaXMuZG93bmxvYWRJbmZvID0gSlNPTi5wYXJzZShlLmRldGFpbCkuZG93bmxvYWRJbmZvOwoJfSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCB0aGlzLl9pbml0RGwuYmluZCAodGhpcyksIGZhbHNlKTsKCgkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoc2NyaXB0TmFtZSkgewoJCQkvLyDlsY/olL3lub/lkYrlhpnlh7oKCQkJZG9jdW1lbnQud3JpdGUgPSAoZnVuY3Rpb24gd3JpdGUoKXt9KS5iaW5kKDApOwoKCQkJd2luZG93LnRpbmcgPSB7fTsKCQkJdmFyIG9yaWdJbml0RG93bmxvYWQ7CgkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cudGluZywgJ2luaXREb3dubG9hZCcsIHsKCQkJCWdldDogZnVuY3Rpb24gKCkgewoJCQkJCXJldHVybiBmdW5jdGlvbiAoaW5pdE9wdHMpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBKU09OLnN0cmluZ2lmeSAoaW5pdE9wdHMpfSkpOwoKCQkJCQkJcmV0dXJuIG9yaWdJbml0RG93bmxvYWQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJfSwKCQkJCXNldDogZnVuY3Rpb24gKGlkbCkgewoJCQkJCW9yaWdJbml0RG93bmxvYWQgPSBpZGw7CgkJCQl9CgkJCX0pOwoJCX0sIEguc2NyaXB0TmFtZSk7Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBzZWxmID0gdGhpczsKCQl0aGlzLnBhcnNlciA9IEgucnVsZS5nZXQgKCdtdXNpYy5iYWlkdS5wbGF5Jyk7CgkJaWYgKCF0aGlzLnBhcnNlcikgewoJCQlILmVycm9yICgnUmVxdWlyZWQgcnVsZSBgbXVzaWMuYmFpZHUucGxheWAgbWlzc2luZywgcGxlYXNlIHJlLWluc3RhbGwgdGhpcyBzY3JpcHQuJyk7CgkJCXJldHVybiA7CgkJfQoKCQkvLyDluqblqJjnmoTmjInpkq7liY3pnaLmj5LlhaXmiJHku6znmoQKCQl2YXIgb3BlckRpdiA9ICQoJy5vcGVyYXRpb24nKS5wcmVwZW5kKCc8ZGl2IGNsYXNzPSJjbGVhcmZpeCI+Jyk7CgkJdGhpcy5wID0gJCgnPHA+JykucHJlcGVuZFRvKG9wZXJEaXYpLmNzcygnbWFyZ2luLWJvdHRvbScsICcyZW0nKTsKCgkJLy8g5re75Yqg5oyJ6ZKuCgkJdGhpcy5idG5Eb3dubG9hZCA9IHRoaXMuX2J0bign6K+36YCJ5oup6Z+z6LSoJywgJ2gnLCAnZG93bmxvYWQtc21hbGwnKTsKCQkvLyB0aGlzLmJ0bkV4cG9ydCA9IHRoaXMuX2J0bign5a+85Ye65Zyw5Z2AJywgJ2InLCAnZG93bmxvYWQtc21hbGwnKTsKCQl0aGlzLmJ0bkRvd25sb2FkLmJ0bi5jbGljayh0aGlzLl9jbGlja0RsLmJpbmQodGhpcykpOwoKCQkkKCcuZG93bi1yYWRpbycpLmNoYW5nZShmdW5jdGlvbiAoKSB7CgkJCXNlbGYuY2hhbmdlQml0cmF0ZSgkKHRoaXMpKTsKCQl9KS5maWx0ZXIoJzpjaGVja2VkJykuY2hhbmdlKCk7Cgl9LAoKCV9jbGlja0RsOiBmdW5jdGlvbiAoZSkgewoJCWlmICh0aGlzLmJ0bkRvd25sb2FkLmJ0bi5kYXRhICgnZG8tbm90aGluZycpKQoJCQlyZXR1cm4gOwoKCQllLnByZXZlbnREZWZhdWx0KCk7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCXZhciAkZWwgPSB0aGlzLiRlbDsKCgkJdmFyIHNpZCAgPSAkZWwuZGF0YSgnc2lkJyksCgkJCXJhdGUgPSAkZWwuZGF0YSgncmF0ZScpLAoJCQlmbXQgID0gJGVsLmRhdGEoJ2Zvcm1hdCcpOwoKCQlzZWxmLl9zZXRUZXh0ICgnKyAo5byA5aeL6Kej5p6QKScpOwoJCXZhciBmbiA9IEguc3ByaW50ZignJXMgWyVzXS4lcycsIHRoaXMuZG93bmxvYWRJbmZvLnNvbmdfdGl0bGUsIHRoaXMuZG93bmxvYWRJbmZvLnNpbmdlcl9uYW1lLCBmbXQpOwoJCXRoaXMucGFyc2VyLl9hZGRGYXYgKHNpZCwgZnVuY3Rpb24gKGVyckluZm8pIHsKCQkJdmFyIGJOZWVkUm1GYXYgPSBlcnJJbmZvLmNvZGUgPT09IDIyMDAwOwoKCQkJc2VsZi5wYXJzZXIuX2dldFJlYWxVcmwgKHNlbGYucGFyc2VyLl9idWlsZFVybChzaWQsIHJhdGUsIGZtdCksIGZ1bmN0aW9uICh1cmwpIHsKCQkJCUguYWRkRG93bmxvYWQodXJsLCBmbik7CgkJCQlzZWxmLl9zZXRMaW5rIChILnVyaSAodXJsLCBmbikpOwoJCQkJc2VsZi5fc2V0VGV4dCAoJysgKOino+aekOWujOavlSknKTsKCQkJCXNlbGYuYnRuRG93bmxvYWQuYnRuLmRhdGEoJ3BhcnNlLScgKyByYXRlLCBbdXJsLCBmbl0pOwoJCQkJaWYgKGJOZWVkUm1GYXYpIHNlbGYucGFyc2VyLl9ybUZhdiAoc2lkKTsKCgkJCQlzZWxmLmJ0bkRvd25sb2FkLmJ0bi5kYXRhICgnZG8tbm90aGluZycsIHRydWUpOwoJCQl9KTsKCQl9KTsKCX0sCgoJY2hhbmdlQml0cmF0ZTogZnVuY3Rpb24gKCRlbCkgewoJCXRoaXMuJGVsID0gJGVsOwoJCXRoaXMuX3NldFRleHQgKEguc3ByaW50Zign5LiL6L29ICglc2ticHMsICVzIOagvOW8jyknLCAkZWwuZGF0YSgncmF0ZScpLCAkZWwuZGF0YSgnZm9ybWF0JykpKTsKCQl2YXIgZGF0YVVybCA9IHRoaXMuYnRuRG93bmxvYWQuYnRuLmRhdGEgKCdwYXJzZS0nICsgJGVsLmRhdGEoJ3JhdGUnKSk7CgkJdGhpcy5idG5Eb3dubG9hZC5idG4uZGF0YSAoJ2RvLW5vdGhpbmcnLCAhIWRhdGFVcmwpOwoKCQlpZiAoZGF0YVVybCkgewoJCQl0aGlzLl9zZXRMaW5rIChkYXRhVXJsKTsKCQkJdGhpcy5fc2V0VGV4dCAoJysgKOW3suino+aekCknKTsKCQl9Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuYmFpZHUucGxheS5qcyAqLwp7CglpZDogJ211c2ljLmJhaWR1LnBsYXknLAoJbmFtZTogJ+eZvuW6pumfs+S5kOebkicsCglob3N0OiAncGxheS5iYWlkdS5jb20nLAoJcGF0aDogJy8nLAoKCXNob3c6ICcjZmxvYXRCdG4+Lmxvc3NsZXNzJywKCgkvLyBqUXVlcnkg55qEIHdpZHRoIOiuoeeul+WcqOeBq+eLkOS4i+S8muWMheaLrOagt+W8j+ihqCwg5Y2z5L2/5YWD57Sg5bey57uP5LiN5ZyoIGJvZHkg6YeM4oCmCgljc3M6ICAnLmNvbHVtbjR7d2lkdGg6MCAhaW1wb3J0YW50fScsCgoJLy8g5Y2V5puy6Kej5p6Q5Y+q5pyJ6L+Z5LqbCglxdWFsaXRpZXM6ICdhdXRvXzEgbXAzXzMyMCtfMSBtcDNfMzIwXzEnLnNwbGl0KCcgJyksCgoJLyoqCgkgKiBAcHJpdmF0ZQoJICog5Yid5aeL5YyW5LqL5Lu257uR5a6aCgkgKi8KCWluaXRFdmVudHM6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmlzQXJpYSA9IEguY29uZmlnLmRVcmlUeXBlID09IDI7CgoJCS8vIEJhdGNoIGRvd25sb2FkIHF1ZXVlCgkJSC5zZXR1cEFyaWEgKCk7CgkJdGhpcy4kcSA9IG5ldyBJbnRlcnZhbExvb3AoW10sIHRoaXMuX2JhdGNoLmJpbmQodGhpcyksIDMwMCk7CgkJdGhpcy4kcS5sb29wKCk7IC8vIOWHhuWkh+aOpeaUtuaVsOaNrgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSArICctQkFUQ0gnLCB0aGlzLl9iYXRjaERvd25sb2FkLmJpbmQgKHRoaXMpLCBmYWxzZSk7CgoJCWlmICghdGhpcy5pc0FyaWEpIHsKCQkJSC53YXJuICgn5om56YeP5LiL6L295LuF5pSv5o+0IEFyaWEyIOaooeW8jyEnKTsKCQl9CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSwgdGhpcy5fcmVjdkV2ZW50LmJpbmQgKHRoaXMpLCBmYWxzZSk7Cgl9LAoKCS8qKgoJICog6ZSZ6K+v5pWw5o2uCgkgKiBAdHlwZSB7T2JqZWN0fQoJICovCglFUlJPUjogewoJCScyMjIzMic6IHsKCQkJdGV4dDogSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsvKgror7fmjILkuIoq5aSn6ZmGKumprOeUsiwg5Zug5YW25a6D5Zyw5Yy66K6/6Zeu6KKr5bGP6JS9LgoK5aaC5p6c5oKo5Lya5L2/55So55u45YWz5o+S5Lu2LCDor7fliqDlhaXkuIvov7DlnLDlnYDoh7Pop4TliJk6ICAKaHR0cDovL211c2ljLmJhaWR1LmNvbS9kYXRhL3VzZXIvY29sbGVjdD8qICAKCuaCqOWPr+S7peaMieS4iyBDdHJsK0Mg5ou36LSd6K+l5raI5oGvLgoK55u45YWz6ZiF6K+7OiBodHRwczovL2dpdGh1Yi5jb20vSml4dW5Nb2UvY3V3Y2w0Yy93aWtpL+mFjeWQiOWkp+mZhuS7o+eQhuWunueOsOiuv+mXruino+mZpOWwgemUgQoqL30pLAoJCQlsZXZlbDogJ2Vycm9yJywKCQkJYWxlcnQ6IHRydWUKCQl9LAoJCScyMjMyMic6IHsKCQkJdGV4dDogJ+W3sue7j+WcqOaUtuiXj+WIl+ihqCwg5LiN56e76ZmkLicsCgkJCWxldmVsOiAnaW5mbycKCQl9LAoJCScyMjMzMSc6IHsKCQkJdGV4dDogJ+S6keerr+aUtuiXj+W3sua7oSwg6K+35YWI6IW+5Ye65L2N572uIScsCgkJCWxldmVsOiAnd2FybicsCgkJCWFsZXJ0OiB0cnVlCgkJfSwKCQknMjIwMDAnOiB7CgkJCXRleHQ6ICflm6DkuIvovb3op6PmnpDogIzmt7vliqDoh7PmlLbol48sIOino+aekOWQjuenu+mZpOmTvuaOpS4nLAoJCQlsZXZlbDogJ2luZm8nCgkJfQoJfSwKCgkvKioKCSAqIOaPkOWPlumUmeivr+S/oeaBrwoJICogQHBhcmFtICB7SW50ZWdlcn0gZXJyQ29kZSDplJnor6/ku6PnoIEKCSAqIEByZXR1cm4ge09iamVjdH0gICAgICAgICAg6ZSZ6K+v5L+h5oGv6K+m57uGCgkgKi8KCWVycm9yOiBmdW5jdGlvbiAoZXJyQ29kZSkgewoJCXZhciBlcnJJbmZvID0gdGhpcy5FUlJPUltlcnJDb2RlLnRvU3RyaW5nKCldIHx8IHsKCQkJdGV4dDogJ+acquefpemUmeivrzogJyArIGVyckNvZGUsCgkJCWFsZXJ0OiB0cnVlLAoJCQlsZXZlbDogJ3dhcm4nCgkJfTsKCQllcnJJbmZvLmNvZGUgPSBwYXJzZUludChlcnJDb2RlLCAxMCk7CgoJCUhbZXJySW5mby5sZXZlbF0oZXJySW5mby50ZXh0KTsKCgkJaWYgKGVyckluZm8uYWxlcnQpCgkJCWFsZXJ0KCBlcnJJbmZvLnRleHQgKTsKCgkJcmV0dXJuIGVyckluZm87Cgl9LAoKCS8qKgoJICogQHByaXZhdGUKCSAqIOaLpuaIquaSreaUvuWZqOS4i+i9veS6i+S7tgoJICovCglob29rUGxheWVyRG93bmxvYWQ6IGZ1bmN0aW9uICgpIHsKCQl2YXIgdGhhdCA9IHRoaXM7CgoJCS8vIGZtUGxheWVyVmlldyDmmK/mnIDlkI7kuIDkuKoKCQlILndhaXRVbnRpbCAoJ2ZtUGxheWVyVmlldycsIGZ1bmN0aW9uICgpIHsKCQkJdGhhdC4kZGxCdG4gPSAkKCcubWFpbi1wYW5lbCAuZG93bmxvYWQgPiBhJyk7CgoJCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChzY3JpcHROYW1lLCBob29rQmF0Y2gpIHsKCQkJCS8vIOm7hOmHkSBWSVAKCQkJCXZhciBvbGRTZXRWaXAgPSBIUS5tb2RlbC5zZXRWaXBJbmZvOwoJCQkJSFEubW9kZWwuc2V0VmlwSW5mbyA9IGZ1bmN0aW9uICggaXNWaXAsIHogKSB7CgkJCQkJaWYgKCFpc1ZpcCkgewoJCQkJCQlpc1ZpcCA9IHRydWU7CgkJCQkJfQoKCQkJCQlyZXR1cm4gb2xkU2V0VmlwLmNhbGwgKHRoaXMsIGlzVmlwLCB6KTsKCQkJCX07CgkJCQlIUS5tb2RlbC5pc0dvbGQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlOyB9OwoJCQkJSFEubW9kZWwuc2V0VmlwSW5mbyAoKTsKCgkJCQl2YXIgYmFrRXh0cmFjdFVzZXJJbmZvID0gVXNlck1vZGVsLnByb3RvdHlwZS5fZ2V0VXNlckluZm87CgkJCQlVc2VyTW9kZWwucHJvdG90eXBlLl9nZXRVc2VySW5mbyA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgciA9IGJha0V4dHJhY3RVc2VySW5mby5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCWlmICghci52aXApIHsKCQkJCQkJci52aXAgPSB7CgkJCQkJCQljbG91ZDogewoJCQkJCQkJCXNlcnZpY2VfbGV2ZWw6ICdnb2xkJwoJCQkJCQkJfQoJCQkJCQl9OwoJCQkJCX0KCQkJCQlyLmlzU2hvd1NvdXJjZUljb24gPSBmYWxzZTsKCgkJCQkJcmV0dXJuIHI7CgkJCQl9OwoKCQkJCS8vIOWxj+iUveaXpeW/l+WPkemAgSwg5Yi35bGP5aW954OmCgkJCQlsb2dDdHJsLnNlbmRMb2cgPSBmdW5jdGlvbiAoKSB7fTsKCgkJCQl2YXIgaW5zdEZsb2F0QnRuID0gbGlzdFZpZXcudGlwLmRhdGEoInVpLWZsb2F0QnV0dG9uIik7CgkJCQl2YXIgb2xkTXVzaWNEb3dubG9hZCA9IGxpc3RWaWV3LmRvd25sb2FkOwoJCQkJbGlzdFZpZXcuZG93bmxvYWQgPSBmdW5jdGlvbiAoc29uZ0luZGV4LCBpc0ZsYWMpIHsKCQkJCQkvLyDmibnph4/kuIvovb0sIOS9huaYr+S4jeaYryBBcmlhIOaooeW8j+WImeaUvuW8gwoJCQkJCWlmICghaG9va0JhdGNoICYmIHNvbmdJbmRleC5sZW5ndGggPiAxKSB7CgkJCQkJCXJldHVybiBvbGRNdXNpY0Rvd25sb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfQoJCQkJCXZhciBzb25nRGF0YSA9IGluc3RGbG9hdEJ0bi5saXN0RWxlbS5yZWVsTGlzdCgib3B0aW9uIiwgImRhdGEiKS5maWx0ZXIoZnVuY3Rpb24gKGUsIGkpIHsKCQkJCQkJcmV0dXJuIC0xICE9PSBzb25nSW5kZXguaW5kZXhPZihpKQoJCQkJCX0pLm1hcCAoZnVuY3Rpb24gKGUpIHsKCQkJCQkJcmV0dXJuIHsKCQkJCQkJCXNvbmdOYW1lOiAgIGUuc29uZ05hbWUsCgkJCQkJCQlhcnRpc3ROYW1lOiBlLmFydGlzdE5hbWUsCgkJCQkJCQlzb25nSWQ6ICAgICBlLnNvbmdJZCwKCQkJCQkJCWlzRmxhYzogICAgICEhaXNGbGFjLAoJCQkJCQkJaXNGYXY6ICAgICAgISFlLmhhc0NvbGxlY3RlZAoJCQkJCQl9OwoJCQkJCX0pOwoKCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50IChuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUgKyAnLUJBVENIJywgeyBkZXRhaWw6IEpTT04uc3RyaW5naWZ5KHNvbmdEYXRhKSB9KSk7CgkJCQl9OwoKCQkJCShmdW5jdGlvbiAoKSB7CgkJCQkJLy8g5Y+W5raI5LiL6L295oyJ6ZKu54K55Ye7CgkJCQkJdGhpcy4kdGl0bGUuZmluZCgnLmRvd25sb2FkJykub2ZmKCdjbGljaycpOwoKCQkJCQkvLyDnu5Hlrprmkq3mlL7kuovku7YKCQkJCQl0aGlzLmxpc3RDdHJsLm9uKCdjaGFuZ2U6c29uZ0xpbmsnLCBmdW5jdGlvbiAoeiwgc29uZ0RhdGEpIHsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lLCB7ZGV0YWlsOiBKU09OLnN0cmluZ2lmeSAoc29uZ0RhdGEpfSkpOwoJCQkJCX0pOwoJCQkJfSkuY2FsbCAod2luZG93LnNvbmdJbmZvVmlldyk7CgkJCX0sIEguc2NyaXB0TmFtZSwgdGhpcy5pc0FyaWEpOwoJCX0pOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiBkb2N1bWVudC1zdGFydCDlm57osIMKCSAqLwoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXRoaXMuaW5pdEV2ZW50cyAoKTsKCQl0aGlzLmhvb2tQbGF5ZXJEb3dubG9hZCAoKTsKCX0sCgoJLyoqCgkgKiDmj5DkuqQgUG9zdCDor7fmsYIKCSAqIEBwYXJhbSAge1JlcXVlc3R9IHJlcSAgIOivt+axguWvueixoSwg5Y+C6KeBIEdNX3htbGh0dHBSZXF1ZXN0CgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgICB4bWxodHRwUmVxdWVzdCDlr7nosaEKCSAqLwoJcG9zdDogZnVuY3Rpb24gKHJlcSkgewoJCXJlcS5tZXRob2QgPSAnUE9TVCc7CgkJcmVxLmhlYWRlcnMgPSByZXEuaGVhZGVycyB8fCB7fTsKCQlyZXEuaGVhZGVycy5SZWZlcmVyID0gcmVxLmhlYWRlcnMuUmVmZXJlciB8fCAnaHR0cDovL211c2ljLmJhaWR1LmNvbS8nOwoJCXJlcS5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnOwoJCXJlcS5kYXRhID0gJC5wYXJhbShyZXEuZGF0YSk7CgoJCXJldHVybiBHTV94bWxodHRwUmVxdWVzdChyZXEpOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiDmkq3mlL7lmajkuIvmlrnnmoTkuIvovb3kuovku7bmjqXnrqEKCSAqIEBwYXJhbSAge0V2ZW50fSBlICAg5LqL5Lu2CgkgKi8KCV9yZWN2RXZlbnQ6IGZ1bmN0aW9uIChlKSB7CgkJdmFyIHNvbmdEYXRhID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpOwoKCQlmb3IgKHZhciBpID0gMy8qIHRoaXMucXVhbGl0aWVzLmxlbmd0aCAqLywgc29uZzsgIXNvbmcgJiYgaS0tOyApCgkJCXNvbmcgPSBzb25nRGF0YS5saW5rc1t0aGlzLnF1YWxpdGllc1tpXV07CgoJCS8vIOiOt+WPluatjOabsuWksei0pQoJCWlmICghc29uZyB8fCAhc29uZy5zb25nTGluaykgewoJCQlILndhcm4gKCfop6PmnpDkuIvovb3lnLDlnYDlpLHotKUsIOWPr+iDveeZvuW6puabtOaWsOS6huiOt+WPluaWueW8jy4nKTsKCQkJcmV0dXJuIDsKCQl9CgoJCXRoaXMuJGRsQnRuLmF0dHIgKHsKCQkJdGl0bGU6IHNvbmcuc29uZ05hbWUsCgkJCWhyZWY6IEgudXJpKHNvbmcuc29uZ0xpbmssIEguc3ByaW50ZignJXMgWyVzXS4lcycsIHNvbmdEYXRhLnNvbmdOYW1lLCBzb25nRGF0YS5hcnRpc3ROYW1lLCBzb25nLmZvcm1hdCkpCgkJfSk7Cgl9LAoKCS8qKgoJICog6ZqP5py65pWwCgkgKiBAcmV0dXJuIHtTdHJpbmd9IOmaj+acuuaVsAoJICovCglfcm5kOiBmdW5jdGlvbiAoKSB7CgkJcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zbGljZSgyKTsKCX0sCgoJLyoqCgkgKiDop6PmnpDnmb7luqbov5Tlm57nmoTkuI3op4TliJnmlbDmja4KCSAqIEBwYXJhbSAge1Jlc3BvbnNlfSByICAgR01feG1saHR0cFJlcXVlc3Qub25sb2FkIOWbnuiwg+eahOWPguaVsCAxCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgIOebuOWFs+aVsOaNrgoJICovCglfcGFyc2VSYXc6IGZ1bmN0aW9uIChyKSB7CgkJcmV0dXJuIEpTT04ucGFyc2Uoci5yZXNwb25zZVRleHQucmVwbGFjZSgvXHMvZywgJycpKTsKCX0sCgoJLyoqCgkgKiDop6PmnpDnmb7luqbov5Tlm57nmoTkuI3op4TliJnmlbDmja7nmoQgZGF0YSDoioLngrkKCSAqIEBwYXJhbSAge1Jlc3BvbnNlfSByICAgR01feG1saHR0cFJlcXVlc3Qub25sb2FkIOWbnuiwg+eahOWPguaVsCAxCgkgKiBAcmV0dXJuIHtPYmplY3R9ICAgICAgIOebuOWFs+aVsOaNrgoJICovCglfcGFyc2U6IGZ1bmN0aW9uIChyKSB7CgkJcmV0dXJuIHRoaXMuX3BhcnNlUmF3KHIpLmRhdGE7Cgl9LAoKCS8qKgoJICog5Y+W5q2M5puy5piv5ZCm5Zyo5pS26JeP6YeM6Z2iLCDmmK/nmoTor53liJnog73nm7TmjqXop6PmnpAKCSAqIEBwYXJhbSAge0ludGVnZXJ9ICAgc29uZ0lkIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259ICBjYkRvbmUg5Zue6LCDLCAxIOWPguaVsCwgQm9vbGVhbiDmmK/lkKblnKjmlLbol4/lpLkKCSAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgICBbZGVzY3JpcHRpb25dCgkgKi8KCV9pc0ZhdjogZnVuY3Rpb24gKHNvbmdJZCwgY2JEb25lKSB7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCUdNX3htbGh0dHBSZXF1ZXN0ICh7CgkJCW1ldGhvZDogJ0dFVCcsCgkJCXVybDogSC5zcHJpbnRmKCdodHRwOi8vbXVzaWMuYmFpZHUuY29tL2RhdGEvdXNlci9pc0NvbGxlY3Q/dHlwZT1zb25nJmlkcz0lcyZyPSVzJywgc29uZ0lkLCB0aGlzLl9ybmQoKSksCgkJCW9ubG9hZDogZnVuY3Rpb24gKHIpIHsKCQkJCWNiRG9uZSghIXNlbGYuX3BhcnNlKHIpLmlzQ29sbGVjdCk7CgkJCX0KCQl9KTsKCX0sCgoJLyoqCgkgKiDliqDlhaXmlLbol4/lpLkKCSAqIEBwYXJhbSB7SW50ZWdlcn0gIHNvbmdJZCDmm7Lnm64gSUQKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGNiRG9uZSDlm57osIPplJnor6/kv6Hmga8KCSAqLwoJX2FkZEZhdjogZnVuY3Rpb24gKHNvbmdJZCwgY2JEb25lKSB7CgkJdmFyIHNlbGYgPSB0aGlzOwoJCXRoaXMucG9zdCh7CgkJCXVybDogJ2h0dHA6Ly9tdXNpYy5iYWlkdS5jb20vZGF0YS91c2VyL2NvbGxlY3Q/cj0nICsgdGhpcy5fcm5kKCksCgkJCWRhdGE6IHsKCQkJCWlkczogc29uZ0lkLAoJCQkJdHlwZTogJ3NvbmcnLAoJCQkJcGF5X3R5cGU6IDAKCQkJfSwKCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJY2JEb25lKHNlbGYuZXJyb3Ioc2VsZi5fcGFyc2VSYXcocikuZXJyb3JDb2RlKSk7CgkJCX0KCQl9KTsKCX0sCgoJLyoqCgkgKiDnp7vpmaTmlLbol4/lpLkKCSAqIEBwYXJhbSB7SW50ZWdlcn0gIHNvbmdJZCDmm7Lnm64gSUQKCSAqIEBwYXJhbSB7RnVuY3Rpb259IGNiRG9uZSDlm57osIPplJnor6/kv6Hmga8KCSAqLwoJX3JtRmF2OiBmdW5jdGlvbiAoc29uZ0lkLCBjYkRvbmUpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgkJdGhpcy5wb3N0KHsKCQkJdXJsOiAnaHR0cDovL211c2ljLmJhaWR1LmNvbS9kYXRhL3VzZXIvZGVsZXRlQ29sbGVjdGlvbj9yPScgKyB0aGlzLl9ybmQoKSwKCQkJZGF0YTogewoJCQkJaWRzOiBzb25nSWQsCgkJCQl0eXBlOiAnc29uZycsCgkJCQlwYXlfdHlwZTogMAoJCQl9LAoJCQlvbmxvYWQ6IGZ1bmN0aW9uIChyKSB7CgkJCQljYkRvbmUoc2VsZi5lcnJvcihzZWxmLl9wYXJzZVJhdyhyKS5lcnJvckNvZGUpKTsKCQkJfQoJCX0pOwoJfSwKCgkvKioKCSAqIOebtOaOpeiOt+WPluabsuebruS/oeaBrywg6K+356Gu5L+d55So5oi35pyJ5p2D6ZmQ55u05o6l6Kej5p6Q5oiW5Zyo5pS26JeP5aS55YaFLgoJICogQHBhcmFtICB7SW50ZWdlcn0gIHNvbmdJZCAgIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259IGNiU29uZyAgIOWbnuiwgwoJICovCglfZ2V0U29uZ0luZm9EaXJlY3Q6IGZ1bmN0aW9uIChzb25nSWQsIGNiU29uZykgewoJCXZhciBzZWxmID0gdGhpczsKCQlHTV94bWxodHRwUmVxdWVzdCAoewoJCQltZXRob2Q6ICdHRVQnLAoJCQl1cmw6ICdodHRwOi8veWlueXVleXVuLmJhaWR1LmNvbS9kYXRhL2Nsb3VkL2Rvd25sb2FkP3NvbmdJZHM9JyArIHNvbmdJZCwKCQkJb25sb2FkOiBmdW5jdGlvbiAocikgewoJCQkJY2JTb25nKHNlbGYuX3BhcnNlKHIpLmRhdGEpOwoJCQl9CgkJfSk7Cgl9LAoKCS8qKgoJICog6I635Y+W5puy55uu5L+h5oGvCgkgKiBAcGFyYW0gIHtJbnRlZ2VyfSAgc29uZ0lkIOabsuebriBJRAoJICogQHBhcmFtICB7RnVuY3Rpb259IGNiU29uZyDlm57osIMKCSAqLwoJX2dldFNvbmdJbmZvOiBmdW5jdGlvbiAoc29uZ0lkLCBjYlNvbmcpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgkJdGhpcy5fYWRkRmF2KHNvbmdJZCwgZnVuY3Rpb24gKGVyckluZm8pIHsKCQkJaWYgKGVyckluZm8ubGV2ZWwgPT0gJ2Vycm9yJykgewoJCQkJSC5lcnJvcign5re75Yqg5pS26JeP5aS55Ye66ZSZLCDlj5bmtojmk43kvZwuJyk7CgkJCQlyZXR1cm4gOwoJCQl9CgoJCQl2YXIgaXNGYXYgPSBlcnJJbmZvLmNvZGUgPT09IDIyMDAwOwoJCQl2YXIgcVJlbW92ZUZhdiA9ICQuRGVmZXJyZWQoKTsKCQkJcVJlbW92ZUZhdi5kb25lKGlzRmF2ID8gSC5ub3AgOiBmdW5jdGlvbiAoKSB7CgkJCQlILmluZm8gKCfnp7vpmaTkuLrop6PmnpDogIzkuLTml7bmt7vliqDnmoTmrYzmm7LigKYgJXMnLCBzb25nSWQpOwoJCQkJc2VsZi5fcm1GYXYoc29uZ0lkKTsKCQkJfSk7CgoJCQlzZWxmLl9nZXRTb25nSW5mb0RpcmVjdChzb25nSWQsIGZ1bmN0aW9uIChyKSB7CgkJCQljYlNvbmcociwgcVJlbW92ZUZhdi5yZXNvbHZlLmJpbmQocVJlbW92ZUZhdikpOwoJCQl9KTsKCQl9KTsKCX0sCgoJLyoqCgkgKiDmoLnmja7ln7rmnKzkv6Hmga/mnoTlu7rkuIvovb3lnLDlnYAKCSAqIEBwYXJhbSAge0ludGVnZXJ9IHNvbmdJZCAgICAgIOabsuebriBJRAoJICogQHBhcmFtICB7SW50ZWdlcn0gc29uZ1JhdGUgICAg56CB546HLCDljZXkvY3kuLoga2JwcwoJICogQHBhcmFtICB7U3RyaW5nfSAgbXVzaWNGb3JtYXQg6Z+z5LmQ5paH5Lu25qC85byPCgkgKiBAcmV0dXJuIHtTdHJpbmd9ICAgICAgICAgICAgICDmnoTlu7rnmoTmlofku7blnLDlnYAsIOmcgOimgSBDb29raWUKCSAqLwoJX2J1aWxkVXJsOiBmdW5jdGlvbiAoc29uZ0lkLCBzb25nUmF0ZSwgbXVzaWNGb3JtYXQpIHsKCQlyZXR1cm4gSC5zcHJpbnRmKAoJCQknaHR0cDovL3lpbnl1ZXl1bi5iYWlkdS5jb20vZGF0YS9jbG91ZC9kb3dubG9hZHNvbmdmaWxlP3NvbmdJZHM9JXMmcmF0ZT0lcyZmb3JtYXQ9JXMnLAoJCQlzb25nSWQsIHNvbmdSYXRlLCBtdXNpY0Zvcm1hdAoJCSk7Cgl9LAoKCS8qKgoJICog5p6E5bu65peg6ZyA6ZmE5Yqg5pWw5o2u55qE5LiL6L295Zyw5Z2ACgkgKiBAcGFyYW0gIHtTdHJpbmd9ICAgdXJsICAg5Lya6Lez6L2s55qE5Zyw5Z2ACgkgKiBAcGFyYW0gIHtGdW5jdGlvbn0gY2JVcmwg5Zue6LCDLCAxIOWPguaVsCwgU3RyaW5nIOecn+WunuWcsOWdgAoJICovCglfZ2V0UmVhbFVybDogZnVuY3Rpb24gKHVybCwgY2JVcmwpIHsKCQlHTV94bWxodHRwUmVxdWVzdCAoewoJCQltZXRob2Q6ICdHRVQnLAoJCQl1cmw6IHVybCwKCQkJaGVhZGVyczogewoJCQkJUmFuZ2U6ICdieXRlcz0wLTEnCgkJCX0sCgkJCW9ubG9hZDogZnVuY3Rpb24gKHIpIHsKCQkJCWNiVXJsIChyLmZpbmFsVXJsKTsKCQkJfQoJCX0pOwoJfSwKCgkvKioKCSAqIOmAieaLqeacgOmrmOeggeeOhwoJICogQHBhcmFtICB7T2JqZWN0fSBkbCAgIOW4puacieeggeeOh+aVsOaNrueahOWvueixoQoJICogQHJldHVybiB7T2JqZWN0fSAgICAgIOacgOmrmOeahOeggeeOh+WvueixoQoJICovCglfZ2V0QmVzdFF1YWxpdHk6IGZ1bmN0aW9uIChkbCkgewoJCXZhciBxdSA9IE9iamVjdC5rZXlzKGRsKS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CgkJCWlmICghZGxbYV0pIHJldHVybiBkbFtiXSA/IC0xIDogMDsKCQkJaWYgKCFkbFtiXSkgcmV0dXJuICAxOwoJCQlyZXR1cm4gZGxbYV0ucmF0ZSAtIGRsW2JdLnJhdGU7CgkJfSkucG9wKCk7CgoJCXJldHVybiBkbFtxdV07Cgl9LAoKCV9yZW5hbWVVcmw6IGZ1bmN0aW9uIChvbGRVcmwsIGZpbGUpIHsKCQkvLyAgICAvMTIzNDUveHh4Lm1wMz95eXkgLT4gLzEyMzQ1L2ZpbGUubXAzP3l5eQoJCXJldHVybiBvbGRVcmwucmVwbGFjZSgvKFwvXGQrXC8pLitcPy8sICckMScgKyBmaWxlICsgJz8nKTsKCX0sCgoJLyoqCgkgKiBAcHJpdmF0ZQoJICog5om56YeP5LiL6L295aSE55CG55qE5Zue6LCD5Ye95pWwCgkgKiBAcGFyYW0gIHtGdW5jdGlvbn0gbmV4dCAgICDlm57osIMsIOW9k+WJjemhueebruWkhOeQhuWujOavleWQjuiwg+eUqAoJICogQHBhcmFtICB7T2JqZWN0fSAgIG9ialNvbmcg5puy55uu5L+h5oGvCgkgKi8KCV9iYXRjaDogZnVuY3Rpb24gKG5leHQsIG9ialNvbmcpIHsKCQl2YXIgc2VsZiA9IHRoaXM7CgoJCS8vIOajgOafpeaYr+WQpumcgOimgeS4tOaXtuWKoOWFpeaUtuiXj+WkuQoJCXZhciBnZXRTb25nSW5mb1R5cGUgPSBvYmpTb25nLmlzRmF2ID8gJ19nZXRTb25nSW5mb0RpcmVjdCcgOiAnX2dldFNvbmdJbmZvJzsKCQl0aGlzW2dldFNvbmdJbmZvVHlwZV0gKG9ialNvbmcuc29uZ0lkLCBmdW5jdGlvbiAoZGwsIGNiUmVtb3ZlRmF2KSB7CgkJCS8vIOmZpOmdnumAieaLqeS4i+aXoOaNnyDlkKbliJnkuI3ph4fnlKjml6DmjZ8KCQkJaWYgKCFvYmpTb25nLmlzRmxhYyAmJiBkbC5mbGFjKQoJCQkJZGVsZXRlIGRsLmZsYWM7CgoJCQl2YXIgc29uZ0RsID0gc2VsZi5fZ2V0QmVzdFF1YWxpdHkoZGwpOwoJCQl2YXIgZmlsZSA9IEguc3ByaW50ZignJXMgWyVzXS4lcycsIG9ialNvbmcuc29uZ05hbWUsIG9ialNvbmcuYXJ0aXN0TmFtZSwgc29uZ0RsLmZvcm1hdCk7CgoJCQlzZWxmLl9nZXRSZWFsVXJsIChzZWxmLl9idWlsZFVybChvYmpTb25nLnNvbmdJZCwgc29uZ0RsLnJhdGUsIHNvbmdEbC5mb3JtYXQpLCBmdW5jdGlvbiAodXJsKSB7CgkJCQkvLyDnp7vpmaTkuLTml7bnlKjnmoTmlLbol4/lpLksIOS4jeWNoOS9jQoJCQkJaWYgKGNiUmVtb3ZlRmF2KQoJCQkJCWNiUmVtb3ZlRmF2ICgpOwoKCQkJCUguYWRkRG93bmxvYWQgKHNlbGYuX3JlbmFtZVVybCh1cmwsIGZpbGUpLCBmaWxlKTsKCQkJCW5leHQgKCk7CgkJCX0pOwoJCX0pOwoJfSwKCgkvKioKCSAqIEBwcml2YXRlCgkgKiDmibnph4/kuIvovb3kuovku7bmjqXnrqHlh73mlbAKCSAqIEBwYXJhbSAge0V2ZW50fSBlICAg5LqL5Lu2CgkgKi8KCV9iYXRjaERvd25sb2FkOiBmdW5jdGlvbiAoZSkgewoJCXZhciBhcnJTb25ncyA9IEpTT04ucGFyc2UgKGUuZGV0YWlsKTsKCQl2YXIgJHEgPSB0aGlzLiRxOwoKCQkkcS5hZGQuYXBwbHkoJHEsIGFyclNvbmdzKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5iYWlkdS55aW55dWV5dW4uanMgKi8KewoJaWQ6ICdtdXNpYy5iYWlkdS55aW55dWV5dW4nLAoJbmFtZTogJ+mfs+S5kOS6keS4i+i9vScsCglob3N0OiAneWlueXVleXVuLmJhaWR1LmNvbScsCglub1N1Ykhvc3Q6IHRydWUsCglwYXRoOiAnLycsCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsKCd1c2VyTW9kZWwuc2V0JywgZnVuY3Rpb24gKCkgewoJCQl1bnNhZmVFeGVjKGZ1bmN0aW9uIChzY3JpcHROYW1lLCBob29rQmF0Y2gpIHsKCQkJCXZhciBiYWtVc2VyU2V0SW5mbyA9IHVzZXJNb2RlbC5zZXQ7CgkJCQl1c2VyTW9kZWwuc2V0ID0gZnVuY3Rpb24gKGtleSwgdmFsLCBvcHRzKSB7CgkJCQkJaWYgKGtleSA9PT0gJ3VzZXJJbmZvJyAmJiB2YWwpIHsKCQkJCQkJdmFsLnZpcCA9IHZhbC5nb2xkZW4gPSB0cnVlOwoJCQkJCX0KCQkJCQlyZXR1cm4gYmFrVXNlclNldEluZm8uYXBwbHkodXNlck1vZGVsLCBhcmd1bWVudHMpOwoJCQkJfTsKCQkJCQoJCQkJLy8gRm9yY2UgdXBkYXRlIHVzZXIgZGF0YSB2aWEgaG9vawoJCQkJdXNlck1vZGVsLnNldCgndXNlckluZm8nLCB1c2VyTW9kZWwuZ2V0KCd1c2VySW5mbycpKTsKCQkJfSk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGpjYy5qcyAqLwp7CglpZDogJ211c2ljLmRqY2MnLAoJbmFtZTogJ0RKQ0Mg6Iie5puyJywKCWhvc3Q6IFsnd3d3LmRqY2MuY29tJy8qICwgJ3d3dy5kai5jYycgKi9dLAoJbm9TdWJIb3N0OiB0cnVlLAoKCXBhdGg6IFsnL2RqLycsICcvcGxheS5waHAnXSwKCW1pc3NpbmdEb21haW41OiAnaHR0cDovL2Rvd24uZGpjYy5jb20vbXVzaWMvJywKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJSC53YWl0VW50aWwgKCckLnBvc3QnLCBmdW5jdGlvbiAoKSB7CgkJCWNvbnNvbGUuaW5mbyAoJ+aJp+ihjCBWSVAg56C06KejIChwbGF5LnBocCDpobXpnaLml6DmlYgpIC4uJyk7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uIChzY3JpcHRIb21lLCBzY3JpcHROYW1lKSB7CgkJCQlmdW5jdGlvbiBybmROdW1iZXIgKCkgewoJCQkJCXJldHVybiB+fig5OTk5OSAqIE1hdGgucmFuZG9tKCkpOwoJCQkJfQoKCQkJCWNvbnNvbGUuaW5mbyAoc2NyaXB0SG9tZSk7CgkJCQl2YXIgX3Bvc3QgPSAkLnBvc3Q7CgkJCQkkLnBvc3QgPSBmdW5jdGlvbiAoYWRkciwgY2IpIHsKCQkJCQlpZiAoYWRkciA9PSAnL2FqYXgucGhwP2FqYXg9dXNlcmluZm8nKSB7CgkJCQkJCXJldHVybiBfcG9zdC5jYWxsICgkLCBhZGRyLCBmdW5jdGlvbiAocykgewoJCQkJCQkJaWYgKHMgPT0gJycpCgkJCQkJCQkJcyA9IFsxLCBzY3JpcHROYW1lLCAwLCBzY3JpcHRIb21lLCAwLCAwLAoJCQkJCQkJCQlybmROdW1iZXIoKSwgcm5kTnVtYmVyKCksIDAsIDAsIDIsCgkJCQkJCQkJCSflsIrotLXnmoQgJyArIHNjcmlwdE5hbWUgKyAnIOeUqOaItycsICc55bm0JwoJCQkJCQkJCV0uam9pbignKndyZionKTsKCgkJCQkJCQljYiAocyk7CgkJCQkJCX0pOwoJCQkJCX0KCQkJCQlyZXR1cm4gX3Bvc3QuYXBwbHkgKCQsIGFyZ3VtZW50cyk7CgkJCQl9OwoKCQkJCXJldHVybiBmdW5jdGlvbiAoKSB7fTsKCQkJfSwgSC5zY3JpcHRIb21lLCBILnNjcmlwdE5hbWUpOwoJCX0pOwoKCQkvLyDmkq3mlL7lmajliqvmjIEgW+aAgOeWkeWkseaViD9dCgkJSC53YWl0VW50aWwgKCdqd3BsYXllci5hcGknLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uICgpIHsKCQkJCXZhciBfc3AgPSB3aW5kb3cuandwbGF5ZXIuYXBpLnNlbGVjdFBsYXllcjsKCQkJCXdpbmRvdy5qd3BsYXllci5hcGkuc2VsZWN0UGxheWVyID0gZnVuY3Rpb24gKHNlbCkgewoJCQkJCXZhciBtUGxheWVyID0gX3NwIChzZWwpOwoJCQkJCXZhciBfc2V0dXAgPSBtUGxheWVyLnNldHVwOwoJCQkJCW1QbGF5ZXIuc2V0dXAgPSBmdW5jdGlvbiAob3B0aW9ucykgewoJCQkJCQljb25zb2xlLmluZm8gKCdzZXR1cCcsIG9wdGlvbnMpOwoJCQkJCQl2YXIgX29wbCA9IG9wdGlvbnMuZXZlbnRzLm9uUGxheWxpc3RJdGVtOwoJCQkJCQlvcHRpb25zLmV2ZW50cy5vblBsYXlsaXN0SXRlbSA9IGZ1bmN0aW9uIChldmVudFBsYXlsaXN0Q2hhbmdlKSB7CgkJCQkJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50ICggbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHsKCQkJCQkJCQlkZXRhaWw6IEpTT04uc3RyaW5naWZ5IChtUGxheWVyLmdldFBsYXlsaXN0SXRlbSAoKSkKCQkJCQkJCX0pICk7CgkJCQkJCQlyZXR1cm4gX29wbC5hcHBseSAodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfTsKCQkJCQkJcmV0dXJuIF9zZXR1cC5hcHBseSAobVBsYXllciwgYXJndW1lbnRzKTsKCQkJCQl9OwoJCQkJCXJldHVybiBtUGxheWVyOwoJCQkJfTsKCQkJfSk7CgkJfSk7CgoJCXRoaXMuZGxMaW5rMSA9ICQoJzxhPicpLnRleHQgKCfor5XlkKzkuIvovb0nKS5hdHRyICgndGFyZ2V0JywgJ19ibGFuaycpOwoJCXRoaXMuZGxMaW5rMiA9ICQoJzxhPicpLnRleHQgKCfpq5jmuIXkuIvovb0nKS5hdHRyICgndGFyZ2V0JywgJ19ibGFuaycpOwoKCQkvLyDkuIvovb3mlbDmja7op6PmnpAKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUsIGZ1bmN0aW9uIChlKSB7CgkJCXZhciBzb25nT2JqID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpOwoJCQlpZiAoSC5iZWdpbldpdGggKHNvbmdPYmouZmlsZSwgd3JmSncuUGxheWVyLmRvbWFpblswXSkpCgkJCQlzb25nT2JqLmZpbGUgPSBzb25nT2JqLmZpbGUuc2xpY2UgKHdyZkp3LlBsYXllci5kb21haW5bMF0ubGVuZ3RoKTsKCgkJCXRoaXMuZGxMaW5rMS5hdHRyICgnaHJlZicsIEgudXJpICh3cmZKdy5QbGF5ZXIuZG9tYWluWzBdICsgc29uZ09iai5maWxlICwgc29uZ09iai50aXRsZSArICcubXAzJykpOwoJCQl0aGlzLmRsTGluazIuYXR0ciAoJ2hyZWYnLCBILnVyaSAobWlzc2luZ0RvbWFpbjUgKyAoc29uZ09iai5maWxlMiB8fCBzb25nT2JqLmZpbGUpLCBzb25nT2JqLnRpdGxlICsgJy7pq5jmuIUubXAzJykpOwoJCQlILmluZm8gKHNvbmdPYmopOwoJCX0uYmluZCh0aGlzKSwgZmFsc2UpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQkkKCcjbGlzdHRhYnMnKQoJCQkuYXBwZW5kICh0aGlzLmRsTGluazEpCgkJCS5hcHBlbmQgKHRoaXMuZGxMaW5rMikKCQkJLmNzcyAoJ2hlaWdodCcsICdpbml0aWFsJykKCQkJLmNzcyAoJ21pbi1oZWlnaHQnLCAnMTYwJyk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGpray5qcyAqLwp7CglpZDogJ211c2ljLmRqa2snLAoJbmFtZTogJ0RKIOWXqOWXqCcsCglob3N0OiAnd3d3LmRqa2suY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS5kamtrLmRsLmNzcyAqLwpILmV4dHJhY3QoZnVuY3Rpb24gKCkgeyAvKgojanhfZGxfd3JhcHBlciB7CiAgICBmbG9hdDogcmlnaHQ7CiAgICBtYXJnaW4tcmlnaHQ6IDEuNWVtOwp9CgojanhfZGxfd3JhcHBlciA+IGEgewoJdHJhbnNpdGlvbjogY29sb3IgLjRzOwoJY29sb3I6ICNhYWE7Cn0KCiNqeF9kbF93cmFwcGVyID4gYTpob3ZlciB7Cgljb2xvcjogI2ZmZjsKCXRleHQtZGVjb3JhdGlvbjogbm9uZTsKfQoqL30pLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmRsSG9sZGVyID0gJCgnPGRpdiBpZD0ianhfZGxfd3JhcHBlciI+Jyk7CgkJdGhpcy5kbEhvbGRlci5hcHBlbmQoJ+S4i+i9vTogJyk7CgkJdGhpcy5kbEhxICAgICA9ICQoJzxhPicpLnRleHQoJ+mrmOa4hScpLmFwcGVuZFRvICh0aGlzLmRsSG9sZGVyKS5wcm9wKCdkb3dubG9hZCcsIHRydWUpOwoJCXRoaXMuZGxIb2xkZXIuYXBwZW5kKCcgfCAnKTsKCQl0aGlzLmRsTGluayAgID0gJCgnPGE+JykudGV4dCgn6K+V5ZCsJykuYXBwZW5kVG8gKHRoaXMuZGxIb2xkZXIpLnByb3AoJ2Rvd25sb2FkJywgdHJ1ZSk7CgoJCUgualBsYXllclBhdGNoZXIgKGZ1bmN0aW9uIChzb25nT2JqKSB7CgkJCXZhciBzb25nQWRkciAgPSBzb25nT2JqLm1wMyB8fCBzb25nT2JqLm00YTsKCQkJdmFyIHNvbmdUaXRsZSA9IHNvbmdPYmoudGl0bGUgfHwgJCgnI3BsYXlUaXRsZSAuanAtdGl0bGUnKS50ZXh0KCkucmVwbGFjZSgvLivvvJovLCAnJyk7CgkJCQoJCQl0aGlzLmRsTGluay5hdHRyKHsKCQkJCWhyZWY6IEgudXJpKHNvbmdBZGRyLCBzb25nVGl0bGUgKyBzb25nQWRkci5zbGljZSgtNCkpLAoJCQkJdGl0bGU6ICfor5XlkKzpn7PotKg6ICcgKyBzb25nVGl0bGUKCQkJfSk7CgoJCQl0aGlzLmRsSHEuYXR0cih7CgkJCQlocmVmOiBILnVyaSh0aGlzLnVwZ3JhZGVIUShzb25nQWRkciksIHNvbmdUaXRsZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+mrmOa4hemfs+i0qDogJyArIHNvbmdUaXRsZQoJCQl9KTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJLy8gU291cmNlOiA1MnBvamllCgl1cGdyYWRlSFE6IGZ1bmN0aW9uICh1cmwpIHsKCQlyZXR1cm4gdXJsCgkJICAgICAgICAgLnJlcGxhY2UodW5zYWZlV2luZG93LnNfc3RyLCAnaHR0cDovL2RvLmRqa2suY29tL21wMycpCgkJICAgICAgICAgLnJlcGxhY2UoLy4uLiQvLCAnbXAzJykKCX0sCgoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5kbEhvbGRlci5hcHBlbmRUbyAoJCgnLm1haW4tcGFuZWwnKSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZGp5ZS5qcyAqLwp7CglpZDogJ211c2ljLmRqeWUnLAoJbmFtZTogJ0RKIOeIt+eIt+e9kScsCglob3N0OiAnd3d3LmRqeWUuY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCXBhdGg6ICcvcGxheWVyLycsCgljc3MgOiAvKiBSZXNvdXJjZTogY29tLmRqeWUuZGwuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCiNqeF9kbF9idG4gewoJbWFyZ2luLXRvcDogN3B4OwoJZmxvYXQ6IHJpZ2h0Owp9CgojanhfZGxfYnRuID4gYSB7Cgl0cmFuc2l0aW9uOiBjb2xvciAuNHM7Cgljb2xvcjogYmxhY2s7Cn0KCiNqeF9kbF9idG4gPiBhOmhvdmVyIHsKCWNvbG9yOiAjNDQ0Owp9CiovfSksCgoJdG9NcDM6IGZ1bmN0aW9uIChzb25nKSB7CgkJcmV0dXJuIHNvbmcucmVwbGFjZSgvW2Etel0qXC4vLCAnbXAzLicpLnJlcGxhY2UoL200YSQvLCAnbXAzP3R5cGU9ZG93bicpOwoJfSwKCglvblN0YXJ0OiBmdW5jdGlvbiAoKSB7CgkJdGhpcy5saW5rSG9sZGVyID0gJCgnPHAgaWQ9Imp4X2RsX2J0biI+Jyk7CgkJdGhpcy5saW5rSG9sZGVyLmFwcGVuZCgn5LiL6L29OiAnKQoJCXRoaXMubGlua000QSA9ICQoJzxhPicpLmFwcGVuZFRvICh0aGlzLmxpbmtIb2xkZXIpLnRleHQgKCfor5XlkKwnKTsKCQl0aGlzLmxpbmtIb2xkZXIuYXBwZW5kICgnIHwgJyk7CgkJdGhpcy5saW5rTVAzID0gJCgnPGE+JykuYXBwZW5kVG8gKHRoaXMubGlua0hvbGRlcikudGV4dCAoJ21wMycpCgkJCS5hdHRyICgndGl0bGUnLCAn6K+35rOo5oSPOiDor6Xpk77mjqXlj6/og73lm6DkuLrmnI3liqHlmajphY3nva7mm7TmlrDlr7zoh7Tml6Dms5XkuIvovb0nKTsKCgkJSC5qUGxheWVyUGF0Y2hlciAoZnVuY3Rpb24gKHNvbmdPYmopIHsKCQkJdmFyIHNvbmdMaW5rID0gc29uZ09iai5tNGEucmVwbGFjZSgvXD8uKi8sICcnKTsKCQkJdmFyIHNvbmdUaXRsZSA9ICQoJyNwbGF5X3RpdGxlJykudGV4dCAoKTsKCgkJCXRoaXMubGlua000QS5hdHRyKCdocmVmJywgSC51cmkgKHNvbmdMaW5rLCBzb25nVGl0bGUgKyAnLm00YScpKTsKCQkJdGhpcy5saW5rTVAzLmF0dHIoJ2hyZWYnLCBILnVyaSAodGhpcy50b01wMyhzb25nTGluayksIHNvbmdUaXRsZSArICcubXAzJykpOwoJCX0uYmluZCAodGhpcykpOwoJfSwKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQl0aGlzLmxpbmtIb2xkZXIKCQkJLmFwcGVuZFRvICgkKCcuYmZfY2tjJykpCgkJCS5jc3MoJ3BhZGRpbmctcmlnaHQnLCAnMWVtJyk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZG91YmFuLmpzICovCi8qKgogKiDosYbnk6Ppn7PkuZDkuIvovb3op6PmnpAgQnkgSml4dW4KICovCih7CglpZDogJ211c2ljLmRvdWJhbicsCgluYW1lOiAn6LGG55Oj6Z+z5LmQ5LiL6L296Kej5p6QJywKCWhvc3Q6ICdtdXNpYy5kb3ViYW4uY29tJywKCW5vU3ViSG9zdDogdHJ1ZSwKCW5vRnJhbWU6IGZhbHNlLAoJZGxfaWNvbjogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS5kb3ViYW4ubXVzaWMuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCi5jb250YWluZXIgLm1vZDEgewoJd2lkdGg6IDUyNXB4Owp9CgouY29udGFpbmVyIC5tb2QyIHsKCXdpZHRoOiA4M3B4Owp9CgoqL30pLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciAkYnRuRG93bmxvYWQgPSAkKCc8YT4nKS5hdHRyKCdpZCcsICdidG4tZG93bmxvYWQnKTsKCQkkKCc8aT4nKS5hZGRDbGFzcygnanhfZGwganhfYnRuJykuYXBwZW5kVG8oJGJ0bkRvd25sb2FkKTsKCQlILmNhcHR1cmVBcmlhKCRidG5Eb3dubG9hZCk7CgoJCWZ1bmN0aW9uIGluamVjdF9kbF9pY29uICgpIHsKCQkJJGJ0bkRvd25sb2FkLnByZXBlbmRUbygnLmNvbnRhaW5lciAubW9kMicpOwoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlX3VybCAoc29uZykgewoJCQl2YXIgdXJsID0gSC51cmkoc29uZy5nZXQoJ3VybCcpLCBzb25nLmdldCgndGl0bGUnKSArICIgWyIgKyBzb25nLmdldCgnYXJ0aXN0X25hbWUnKSArICJdLm1wMyIpOwoJCQkkYnRuRG93bmxvYWQuYXR0cignaHJlZicsIHVybCk7CgkJfQoKCQlleHBvcnRGdW5jdGlvbihoYW5kbGVfdXJsLCB1bnNhZmVXaW5kb3csIHsKCQkJZGVmaW5lQXM6ICJkbF9qaXh1biIKCQl9KTsKCgkJZXhwb3J0RnVuY3Rpb24oaW5qZWN0X2RsX2ljb24sIHVuc2FmZVdpbmRvdywgewoJCQlkZWZpbmVBczogImluaXRfaml4dW4iCgkJfSk7CgoJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQlyZXF1aXJlKFsncGxheWVyL2FwcCcsICdwbGF5ZXIvbW9kZWxzL3NvbmcnLCAncGxheWVyL3ZpZXdzL3BsYXlpbmZvJ10sIGZ1bmN0aW9uIChBcHAsIFNvbmcsIFBsYXlJbmZvKSB7CgkJCQlzZXRUaW1lb3V0KGluaXRfaml4dW4sIDI1KTsKCgkJCQl2YXIgc3AgPSBTb25nLnByb3RvdHlwZS5zdGFydFBsYXlpbmc7CgkJCQlTb25nLnByb3RvdHlwZS5zdGFydFBsYXlpbmcgPSBmdW5jdGlvbiAoKSB7CgkJCQkJZGxfaml4dW4odGhpcyk7CgkJCQkJcmV0dXJuIHNwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoKCQkJCXZhciBwaXIgPSBQbGF5SW5mby5wcm90b3R5cGUucmVuZGVyOwoJCQkJUGxheUluZm8ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKCQkJCQl2YXIgciA9IHBpci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCWluaXRfaml4dW4oKTsKCQkJCQlyZXR1cm4gcjsKCQkJCX07CgkJCX0pOwoJCX0pOwoJfQp9KSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5kdW9sZS5qcyAqLwp7CglpZDogJ211c2ljLmR1b2xlJywKCW5hbWU6ICflpJrkuZDpn7PkuZAnLAoJaG9zdDogJ3d3dy5kdW9sZS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBidG5QcmV2U29uZyA9ICQoJyNwbGF5ZXJfcmlnaHQgLmxhc3QnKSwKCQkJYnRuRG93bmxvYWQgPSBidG5QcmV2U29uZy5jbG9uZSgpOwoJCQoJCSQoJyNwbGF5ZXJfcmlnaHQnKS5hbmltYXRlKHsKCQkJJ3dpZHRoJzogJys9MzInCgkJfSwgNTAwKTsKCQkKCQl2YXIgc29uZ0luZm8gPSAkKCdhLm11c2ljX2luZm8nKS5jc3MoewoJCQknY3Vyc29yJzogJ3RleHQnCgkJfSkucmVtb3ZlQXR0cignaHJlZicpOwoKCgkJdmFyIG1vID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIgKGZ1bmN0aW9uICgpIHsKCQkJaWYgKHNvbmdJbmZvWzBdLmhhc0F0dHJpYnV0ZSgnaHJlZicpKQoJCQkJc29uZ0luZm8ucmVtb3ZlQXR0ciAoJ2hyZWYnKTsKCQl9LmJpbmQgKHRoaXMpKTsKCQltby5vYnNlcnZlIChzb25nSW5mb1swXSwgewoJCQlhdHRyaWJ1dGVzOiB0cnVlCgkJfSk7CgoJCWJ0bkRvd25sb2FkLmluc2VydEJlZm9yZShidG5QcmV2U29uZy5wcmV2KCkpLnJlbW92ZUNsYXNzKCdsYXN0JykuY3NzKHsKCQkJJ3dpZHRoJzogJzAnLAoJCQknZGlzcGxheSc6ICdpbmxpbmUnLAoJCQknYmFja2dyb3VuZC1wb3NpdGlvbic6ICctMTUwcHggLTEwNHB4JwoJCX0pLmNzcyhILm1ha2VSb3RhdGVDc3MoOTApKS5hbmltYXRlKHsKCQkJJ3dpZHRoJzogJys9MzInCgkJfSwgNTAwKS5hdHRyKCd0YXJnZXQnLCAnX2JsYW5rJyk7CgkJCgkJdmFyIG9sZFBsYXlOZXcgPSB1bnNhZmVXaW5kb3cuZHVvbGVQbGF5ZXIucGxheU5ldzsKCQl2YXIgcmFuZG9tSWQ7CgoJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCXBsYXlOZXc6IChmdW5jdGlvbiAodCwgbikgewoJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAoCgkJCQkJbmV3IEN1c3RvbUV2ZW50IChILnNjcmlwdE5hbWUsIHtkZXRhaWw6IEpTT04uc3RyaW5naWZ5ICh7CgkJCQkJCW1wMzogdCwKCQkJCQkJaW5mbzogdGhpcy5jdXJNdXNpYwoJCQkJCX0pfSkKCQkJCSk7CgoJCQkJdGhyb3cgbmV3IEVycm9yVW5zYWZlU3VjY2VzcyAoKTsKCQkJfSkuYmluZCh1bnNhZmVXaW5kb3cuZHVvbGVQbGF5ZXIpCgkJfSwgdW5zYWZlV2luZG93LmR1b2xlUGxheWVyLCAnLmR1b2xlUGxheWVyJyk7CgoJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgKEguc2NyaXB0TmFtZSwgZnVuY3Rpb24gKGUpIHsKCQkJdmFyIHNvbmdPYmogID0gSlNPTi5wYXJzZSAoZS5kZXRhaWwpLAoJCQkJc29uZ0luZm8gPSBzb25nT2JqLmluZm87CgoJCQlidG5Eb3dubG9hZC5hdHRyKHsKCQkJCWhyZWY6IEgudXJpIChzb25nT2JqLm1wMywgc29uZ0luZm8uc29uZ19uYW1lICsgJyBbJyArIHNvbmdJbmZvLmFsYnVtX25hbWUgKyAnXSAtICcgKyBzb25nSW5mby5zaW5nZXJfbmFtZSArICcubXAzJyksCgkJCQl0aXRsZTogJ+WNleWHu+S4i+i9vTogJyArIHNvbmdJbmZvLnNvbmdfbmFtZQoJCQl9KTsKCQl9LCBmYWxzZSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuZHVvbWkuZWFyLmpzICovCnsKCWlkOiAnbXVzaWMuZHVvbWkuZWFyJywKCW5hbWU6ICfpgrvlsYXnmoTogLPmnLUnLAoJaG9zdDogJ2Vhci5kdW9taS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC53b3JkcHJlc3NBdWRpbyAoKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy5rdWdvdS5qcyAqLwovKioKICog6YW354uX6Z+z5LmQ6Kej5p6QIEJ5IEppeHVuCiAqIOaKk+WMhemFt+eLl+mfs+S5kCA6RAogKi8KKHsKCWlkOiAnbXVzaWMua3Vnb3UnLAoJbmFtZTogJ+mFt+eLl+mfs+S5kOS4i+i9veino+aekCcsCglob3N0OiBbJ3dlYi5rdWdvdS5jb20nLCAna3Vnb3UuY29tJywgJ3d3dy5rdWdvdS5jb20nXSwKCW5vU3ViSG9zdDogdHJ1ZSwKCW5vRnJhbWU6IHRydWUsCgloaWRlOiAnI2FkdicsCgljc3M6IC8qIFJlc291cmNlOiBjb20ua3Vnb3UuY3NzICovCkguZXh0cmFjdChmdW5jdGlvbiAoKSB7IC8qCi5kaWFsb2ctc2hhZG93IHsKCWRpc3BsYXk6IGZsZXg7CglqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKCWFsaWduLWl0ZW1zOiBjZW50ZXI7Cglwb3NpdGlvbjogZml4ZWQ7CglsZWZ0OiAwOwoJdG9wOiAwOwoJaGVpZ2h0OiAxMDAlOwoJd2lkdGg6IDEwMCU7CgliYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC4zKTsKCXotaW5kZXg6IDEwMDsKfQoKLmRpYWxvZy1jb250YWluZXIgewoJbWluLXdpZHRoOiBjYWxjKDc2OHB4ICsgMmVtKTsKCW1pbi1oZWlnaHQ6IDIwZW07CglwYWRkaW5nOiAxZW07CgliYWNrZ3JvdW5kOiAjZmZmOwoJYm94LXNoYWRvdzogMnB4IDJweCAycHggIzY2NjsKCWJvcmRlcjogMXB4IHNvbGlkIHJnYmEoNiw2LDYsLjMpOwoJcG9zaXRpb246IHJlbGF0aXZlOwoJcGFkZGluZy10b3A6IDIuNWVtOwp9CgouZGlhbG9nLWJhciB7Cglwb3NpdGlvbjogYWJzb2x1dGU7CglsZWZ0OiAwOwoJdG9wOiAwOwoJcGFkZGluZzogLjRlbTsKCXdpZHRoOiBjYWxjKDEwMCUgLSAuOGVtKTsKCWJvcmRlci1ib3R0b206IDFweCBzb2xpZCB3aGl0ZTsKCWJhY2tncm91bmQ6ICMwMEE3RjI7Cgljb2xvcjogd2hpdGU7Cn0KCi5kaWFsb2ctYmFyLWJ0biB7CglmbG9hdDogcmlnaHQ7Cgl3aWR0aDogMWVtOwoJaGVpZ2h0OiAxZW07Cglib3JkZXI6IDFweCBzb2xpZCB3aGl0ZTsKCXRleHQtYWxpZ246IGNlbnRlcjsKCWxpbmUtaGVpZ2h0OiAxLjI7CglwYWRkaW5nOiAwIC41ZW07CgltYXJnaW4tbGVmdDogLjVlbTsKfQoKLmRpYWxvZy1jb250ZW50IGlmcmFtZSB7CgloZWlnaHQ6IDMwZW07Cgl3aWR0aDogMTAwJTsKfQoqL30pLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT09IDIvKiBVUklfVVNFX0FSSUEgKi8pIHsKCQkJSC5zZXR1cEFyaWEoKTsKCQl9Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBfQ09OU1RfQkFTRSA9ICdodHRwczovL2ppeHVubW9lLmdpdGh1Yi5pby9jdXdjbDRjL2t1Z291LWRsJzsKCgkJdmFyICRkbFNoYWRvdyA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ2RpYWxvZy1zaGFkb3cnKS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKTsKCQl2YXIgJGRsRGlhbG9nID0gJCgnPGRpdj4nKS5hZGRDbGFzcygnZGlhbG9nLWNvbnRhaW5lcicpLmFwcGVuZFRvKCRkbFNoYWRvdyk7CgkJdmFyICRkbERpYWxvZ1RpdGxlID0gJCgnPGRpdj4nKS5hZGRDbGFzcygnZGlhbG9nLWJhcicpLmFwcGVuZFRvKCRkbERpYWxvZykudGV4dCgn5LiL6L2956qX5Y+jJyk7CgkJdmFyICRkbERpYWxvZ0NvbnRhaW5lciA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ2RpYWxvZy1jb250ZW50JykuYXBwZW5kVG8oJGRsRGlhbG9nKTsKCQl2YXIgJGRsRGlhbG9nQ2xvc2VCdG4gPSAkKCc8c3Bhbj4nKS5hZGRDbGFzcygnZGlhbG9nLWJhci1idG4nKS5hcHBlbmRUbygkZGxEaWFsb2dUaXRsZSkudGV4dCgn5YWzJyk7CgkJdmFyICRkbERpYWxvZ01hbmFnZUJ0biA9ICQoJzxzcGFuPicpLmFkZENsYXNzKCdkaWFsb2ctYmFyLWJ0bicpLmFwcGVuZFRvKCRkbERpYWxvZ1RpdGxlKS50ZXh0KCfnrqEnKTsKCgkJLy8g5YWz6Zet5oyJ6ZKu6KKr54K55Ye7CgkJJGRsRGlhbG9nQ2xvc2VCdG4uY2xpY2soZnVuY3Rpb24gKCkgewoJCQkkZGxTaGFkb3cuaGlkZSgpOwoJCX0pOwoKCQkkZGxEaWFsb2dNYW5hZ2VCdG4uY2xpY2soZnVuY3Rpb24gKCkgewoJCQkkd25kRG93bmxvYWRCb3gudG9nZ2xlKCk7CgkJCSR3bmREb3dubG9hZE1hbmFnZXIudG9nZ2xlKCk7CgkJfSk7CgoJCXZhciAkd2FpdE1zZyA9ICQoJzxkaXY+JykudGV4dCgn5q2j5Zyo6I635Y+W55u45YWz5L+h5oGvLi4nKS5hcHBlbmRUbygkZGxEaWFsb2dDb250YWluZXIpOwoKCQl2YXIgZnJhbWVEbERpYWxvZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJCXZhciAkd25kRG93bmxvYWRCb3ggPSAkKGZyYW1lRGxEaWFsb2cpLmhpZGUoKS5hcHBlbmRUbygkZGxEaWFsb2dDb250YWluZXIpOwoJCWZyYW1lRGxEaWFsb2cuc3JjID0gX0NPTlNUX0JBU0U7CgoJCXZhciBmcmFtZURsTWFuYWdlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwoJCXZhciAkd25kRG93bmxvYWRNYW5hZ2VyID0gJChmcmFtZURsTWFuYWdlcikuaGlkZSgpLmFwcGVuZFRvKCRkbERpYWxvZ0NvbnRhaW5lcik7CgkJZnJhbWVEbE1hbmFnZXIuc3JjID0gX0NPTlNUX0JBU0UgKyAnL2RsLmh0bWwnOwoKCQl2YXIgYWN0aW9uRGxEaWFsb2cgID0gWydzZXQnLCAnY2xlYXInXTsKCQl2YXIgYWN0aW9uRGxNYW5hZ2VyID0gWydhZGQnXTsKCQlmdW5jdGlvbiBwb3N0IChhY3Rpb24sIGRhdGEpIHsKCQkJdmFyIGZyYW1lID0gYWN0aW9uRGxEaWFsb2cuaW5kZXhPZihhY3Rpb24pICE9IC0xID8gZnJhbWVEbERpYWxvZyA6IGZyYW1lRGxNYW5hZ2VyOwoJCQl2YXIgbXNnID0gewoJCQkJYWN0aW9uOiBhY3Rpb24sCgkJCQlkYXRhOiBkYXRhCgkJCX07CgoJCQlmcmFtZS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKEpTT04uc3RyaW5naWZ5KG1zZyksICcqJyk7CgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVEb3dubG9hZCAoc29uZ3MpIHsKCQkJcG9zdCgnY2xlYXInKTsKCQkJJHdhaXRNc2cuaGlkZSgpOwoJCQkkd25kRG93bmxvYWRCb3guc2hvdygpOwoJCQkkd25kRG93bmxvYWRNYW5hZ2VyLmhpZGUoKTsKCQkJJGRsU2hhZG93LnNob3coKTsKCQkJdmFyIHJlc291cmNlID0gSlNPTi5wYXJzZSh1bmVzY2FwZShzb25ncykpLm1hcChmdW5jdGlvbiAoc29uZykgewoJCQkJcmV0dXJuIHsKCQkJCQl0eXBlOiAnYXVkaW8nLAoJCQkJCWlkOiAwLAoJCQkJCWhhc2g6IHNvbmcuSGFzaAoJCQkJfTsKCQkJfSk7CgoJCQl2YXIgcGF5bG9hZCA9IHsKCQkJCSJ1c2VyaWQiOiAwLAoJCQkJInRva2VuIjogIiIsCgkJCQkidmlwIjogMSwKCQkJCSJiZWhhdmlvciI6ICJkb3dubG9hZCIsCgkJCQkicmVsYXRlIjogMSwKCQkJCSJyZXNvdXJjZSI6IHJlc291cmNlLAoJCQkJImFwcGlkIjogMTAwMSwKCQkJCSJjbGllbnR2ZXIiOiAiODAzMSIsCgkJCQkic291cmNlIjogewoJCQkJCSJtb2R1bGUiOiAiMSIsCgkJCQkJInR5cGUiOiAiMCIsCgkJCQkJImlkIjogMAoJCQkJfQoJCQl9OwoKCQkJR01feG1saHR0cFJlcXVlc3QoewoJCQkJbWV0aG9kOiAiUE9TVCIsCgkJCQl1cmw6ICJodHRwOi8vbWVkaWEuc3RvcmUua3Vnb3UuY29tL3YxL2dldF9yZXNfcHJpdmlsZWdlIiwKCQkJCWRhdGE6IEpTT04uc3RyaW5naWZ5KHBheWxvYWQpLAoJCQkJaGVhZGVyczogewoJCQkJCSJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIgoJCQkJfSwKCQkJCW9ubG9hZDogZnVuY3Rpb24ocmVzcG9uc2UpIHsKCQkJCQlwb3N0KCdzZXQnLCBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkpOwoJCQkJCSR3YWl0TXNnLmhpZGUoKTsKCQkJCQkkd25kRG93bmxvYWRCb3guc2hvdygpOwoJCQkJfSwKCQkJCW9uZXJyb3I6IGZ1bmN0aW9uICgpIHsKCQkJCQlhbGVydCgn5o6l5Y+j6I635Y+W5aSx6LSlLCDor7fnqI3lkI7ph43or5UhJyk7CgkJCQkJJGRsU2hhZG93LmhpZGUoKTsKCQkJCX0KCQkJfSk7CgkJfQoKCQl2YXIgbG9vcGVyID0gbmV3IEludGVydmFsTG9vcChbXSwgcHJvY19oYXNoLCA1MDApOwoJCWxvb3Blci5sb29wKCk7CgkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBvbk1lc3NhZ2UsIGZhbHNlKTsKCQlmdW5jdGlvbiBvbk1lc3NhZ2UgKGUpIHsKCQkJdmFyIGRhdGEgPSBKU09OLnBhcnNlKGUuZGF0YSk7CgkJCWlmIChkYXRhLmFjdGlvbiA9PSAnY2FuY2VsJykgewoJCQkJJGRsU2hhZG93LmhpZGUoKTsKCQkJfSBlbHNlIGlmIChkYXRhLmFjdGlvbiA9PSAnZG93bmxvYWQnKSB7CgkJCQkkd25kRG93bmxvYWRCb3guaGlkZSgpOwoJCQkJJHduZERvd25sb2FkTWFuYWdlci5zaG93KCk7CgoJCQkJbG9vcGVyLmFkZC5hcHBseShsb29wZXIsIGRhdGEuZGF0YSk7CgkJCX0gZWxzZSB7CgkJCQlILmVycm9yKCdVbmRlZmluZWQgYWN0aW9uOiAnICsgZGF0YS5hY3Rpb24pOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVfZGwgKHNvbmcpIHsKCQkJdmFyIGZpbGUgPSBzb25nLmZpbGVOYW1lICsgJy4nICsgc29uZy5leHROYW1lOwoJCQl2YXIgdXJsID0gc29uZy51cmw7CgoJCQlwb3N0KCdhZGQnLCBzb25nKTsKCQkJaWYgKEguY29uZmlnLmRVcmlUeXBlID09PSAyLyogVVJJX1VTRV9BUklBICovKSB7CgkJCQlILmFkZFRvQXJpYSh1cmwsIGZpbGUpOwoJCQl9CgkJfQoKCQlmdW5jdGlvbiBwcm9jX2hhc2ggKG5leHQsIGhhc2gpIHsKCQkJaGFzaCA9IGhhc2gudG9Mb3dlckNhc2UoKTsKCQkJdmFyIGtleSA9IENyeXB0b0pTLk1ENShoYXNoICsgJ2tnY2xvdWQnKS50b1N0cmluZygpOwoJCQlHTV94bWxodHRwUmVxdWVzdCh7CgkJCQltZXRob2Q6ICdHRVQnLAoJCQkJdXJsOiAnaHR0cDovL3RyYWNrZXJjZG4ua3Vnb3UuY29tL2kvP2NtZD00Jmhhc2g9JyArIGhhc2ggKyAnJmtleT0nICsga2V5ICsgJyZwaWQ9MSZmb3JjZURvd249MCZ2aXA9MScsCgkJCQlvbmxvYWQ6IGZ1bmN0aW9uIChyZXNwb25zZSkgewoJCQkJCXZhciBzb25nID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXNwb25zZVRleHQpOwoJCQkJCWhhbmRsZV9kbChzb25nKTsKCQkJCQluZXh0KCk7CgkJCQl9LAoJCQkJb25lcnJvcjogZnVuY3Rpb24gKCkgewoJCQkJCUguZXJyb3IoJ0Vycm9yIHdoaWxlIGZldGNoaW5nIGRhdGEgZm9yICVzJywgaGFzaCk7CgkJCQkJbmV4dCgpOwoJCQkJfQoJCQl9KTsKCQl9CgoJCS8qIOWvvOWHuuWHveaVsCAqLwoJCWV4cG9ydEZ1bmN0aW9uKGhhbmRsZURvd25sb2FkLCB1bnNhZmVXaW5kb3csIHsKCQkJZGVmaW5lQXM6ICJkbF9qaXh1biIKCQl9KTsKCgkJdW5zYWZlRXhlYyhmdW5jdGlvbiAoKSB7CgkJCWRvd25Mb2FkID0gZGxfaml4dW47CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLm95aW55dWUuanMgKi8KewoJaWQ6ICdtdXNpYy5veWlueXVlJywKCW5hbWU6ICflmaLpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogJ295aW55dWUuY29tJywKCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5iZWdpbldpdGggKGxvY2F0aW9uLnBhdGhuYW1lLCAnL0Rvd24uYXNweCcpKSB7CgkJCXRoaXMuZG93blBhZ2UgKCk7CgkJCXJldHVybiA7CgkJfQoKCQlILndhaXRVbnRpbCAoJ3BsYXllci5zZXRVcmwnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlzZXRVcmw6IGZ1bmN0aW9uIChzb25nVXJsKSB7CgkJCQkJJCgnLmZ1bmNfaWNvbjQgPiBhJykuYXR0cih7CgkJCQkJCSdocmVmJzogc29uZ1VybCwKCQkJCQkJJ3RhcmdldCc6ICdfYmxhbmsnCgkJCQkJfSkuaHRtbCgnPGIvPuebtOmTvuS4i+i9vScpOwoKCQkJCQl0aHJvdyBuZXcgRXJyb3JVbnNhZmVTdWNjZXNzICgpOwoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cucGxheWVyLCAnLnBsYXllcicpCgkJfSk7Cgl9LAoKCWRvd25QYWdlOiBmdW5jdGlvbiAoKSB7CgkJdmFyICRkbCA9ICQoJzxwPicpLnByZXBlbmRUbyAoJCgnLnNpbmdfdmlldycpKS50ZXh0KCfmraPlnKjop6PmnpDpn7PkuZDlnLDlnYDigKYnKTsKCQl0aGlzLmZldGNoICgkX0dFVC5pZCwgZnVuY3Rpb24gKHNvbmdVcmwpIHsKCgkJCSRkbC50ZXh0KCfop6PmnpDlrozmr5U6ICcpLmFwcGVuZCAoJCgnPGE+JykuYXR0cih7CgkJCQlocmVmOiBzb25nVXJsLAoJCQkJdGFyZ2V0OiAnX2JsYW5rJwoJCQl9KS50ZXh0KCfngrnmiJHkuIvovb0nKSk7CgoJCX0sIGZ1bmN0aW9uICgpIHsKCQkJJGRsLnRleHQgKCcqIOS4i+i9veino+aekOWksei0pe+8jOivt+iuv+mXruatjOabsumhteino+aekOOAgicpCgkJCQkuY3NzICgnY29sb3InLCAncmVkJyk7CgkJfSk7Cgl9LAoKCWZldGNoOiBmdW5jdGlvbiAoc29uZ0lkLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWxDYWxsYmFjaykgewoJCSQuYWpheCAoewoJCQl1cmw6ICcvbG9hZC9sb2Fkc29uZy5hc2h4JywKCQkJbWV0aG9kOiAnUE9TVCcsCgkJCWRhdGE6IHsKCQkJCXNvbmdpZDogc29uZ0lkLAoJCQkJaWQ6IDMKCQkJfSwKCQkJZGF0YVR5cGU6ICd0ZXh0JwoJCX0pLnN1Y2Nlc3MgKGZ1bmN0aW9uICh1cmwpIHsKCQkJaWYgKHVybCAmJiB1cmwgIT0gJzAnKSB7CgkJCQlzdWNjZXNzQ2FsbGJhY2sgKHVybCk7CgkJCX0gZWxzZSB7CgkJCQlmYWlsQ2FsbGJhY2sgKCk7CgkJCX0KCQl9KS5lcnJvciAoZnVuY3Rpb24gKCkgewoJCQlmYWlsQ2FsbGJhY2sgKCk7CgkJfSk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMucXEuaXBsaW1pdC5qcyAqLwooewoJaWQ6ICdtdXNpYy5xcS5pcGxpbWl0JywKCW5hbWU6ICdRUSDpn7PkuZDjgIHnlLXlj7DmtbflpJborr/pl67pmZDliLbop6PpmaQnLAoJaG9zdDogWyd5LnFxLmNvbScsICdpLnkucXEuY29tJywgJ2ZtLnFxLmNvbSddLAoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCS8vIE1WIOmhtemdouino+mUgQoJCWlmIChkb2N1bWVudC5jb29raWUuaW5kZXhPZignaXBfbGltaXQ9MScpID09IC0xKSB7CgkJCWRvY3VtZW50LmNvb2tpZSA9ICdpcF9saW1pdCA9IDE7IGV4cGlyZXM9JyArIChuZXcgRGF0ZSgnMjA5OS8wMS8wMScpKS50b0dNVFN0cmluZygpICsgIjsgZG9tYWluPS5xcS5jb207IjsKCQl9Cgl9LAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJSC5pbmZvICgn562J5YCZ5rW35aSW6K6/6Zeu6ZmQ5Yi25qih57uE5Yqg6L294oCmJyk7CgkJSC53YWl0VW50aWwgKCdNVVNJQy53aWRnZXQubWFpbi5JUF9saW1pdC5pc0xpbWl0JywgZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCfmtbflpJborr/pl67pmZDliLbop6PpmaQuJyk7CgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uICh7CgkJCQkvLyDop6PpmaTjgIxRUemfs+S5kOaaguaXtuS4jeiDveWvueaCqOaJgOWcqOeahOWbveWutuaIluWcsOWMuuaPkOS+m+acjeWKoeOAjemZkOWItgoJCQkJaXNMaW1pdDogZnVuY3Rpb24gKCkge30KCQkJfSwgdW5zYWZlV2luZG93Lk1VU0lDLndpZGdldC5tYWluLklQX2xpbWl0LCAnLk1VU0lDLndpZGdldC5tYWluLklQX2xpbWl0Jyk7CgkJfSk7Cgl9Cn0pLAovKiBDb21waWxlZCBmcm9tIG11c2ljLnFxLnkuanMgKi8KewoJaWQ6ICdtdXNpYy5xcS55JywKCW5hbWU6ICdRUSDpn7PkuZDkuIvovb3op6PmnpAnLAoJaG9zdDogWyd5LnFxLmNvbScsICdzb3NvLm11c2ljLnFxLmNvbSddLAoJbm9TdWJIb3N0OiB0cnVlLAoKCWNzczogLyogUmVzb3VyY2U6IGNvbS5xcS55LmRsLmNzcyAqLwpILmV4dHJhY3QoZnVuY3Rpb24gKCkgeyAvKgpAbWVkaWEgc2NyZWVuIHsKCS5tX3BsYXllciAuYmFyX29wIHsKCQlsZWZ0OiAgMjA4cHg7CgkJd2lkdGg6IDMxMHB4OwoJfQoKCS5qeF9kbF9idCB7CgkJdHJhbnNmb3JtOiByb3RhdGUoOTBkZWcpOwoJfQoKCS5qeF9kbF9idCA+IGEgewoJCXdpZHRoOiAgIDEwMCU7CgkJaGVpZ2h0OiAgMTAwJTsKCQlkaXNwbGF5OiBibG9jazsKCQlvdXRsaW5lOiAwICFpbXBvcnRhbnQ7Cgl9Cn0KCiovfSksCglvbkJvZHk6IGZ1bmN0aW9uICgpIHsKCQlpZiAoSC5jb25maWcuZFVyaVR5cGUgPT0gMSkgewoJCQlILndhcm4gKAoJCQkJJyVzXG4lcycsCgkJCQkn5b2T5YmN54mI5pys55qE5Y2P6K6u5bCa5pyq5pSv5o+0IENvb2tpZSDovpPlhaUsIOWbnua7muiHs+i/nuaOpeeJiCcsCgkJCQkn5aaC5p6c5oKo56Gu5a6e6ZyA6KaB6Ieq5Yqo5aGr5YWl55So5oi35ZCNLCDor7fmlLnnlKggQXJpYTIg54mIJwoJCQkpOwoKCQkJSC5jb25maWcuZFVyaVR5cGUgPSAwOwoJCX0KCgkJdmFyIHN0eWxlVG9GaXggPSB0aGlzLnN0eWxlQmxvY2s7CgoJCUgud2FpdFVudGlsICgnTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5maXhTdHlsZU9yZGVyIChzdHlsZVRvRml4KTsKCgkJCXZhciBkbEJ0biA9ICQoJzxhPicpCgkJCQkuYWRkQ2xhc3MoJ2FyaWEtY29va2llJykKCQkJCS5hdHRyKCd0aXRsZScsICfmkq3mlL7pn7PkuZAsIOWNs+WIu+S4i+i9vScpCgkJCQkuYXBwZW5kVG8gKAoJCQkJCSQoJzxzdHJvbmc+JykKCQkJCQkJLmFkZENsYXNzICgnbmV4dF9idCBqeF9kbF9idCcpCgkJCQkJCS5pbnNlcnRBZnRlciAoJy5uZXh0X2J0JykKCQkJCSk7CgoJCQl1bnNhZmVFeGVjIChmdW5jdGlvbiAoc2NyaXB0TmFtZSkgewoJCQkJdmFyIG9sZEdldFNvbmcgPSB3aW5kb3cuTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybDsKCgkJCQl3aW5kb3cuTVVTSUMubW9kdWxlLndlYlBsYXllci5pbnRlckZhY2UuZ2V0U29uZ1VybCA9IGZ1bmN0aW9uIChzb25nT2JqLCBjYikgewoJCQkJCWRvY3VtZW50LmRpc3BhdGNoRXZlbnQgKCBuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUsIHtkZXRhaWw6IHsKCQkJCQkJaG9zdDogJ2h0dHA6Ly9zdHJlYW0nICsgKHBhcnNlSW50KHNvbmdPYmoubXN0cmVhbSkgKyAxMCkgKyAnLnFxbXVzaWMucXEuY29tLycsCgkJCQkJCXBhdGg6ICJNODAwIiArIHNvbmdPYmoubW1pZCArICIubXAzIiwKCQkJCQkJbmFtZTogc29uZ09iai5tc29uZyArICdbJyArIHNvbmdPYmoubXNpbmdlciArICddJwoJCQkJCX0gfSkgKTsKCgkJCQkJcmV0dXJuIG9sZEdldFNvbmcuYXBwbHkgKHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQl9LCBILnNjcmlwdE5hbWUpOwoKCQkJZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAoSC5zY3JpcHROYW1lLCBmdW5jdGlvbiAoZSkgewoJCQkJdmFyIHNvbmdPYmogPSBlLmRldGFpbDsKCgkJCQlkbEJ0bi5hdHRyICh7CgkJCQkJaHJlZjogSC51cmkgKHNvbmdPYmouaG9zdCArIHNvbmdPYmoucGF0aCwgc29uZ09iai5uYW1lICsgJy5tcDMnKSwKCQkJCQl0aXRsZTogJ+S4i+i9vTogJyArIHNvbmdPYmoubmFtZQoJCQkJfSk7CgkJCX0sIGZhbHNlKTsKCQl9LCA3MDAwLCA1MDApOwoKCQlILndhaXRVbnRpbCAoJ01VU0lDLndpZGdldC50cmFja1NlcnYuZm9ybWF0TXVzaWMnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMoZnVuY3Rpb24gKCkgewoJCQkJdmFyIF9mb3JtYXRNdXNpYyA9IE1VU0lDLndpZGdldC50cmFja1NlcnYuZm9ybWF0TXVzaWM7CgkJCQlNVVNJQy53aWRnZXQudHJhY2tTZXJ2LmZvcm1hdE11c2ljID0gZnVuY3Rpb24gKCkgewoJCQkJCXZhciBfbXVzaWMgPSBfZm9ybWF0TXVzaWMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCgkJCQkJX211c2ljLm1zdGF0dXMgPSBwYXJzZUludChfbXVzaWMubXN0YXR1cykgfHwgMTsKCgkJCQkJX211c2ljLm1zaXplID0gX211c2ljLm1zaXplIHx8IDE7CgkJCQkJX211c2ljLm1pbnRlcnZhbCA9IF9tdXNpYy5taW50ZXJ2YWwgfHwgMTsKCgkJCQkJaWYgKF9tdXNpYy5tc29uZ3VybCkgewoJCQkJCQl2YXIgX3ByZTsKCQkJCQkJaWYgKF9tdXNpYy5zaXplMzIwKSB7CgkJCQkJCQlfcHJlID0gJ004MDAnOwoJCQkJCQl9IGVsc2UgaWYgKF9tdXNpYy5zaXplMTI4KSB7CgkJCQkJCQlfcHJlID0gJ001MDAnOwoJCQkJCQl9CgoJCQkJCQlpZiAoX3ByZSkgewoJCQkJCQkJX211c2ljLm1zb25ndXJsID0gJ2h0dHA6Ly9zdHJlYW0nICsgKHBhcnNlSW50KF9tdXNpYy5tc3RyZWFtKSArIDEwKSArCgkJCQkJCQkJCQkJCScucXFtdXNpYy5xcS5jb20vJyArIF9wcmUgKyBfbXVzaWMubW1pZCArICcubXAzJzsKCQkJCQkJfQoJCQkJCX0KCgkJCQkJcmV0dXJuIF9tdXNpYzsKCQkJCX07CgoJCQkJdmFyIGdldFZpcCA9IGdfdXNlci5nZXRWaXBJbmZvOwoJCQkJZ191c2VyLmdldFZpcEluZm8gPSBmdW5jdGlvbiAoc3VjY2Vzc0NiLCBmYWlsQ2IpIHsKCQkJCQlyZXR1cm4gZ191c2VyLmdldFZpcEluZm8gKGZ1bmN0aW9uIChpbmZvKSB7CgkJCQkJCWlmICgxICE9IGluZm8udmlwKSBpbmZvLnZpcCA9IDE7CgkJCQkJCWlmIChzdWNjZXNzQ2IpIHN1Y2Nlc3NDYiAoaW5mbyk7CgkJCQkJfSwgZmFpbENiKTsKCQkJCX07CgkJCX0pOwoJCX0sIDcwMDAsIDUwMCk7Cgl9Cn0sCi8qIENvbXBpbGVkIGZyb20gbXVzaWMuc29uZ3Rhc3RlLmpzICovCnsKCWlkOiAnbXVzaWMuc29uZ3Rhc3RlJywKCW5hbWU6ICdTb25nVGFzdGUg5LiL6L296Kej5p6QJywKCWhvc3Q6IFsnc29uZ3Rhc3RlLmNvbSddLAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCXZhciBwYXRoID0gbG9jYXRpb24ucGF0aG5hbWU7CgkJaWYgKEguYmVnaW5XaXRoIChwYXRoLCAnL2FsYnVtLycpIHx8IEguYmVnaW5XaXRoIChwYXRoLCAnL211c2ljLycpKSB7CgkJCXRoaXMuYWxidW0gKCk7CgkJfSBlbHNlIGlmIChILmJlZ2luV2l0aCAocGF0aCwgJy9zb25nLycpKSB7CgkJCXRoaXMuc2luZ2xlICgpOwoJCX0gZWxzZSBpZiAoSC5iZWdpbldpdGggKHBhdGgsICcvcGxheW11c2ljLnBocCcpKSB7CgkJCXRoaXMucGxheWxpc3QgKCk7CgkJfQoJfSwKCgoJYWxidW06IGZ1bmN0aW9uICgpIHsKCQlILmxvZyAoJ1NUIDo6IOS4k+i+kemhtemdouiwg+aVtCcpOwoJCXZhciBidG5fcGxheUFsbCA9ICQoJCgnLnNvbmdfZnVuX2J0bicpLmNoaWxkcmVuKClbMV0pOwoJCXZhciBidG5fbm9Qb3BQbGF5ID0gYnRuX3BsYXlBbGwuY2xvbmUoKS5hdHRyKHsKCQkJJ3ZhbHVlJzogJ+W9k+WJjeeql+WPo+aSreaUvicsCgkJCSdvbmNsaWNrJzogJycKCQl9KS5pbnNlcnRBZnRlciAoYnRuX3BsYXlBbGwpOwoKCQlidG5fbm9Qb3BQbGF5LmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJdmFyIGlkcyA9IFtdLmZpbHRlci5jYWxsICh1bnNhZmVXaW5kb3cuY2hrQXJyYXksIGZ1bmN0aW9uIChlKSB7CgkJCQlyZXR1cm4gZS5jaGVja2VkOwoJCQl9KS5tYXAgKGZ1bmN0aW9uIChlKSB7CgkJCQlyZXR1cm4gZS52YWx1ZTsKCQkJfSkuam9pbignLCcpOwoKCQkJaWYgKCFpZHMpIHsKCQkJCWlkcyA9IFtdLm1hcC5jYWxsKHVuc2FmZVdpbmRvdy5jaGtBcnJheSwgZnVuY3Rpb24gKGUpIHsKCQkJCQlyZXR1cm4gZS52YWx1ZTsKCQkJCX0pLmpvaW4gKCcsJyk7CgkJCX0KCgkJCWxvY2F0aW9uLmhyZWYgPSAnL3BsYXltdXNpYy5waHA/c29uZ19pZD0nICsgaWRzOwoJCX0pOwoJfSwKCglzaW5nbGU6IGZ1bmN0aW9uICgpIHsKCQl2YXIgYXJncyAgICA9ICQoIiNwbGF5aWNvbiBhIikuYXR0cignaHJlZicpLnJlcGxhY2UoL1xzL2csICcnKS5yZXBsYWNlKC8iL2csICInIikuc3BsaXQoIiciKTsKCQl2YXIgc1VSTCAgICA9IGFyZ3MgWzA1XSwKCQkJc1R5cGUgICA9IGFyZ3MgWzExXSwKCQkJc0hlYWQgICA9IGFyZ3MgWzEzXSwKCQkJc29uZ0lkICA9IGFyZ3MgWzE1XSwKCQkJc0xlbmd0aCA9IGFyZ3MgWzE2XS5tYXRjaCAoL1xkezIsfS8pWzBdOwoKCQl2YXIgcSA9ICQuRGVmZXJyZWQoKTsKCQlxLnRoZW4gKGZ1bmN0aW9uIChzb25nVXJsKSB7CgkJCUgubG9nICgnU1QgOjog6Kej5p6Q6Z+z5LmQ5Zyw5Z2AIDo6ICVzJywgc29uZ1VybCk7CgkJCXZhciBzb25nTmFtZSA9ICQoJy5taWRfdGl0JykudGV4dCgpOwoKCQkJJCgnYSNjdXN0b21fMScpLmF0dHIoewoJCQkJJ2hyZWYnOiBILnVyaShzb25nVXJsLCBzb25nTmFtZSArIHNvbmdVcmwuc2xpY2UoLTQpKSwKCQkJCSd0aXRsZSc6ICfkuIvovb06ICcgKyBzb25nTmFtZQoJCQl9KS50ZXh0KCfnm7TmjqXkuIvovb0nKTsKCQl9KTsKCgkJaWYgKEguY29udGFpbnMoc1VSTCwgJ3JheWZpbGUnKSkgewoJCQlxLnJlc29sdmUgKHNIZWFkICsgc1VSTCArIHVuc2FmZVdpbmRvdy5HZXRTb25nVHlwZShzVHlwZSkpOwoJCX0gZWxzZSB7CgkJCSQuYWpheCh7CgkJCQl0eXBlOiAnUE9TVCcsCgkJCQl1cmw6ICcvdGltZS5waHAnLAoJCQkJY2FjaGU6IHRydWUsCgkJCQlkYXRhOiAnc3RyPScgKyBzVVJMICsgJyZzaWQ9JyArIHNvbmdJZCArICcmdD0nICsgc0xlbmd0aCwKCQkJCWRhdGFUeXBlOiAndGV4dCcsCgkJCX0pLnN1Y2Nlc3MoZnVuY3Rpb24gKHIpIHsKCQkJCXEucmVzb2x2ZSAocik7CgkJCX0pOwoJCX0KCX0sCgoJcGxheWxpc3Q6IGZ1bmN0aW9uICgpIHsKCQkvLyDkuIvovb3op6PmnpAgLSBIb29rIOabtOaNouatjOabsueahOWHveaVsO+8jOmBv+WFjemHjeWkjeivu+WPluatjOabsiArIOS4jemcgOimgeWkmuasoeivt+axguacjeWKoeWZqOS4jeWuueaYk+aOiee6v+OAggoJCUgubG9nICgnU1QgOjog5YiX6KGo5qih5byP6Kej5p6QJyk7CgoJCXZhciBwRG93bmxvYWQgPSAkKCcjbGVmdF9tdXNpY19kaXYgPiAucF9mdW4gPiBhOmxhc3QnKQoJCQkudGV4dCgn55u05o6l5LiL6L29JykKCQkJLmF0dHIoJ3RhcmdldCcsICdfYmxhbmsnKTsKCgkJdW5zYWZlT3ZlcndyaXRlRnVuY3Rpb25TYWZlUHJveHkgKHsKCQkJY2hhbmdlU29uZzogZnVuY3Rpb24gKG5hbWUsIHVybCwgaXNMb2dvU2hvd24pIHsKCQkJCS8vIDIwMTMuMDMuMTkgJiAyMDEzLjA0LjA5IOS/ruatozoKCQkJCS8vICAg5bey57uP5Yig6Zmk55qE5q2M5puy6Ieq5Yqo6Lez5Yiw5LiL5LiA5puyCgkJCQlpZiAoIDAgPT0gbmFtZS50cmltKCkubGVuZ3RoICkgewoJCQkJCXVuc2FmZVdpbmRvdy5wdS5kb1BsYXlOZXh0KDIpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJCUgubG9nICgn6K+35rGC5q2M5puyIDo6ICVzIDo6ICVzJywgbmFtZSwgdXJsKTsKCQkJCXBEb3dubG9hZC5hdHRyKHsKCQkJCQknaHJlZic6IEgudXJpKHVybCwgbmFtZSArIHVybC5zbGljZSgtNCkpLAoJCQkJCSd0aXRsZSc6ICfkuIvovb06ICcgKyBuYW1lCgkJCQl9KTsKCQkJCWRvY3VtZW50LnRpdGxlID0gJ1NUIC0gJyArIG5hbWU7CgoJCQkJLy8g6L2s5o6l57uZ5Y6f5Ye95pWwCgkJCQl0aHJvdyBuZXcgRXJyb3JVbnNhZmVTdWNjZXNzKCk7CgkJCX0sCgoJCQlkZWxTb25nRGl2OiBmdW5jdGlvbiAoc29uZ2lkLCBpc2JveCkgewoJCQkJSC5sb2cgKCfliKDpmaTmrYzmm7IgOjogJyArIHNvbmdpZC50b1N0cmluZygpKTsKCQkJCSQoJyMnICsgc29uZ2lkKS5oaWRlKCk7CgoJCQkJdmFyIG5ld19zb25nbGlzdCA9IFtdOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB1bnNhZmVXaW5kb3cuYXJyX2lkcy5sZW5ndGg7IGkrKykgewoJCQkJCWlmICh1bnNhZmVXaW5kb3cuYXJyX2lkc1tpXSA9PSBzb25naWQpIHsKCQkJCQkJaWYgKHNvbmdpZCA9PSB1bnNhZmVXaW5kb3cuY3VyX3NpZCkKCQkJCQkJCXVuc2FmZVdpbmRvdy5wdS5kb1BsYXlOZXh0KDEpOwoJCQkJCQl1bnNhZmVXaW5kb3cuYXJyX2lkc1tpXSA9IDA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfSk7CgoJCS8vIDIwMTMuMDMuMTkg5re75YqgOgoJCS8vICAg6YeN5bu65pKt5pS+5YiX6KGo5Zyw5Z2ACgkJJCgncC5wX2xpc3RfdHh0JykuYXBwZW5kKCQoJzxhPicpLnRleHQoJ+mHjeW7uuaSreaUvuWIl+ihqCcpLmNsaWNrKGZ1bmN0aW9uICgpIHsKCQkJbG9jYXRpb24uc2VhcmNoID0gJz9zb25nX2lkPScgKyB1bnNhZmVXaW5kb3cuYXJyX2lkcy5qb2luKCcsJyk7CgkJfSkuY3NzKCdjdXJzb3InLCAncG9pbnRlcicpKTsKCQkKCQlILmxvZyAoJ1NUIDo6IOetieW+hee9kemhteWKoOi9vS4uLicpOwoJCUgud2FpdFVudGlsICgncHUuZG9QbGF5TmV4dCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5sb2cgKCdTVCA6OiDlrpjmlrnmkq3mlL7lmajliKDpmaTlip/og73kv67mraPlkK/liqgnKTsKCgkJCXVuc2FmZU92ZXJ3cml0ZUZ1bmN0aW9uU2FmZVByb3h5ICh7CgkJCQlkb1BsYXlOZXh0OiBmdW5jdGlvbiAodCkgewoJCQkJCXZhciBub3csIGF2bCwgaTsKCQkJCQlmb3IgKGkgPSAwOyBpIDwgdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJaWYgKHVuc2FmZVdpbmRvdy5hcnJfaWRzW2ldID09IHVuc2FmZVdpbmRvdy5jdXJfc2lkKSB7CgkJCQkJCQlub3cgPSBpOwoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQl9CgkJCQkJLy8g5a+75om+5LiL5LiA6aaW5pyq5Yig6Zmk55qE5q2M5puy44CCCgkJCQkJLy8gICAqIDIwMTMuMDEuMjkg5L+u5q2jCgkJCQkJLy8JIDEuIOS4iuS4gOmmluafpeaJvuWksei0peeahOaDheWGteS4i+S8mua7muWbnuWIsOW9k+WJjemfs+S5kOeahOmUmeivr+OAggoJCQkJCS8vCSAyLiDlpoLmnpzmsqHmnInlj6/lkKzmrYzmm7Lmg4XlhrXkuIvml6DpmZDlvqrnjq/nmoTplJnor6/jgIIKCQkJCQkKCQkJCQlub3cgPSBNYXRoLmFicygobm93IHx8IDApICsgdCk7CgkJCQkJYXZsID0gMDsKCQkJCQkKCQkJCQkvLyDmo4Dmn6XmmK/lkKbmnInmrYzmm7LliankvZkKCQkJCQlmb3IgKGkgPSAwOyBpIDwgdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJaWYgKHVuc2FmZVdpbmRvdy5hcnJfaWRzW2ldKSB7CgkJCQkJCQlhdmwrKzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoYXZsID09PSAwKSB7CgkJCQkJCWFsZXJ0KCfmrYzpg73ooqvliKDlhYnkuobov5jlkKzllaUuLi4nKTsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCQkJCQkKCQkJCQkvLyDlr7vmib7nqbrkvY0KCQkJCQl3aGlsZSAodHJ1ZSkgewoJCQkJCQlpZiAodW5zYWZlV2luZG93LmFycl9pZHNbbm93XSkgewoJCQkJCQkJSC5sb2cgKCfliIfmjaLmrYzmm7IgOjogJyArIG5vdy50b1N0cmluZygpKTsKCQkJCQkJCXVuc2FmZVdpbmRvdy5wdS51dGlscyhub3cpOwoJCQkJCQkJdW5zYWZlV2luZG93LmN1cl9zaWQgPSB1bnNhZmVXaW5kb3cuYXJyX2lkc1tub3ddOwoJCQkJCQkJdW5zYWZlV2luZG93LnBsYXlTb25nUmlnaHQoKTsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCQlub3cgKz0gdCA+PSAwID8gMSA6IC0xOwoJCQkJCQlpZiAodW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoIDw9IG5vdykgewoJCQkJCQkJbm93ID0gMDsKCQkJCQkJfQoJCQkJCQlpZiAobm93IDwgMCkgewoJCQkJCQkJbm93ID0gdW5zYWZlV2luZG93LmFycl9pZHMubGVuZ3RoOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9LCB1bnNhZmVXaW5kb3cucHUsICcucHUnKTsKCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBtdXNpYy54aWFtaS5qcyAqLwp7CglpZDogJ211c2ljLnhpYW1pJywKCW5hbWU6ICfomb7nsbPpn7PkuZAnLAoJaG9zdDogJ3d3dy54aWFtaS5jb20nLAoJbm9TdWJIb3N0OiB0cnVlLAoJZGxfaWNvbjogdHJ1ZSwKCWNzczogLyogUmVzb3VyY2U6IGNvbS54aWFtaS5mbS5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKLS0geGlhbWkgRk0gcGxheWVyIGNzcwoKLmp4X2RsIHsKCXBvc2l0aW9uOiBhYnNvbHV0ZTsKCWNvbG9yOiAjZGRkOwoJcmlnaHQ6IDk5cHg7Cgl3aWR0aDogMThweDsKCWhlaWdodDogMThweDsKCWZvbnQtc2l6ZTogMThweDsKCXRyYW5zaXRpb246IGNvbG9yIC4zczsKfQoKLmp4X2RsOmhvdmVyIHsKCWNvbG9yOiAjYWFhOwp9CiovfSksCgoJb25TdGFydDogZnVuY3Rpb24gKCkgewoJCXZhciB0aGF0ID0gdGhpczsKCQlILmhvb2tSZXF1aXJlICgnU0VJWUEnLCAnZG93bmxvYWQnLCBmdW5jdGlvbiAoc2NyaXB0TmFtZSwgX1NFSVlBLCBfZG93bmxvYWQsIHNvbmdJZCkgewoJCQlkb2N1bWVudC5kaXNwYXRjaEV2ZW50IChuZXcgQ3VzdG9tRXZlbnQgKHNjcmlwdE5hbWUgKyAnLWRsQnlJZCcsIHsgZGV0YWlsOiBzb25nSWQgfSkpOwoKCQkJcmV0dXJuIHRydWU7CgkJfSwgSC5zY3JpcHROYW1lKTsKCgkJSC53YWl0VW50aWwgKCdLSVNTWS51c2UnLCBmdW5jdGlvbiAoKSB7CgkJCXVuc2FmZUV4ZWMgKGZ1bmN0aW9uIChzY3JpcHROYW1lKSB7CgkJCQl3aW5kb3cuS0lTU1kudXNlICgncGFnZS9tb2RzL3BsYXllcicsIGZ1bmN0aW9uIChfS0lTU1ksIG1QbGF5ZXIpIHsKCQkJCQl2YXIgX3NldE11c2ljSW5mbyA9IG1QbGF5ZXIucHJvdG90eXBlLnNldE11c2ljSW5mbzsKCQkJCQltUGxheWVyLnByb3RvdHlwZS5zZXRNdXNpY0luZm8gPSBmdW5jdGlvbiAoc29uZ09iaikgewoJCQkJCQl0aGlzLmlzVklQID0gdHJ1ZTsKCQkJCQkJZG9jdW1lbnQuZGlzcGF0Y2hFdmVudCAobmV3IEN1c3RvbUV2ZW50IChzY3JpcHROYW1lICsgJy1kbEJ5T2JqJywgeyBkZXRhaWw6IEpTT04ucGFyc2UgKHNvbmdPYmopIH0pKTsKCQkJCQkJcmV0dXJuIF9zZXRNdXNpY0luZm8uYXBwbHkgKHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfTsKCQkJCX0pOwoJCQl9LCBILnNjcmlwdE5hbWUpOwoJCX0pOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUgKyAnLWRsQnlJZCcsIGZ1bmN0aW9uIChlKSB7CgkJCXRoYXQuZmV0Y2ggKGUuZGV0YWlsLCBmdW5jdGlvbiAoc29uZ09iaikgewoJCQkJR01fb3BlbkluVGFiICggSC51cmkgKHNvbmdPYmouc3JjLCBzb25nT2JqLnRpdGxlICsgJ1snICsgc29uZ09iai5hcnRpc3QgKyAnXScgKyAnLm1wMycpLCBmYWxzZSApOwoJCQl9KTsKCQl9LCBmYWxzZSk7CgoJCXRoYXQuZGxCdG4gPSAkKCc8YT4nKQoJCQkuYWRkQ2xhc3MgKEguZGVmYXVsdERsSWNvbikKCQkJLmF0dHIoJ3RpdGxlJywgJ+etieW+heiOt+WPlumfs+S5kOS/oeaBr+KApicpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyIChILnNjcmlwdE5hbWUgKyAnLWRsQnlPYmonLCBmdW5jdGlvbiAoZSkgewoJCQl2YXIgc29uZ09iaiA9IGUuZGV0YWlsOwoJCQl0aGF0LmRsQnRuCgkJCQkuYXR0ciAoJ2hyZWYnLCAgSC51cmkgKHRoYXQuZGVjcnlwdCAoIHNvbmdPYmoudXJsICksIHNvbmdPYmouc29uZyArICdbJyArIHNvbmdPYmouYXJ0aXN0ICsgJ10nICsgJy5tcDMnKSkKCQkJCS5hdHRyICgndGl0bGUnLCAn5LiL6L29OiAnICsgc29uZ09iai5zb25nICsgJyBbYnkgJyArIHNvbmdPYmouYXJ0aXN0ICsgJ10nKTsKCQl9LCBmYWxzZSk7Cgl9LAoKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsIChmdW5jdGlvbiAoKSB7CgkJCXJldHVybiAkKCcjSl90cmFja0ZhdicpLmxlbmd0aDsKCQl9LCBmdW5jdGlvbiAoKSB7CgkJCXRoaXMuZGxCdG4uaW5zZXJ0QmVmb3JlICgkKCcjSl90cmFja0ZhdicpKTsKCQl9LmJpbmQgKHRoaXMpKTsKCX0sCgoJZmV0Y2g6IGZ1bmN0aW9uIChzb25nSWQsIGNhbGxiYWNrKSB7CgkJaWYgKCFjYWxsYmFjayB8fCAhY2FsbGJhY2suY2FsbCkKCQkJcmV0dXJuIDsKCgkJdmFyIHRoYXQgPSB0aGlzOwoJCSQuYWpheCh7CgkJCXR5cGU6ICdHRVQnLAoJCQl1cmw6ICcvc29uZy9wbGF5bGlzdC9pZC8nICsgc29uZ0lkICsgJy9vYmplY3RfbmFtZS9kZWZhdWx0L29iamVjdF9pZC8wJywKCQkJY2FjaGU6IHRydWUsCgkJCWRhdGFUeXBlOiAneG1sJwoJCX0pLnN1Y2Nlc3MgKGZ1bmN0aW9uICh4bWxEb2MpIHsKCQkJdmFyIHNvbmdPYmogPSB7fTsKCQkJW10uZm9yRWFjaC5jYWxsICh4bWxEb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUgKCd0cmFjaycpWzBdLmNoaWxkcmVuLCBmdW5jdGlvbiAoZSkgewoJCQkJLy8gY29uc29sZS5sb2cgKCclcyA9PiAlcycsIGUudGFnTmFtZSwgZS50ZXh0Q29udGVudCk7CgkJCQlzb25nT2JqW2UudGFnTmFtZV0gPSBlLnRleHRDb250ZW50OwoJCQl9KTsKCQkJc29uZ09iai5zcmMgPSB0aGF0LmRlY3J5cHQgKHNvbmdPYmoubG9jYXRpb24pOwoJCQljYWxsYmFjayAoIHNvbmdPYmogKTsKCQl9KTsKCX0sCgoJZGVjcnlwdDogZnVuY3Rpb24gKGVuY3J5cHRlZEFkZHJlc3MpIHsKCQl2YXIgc3BsaXRlciA9IHBhcnNlSW50KGVuY3J5cHRlZEFkZHJlc3NbMF0pLAoJCQlsaW5rID0gZW5jcnlwdGVkQWRkcmVzcy5zbGljZSgxKSwKCQkJcmVtYWluZGVyID0gbGluay5sZW5ndGggJSBzcGxpdGVyLAoJCQl0bXAgPSAwLAoJCQlyZXQgPSAnJywKCQkJYXJyID0gW107CgoJCWZvciAodmFyIGkgPSAwOyBpIDwgc3BsaXRlcjsgaSsrKSB7CgkJCWFyci5wdXNoICgocmVtYWluZGVyID4gaSA/IDEgOiAwKSArIChsaW5rLmxlbmd0aCAtIHJlbWFpbmRlcikgLyBzcGxpdGVyKTsKCQl9CgoJCWZvciAoaSA9IDA7IGkgPCBhcnJbMV07IGkrKywgdG1wID0gMCkgewoJCQlmb3IgKHZhciBqID0gMDsgaiA8IHNwbGl0ZXI7IGorKykgewoJCQkJcmV0ICs9IGxpbmtbdG1wICsgaV07CgkJCQl0bXAgKz0gYXJyW2pdOwoJCQl9CgkJfQoJCXJldHVybiB1bmVzY2FwZShyZXQuc3Vic3RyKDAsIGxpbmsubGVuZ3RoKSkucmVwbGFjZSgvXF4vZywgJzAnKS5yZXBsYWNlKC9cKy9nLCAnICcpOwoJfQp9LAovKiBDb21waWxlZCBmcm9tIG11c2ljLnlpbnl1ZXRhaS5qcyAqLwp7CglpZDogJ211c2ljLnlpbnl1ZXRhaScsCgluYW1lOiAn6Z+z5oKm5Y+w5LiL6L296Kej5p6QJywKCWhvc3Q6IFsneWlueXVldGFpLmNvbSddLAoKCV9saW5rSG9sZGVyOiBudWxsLAoJb25Cb2R5OiBmdW5jdGlvbiAoKSB7CgkJaWYgKEguYmVnaW5XaXRoIChsb2NhdGlvbi5wYXRobmFtZSwgJy92aWRlby8nKSkgewoJCQl0aGlzLl9saW5rSG9sZGVyID0gJCgnPHNwYW4+JykuY3NzICh7CgkJCQljb2xvcjogJ3doaXRlJywKCQkJCWZvbnRTaXplOiAnc21hbGwnLAoJCQkJbWFyZ2luTGVmdDogJzEuNWVtJwoJCQl9KS5hcHBlbmRUbyAoJCgnLnZjaGFydCwgLnBsX3RpdGxlJykuZmlyc3QoKSk7CgoJCQl0aGlzLmZldGNoKGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cZCskLylbMF0pOwoJCX0gZWxzZSB7CgkJCUgud2FpdFVudGlsIChmdW5jdGlvbiAoKSB7CgkJCQlyZXR1cm4gJCgnLkpfdmlkZW9faW5mbycpLmxlbmd0aDsKCQkJfSwgdGhpcy5wcm9jTGlzdFBhZ2UuYmluZCAodGhpcykpOwoJCX0KCX0sCgoJcHJvY0xpc3RQYWdlOiBmdW5jdGlvbiAoKSB7CgkJSC5pbmZvICgn5bCx57uqLicpOwoKCQl2YXIgbW8gPSBuZXcgTXV0YXRpb25PYnNlcnZlciAoZnVuY3Rpb24gKCkgewoJCQlILmluZm8gKCdNViDlt7Lmm7TmlrAsIOaKk+WPluaWsOeahOS4i+i9veWcsOWdgC4uJyk7CgkJCXRoaXMuX2xpbmtIb2xkZXIgPSAkKCc8cD4nKS5wcmVwZW5kVG8gKCcuSl9tdl9jb250ZW50Jyk7CgkJCXRoaXMuZmV0Y2goJCgnLkpfdmlkZW9faW5mbyA+IGEnKS5hdHRyKCdocmVmJykubWF0Y2ggKC9cZCsvKSk7CgkJfS5iaW5kICh0aGlzKSk7CgoJCW1vLm9ic2VydmUgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5KX3ZpZGVvX2luZm8nKSwgewoJCQljaGlsZExpc3Q6IHRydWUKCQl9KTsKCX0sCgoJZmV0Y2g6IGZ1bmN0aW9uICh2aWRlb0lkKSB7CgkJdmFyIHRoYXQgPSB0aGlzOwoJCUdNX3htbGh0dHBSZXF1ZXN0ICh7CgkJCW1ldGhvZDogJ0dFVCcsCgkJCXVybDogJ2h0dHA6Ly93d3cueWlueXVldGFpLmNvbS9pbnNpdGUvZ2V0LXZpZGVvLWluZm8/anNvbj10cnVlJnZpZGVvSWQ9JyArIHZpZGVvSWQsCgkJCW9ubG9hZDogZnVuY3Rpb24gKHUpIHsKCQkJCXRyeSB7CgkJCQkJdmFyIHIgPSBKU09OLnBhcnNlICh1LnJlc3BvbnNlVGV4dCk7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCfop6PmnpDlpLHotKXvvJrmlbDmja7moLzlvI/plJnor6/jgIInKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCWlmIChyLmVycm9yKSB7CgkJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCfop6PmnpDlpLHotKXvvJonICsgci5tZXNzYWdlKTsKCQkJCQlyZXR1cm4gOwoJCQkJfQoKCQkJCUguaW5mbyAoJ+ino+aekOWujOavlSwg5Yqg5YWl5LiL6L295Zyw5Z2ALi4nKTsKCQkJCXRoYXQuYWRkRG93bmxvYWQgKHIudmlkZW9JbmZvLmNvcmVWaWRlb0luZm8pOwoJCQl9LAoJCQlvbmVycm9yOiBmdW5jdGlvbiAocikgewoJCQkJdGhhdC5fbGlua0hvbGRlci50ZXh0KCflvojmirHmrYksIOino+aekOS4i+i9veWcsOWdgOWksei0pS4uJyk7CgkJCX0KCQl9KTsKCX0sCgoJYWRkRG93bmxvYWQ6IGZ1bmN0aW9uICh2aWRlb0luZm8pIHsKCQl0aGlzLl9saW5rSG9sZGVyLnRleHQoJ+S4i+i9vTogJyk7CgkJdmFyIHJhd0xpbmtzID0gdmlkZW9JbmZvLnZpZGVvVXJsTW9kZWxzOwoKCQlmb3IgKHZhciBpID0gcmF3TGlua3MubGVuZ3RoOyBpLS07ICkgewoJCQkkKCc8YT4nKS50ZXh0KHJhd0xpbmtzW2ldLlF1YWxpdHlMZXZlbE5hbWUpCgkJCQkvLyBUT0RPIGZpeCB0aGUgbmFtZQoJCQkJLmF0dHIoJ2hyZWYnLCBILnVyaSgKCQkJCQlyYXdMaW5rc1tpXS52aWRlb1VybCwgCgkJCQkJSC5zcHJpbnRmKCclcyBbJXNdWyVzXSVzJywKCQkJCQkJdmlkZW9JbmZvLnZpZGVvTmFtZSwKCQkJCQkJdmlkZW9JbmZvLmFydGlzdE5hbWUsCgoJCQkJCQlyYXdMaW5rc1tpXS5RdWFsaXR5TGV2ZWxOYW1lLAoJCQkJCQlILmdldExpbmtFeHQocmF3TGlua3NbaV0udmlkZW9VcmwpKQoJCQkJKSkKCQkJCS5hdHRyKCd0aXRsZScsICfkuIvovb06ICcgKyB2aWRlb0luZm8udmlkZW9OYW1lKS5hcHBlbmRUbyh0aGlzLl9saW5rSG9sZGVyKQoJCQkJLmFkZENsYXNzICgnY19jZjknKTsKCgkJCXRoaXMuX2xpbmtIb2xkZXIuYXBwZW5kKCcgfCAnKTsKCQl9CgoJCXRoaXMuX2xpbmtIb2xkZXIuYXBwZW5kKEguc3ByaW50ZiAoJ+aPkOS+mzogJXMgJXMgJywgSC5zY3JpcHROYW1lLCBILnZlcnNpb24pKTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBwaHBkaXNrLmEuanMgKi8KewoJaWQ6ICdwaHBkaXNrLmEnLAoJbmFtZTogJ+mAmueUqCBwaHBEaXNrLmEg572R55uY6KeE5YiZJywKCS8vIOebuOWFs+inhOWImTog6Lez6L2sIC9maWxlLXh4eCAtPiAvZG93bmxvYWQucGhwP2lkPXh4eCZrZXk9eHh4CgkKCWhvc3Q6IFsKCQknNzlwYW4uY29tJywgJzAzeGcuY29tJywKCQkKCQknN212LmNjJywgJ3Bhbi41Mnp6Lm9yZycsICcyNThwYW4uY29tJywgJ2h1aW1laWt1LmNvbScKCV0sCgoJaGlkZTogWycjY29kZV9ib3gnLCAnI2Rvd25fYm94MicsICcjY29kZWZybScsICcuYWQnLCAnW2NsYXNzXj0iYmFubmVyIl0nXSwKCXNob3c6ICcjZG93bl9ib3gnLAoKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVPdmVyd3JpdGVGdW5jdGlvblNhZmVQcm94eSAoewoJCQlvcGVuOiB0RnVuYwoJCX0pOwoJfSwKCW9uQm9keTogZnVuY3Rpb24gKCkgewoJCUgud2FpdFVudGlsICgnZG93bl9maWxlX2xpbmsnLCBmdW5jdGlvbiAoKSB7CgkJCS8vIOmBv+WFjeWcsOWdgOiiq+imhueblgoJCQl1bnNhZmVXaW5kb3cudXBkYXRlX3NlYyA9IG51bGw7CgkJCS8vIOW8uuWItuaYvuekuuWcsOWdgAoJCQl1bnNhZmVXaW5kb3cuZG93bl9maWxlX2xpbmsgKCk7CgoJCQkvLyDlvLrliLbmmL7npLrkuIvovb3lnLDlnYAKCQkJaWYgKHVuc2FmZVdpbmRvdy5zaG93X2Rvd25fdXJsKQoJCQkJdW5zYWZlV2luZG93LnNob3dfZG93bl91cmwgKCdkb3duX2ExJyk7CgoJCQl2YXIganVtcFVybCA9ICQoJyNkb3duX2xpbmsnKS5maW5kKCdhJykuYXR0cignaHJlZicpOwoKCQkJLy8g54S25ZCO6Lez6L+H5Y67CgkJCWlmIChqdW1wVXJsKSB7CgkJCQlILnJlRGlyV2l0aFJlZiAoanVtcFVybCk7CgkJCX0gZWxzZSB7CgkJCQlhbGVydCAoSC5zcHJpbnRmKCdbJXNdOiDlupTnlKggJXMg5aSx6LSlOlxu5om+5LiN5Yiw6Lez6L2s5Zyw5Z2ALicsIEguc2NyaXB0TmFtZSwgdGhpcy5uYW1lKSk7CgkJCX0KCQl9KTsKCX0KfSwKLyogQ29tcGlsZWQgZnJvbSBwaHBkaXNrLnouanMgKi8KewoJaWQ6ICdwaHBkaXNrLnonLAoJbmFtZTogJ+mAmueUqCBwaHBEaXNrLnog572R55uY6KeE5YiZJywKCS8vIOinhOWImTog55u05o6l6Lez6L2sIC9maWxlLXh4eCAtPiAvZG93bi14eHgKCS8vICAgICAgIOW5tumakOiXjyBkb3duX2JveDIsIOaYvuekuiBkb3duX2JveAoJCglob3N0OiBbCgkJJ3dwYW4uY2MnLCAneXBhbi5jYycsCgkJJ2F6cGFuLmNvbScsICdneGRpc2suY29tJywgJzJrdWFpLmNvbScsICcxd3AubWUnLCAKCQknNzdwYW4uY2MnLCAndnZwYW4uY29tJywgJ2ZtZGlzay5jb20nLCAnYngwNjM1LmNvbScsCgkJJzEwcGFuLmNjJywgJzFwYW4uY2MnLCAnMTIzd3p3cC5jb20nLCAnd3dwNS5jb20nLAoJCSdmeWRpc2suY29tJwoJXSwKCWhpZGU6IFsKCQkvLyBhenBhbiwgZ3hkaXNrCgkJJy5Eb3ducGFnZWJveCcsCgoJCScudGFsa19zaG93JywgJy5iYW5uZXJfMicsICcud18zMDUnLAoKCQkvLyAya3VhaS5jb20KCQknLmFkJywgJyN2Y29kZScsICcjdHVpJywgJy5kY29kZScsICcjZG93bl9ib3gyJywgJyNkbF90aXBzJywgJy5uYWwnLCAnLnNjYmFyX2hvdF90ZCcsICcjaW5jb2RlJwoJXSwKCXNob3c6IFsKCQkvLyAya3VhaS5jb20KCQknI2Rvd25fYm94JywgJyNkbF9hZGRyJwoJXSwKCW9uU3RhcnQ6IGZ1bmN0aW9uICgpIHsKCQl1bnNhZmVEZWZpbmVGdW5jdGlvbiAoJ2Rvd25fcHJvY2VzcycsIHRGdW5jKTsKCQlILnBocERpc2tBdXRvUmVkaXIgKCk7Cgl9Cn0KIF07CgoJaWYgKEguY29uZmlnLmJVc2VDdXN0b21SdWxlcykgewoJCXRyeSB7CgkJCVtdLnNwbGljZS5hcHBseSAoc2l0ZXMsIFswLCAwXS5jb25jYXQoZXZhbCAoSC5zcHJpbnRmKCdbJXNcbl0nLCBILmNvbmZpZy5zQ3VzdG9tUnVsZSkpKSk7CgkJfSBjYXRjaCAoZSkgewoJCQlILmluZm8gKCfop6PmnpDoh6rlrprkuYnop4TliJnml7blj5HnlJ/plJnor686ICVzJywgZS5tZXNzYWdlKTsKCQl9Cgl9CgoJdmFyIGhhbmRsZVNpdGUgPSAoZnVuY3Rpb24gKCkgewoJCS8vIOaJqeWxleinhOWImeWHveaVsApILnJ1bGUgPSB7CgljaGVja1BhdGg6IGZ1bmN0aW9uIChwYXRoLCBydWxlKSB7CgkJaWYgKHJ1bGUgaW5zdGFuY2VvZiBBcnJheSkgewoJCQlpZiAocnVsZS5sZW5ndGggPT09IDApCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQlmb3IgKHZhciBpID0gcnVsZS5sZW5ndGg7IGktLTsgKSB7CgkJCQlpZiAodGhpcy5jaGVja1BhdGgocGF0aCwgcnVsZVtpXSkpCgkJCQkJcmV0dXJuIHRydWU7CgkJCX0KCgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCXJldHVybiAoCgkJCS8vIEZ1bmN0aW9uCgkJCShydWxlLmNhbGwgJiYgcnVsZShwYXRoKSkKCgkJCS8vIFN0cmluZwoJCQl8fCAodHlwZW9mIHJ1bGUgPT0gJ3N0cmluZycgJiYgSC5iZWdpbldpdGggKHBhdGgsIHJ1bGUpKQoKCQkJLy8gUmVnZXggbWF0Y2gKCQkJfHwgKHJ1bGUgaW5zdGFuY2VvZiBSZWdFeHAgJiYgcnVsZS50ZXN0IChwYXRoKSkKCgkJCS8vIEZhaWxlZCB0byBtYXRjaCBhbnl0aGluZyA6PAoJCQl8fCBmYWxzZQoJCSk7Cgl9LAoJCgljaGVjazogZnVuY3Rpb24gKHNpdGUsIGV2ZSkgewoJCS8vIOWtkOaooeWdlywg5peg5Z+f5ZCN57uR5a6aCgkJaWYgKCFzaXRlLmhvc3QpCgkJCXJldHVybiA7CgoJCWZvciAodmFyIGkgPSA1OyBpLS07ICkgewoJCQlpZiAodHlwZW9mIGV2ZSA9PSAnc3RyaW5nJykgewoJCQkJZXZlID0gc2l0ZVtldmVdOwoJCQl9IGVsc2UgewoJCQkJYnJlYWs7CgkJCX0KCQl9CgoJCWlmICh0eXBlb2YgZXZlID09ICdzdHJpbmcnKSB7CgkJCUguZXJyb3IgKCdSZXBldGl0aXZlICcgKyBldmVudCArICcgaGFuZGxlciAoJyArIGV2ZSArICcpLCBza2lwIC4uJyk7CgkJCWV2ZSA9IG51bGw7CgkJCXJldHVybiA7CgkJfQoJCQoJCS8vIE1ha2UgdGhpcyB0byBhbiBhcnJheS4KCQlpZiAodHlwZW9mIHNpdGUuaG9zdCA9PSAnc3RyaW5nJykKCQkJc2l0ZS5ob3N0ID0gWyBzaXRlLmhvc3QgXTsKCgkJLy8gU2hvdWxkIGhhdmUgYXQgbGVhc3Qgb25lIHNpdGUgc2V0dXAuCgkJaWYgKCFzaXRlLmhvc3QubGVuZ3RoKSB7CgkJCUguZXJyb3IgKCdSVUxFOiBrZXkgYGhvc3RgIGlzIG1pc3NpbmchJyk7CgkJCXJldHVybiA7CgkJfQoJCQoJCQoJCS8vIOajgOafpeWfn+WQjQoJCXZhciBob3N0TWF0Y2g7CgkJaWYgKCFILmNvbnRhaW5zIChzaXRlLmhvc3QsIEgubG93ZXJIb3N0KSkgewoJCQkvLyDmmK/lkKbmo4Dmn6XlrZDln5/lkI0/CgkJCWlmIChzaXRlLm5vU3ViSG9zdCkKCQkJCXJldHVybiA7CgoJCQlob3N0ID0gSC5sb3dlckhvc3Q7CgoJCQl3aGlsZSAoKGhvc3RNYXRjaCA9IGhvc3QubWF0Y2ggKC9eLis/XC4oLispLykpKSB7CgkJCQlpZiAoSC5jb250YWlucyAoc2l0ZS5ob3N0LCBob3N0ID0gaG9zdE1hdGNoWzFdKSkgewoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgoJCQkvLyBObyBtYXRjaGluZyBob3N0IG5hbWUKCQkJaWYgKCFob3N0TWF0Y2gpIHJldHVybjsKCQl9CgkJCgkJLy8g5qOA5p+l6Lev5b6ECgkJaWYgKHNpdGUucGF0aCAmJiAhdGhpcy5jaGVja1BhdGgobG9jYXRpb24ucGF0aG5hbWUsIHNpdGUucGF0aCkpIHsKCQkJcmV0dXJuIDsKCQl9CgkJCgkJcmV0dXJuIHRydWU7Cgl9LAoKCXJ1bjogZnVuY3Rpb24gKHNpdGUsIGV2ZW50KSB7CgkJaWYgKCFzaXRlIHx8ICFldmVudCkKCQkJcmV0dXJuIDsKCQkKCQl2YXIgZXZlID0gc2l0ZVtldmVudF07CgoJCWlmIChzaXRlLl9zdHlsZUFwcGxpZWQpCgkJCS8vIOS/ruatoyBDU1Mg5Y+v6IO96KKr6KaG55uW55qE6ZSZ6K+vCgkJCUguZml4U3R5bGVPcmRlciAoc2l0ZS5zdHlsZUJsb2NrKTsKCgkJaWYgKCFzaXRlLl9zdHlsZUFwcGxpZWQpIHsKCQkJc2l0ZS5fc3R5bGVBcHBsaWVkID0gdHJ1ZTsKCQkJSC5sb2cgKCflupTnlKggWyVzXSDnmoTmoLflvI/ooajigKYnLCBzaXRlLm5hbWUgfHwgJ+aXoOWQjScpOwoKCQkJdmFyIHN0eWxlQmxvY2sgPSBILmluamVjdFN0eWxlICgpOwoJCQlILnN0eWxlQmxvY2sgPSBzdHlsZUJsb2NrOwoKCQkJaWYgKHR5cGVvZiBzaXRlLmhpZGUgPT0gJ3N0cmluZycpCgkJCQlILmZvcmNlSGlkZS5jYWxsICAoc3R5bGVCbG9jaywgc2l0ZS5oaWRlKTsKCQkJZWxzZSBpZiAoc2l0ZS5oaWRlICYmIHNpdGUuaGlkZS5sZW5ndGgpCgkJCQlILmZvcmNlSGlkZS5hcHBseSAoc3R5bGVCbG9jaywgc2l0ZS5oaWRlKTsKCgkJCWlmICh0eXBlb2Ygc2l0ZS5zaG93ID09ICdzdHJpbmcnKQoJCQkJSC5mb3JjZVNob3cuY2FsbCAgKHN0eWxlQmxvY2ssIHNpdGUuc2hvdyk7CgkJCWVsc2UgaWYgKHNpdGUuc2hvdyAmJiBzaXRlLnNob3cubGVuZ3RoKQoJCQkJSC5mb3JjZVNob3cuYXBwbHkgKHN0eWxlQmxvY2ssIHNpdGUuc2hvdyk7CgoJCQkvLyDoh6rlrprkuYkgY3NzIOazqOWFpQoJCQlpZiAodHlwZW9mIHNpdGUuY3NzID09ICdzdHJpbmcnKQoJCQkJSC5pbmplY3RTdHlsZS5jYWxsICAoc3R5bGVCbG9jaywgc2l0ZS5jc3MpOwoJCQllbHNlIGlmIChzaXRlLmNzcyAmJiBzaXRlLmNzcy5sZW5ndGgpCgkJCQlILmluamVjdFN0eWxlLmFwcGx5IChzdHlsZUJsb2NrLCBzaXRlLmNzcyk7CgoJCQkvLyDkuIvovb3mjInpkq4KCQkJaWYgKHNpdGUuZGxfaWNvbikgewoJCQkJaWYgKHNpdGUuZGxfaWNvbi5tYXApIHsKCQkJCQlzaXRlLmRsX2ljb24gPSBzaXRlLmRsX2ljb24uam9pbiAoJzo6YmVmb3JlLCAnKTsKCQkJCX0gZWxzZSBpZiAodHlwZW9mIHNpdGUuZGxfaWNvbiAhPSAnc3RyaW5nJykgewoJCQkJCXNpdGUuZGxfaWNvbiA9IEguZGVmYXVsdERsQ2xhc3M7CgkJCQl9CgoJCQkJSC5pbmplY3RTdHlsZS5jYWxsIChzdHlsZUJsb2NrLCBILnNwcmludGYoLyogUmVzb3VyY2U6IEFBLmRsX2J0bi5jc3MgKi8KSC5leHRyYWN0KGZ1bmN0aW9uICgpIHsgLyoKQGZvbnQtZmFjZSB7Cglmb250LWZhbWlseTogY2NjOwoJc3JjOiB1cmwoaHR0cHM6Ly9jZG4uYm9vdGNzcy5jb20vZm9udC1hd2Vzb21lLzQuMi4wL2ZvbnRzL2ZvbnRhd2Vzb21lLXdlYmZvbnQud29mZikgZm9ybWF0KCd3b2ZmJyk7Cglmb250LXdlaWdodDogbm9ybWFsOwoJZm9udC1zdHlsZTogbm9ybWFsOwp9Cgolczo6YmVmb3JlIHsKCWZvbnQtZmFtaWx5OiBjY2M7Cgljb250ZW50OiAiXGYwMTkiOwoJcGFkZGluZy1yaWdodDogLjVlbTsKfQoKLmp4X2hpZGUgewoJZGlzcGxheTogbm9uZTsKfQoqL30pLCBzaXRlLmRsX2ljb24pKTsKCQkJfQoKCQkJc2l0ZS5zdHlsZUJsb2NrID0gc3R5bGVCbG9jazsKCQl9CgoJCWlmICghZXZlKSByZXR1cm4gOwoJCUguaW5mbyAoJ+aJp+ihjOinhOWImTogJXM8SUQ6ICVzPlvkuovku7Y6ICVzXScsIHNpdGUubmFtZSB8fCAnPOacquefpT4nLCBzaXRlLmlkIHx8ICfmnKrnn6UnLCBldmVudCk7CgoJCXJldHVybiBldmUuY2FsbCAoc2l0ZSk7Cgl9LAoKCS8qKgoJICogZ2V0IHJ1bGUgYnkgSUQKCSAqIEBwYXJhbSAge1N0cmluZ30gaWQgUnVsZSBpZAoJICogQHJldHVybiB7UnVsZX0gICAgICBSdWxlIE9iamVjdAoJICovCglnZXQ6IGZ1bmN0aW9uIChpZCkgewoJCXJldHVybiBzaXRlcy5maWx0ZXIoZnVuY3Rpb24gKHNpdGUpIHsgcmV0dXJuIHNpdGUuaWQgPT0gaWQ7IH0pLnBvcCgpOwoJfSwKCQoJZXhlYzogZnVuY3Rpb24gKGlkLCBldmVudCkgewoJCXJldHVybiB0aGlzLnJ1bih0aGlzLmdldChpZCksIGV2ZW50KTsKCX0KfTsKCnJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHsKCWZvciAodmFyIGkgPSBzaXRlcy5sZW5ndGg7IGktLTsgKSB7CgkJaWYgKEguaXNGcmFtZSAmJiBzaXRlc1tpXS5ub0ZyYW1lKQoJCQljb250aW51ZTsKCQkKCQlpZiAoSC5ydWxlLmNoZWNrKHNpdGVzW2ldLCBldmVudCkgJiYgSC5ydWxlLnJ1bihzaXRlc1tpXSwgZXZlbnQpKQoJCQlyZXR1cm4gdHJ1ZTsKCX0KfTsKCX0pKCk7CgoJdHJ5IHsKCQlHTV9yZWdpc3Rlck1lbnVDb21tYW5kIChILnNwcmludGYoJ+mFjee9riAlc1slc10nLCBILnNjcmlwdE5hbWUsIEgudmVyc2lvbiksIGZ1bmN0aW9uICgpIHsKCQkJR01fb3BlbkluVGFiKCdodHRwczovL2ppeHVubW9lLmdpdGh1Yi5pby9jdXdjbDRjL2NvbmZpZy8nLCBmYWxzZSk7CgkJfSk7CgoJCUgubG9nICgnb25TdGFydCDlh4blpIfpmLbmrrUgOjog5byA5aeLJyk7CgkJaGFuZGxlU2l0ZSAoJ29uU3RhcnQnKTsKCQlILmxvZyAoJ29uU3RhcnQg5YeG5aSH6Zi25q61IDo6IOe7k+adnycpOwoKCQlkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICgnRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHsKCQkJSC5sb2cgKCdvbkJvZHkg6Zi25q61IDo6IOW8gOWniycpOwoJCQloYW5kbGVTaXRlICgnb25Cb2R5Jyk7CgkJCUgubG9nICgnb25Cb2R5IOmYtuautSA6OiDnu5PmnZ8nKTsKCQl9LCBmYWxzZSk7CgoJfSBjYXRjaCAoZSkgewoJCWlmIChlLmlzRXhpdCkgewoJCQlILmxvZy5hcHBseSAoIDAsIFtdLmNvbmNhdC5hcHBseSAoIFsn6ISa5pys6YCA5Ye6LCDplJnor6/kv6Hmga8nXSwgZS5tZXNzYWdlICkgKTsKCQl9IGVsc2UgewoJCQlILmVycm9yICgn6K+35Yqh5b+F5bCG5LiL6L+w6ZSZ6K+v6L+96Liq5Luj56CB5o+Q5Lqk6IezICVzXG5cbiVzJywgSC5yZXBvcnRVcmwsIGUubWVzc2FnZSk7CgkJfQoJfQp9KSAoKTs="},{"name":"Download YouTube Videos as MP4","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":["googlevideo.com","ytimg.com"],"orig_excludes":["http://www.youtube.com/embed/*","https://www.youtube.com/embed/*"],"orig_includes":["http://www.youtube.com/*","https://www.youtube.com/*"],"orig_matches":["http://www.youtube.com/*","https://www.youtube.com/*","http://s.ytimg.com/yts/jsbin/html5player*","https://s.ytimg.com/yts/jsbin/html5player*","http://manifest.googlevideo.com/*","https://manifest.googlevideo.com/*","http://*.googlevideo.com/videoplayback*","https://*.googlevideo.com/videoplayback*","http://*.youtube.com/videoplayback*","https://*.youtube.com/videoplayback*"],"orig_noframes":null,"orig_run_at":"document-end","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"download-youtube-dash-enabled":"s0","download-youtube-script-url":"shttps://s.ytimg.com/yts/jsbin/player-zh_CN-vfl6J9imP/base.js","download-youtube-signature-code":"s0,9,0,-3,0,-3,51,0"},"ts":1475761158388},"enabled":true,"position":5,"file_url":"https://greasyfork.org/scripts/1317-download-youtube-videos-as-mp4/code/Download%20YouTube%20Videos%20as%20MP4.user.js","uuid":"a850a58d-2f71-4114-b763-127ec25c90be","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgRG93bmxvYWQgWW91VHViZSBWaWRlb3MgYXMgTVA0Ci8vIEBkZXNjcmlwdGlvbiBBZGRzIGEgYnV0dG9uIHRoYXQgbGV0cyB5b3UgZG93bmxvYWQgWW91VHViZSB2aWRlb3MuCi8vIEBob21lcGFnZVVSTCBodHRwczovL2dpdGh1Yi5jb20vZ2FudHQvZG93bmxvYWR5b3V0dWJlCi8vIEBhdXRob3IgR2FudHQKLy8gQHZlcnNpb24gMS44LjgKLy8gQGRhdGUgMjAxNi0wOS0wMgovLyBAbmFtZXNwYWNlIGh0dHA6Ly9nb29nbGVzeXN0ZW0uYmxvZ3Nwb3QuY29tCi8vIEBpbmNsdWRlIGh0dHA6Ly93d3cueW91dHViZS5jb20vKgovLyBAaW5jbHVkZSBodHRwczovL3d3dy55b3V0dWJlLmNvbS8qCi8vIEBleGNsdWRlIGh0dHA6Ly93d3cueW91dHViZS5jb20vZW1iZWQvKgovLyBAZXhjbHVkZSBodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBtYXRjaCBodHRwOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoIGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tLyoKLy8gQG1hdGNoIGh0dHA6Ly9zLnl0aW1nLmNvbS95dHMvanNiaW4vaHRtbDVwbGF5ZXIqCi8vIEBtYXRjaCBodHRwczovL3MueXRpbWcuY29tL3l0cy9qc2Jpbi9odG1sNXBsYXllcioKLy8gQG1hdGNoIGh0dHA6Ly9tYW5pZmVzdC5nb29nbGV2aWRlby5jb20vKgovLyBAbWF0Y2ggaHR0cHM6Ly9tYW5pZmVzdC5nb29nbGV2aWRlby5jb20vKgovLyBAbWF0Y2ggaHR0cDovLyouZ29vZ2xldmlkZW8uY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBtYXRjaCBodHRwczovLyouZ29vZ2xldmlkZW8uY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBtYXRjaCBodHRwOi8vKi55b3V0dWJlLmNvbS92aWRlb3BsYXliYWNrKgovLyBAbWF0Y2ggaHR0cHM6Ly8qLnlvdXR1YmUuY29tL3ZpZGVvcGxheWJhY2sqCi8vIEBjb25uZWN0IGdvb2dsZXZpZGVvLmNvbQovLyBAY29ubmVjdCB5dGltZy5jb20KLy8gQGdyYW50IEdNX3htbGh0dHBSZXF1ZXN0Ci8vIEBncmFudCBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgR01fc2V0VmFsdWUKLy8gQHJ1bi1hdCBkb2N1bWVudC1lbmQKLy8gQGxpY2Vuc2UgTUlUIExpY2Vuc2UKLy8gQGljb24gZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFFQUFBQUJBQ0FNQUFBQ2R0NEhzQUFBQUIzUkpUVVVIMndNT0NnSW9HVVlFQVFBQUFBbHdTRmx6QUFBTEVnQUFDeElCMHQxKy9BQUFBQVJuUVUxQkFBQ3hqd3Y4WVFVQUFBR1NVRXhVUmZpL0pPL3Y3OTdlM3NiR3hxMnRyYVdscFpTVWxKeWNuTmJXMW95RWhJUmFXb3c1T1pRaElad1lHS1VRRUtVSUNLMElDSlF4TVl4S1NveHpjNHg3ZTRSQ1FwUVlHS1VBQUswQUFMVUFBTDBBQUswUUVJeHJhNVFwS2EwWUdJeFNVc1lBQUtVaElaUjdlODdPenIwSUNKUlNVcjI5dll4alk2VTVPYVVwS2EwaEliMjF0WndBQUxVSUNPL096dS9HeHFVeE1aU0VoTFVZR08vVzFyMFlHS1ZDUXBRUUVMMHBLZmZlM3ZmVzFweHJhNVE1T2NaQ1F2Zm41ODVDUXIydHJaeDdlOFpTVXM1U1VxMDVPYzVqWTlaalk4NEFBS1dNak01emM5NTdlNjBwS2RhTWpPZWxwYldjbkxXVWxMVkNRc1lZR01ZSUNOYk96cFFJQ01ZaEliVjdlNXhhV3Q2Y25QZnY3OWJHeHQ2bHBlKzl2YzVLU3M2bHBiMHhNYzZFaE02OXZiVXhNYlVoSWIxYVdzNjF0Y1phV3VlY25NWXhNYjFLU3Naalk5NlVsTmExdGQ3VzFyMTdlOWE5dlp3UUVONnRyYjFqWThZUUVOWnJhK2ZPenIxemM4NWFXdWZlM3Q2TWpNWTVPZFphV3Q2MXRkWjdlKy9uNStlOXZjNk1qTVpyYSsvZTN1ZTF0ZGFscGQ3R3hyVXBLYWxMNGFBQUFBQUJkRkpPVXdCQTV0aG1BQUFDeGtsRVFWUjQydVhYLzEvU1FCZ0g4TnVBb0VRMmlqZ2JCaXZKTHpuQkFpVVVLaXlKU2dPVkFrMHRLWkt3NzVtUlJ0Lzd2NE1CWThlempXMzlWczh2OHJxSHovdTFqYnZiaWRDL1hMOEttY3BPcVZUNm5Talhqb29HdzhXZkZkK1FXR2ZFNG9MYnRicisrUGRNT3kwQkRZTGpFai8weGV2ZldJeVZBSTdiL2FJai85V0hzUnJBOFlmOWJxU2V4VmdENExpYzlrV0UvTGdQd1BHZk5mSkhETzRQOEl1cStTMk05UUQ4b1VwK254RUFjRkN0ZmdJQS8xNHgvOUVsQUtEUWJOUUF3TjlWQWlZRUFCeTBPZ3NBV0FuQi9BY0JBdFZXYXdrQWZKNENEMEJRQURaYXZZY1FnSTloM0NDUWpwRDVQY0Vnd0crU3dMUmhJTDB2ejc4U2pBUEVVM2hySE9EZnlYNEk2clVKSVAwRzNvRXhvTndGWHBvQitId1htREVGcEY5SXdLQTVZSytUcDlmTUFkVU9zQzZZQTU1M2dLY21nZFRmQWhWMW9NUXFBRG5kUURtSjBBWkxBc0ZuQ0lWM1ZZREhKTEFqRGtaS2NpQWFGei9sQ2VCSkIxZ2xnWEJyTkxuZEJXTEo5dVpHQUkra2VUQkxBTkw4U25XQXpXUm5pQUMycEcrNmxRRjBoZmpUcUNJQnJFdmpEd2lnZ0ZTTHVJVW9MWTB2RXdBYlVjc25jL0xsbk8wMkhHdkV6K2hYRWVKNVlqKzRMMnZOa3hPSkRTbmxRemxpSXEyc3lucjNlbWJpVUJqbXcwRnlVODNLWDA0T2IrOWFBSy9QcGQ1ZGVabG96NEhGbENIenQzc1gweDJhNkxjdlFiNGFiOHI3aStEVmRxdm5DcS9ENVp6cWRoZkFjcjVCOXdEMFBOd1BFdTBabkx3SzlvUGdOZkNRSjJmaGhoSVRKM0U4QmplVU9YQStRTlFsQmg1eExqZW1WQ2dLanpnek5JSkZqV0Y0eUpvS2hhZmdJV3Q2VkhHbWpnUjBIdk11VGlwUGRXUUo2QUltYkJSU0U4YVkvc0M0ZXI1eEZ4NXZIeUI0WVJScEZXVWYwQUw0YytkSGtIWlJGbzlURGVCOUFhM0xsd2pyOEZsRndCK3dPL3JIbTBWYlBhZTltUGluaS9PNWgvWEd4YXR3Mkk2ZkdIQU91aGlHWlZ4Tzk4bFRkZ3V0UDk0eWFJdlZkcXhaZHB2RllUVDlYOVVmcVFRbFRYbG04d2tBQUFBQVNVVk9SSzVDWUlJPQovLyA9PS9Vc2VyU2NyaXB0PT0KCgooZnVuY3Rpb24gKCkgewogIHZhciBGT1JNQVRfTEFCRUw9eycxOCc6J01QNCAzNjBwJywnMjInOidNUDQgNzIwcCcsJzQzJzonV2ViTSAzNjBwJywnNDQnOidXZWJNIDQ4MHAnLCc0NSc6J1dlYk0gNzIwcCcsJzQ2JzonV2ViTSAxMDgwcCcsJzEzNSc6J01QNCA0ODBwIC0gbm8gYXVkaW8nLCcxMzcnOidNUDQgMTA4MHAgLSBubyBhdWRpbycsJzEzOCc6J01QNCAyMTYwcCAtIG5vIGF1ZGlvJywnMTQwJzonTTRBIDEyOGticHMgLSBhdWRpbycsJzI2NCc6J01QNCAxNDQwcCAtIG5vIGF1ZGlvJywnMjY2JzonTVA0IDIxNjBwIC0gbm8gYXVkaW8nLCcyOTgnOidNUDQgNzIwcDYwIC0gbm8gYXVkaW8nLCcyOTknOidNUDQgMTA4MHA2MCAtIG5vIGF1ZGlvJ307CiAgdmFyIEZPUk1BVF9UWVBFPXsnMTgnOidtcDQnLCcyMic6J21wNCcsJzQzJzond2VibScsJzQ0Jzond2VibScsJzQ1Jzond2VibScsJzQ2Jzond2VibScsJzEzNSc6J21wNCcsJzEzNyc6J21wNCcsJzEzOCc6J21wNCcsJzE0MCc6J200YScsJzI2NCc6J21wNCcsJzI2Nic6J21wNCcsJzI5OCc6J21wNCcsJzI5OSc6J21wNCd9OwogIHZhciBGT1JNQVRfT1JERVI9WycxOCcsJzQzJywnMTM1JywnNDQnLCcyMicsJzI5OCcsJzQ1JywnMTM3JywnMjk5JywnNDYnLCcyNjQnLCcxMzgnLCcyNjYnLCcxNDAnXTsKICB2YXIgRk9STUFUX1JVTEU9eydtcDQnOidhbGwnLCd3ZWJtJzonbm9uZScsJ200YSc6J2FsbCd9OwogIC8vIGFsbD1kaXNwbGF5IGFsbCB2ZXJzaW9ucywgbWF4PW9ubHkgaGlnaGVzdCBxdWFsaXR5IHZlcnNpb24sIG5vbmU9bm8gdmVyc2lvbiAgCiAgLy8gdGhlIGRlZmF1bHQgc2V0dGluZ3Mgc2hvdyBhbGwgTVA0IHZpZGVvcwogIHZhciBTSE9XX0RBU0hfRk9STUFUUz1mYWxzZTsKICB2YXIgQlVUVE9OX1RFWFQ9eydhcic6J9iq2YbYstmK2YQnLCdjcyc6J1N0w6Fobm91dCcsJ2RlJzonSGVydW50ZXJsYWRlbicsJ2VuJzonRG93bmxvYWQnLCdlcyc6J0Rlc2NhcmdhcicsJ2ZyJzonVMOpbMOpY2hhcmdlcicsJ2hpJzon4KSh4KS+4KSJ4KSo4KSy4KWL4KShJywnaHUnOidMZXTDtmx0w6lzJywnaWQnOidVbmR1aCcsJ2l0JzonU2NhcmljYScsJ2phJzon44OA44Km44Oz44Ot44O844OJJywna28nOifrgrTroKTrsJvquLAnLCdwbCc6J1BvYmllcnonLCdwdCc6J0JhaXhhcicsJ3JvJzonRGVzY8SDcmNhyJtpJywncnUnOifQodC60LDRh9Cw0YLRjCcsJ3RyJzonxLBuZGlyJywnemgnOifkuIvovb0nLCd6aC1UVyc6J+S4i+i8iSd9OwogIHZhciBCVVRUT05fVE9PTFRJUD17J2FyJzon2KrZhtiy2YrZhCDZh9iw2Kcg2KfZhNmB2YrYr9mK2YgnLCdjcyc6J1N0w6Fobm91dCB0b3RvIHZpZGVvJywnZGUnOidEaWVzZXMgVmlkZW8gaGVydW50ZXJsYWRlbicsJ2VuJzonRG93bmxvYWQgdGhpcyB2aWRlbycsJ2VzJzonRGVzY2FyZ2FyIGVzdGUgdsOtZGVvJywnZnInOidUw6lsw6ljaGFyZ2VyIGNldHRlIHZpZMOpbycsJ2hpJzon4KS14KWA4KSh4KS/4KSv4KWLIOCkoeCkvuCkieCkqOCksuCli+CkoSDgpJXgpLDgpYfgpIInLCdodSc6J1ZpZGXDsyBsZXTDtmx0w6lzZScsJ2lkJzonVW5kdWggdmlkZW8gaW5pJywnaXQnOidTY2FyaWNhIHF1ZXN0byB2aWRlbycsJ2phJzon44GT44Gu44OT44OH44Kq44KS44OA44Km44Oz44Ot44O844OJ44GZ44KLJywna28nOifsnbQg67mE65SU7Jik66W8IOuCtOugpOuwm+q4sCcsJ3BsJzonUG9iaWVyeiBwbGlrIHdpZGVvJywncHQnOidCYWl4YXIgZXN0ZSB2w61kZW8nLCdybyc6J0Rlc2PEg3JjYcibaSBhY2VzdCB2aWRlb2NsaXAnLCdydSc6J9Ch0LrQsNGH0LDRgtGMINGN0YLQviDQstC40LTQtdC+JywndHInOiAnQnUgdmlkZW95dSBpbmRpcicsJ3poJzon5LiL6L295q2k6KeG6aKRJywnemgtVFcnOifkuIvovInmraTlvbHniYcnfTsKICB2YXIgREVDT0RFX1JVTEU9W107CiAgdmFyIFJBTkRPTT03NDg5MjM1MTc5OyAvLyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTIzNDU2Nzg5MCk7CiAgdmFyIENPTlRBSU5FUl9JRD0nZG93bmxvYWQteW91dHViZS12aWRlbycrUkFORE9NOwogIHZhciBMSVNUSVRFTV9JRD0nZG93bmxvYWQteW91dHViZS12aWRlby1mbXQnK1JBTkRPTTsKICB2YXIgQlVUVE9OX0lEPSdkb3dubG9hZC15b3V0dWJlLXZpZGVvLWJ1dHRvbicrUkFORE9NOwogIHZhciBERUJVR19JRD0nZG93bmxvYWQteW91dHViZS12aWRlby1kZWJ1Zy1pbmZvJzsKICB2YXIgU1RPUkFHRV9VUkw9J2Rvd25sb2FkLXlvdXR1YmUtc2NyaXB0LXVybCc7CiAgdmFyIFNUT1JBR0VfQ09ERT0nZG93bmxvYWQteW91dHViZS1zaWduYXR1cmUtY29kZSc7CiAgdmFyIFNUT1JBR0VfREFTSD0nZG93bmxvYWQteW91dHViZS1kYXNoLWVuYWJsZWQnOwogIHZhciBpc0RlY29kZVJ1bGVVcGRhdGVkPWZhbHNlOyAgCiAgICAKICBzdGFydCgpOwogICAgICAgICAgCmZ1bmN0aW9uIHN0YXJ0KCkgewogIHZhciBwYWdlY29udGFpbmVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWdlLWNvbnRhaW5lcicpOwogIGlmICghcGFnZWNvbnRhaW5lcikgcmV0dXJuOwogIGlmICgvXmh0dHBzPzpcL1wvd3d3XC55b3V0dWJlLmNvbVwvd2F0Y2hcPy8udGVzdCh3aW5kb3cubG9jYXRpb24uaHJlZikpIHJ1bigpOyAgICAgICAKICB2YXIgaXNBamF4PS9jbGFzc1tcd1xzIictPV0rc3BmXC1saW5rLy50ZXN0KHBhZ2Vjb250YWluZXIuaW5uZXJIVE1MKTsKICB2YXIgbG9nb2NvbnRhaW5lcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nby1jb250YWluZXInKTsgIAogIGlmIChsb2dvY29udGFpbmVyICYmICFpc0FqYXgpIHsgLy8gZml4IGZvciBibG9ja2VkIHZpZGVvcwogICAgaXNBamF4PSgnICcrbG9nb2NvbnRhaW5lci5jbGFzc05hbWUrJyAnKS5pbmRleE9mKCcgc3BmLWxpbmsgJyk+PTA7CiAgfQogIHZhciBjb250ZW50PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50Jyk7CiAgaWYgKGlzQWpheCAmJiBjb250ZW50KSB7IC8vIEFqYXggVUkKICAgICAgdmFyIG1vPXdpbmRvdy5NdXRhdGlvbk9ic2VydmVyfHx3aW5kb3cuV2ViS2l0TXV0YXRpb25PYnNlcnZlcjsKICAgICAgaWYodHlwZW9mIG1vIT09J3VuZGVmaW5lZCcpIHsKICAgICAgICB2YXIgb2JzZXJ2ZXI9bmV3IG1vKGZ1bmN0aW9uKG11dGF0aW9ucykgewogICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICBpZihtdXRhdGlvbi5hZGRlZE5vZGVzIT09bnVsbCkgewogICAgICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24uYWRkZWROb2Rlc1tpXS5pZD09J3dhdGNoNy1jb250YWluZXInIHx8CiAgICAgICAgICAgICAgICAgICAgICAgIG11dGF0aW9uLmFkZGVkTm9kZXNbaV0uaWQ9PSd3YXRjaDctbWFpbi1jb250YWluZXInKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgICAgICAgICAgICAgICAgICBydW4oKTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGNvbnRlbnQsIHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9KTsgLy8gb2xkIHZhbHVlOiBwYWdlY29udGFpbmVyCiAgICAgIH0gZWxzZSB7IC8vIE11dGF0aW9uT2JzZXJ2ZXIgZmFsbGJhY2sgZm9yIG9sZCBicm93c2VycwogICAgICAgIHBhZ2Vjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignRE9NTm9kZUluc2VydGVkJywgb25Ob2RlSW5zZXJ0ZWQsIGZhbHNlKTsKICAgICAgfQogIH0gCn0KCmZ1bmN0aW9uIG9uTm9kZUluc2VydGVkKGUpIHsgCiAgICBpZiAoZSAmJiBlLnRhcmdldCAmJiAoZS50YXJnZXQuaWQ9PSd3YXRjaDctY29udGFpbmVyJyB8fCAKICAgICAgICBlLnRhcmdldC5pZD09J3dhdGNoNy1tYWluLWNvbnRhaW5lcicpKSB7IC8vIG9sZCB2YWx1ZTogbW92aWVfcGxheWVyCiAgICAgIHJ1bigpOwogIH0KfQogIApmdW5jdGlvbiBydW4oKSB7CiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKENPTlRBSU5FUl9JRCkpIHJldHVybjsgLy8gY2hlY2sgZG93bmxvYWQgY29udGFpbmVyCiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwJykgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvJykpIHJldHVybjsgLy8gRmVhdGhlciBub3Qgc3VwcG9ydGVkCgogIHZhciB2aWRlb0lELCB2aWRlb0Zvcm1hdHMsIHZpZGVvQWRhcHRGb3JtYXRzLCB2aWRlb01hbmlmZXN0VVJMLCBzY3JpcHRVUkw9bnVsbDsKICB2YXIgaXNTaWduYXR1cmVVcGRhdGluZ1N0YXJ0ZWQ9ZmFsc2U7CiAgdmFyIG9wZXJhVGFibGU9bmV3IEFycmF5KCk7CiAgdmFyIGxhbmd1YWdlPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2xhbmcnKTsKICB2YXIgdGV4dERpcmVjdGlvbj0nbGVmdCc7CiAgaWYgKGRvY3VtZW50LmJvZHkuZ2V0QXR0cmlidXRlKCdkaXInKT09J3J0bCcpIHsKICAgIHRleHREaXJlY3Rpb249J3JpZ2h0JzsKICB9CiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaDctYWN0aW9uLWJ1dHRvbnMnKSkgeyAgLy8gb2xkIFVJCiAgICBmaXhUcmFuc2xhdGlvbnMobGFuZ3VhZ2UsIHRleHREaXJlY3Rpb24pOwogIH0KICAgICAgICAKICAvLyBvYnRhaW4gdmlkZW8gSUQsIGZvcm1hdHMgbWFwICAgCiAgCiAgdmFyIGFyZ3M9bnVsbDsKICB2YXIgdXN3PSh0eXBlb2YgdGhpcy51bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnKT90aGlzLnVuc2FmZVdpbmRvdzp3aW5kb3c7IC8vIEZpcmVmb3gsIE9wZXJhPDE1CiAgaWYgKHVzdy55dHBsYXllciAmJiB1c3cueXRwbGF5ZXIuY29uZmlnICYmIHVzdy55dHBsYXllci5jb25maWcuYXJncykgewogICAgYXJncz11c3cueXRwbGF5ZXIuY29uZmlnLmFyZ3M7CiAgfQogIGlmIChhcmdzKSB7CiAgICB2aWRlb0lEPWFyZ3NbJ3ZpZGVvX2lkJ107CiAgICB2aWRlb0Zvcm1hdHM9YXJnc1sndXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXAnXTsKICAgIHZpZGVvQWRhcHRGb3JtYXRzPWFyZ3NbJ2FkYXB0aXZlX2ZtdHMnXTsKICAgIHZpZGVvTWFuaWZlc3RVUkw9YXJnc1snZGFzaG1wZCddOwogICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogU3RhbmRhcmQgbW9kZS4gdmlkZW9JRCAnKyh2aWRlb0lEP3ZpZGVvSUQ6J25vbmUnKSsnOyAnKTsKICB9CiAgaWYgKHVzdy55dHBsYXllciAmJiB1c3cueXRwbGF5ZXIuY29uZmlnICYmIHVzdy55dHBsYXllci5jb25maWcuYXNzZXRzKSB7CiAgICBzY3JpcHRVUkw9dXN3Lnl0cGxheWVyLmNvbmZpZy5hc3NldHMuanM7CiAgfSAgCiAgCiAgaWYgKHZpZGVvSUQ9PW51bGwpIHsgLy8gdW5zYWZlV2luZG93IHdvcmthcm91bmQgKENocm9tZSwgT3BlcmEgMTUrKQogICAgdmFyIGJ1ZmZlcj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChERUJVR19JRCsnMicpOwogICAgaWYgKGJ1ZmZlcikgewogICAgICB3aGlsZSAoYnVmZmVyLmZpcnN0Q2hpbGQpIHsKICAgICAgICBidWZmZXIucmVtb3ZlQ2hpbGQoYnVmZmVyLmZpcnN0Q2hpbGQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBidWZmZXI9Y3JlYXRlSGlkZGVuRWxlbSgncHJlJywgREVCVUdfSUQrJzInKTsKICAgIH0gICAgCiAgICBpbmplY3RTY3JpcHQgKCdpZih5dHBsYXllciYmeXRwbGF5ZXIuY29uZmlnJiZ5dHBsYXllci5jb25maWcuYXJncyl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIicrREVCVUdfSUQrJzIiKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcJyJ2aWRlb19pZCI6IlwnK3l0cGxheWVyLmNvbmZpZy5hcmdzLnZpZGVvX2lkK1wnIiwgImpzIjoiXCcreXRwbGF5ZXIuY29uZmlnLmFzc2V0cy5qcytcJyIsICJkYXNobXBkIjoiXCcreXRwbGF5ZXIuY29uZmlnLmFyZ3MuZGFzaG1wZCtcJyIsICJ1cmxfZW5jb2RlZF9mbXRfc3RyZWFtX21hcCI6IlwnK3l0cGxheWVyLmNvbmZpZy5hcmdzLnVybF9lbmNvZGVkX2ZtdF9zdHJlYW1fbWFwK1wnIiwgImFkYXB0aXZlX2ZtdHMiOiJcJyt5dHBsYXllci5jb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzK1wnIlwnKSk7fScpOwogICAgdmFyIGNvZGU9YnVmZmVyLmlubmVySFRNTDsKICAgIGlmIChjb2RlKSB7CiAgICAgIHZpZGVvSUQ9ZmluZE1hdGNoKGNvZGUsIC9cInZpZGVvX2lkXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgIHZpZGVvRm9ybWF0cz1maW5kTWF0Y2goY29kZSwgL1widXJsX2VuY29kZWRfZm10X3N0cmVhbV9tYXBcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgdmlkZW9Gb3JtYXRzPXZpZGVvRm9ybWF0cy5yZXBsYWNlKC8mYW1wOy9nLCdcXHUwMDI2Jyk7CiAgICAgIHZpZGVvQWRhcHRGb3JtYXRzPWZpbmRNYXRjaChjb2RlLCAvXCJhZGFwdGl2ZV9mbXRzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgIHZpZGVvQWRhcHRGb3JtYXRzPXZpZGVvQWRhcHRGb3JtYXRzLnJlcGxhY2UoLyZhbXA7L2csJ1xcdTAwMjYnKTsKICAgICAgdmlkZW9NYW5pZmVzdFVSTD1maW5kTWF0Y2goY29kZSwgL1wiZGFzaG1wZFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICBzY3JpcHRVUkw9ZmluZE1hdGNoKGNvZGUsIC9cImpzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICB9CiAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBJbmplY3Rpb24gbW9kZS4gdmlkZW9JRCAnKyh2aWRlb0lEP3ZpZGVvSUQ6J25vbmUnKSsnOyAnKTsKICB9CiAgICAgCiAgaWYgKHZpZGVvSUQ9PW51bGwpIHsgLy8gaWYgYWxsIGVsc2UgZmFpbHMKICAgIHZhciBib2R5Q29udGVudD1kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogICAgaWYgKGJvZHlDb250ZW50IT1udWxsKSB7CiAgICAgIHZpZGVvSUQ9ZmluZE1hdGNoKGJvZHlDb250ZW50LCAvXCJ2aWRlb19pZFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICB2aWRlb0Zvcm1hdHM9ZmluZE1hdGNoKGJvZHlDb250ZW50LCAvXCJ1cmxfZW5jb2RlZF9mbXRfc3RyZWFtX21hcFwiOlxzKlwiKFteXCJdKylcIi8pOwogICAgICB2aWRlb0FkYXB0Rm9ybWF0cz1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImFkYXB0aXZlX2ZtdHNcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgdmlkZW9NYW5pZmVzdFVSTD1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImRhc2htcGRcIjpccypcIihbXlwiXSspXCIvKTsKICAgICAgaWYgKHNjcmlwdFVSTD09bnVsbCkgewogICAgICAgIHNjcmlwdFVSTD1maW5kTWF0Y2goYm9keUNvbnRlbnQsIC9cImpzXCI6XHMqXCIoW15cIl0rKVwiLyk7CiAgICAgICAgaWYgKHNjcmlwdFVSTCkgewogICAgICAgICAgc2NyaXB0VVJMPXNjcmlwdFVSTC5yZXBsYWNlKC9cXC9nLCcnKTsKICAgICAgICB9CiAgICAgIH0gICAgICAKICAgIH0KICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IEJydXRlIG1vZGUuIHZpZGVvSUQgJysodmlkZW9JRD92aWRlb0lEOidub25lJykrJzsgJyk7CiAgfQogIAogIGRlYnVnKCdEWVZBTSAtIEluZm86IHVybCAnK3dpbmRvdy5sb2NhdGlvbi5ocmVmKyc7IHVzZXJhZ2VudCAnK3dpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTsgIAogIAogIGlmICh2aWRlb0lEPT1udWxsIHx8IHZpZGVvRm9ybWF0cz09bnVsbCB8fCB2aWRlb0lELmxlbmd0aD09MCB8fCB2aWRlb0Zvcm1hdHMubGVuZ3RoPT0wKSB7CiAgIGRlYnVnKCdEWVZBTSAtIEVycm9yOiBObyBjb25maWcgaW5mb3JtYXRpb24gZm91bmQuIFlvdVR1YmUgbXVzdCBoYXZlIGNoYW5nZWQgdGhlIGNvZGUuJyk7CiAgIHJldHVybjsKICB9CiAgCiAgLy8gT3BlcmEgMTIgZXh0ZW5zaW9uIG1lc3NhZ2UgaGFuZGxlcgogIGlmICh0eXBlb2Ygd2luZG93Lm9wZXJhICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cub3BlcmEgJiYgdHlwZW9mIG9wZXJhLmV4dGVuc2lvbiAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIG9wZXJhLmV4dGVuc2lvbi5vbm1lc3NhZ2UgPSBmdW5jdGlvbihldmVudCkgewogICAgICB2YXIgaW5kZXg9ZmluZE1hdGNoKGV2ZW50LmRhdGEuYWN0aW9uLCAveGhyXC0oWzAtOV0rKVwtcmVzcG9uc2UvKTsKICAgICAgaWYgKGluZGV4ICYmIG9wZXJhVGFibGVbcGFyc2VJbnQoaW5kZXgsMTApXSkgewogICAgICAgIGluZGV4PXBhcnNlSW50KGluZGV4LDEwKTsKICAgICAgICB2YXIgdHJpZ2dlcj0ob3BlcmFUYWJsZVtpbmRleF0pWydvbmxvYWQnXTsKICAgICAgICBpZiAodHlwZW9mIHRyaWdnZXIgPT09ICdmdW5jdGlvbicgJiYgZXZlbnQuZGF0YS5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICAgIGlmICh0cmlnZ2VyKSB7CiAgICAgICAgICAgICAgdHJpZ2dlcihldmVudC5kYXRhKTsgICAgICAgICAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgICAKICBpZiAoIWlzRGVjb2RlUnVsZVVwZGF0ZWQpIHsKICAgIERFQ09ERV9SVUxFPWdldERlY29kZVJ1bGVzKERFQ09ERV9SVUxFKTsKICAgIGlzRGVjb2RlUnVsZVVwZGF0ZWQ9dHJ1ZTsKICB9CiAgaWYgKHNjcmlwdFVSTCkgewogICAgaWYgKHNjcmlwdFVSTC5pbmRleE9mKCcvLycpPT0wKSB7CiAgICAgIHZhciBwcm90b2NvbD0oZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2w9PSdodHRwOicpPydodHRwOic6J2h0dHBzOic7CiAgICAgIHNjcmlwdFVSTD1wcm90b2NvbCtzY3JpcHRVUkw7CiAgICB9CiAgICBmZXRjaFNpZ25hdHVyZVNjcmlwdChzY3JpcHRVUkwpOwogIH0KICAKICAgLy8gdmlkZW8gdGl0bGUKICAgdmFyIHZpZGVvVGl0bGU9ZG9jdW1lbnQudGl0bGUgfHwgJ3ZpZGVvJzsKICAgdmlkZW9UaXRsZT12aWRlb1RpdGxlLnJlcGxhY2UoL1xzKlwtXHMqWW91VHViZSQvaSwgJycpLnJlcGxhY2UoLycvZywgJ1wnJykucmVwbGFjZSgvXlxzK3xccyskL2csICcnKS5yZXBsYWNlKC9cLiskL2csICcnKTsKICAgdmlkZW9UaXRsZT12aWRlb1RpdGxlLnJlcGxhY2UoL1s6Ilw/XCpdL2csICcnKS5yZXBsYWNlKC9bXHxcXFwvXS9nLCAnXycpOyAvLyBNYWMsIExpbnV4LCBXaW5kb3dzCiAgIGlmICgoKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50IHx8ICcnKS50b0xvd2VyQ2FzZSgpKS5pbmRleE9mKCd3aW5kb3dzJykgPj0gMCkgewogICAgICB2aWRlb1RpdGxlPXZpZGVvVGl0bGUucmVwbGFjZSgvIy9nLCAnJykucmVwbGFjZSgvJi9nLCAnXycpOyAvLyBXaW5kb3dzCiAgIH0gZWxzZSB7CiAgICAgIHZpZGVvVGl0bGU9dmlkZW9UaXRsZS5yZXBsYWNlKC8jL2csICclMjMnKS5yZXBsYWNlKC8mL2csICclMjYnKTsgLy8gIE1hYywgTGludXgKICAgfQogICAgICAgICAgICAgICAgICAgICAgICAKICAvLyBwYXJzZSB0aGUgZm9ybWF0cyBtYXAKICB2YXIgc2VwMT0nJTJDJywgc2VwMj0nJTI2Jywgc2VwMz0nJTNEJzsKICBpZiAodmlkZW9Gb3JtYXRzLmluZGV4T2YoJywnKT4tMSkgeyAKICAgIHNlcDE9JywnOyAKICAgIHNlcDI9KHZpZGVvRm9ybWF0cy5pbmRleE9mKCcmJyk+LTEpPycmJzonXFx1MDAyNic7IAogICAgc2VwMz0nPSc7CiAgfQogIHZhciB2aWRlb1VSTD1uZXcgQXJyYXkoKTsKICB2YXIgdmlkZW9TaWduYXR1cmU9bmV3IEFycmF5KCk7CiAgaWYgKHZpZGVvQWRhcHRGb3JtYXRzKSB7CiAgICB2aWRlb0Zvcm1hdHM9dmlkZW9Gb3JtYXRzK3NlcDErdmlkZW9BZGFwdEZvcm1hdHM7CiAgfQogIHZhciB2aWRlb0Zvcm1hdHNHcm91cD12aWRlb0Zvcm1hdHMuc3BsaXQoc2VwMSk7CiAgZm9yICh2YXIgaT0wO2k8dmlkZW9Gb3JtYXRzR3JvdXAubGVuZ3RoO2krKykgewogICAgdmFyIHZpZGVvRm9ybWF0c0VsZW09dmlkZW9Gb3JtYXRzR3JvdXBbaV0uc3BsaXQoc2VwMik7CiAgICB2YXIgdmlkZW9Gb3JtYXRzUGFpcj1uZXcgQXJyYXkoKTsKICAgIGZvciAodmFyIGo9MDtqPHZpZGVvRm9ybWF0c0VsZW0ubGVuZ3RoO2orKykgewogICAgICB2YXIgcGFpcj12aWRlb0Zvcm1hdHNFbGVtW2pdLnNwbGl0KHNlcDMpOwogICAgICBpZiAocGFpci5sZW5ndGg9PTIpIHsKICAgICAgICB2aWRlb0Zvcm1hdHNQYWlyW3BhaXJbMF1dPXBhaXJbMV07CiAgICAgIH0KICAgIH0KICAgIGlmICh2aWRlb0Zvcm1hdHNQYWlyWyd1cmwnXT09bnVsbCkgY29udGludWU7CiAgICB2YXIgdXJsPXVuZXNjYXBlKHVuZXNjYXBlKHZpZGVvRm9ybWF0c1BhaXJbJ3VybCddKSkucmVwbGFjZSgvXFxcLy9nLCcvJykucmVwbGFjZSgvXFx1MDAyNi9nLCcmJyk7CiAgICBpZiAodmlkZW9Gb3JtYXRzUGFpclsnaXRhZyddPT1udWxsKSBjb250aW51ZTsKICAgIHZhciBpdGFnPXZpZGVvRm9ybWF0c1BhaXJbJ2l0YWcnXTsKICAgIHZhciBzaWc9dmlkZW9Gb3JtYXRzUGFpclsnc2lnJ118fHZpZGVvRm9ybWF0c1BhaXJbJ3NpZ25hdHVyZSddOwogICAgaWYgKHNpZykgewogICAgICB1cmw9dXJsKycmc2lnbmF0dXJlPScrc2lnOwogICAgICB2aWRlb1NpZ25hdHVyZVtpdGFnXT1udWxsOwogICAgfSBlbHNlIGlmICh2aWRlb0Zvcm1hdHNQYWlyWydzJ10pIHsKICAgICAgdXJsPXVybCsnJnNpZ25hdHVyZT0nK2RlY3J5cHRTaWduYXR1cmUodmlkZW9Gb3JtYXRzUGFpclsncyddKTsKICAgICAgdmlkZW9TaWduYXR1cmVbaXRhZ109dmlkZW9Gb3JtYXRzUGFpclsncyddOwogICAgfQogICAgaWYgKHVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoJ3JhdGVieXBhc3MnKT09LTEpIHsgLy8gc3BlZWQgdXAgZG93bmxvYWQgZm9yIGRhc2gKICAgICAgdXJsPXVybCsnJnJhdGVieXBhc3M9eWVzJzsKICAgIH0KICAgIGlmICh1cmwudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdodHRwJyk9PTApIHsgLy8gdmFsaWRhdGUgVVJMCiAgICAgIHZpZGVvVVJMW2l0YWddPXVybCsnJnRpdGxlPScrdmlkZW9UaXRsZTsKICAgIH0KICB9CiAgICAKICB2YXIgc2hvd0Zvcm1hdD1uZXcgQXJyYXkoKTsKICBmb3IgKHZhciBjYXRlZ29yeSBpbiBGT1JNQVRfUlVMRSkgewogICAgdmFyIHJ1bGU9Rk9STUFUX1JVTEVbY2F0ZWdvcnldOwogICAgZm9yICh2YXIgaW5kZXggaW4gRk9STUFUX1RZUEUpewogICAgICBpZiAoRk9STUFUX1RZUEVbaW5kZXhdPT1jYXRlZ29yeSkgewogICAgICAgIHNob3dGb3JtYXRbaW5kZXhdPShydWxlPT0nYWxsJyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChydWxlPT0nbWF4JykgewogICAgICBmb3IgKHZhciBpPUZPUk1BVF9PUkRFUi5sZW5ndGgtMTtpPj0wO2ktLSkgewogICAgICAgIHZhciBmb3JtYXQ9Rk9STUFUX09SREVSW2ldOwogICAgICAgIGlmIChGT1JNQVRfVFlQRVtmb3JtYXRdPT1jYXRlZ29yeSAmJiB2aWRlb1VSTFtmb3JtYXRdIT11bmRlZmluZWQpIHsKICAgICAgICAgIHNob3dGb3JtYXRbZm9ybWF0XT10cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIAogIHZhciBkYXNoUHJlZj1nZXRQcmVmKFNUT1JBR0VfREFTSCk7CiAgaWYgKGRhc2hQcmVmPT0nMScpIHsKICAgIFNIT1dfREFTSF9GT1JNQVRTPXRydWU7CiAgfSBlbHNlIGlmIChkYXNoUHJlZiE9JzAnKSB7CiAgICBzZXRQcmVmKFNUT1JBR0VfREFTSCwnMCcpOwogIH0KICAKICB2YXIgZG93bmxvYWRDb2RlTGlzdD1bXTsKICBmb3IgKHZhciBpPTA7aTxGT1JNQVRfT1JERVIubGVuZ3RoO2krKykgewogICAgdmFyIGZvcm1hdD1GT1JNQVRfT1JERVJbaV07CiAgICBpZiAoZm9ybWF0PT0nMzcnICYmIHZpZGVvVVJMW2Zvcm1hdF09PXVuZGVmaW5lZCkgeyAvLyBoYWNrIGZvciBkYXNoIDEwODBwCiAgICAgIGlmICh2aWRlb1VSTFsnMTM3J10pIHsKICAgICAgIGZvcm1hdD0nMTM3JzsKICAgICAgfQogICAgICBzaG93Rm9ybWF0W2Zvcm1hdF09c2hvd0Zvcm1hdFsnMzcnXTsKICAgIH0gZWxzZSBpZiAoZm9ybWF0PT0nMzgnICYmIHZpZGVvVVJMW2Zvcm1hdF09PXVuZGVmaW5lZCkgeyAvLyBoYWNrIGZvciBkYXNoIDRLCiAgICAgIGlmICh2aWRlb1VSTFsnMTM4J10gJiYgIXZpZGVvVVJMWycyNjYnXSkgewogICAgICAgZm9ybWF0PScxMzgnOwogICAgICB9CiAgICAgIHNob3dGb3JtYXRbZm9ybWF0XT1zaG93Rm9ybWF0WyczOCddOwogICAgfSAgICAKICAgIGlmICghU0hPV19EQVNIX0ZPUk1BVFMgJiYgZm9ybWF0Lmxlbmd0aD4yKSBjb250aW51ZTsKICAgIGlmICh2aWRlb1VSTFtmb3JtYXRdIT11bmRlZmluZWQgJiYgRk9STUFUX0xBQkVMW2Zvcm1hdF0hPXVuZGVmaW5lZCAmJiBzaG93Rm9ybWF0W2Zvcm1hdF0pIHsKICAgICAgZG93bmxvYWRDb2RlTGlzdC5wdXNoKHt1cmw6dmlkZW9VUkxbZm9ybWF0XSxzaWc6dmlkZW9TaWduYXR1cmVbZm9ybWF0XSxmb3JtYXQ6Zm9ybWF0LGxhYmVsOkZPUk1BVF9MQUJFTFtmb3JtYXRdfSk7CiAgICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IGl0YWcnK2Zvcm1hdCsnIHVybDonK3ZpZGVvVVJMW2Zvcm1hdF0pOwogICAgfQogIH0gIAogIAogIGlmIChkb3dubG9hZENvZGVMaXN0Lmxlbmd0aD09MCkgewogICAgZGVidWcoJ0RZVkFNIC0gRXJyb3I6IE5vIGRvd25sb2FkIFVSTCBmb3VuZC4gUHJvYmFibHkgWW91VHViZSB1c2VzIGVuY3J5cHRlZCBzdHJlYW1zLicpOwogICAgcmV0dXJuOyAvLyBubyBmb3JtYXQKICB9IAogICAgCiAgLy8gZmluZCBwYXJlbnQgY29udGFpbmVyCiAgdmFyIG5ld1dhdGNoUGFnZT1mYWxzZTsKICB2YXIgcGFyZW50RWxlbWVudD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2F0Y2g3LWFjdGlvbi1idXR0b25zJyk7CiAgaWYgKHBhcmVudEVsZW1lbnQ9PW51bGwpIHsKICAgIHBhcmVudEVsZW1lbnQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dhdGNoOC1zZWNvbmRhcnktYWN0aW9ucycpOwogICAgaWYgKHBhcmVudEVsZW1lbnQ9PW51bGwpIHsKICAgICAgZGVidWcoJ0RZVkFNIEVycm9yIC0gTm8gY29udGFpbmVyIGZvciBhZGRpbmcgdGhlIGRvd25sb2FkIGJ1dHRvbi4gWW91VHViZSBtdXN0IGhhdmUgY2hhbmdlZCB0aGUgY29kZS4nKTsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgbmV3V2F0Y2hQYWdlPXRydWU7CiAgICB9CiAgfQogIAogIC8vIGdldCBidXR0b24gbGFiZWxzCiAgdmFyIGJ1dHRvblRleHQ9KEJVVFRPTl9URVhUW2xhbmd1YWdlXSk/QlVUVE9OX1RFWFRbbGFuZ3VhZ2VdOkJVVFRPTl9URVhUWydlbiddOwogIHZhciBidXR0b25MYWJlbD0oQlVUVE9OX1RPT0xUSVBbbGFuZ3VhZ2VdKT9CVVRUT05fVE9PTFRJUFtsYW5ndWFnZV06QlVUVE9OX1RPT0xUSVBbJ2VuJ107CiAgICAKICAvLyBnZW5lcmF0ZSBkb3dubG9hZCBjb2RlIGZvciByZWd1bGFyIGludGVyZmFjZQogIHZhciBtYWluU3Bhbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CgogIGlmIChuZXdXYXRjaFBhZ2UpIHsKICAgIHZhciBzcGFuSWNvbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICBzcGFuSWNvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24taWNvbi13cmFwcGVyJyk7CiAgICB2YXIgaW1hZ2VJY29uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaW1hZ2VJY29uLnNldEF0dHJpYnV0ZSgnc3JjJywgJy8vcy55dGltZy5jb20veXQvaW1nL3BpeGVsLXZmbDN6NVdmVy5naWYnKTsKICAgIGltYWdlSWNvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24taWNvbicpOwogICAgaW1hZ2VJY29uLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnd2lkdGg6MjBweDtoZWlnaHQ6MjBweDtiYWNrZ3JvdW5kLXNpemU6MjBweCAyMHB4O2JhY2tncm91bmQtcmVwZWF0Om5vLXJlcGVhdDtiYWNrZ3JvdW5kLWltYWdlOiB1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBQkcwbEVRVlJZUisyVzBRM0NNQXhFMndrWUFkaUVFV0FEbUl4dUFDTXdDbXpBQnBDVEVtUlNPN1lUUVgrQ2hFQ1Y0M3QybkY3R1llSFB1TEQrMEFLd0MvRG5XTUFwL041cWlta0J1QWZCZFJURi8rMi9BVjZaWUZVeFZZdWljQWZvSGVnZDZCM29IZmhaQitCeUYrSnlWOEZrckFCNzRwcUgzRFU1TDNpR29CVVJoZFZPRElRRjRFakVrV0xtbWhZQUxPUWdOSUJjSEhrZTRidWh4WEFBYUZuYUFocWJRNVFBT0hIa3doWjhiYWxreDFJQ0NpRUJXTlorQ2l2ZEI3UkVISUMyWmpaSzJvV2tsRERkQjFOU2RDZC9KczJQcVFNcFNJS1lWY004a0U2UUN3REJOUkNxT0JKclcwQ0w4a0NZeEwwQTFrNll4V3NBTkFpWGVDMkFCT0VXYndIQVdyd3hwemdrbUEvSnRJcW54VE9FbG1Qbmpsa2M0QTNGeWtBaEE0MkF4d0FBQUFCSlJVNUVya0pnZ2c9PSk7Jyk7CiAgICBzcGFuSWNvbi5hcHBlbmRDaGlsZChpbWFnZUljb24pOwogICAgbWFpblNwYW4uYXBwZW5kQ2hpbGQoc3Bhbkljb24pOwogIH0KCiAgdmFyIHNwYW5CdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIHNwYW5CdXR0b24uc2V0QXR0cmlidXRlKCdjbGFzcycsICd5dC11aXgtYnV0dG9uLWNvbnRlbnQnKTsKICBzcGFuQnV0dG9uLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGJ1dHRvblRleHQrJyAnKSk7CiAgbWFpblNwYW4uYXBwZW5kQ2hpbGQoc3BhbkJ1dHRvbik7CiAgCiAgaWYgKCFuZXdXYXRjaFBhZ2UpIHsgLy8gb2xkIFVJCiAgICB2YXIgaW1nQnV0dG9uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgaW1nQnV0dG9uLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbi1hcnJvdycpOwogICAgaW1nQnV0dG9uLnNldEF0dHJpYnV0ZSgnc3JjJywgJy8vcy55dGltZy5jb20veXQvaW1nL3BpeGVsLXZmbDN6NVdmVy5naWYnKTsKICAgIG1haW5TcGFuLmFwcGVuZENoaWxkKGltZ0J1dHRvbik7CiAgfQoKICB2YXIgbGlzdEl0ZW1zPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29sJyk7CiAgbGlzdEl0ZW1zLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnZGlzcGxheTpub25lOycpOwogIGxpc3RJdGVtcy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24tbWVudScpOwogIGZvciAodmFyIGk9MDtpPGRvd25sb2FkQ29kZUxpc3QubGVuZ3RoO2krKykgewogICAgdmFyIGxpc3RJdGVtPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICB2YXIgbGlzdExpbms9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgbGlzdExpbmsuc2V0QXR0cmlidXRlKCdzdHlsZScsICd0ZXh0LWRlY29yYXRpb246bm9uZTsnKTsKICAgIGxpc3RMaW5rLnNldEF0dHJpYnV0ZSgnaHJlZicsIGRvd25sb2FkQ29kZUxpc3RbaV0udXJsKTsKICAgIGxpc3RMaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCB2aWRlb1RpdGxlKycuJytGT1JNQVRfVFlQRVtkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdF0pOwogICAgdmFyIGxpc3RCdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgbGlzdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3l0LXVpeC1idXR0b24tbWVudS1pdGVtJyk7CiAgICBsaXN0QnV0dG9uLnNldEF0dHJpYnV0ZSgnbG9vcCcsIGkrJycpOwogICAgbGlzdEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2lkJywgTElTVElURU1fSUQrZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgbGlzdEJ1dHRvbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkb3dubG9hZENvZGVMaXN0W2ldLmxhYmVsKSk7CiAgICBsaXN0TGluay5hcHBlbmRDaGlsZChsaXN0QnV0dG9uKTsKICAgIGxpc3RJdGVtLmFwcGVuZENoaWxkKGxpc3RMaW5rKTsKICAgIGxpc3RJdGVtcy5hcHBlbmRDaGlsZChsaXN0SXRlbSk7CiAgfQogIG1haW5TcGFuLmFwcGVuZENoaWxkKGxpc3RJdGVtcyk7CiAgdmFyIGJ1dHRvbkVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgQlVUVE9OX0lEKTsKICBpZiAobmV3V2F0Y2hQYWdlKSB7CiAgICBidXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbiAgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1vcGFjaXR5IHl0LXVpeC10b29sdGlwJyk7CiAgfSBlbHNlIHsgLy8gb2xkIFVJCiAgICBidXR0b25FbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAneXQtdWl4LWJ1dHRvbiB5dC11aXgtdG9vbHRpcCB5dC11aXgtYnV0dG9uLWVtcHR5IHl0LXVpeC1idXR0b24tdGV4dCcpOwogICAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ21hcmdpbi10b3A6NHB4OyBtYXJnaW4tbGVmdDonKygodGV4dERpcmVjdGlvbj09J2xlZnQnKT81OjEwKSsncHg7Jyk7CiAgfQogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXRvb2x0aXAtdGV4dCcsIGJ1dHRvbkxhYmVsKTsgIAogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2J1dHRvbicpOwogIGJ1dHRvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpOwogIGJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpe3JldHVybiBmYWxzZTt9LCBmYWxzZSk7CiAgYnV0dG9uRWxlbWVudC5hcHBlbmRDaGlsZChtYWluU3Bhbik7CiAgdmFyIGNvbnRhaW5lclNwYW49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogIGNvbnRhaW5lclNwYW4uc2V0QXR0cmlidXRlKCdpZCcsIENPTlRBSU5FUl9JRCk7CiAgY29udGFpbmVyU3Bhbi5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICcpKTsKICBjb250YWluZXJTcGFuLmFwcGVuZENoaWxkKGJ1dHRvbkVsZW1lbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogIC8vIGFkZCB0aGUgYnV0dG9uCiAgaWYgKCFuZXdXYXRjaFBhZ2UpIHsgLy8gd2F0Y2g3CiAgICBwYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKGNvbnRhaW5lclNwYW4pOwogIH0gZWxzZSB7IC8vIHdhdGNoOAogICAgcGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoY29udGFpbmVyU3BhbiwgcGFyZW50RWxlbWVudC5maXJzdENoaWxkKTsKICB9CiAgICAKICAvLyBSRVBMQUNFV0lUSCBpZiAoIWlzU2lnbmF0dXJlVXBkYXRpbmdTdGFydGVkKSB7CiAgICBmb3IgKHZhciBpPTA7aTxkb3dubG9hZENvZGVMaXN0Lmxlbmd0aDtpKyspIHsgCiAgICAgIGFkZEZpbGVTaXplKGRvd25sb2FkQ29kZUxpc3RbaV0udXJsLCBkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdCk7CiAgICB9CiAgLy8gfSAKICAKICBpZiAodHlwZW9mIEdNX2Rvd25sb2FkICE9PSAndW5kZWZpbmVkJykgewogICAgZm9yICh2YXIgaT0wO2k8ZG93bmxvYWRDb2RlTGlzdC5sZW5ndGg7aSsrKSB7CiAgICAgIHZhciBkb3dubG9hZEZNVD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChMSVNUSVRFTV9JRCtkb3dubG9hZENvZGVMaXN0W2ldLmZvcm1hdCk7CiAgICAgIHZhciB1cmw9KGRvd25sb2FkQ29kZUxpc3RbaV0udXJsKS50b0xvd2VyQ2FzZSgpOwogICAgICBpZiAodXJsLmluZGV4T2YoJ2NsZW49Jyk+MCAmJiB1cmwuaW5kZXhPZignZHVyPScpPjAgJiYgdXJsLmluZGV4T2YoJ2dpcj0nKT4wCiAgICAgICAgICAmJiB1cmwuaW5kZXhPZignbG10PScpPjApIHsKICAgICAgICBkb3dubG9hZEZNVC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGRvd25sb2FkVmlkZW9OYXRpdmVseSwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgfQogIAogIGFkZEZyb21NYW5pZmVzdCgpOwogIAogIGZ1bmN0aW9uIGRvd25sb2FkVmlkZW9OYXRpdmVseShlKSB7CiAgICB2YXIgZWxlbT1lLmN1cnJlbnRUYXJnZXQ7CiAgICBlLnJldHVyblZhbHVlPWZhbHNlOyAgICAKICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIH0KICAgIHZhciBsb29wPWVsZW0uZ2V0QXR0cmlidXRlKCdsb29wJyk7CiAgICBpZiAobG9vcCkgewogICAgICBHTV9kb3dubG9hZChkb3dubG9hZENvZGVMaXN0W2xvb3BdLnVybCwgdmlkZW9UaXRsZSsnLicrRk9STUFUX1RZUEVbZG93bmxvYWRDb2RlTGlzdFtsb29wXS5mb3JtYXRdKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgCiAgZnVuY3Rpb24gYWRkRnJvbU1hbmlmZXN0KCkgeyAvLyBhZGQgRGFzaCBVUkxzIGZyb20gbWFuaWZlc3QgZmlsZQogICAgdmFyIGZvcm1hdHM9WycxMzcnLCAnMTM4JywgJzE0MCddOyAvLyAxMzc9MTA4MHAsIDEzOD00aywgMTQwPW00YQogICAgdmFyIGlzTmVjZXNzYXJ5PXRydWU7CiAgICBmb3IgKHZhciBpPTA7aTxmb3JtYXRzLmxlbmd0aDtpKyspIHsKICAgICAgaWYgKHZpZGVvVVJMW2Zvcm1hdHNbaV1dKSB7CiAgICAgICAgaXNOZWNlc3Nhcnk9ZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICh2aWRlb01hbmlmZXN0VVJMICYmIFNIT1dfREFTSF9GT1JNQVRTICYmIGlzTmVjZXNzYXJ5KSB7CiAgICAgIHZhciBtYXRjaFNpZz1maW5kTWF0Y2godmlkZW9NYW5pZmVzdFVSTCwgL1wvc1wvKFthLXpBLVowLTlcLl0rKVwvL2kpOwogICAgICBpZiAobWF0Y2hTaWcpIHsKICAgICAgICB2YXIgZGVjcnlwdGVkU2lnPWRlY3J5cHRTaWduYXR1cmUobWF0Y2hTaWcpOwogICAgICAgIGlmIChkZWNyeXB0ZWRTaWcpIHsKICAgICAgICAgIHZpZGVvTWFuaWZlc3RVUkw9dmlkZW9NYW5pZmVzdFVSTC5yZXBsYWNlKCcvcy8nK21hdGNoU2lnKycvJywnL3NpZ25hdHVyZS8nK2RlY3J5cHRlZFNpZysnLycpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodmlkZW9NYW5pZmVzdFVSTC5pbmRleE9mKCcvLycpPT0wKSB7CiAgICAgICAgdmFyIHByb3RvY29sPShkb2N1bWVudC5sb2NhdGlvbi5wcm90b2NvbD09J2h0dHA6Jyk/J2h0dHA6JzonaHR0cHM6JzsKICAgICAgICB2aWRlb01hbmlmZXN0VVJMPXByb3RvY29sK3ZpZGVvTWFuaWZlc3RVUkw7CiAgICAgIH0KICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogbWFuaWZlc3RVUkwgJyt2aWRlb01hbmlmZXN0VVJMKTsKICAgICAgY3Jvc3NYbWxIdHRwUmVxdWVzdCh7CiAgICAgICAgICBtZXRob2Q6J0dFVCcsCiAgICAgICAgICB1cmw6dmlkZW9NYW5pZmVzdFVSTCwgLy8gY2hlY2sgaWYgVVJMIGV4aXN0cwogICAgICAgICAgb25sb2FkOmZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWFkeVN0YXRlID09PSA0ICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwICYmIHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkgewogICAgICAgICAgICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IG1hbmllc3RGaWxlQ29udGVudHMgJytyZXNwb25zZS5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgIHZhciBsYXN0Rm9ybWF0RnJvbUxpc3Q9ZG93bmxvYWRDb2RlTGlzdFtkb3dubG9hZENvZGVMaXN0Lmxlbmd0aC0xXS5mb3JtYXQ7CiAgICAgICAgICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogbGFzdGZvcm1hdDogJytsYXN0Rm9ybWF0RnJvbUxpc3QpOwogICAgICAgICAgICAgIGZvciAodmFyIGk9MDtpPGZvcm1hdHMubGVuZ3RoO2krKykgewogICAgICAgICAgICAgICAgaz1mb3JtYXRzW2ldOwogICAgICAgICAgICAgICAgaWYgKHZpZGVvVVJMW2tdIHx8IHNob3dGb3JtYXRba109PWZhbHNlKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIHZhciByZWdleHAgPSBuZXcgUmVnRXhwKCc8QmFzZVVSTD4oaHR0cFtePF0raXRhZ1xcLycraysnW148XSspPFxcL0Jhc2VVUkw+JywnaScpOwogICAgICAgICAgICAgICAgdmFyIG1hdGNoVVJMPWZpbmRNYXRjaChyZXNwb25zZS5yZXNwb25zZVRleHQsIHJlZ2V4cCk7CiAgICAgICAgICAgICAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBtYXRjaFVSTCBpdGFnPSAnK2srJyB1cmw9ICcrbWF0Y2hVUkwpOwogICAgICAgICAgICAgICAgaWYgKCFtYXRjaFVSTCkgY29udGludWU7CiAgICAgICAgICAgICAgICBtYXRjaFVSTD1tYXRjaFVSTC5yZXBsYWNlKC8mYW1wXDsvZywnJicpOwogICAgICAgICAgICAgICAgLy8gLi4uCiAgICAgICAgICAgICAgICBkb3dubG9hZENvZGVMaXN0LnB1c2goCiAgICAgICAgICAgICAgICAgIHt1cmw6bWF0Y2hVUkwsc2lnOnZpZGVvU2lnbmF0dXJlW2tdLGZvcm1hdDprLGxhYmVsOkZPUk1BVF9MQUJFTFtrXX0pOwogICAgICAgICAgICAgICAgdmFyIGRvd25sb2FkRk1UPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKExJU1RJVEVNX0lEK2xhc3RGb3JtYXRGcm9tTGlzdCk7CiAgICAgICAgICAgICAgICB2YXIgY2xvbmU9ZG93bmxvYWRGTVQucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgICAgICAgIGNsb25lLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoJ2lkJywgTElTVElURU1fSUQrayk7CiAgICAgICAgICAgICAgICBjbG9uZS5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSgnaHJlZicsIG1hdGNoVVJMKTsKICAgICAgICAgICAgICAgIGRvd25sb2FkRk1ULnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGNsb25lKTsKICAgICAgICAgICAgICAgIGRvd25sb2FkRk1UPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKExJU1RJVEVNX0lEK2spOwogICAgICAgICAgICAgICAgZG93bmxvYWRGTVQuZmlyc3RDaGlsZC5ub2RlVmFsdWU9Rk9STUFUX0xBQkVMW2tdOwogICAgICAgICAgICAgICAgYWRkRmlsZVNpemUobWF0Y2hVUkwsIGspOwogICAgICAgICAgICAgICAgbGFzdEZvcm1hdEZyb21MaXN0PWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IAogICAgICAgIH0pOwogICAgfSAgCiAgfQogIAogIGZ1bmN0aW9uIGluamVjdFN0eWxlKGNvZGUpIHsKICAgIHZhciBzdHlsZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwogICAgc3R5bGUudHlwZT0ndGV4dC9jc3MnOwogICAgc3R5bGUuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY29kZSkpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXS5hcHBlbmRDaGlsZChzdHlsZSk7CiAgfQogIAogIGZ1bmN0aW9uIGluamVjdFNjcmlwdChjb2RlKSB7CiAgICB2YXIgc2NyaXB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgc2NyaXB0LnR5cGU9J2FwcGxpY2F0aW9uL2phdmFzY3JpcHQnOwogICAgc2NyaXB0LnRleHRDb250ZW50PWNvZGU7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcmlwdCk7CiAgfSAgICAKICAKICBmdW5jdGlvbiBkZWJ1ZyhzdHIpIHsKICAgIHZhciBkZWJ1Z0VsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoREVCVUdfSUQpOwogICAgaWYgKCFkZWJ1Z0VsZW0pIHsKICAgICAgZGVidWdFbGVtPWNyZWF0ZUhpZGRlbkVsZW0oJ2RpdicsIERFQlVHX0lEKTsKICAgIH0KICAgIGRlYnVnRWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzdHIrJyAnKSk7CiAgfQogIAogIGZ1bmN0aW9uIGNyZWF0ZUhpZGRlbkVsZW0odGFnLCBpZCkgewogICAgdmFyIGVsZW09ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOwogICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpOwogICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgJ2Rpc3BsYXk6bm9uZTsnKTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbSk7CiAgICByZXR1cm4gZWxlbTsKICB9CiAgCiAgZnVuY3Rpb24gZml4VHJhbnNsYXRpb25zKGxhbmd1YWdlLCB0ZXh0RGlyZWN0aW9uKSB7ICAKICAgIGlmICgvXmFmfGJnfGJufGNhfGNzfGRlfGVsfGVzfGV0fGV1fGZhfGZpfGZpbHxmcnxnbHxoaXxocnxodXxpZHxpdHxpd3xrbnxsdnxsdHxtbHxtcnxtc3xubHxwbHxyb3xydXxzbHxza3xzcnxzd3x0YXx0ZXx0aHx1a3x1cnx2aXx6dSQvLnRlc3QobGFuZ3VhZ2UpKSB7IC8vIGZpeCBpbnRlcm5hdGlvbmFsIFVJCiAgICAgIHZhciBsaWtlQnV0dG9uPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3YXRjaC1saWtlJyk7CiAgICAgIGlmIChsaWtlQnV0dG9uKSB7CiAgICAgICAgdmFyIHNwYW5FbGVtZW50cz1saWtlQnV0dG9uLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3l0LXVpeC1idXR0b24tY29udGVudCcpOwogICAgICAgIGlmIChzcGFuRWxlbWVudHMpIHsKICAgICAgICAgIHNwYW5FbGVtZW50c1swXS5zdHlsZS5kaXNwbGF5PSdub25lJzsgLy8gaGlkZSBsaWtlIHRleHQKICAgICAgICB9CiAgICAgIH0KICAgICAgdmFyIG1hcmdpblBpeGVscz0xMDsKICAgICAgaWYgKC9eYmd8Y2F8Y3N8ZWx8ZXV8aHJ8aXR8bWx8bXN8cGx8c2x8c3d8dGUkLy50ZXN0KGxhbmd1YWdlKSkgewogICAgICAgIG1hcmdpblBpeGVscz0xOwogICAgICB9CiAgICAgIGluamVjdFN0eWxlKCcjd2F0Y2g3LXNlY29uZGFyeS1hY3Rpb25zIC55dC11aXgtYnV0dG9ue21hcmdpbi0nK3RleHREaXJlY3Rpb24rJzonK21hcmdpblBpeGVscysncHghaW1wb3J0YW50fScpOwogICAgfQogIH0KICAKICBmdW5jdGlvbiBmaW5kTWF0Y2godGV4dCwgcmVnZXhwKSB7CiAgICB2YXIgbWF0Y2hlcz10ZXh0Lm1hdGNoKHJlZ2V4cCk7CiAgICByZXR1cm4gKG1hdGNoZXMpP21hdGNoZXNbMV06bnVsbDsKICB9CiAgCiAgZnVuY3Rpb24gaXNTdHJpbmcocykgewogICAgcmV0dXJuICh0eXBlb2Ygcz09PSdzdHJpbmcnIHx8IHMgaW5zdGFuY2VvZiBTdHJpbmcpOwogIH0KICAgIAogIGZ1bmN0aW9uIGlzSW50ZWdlcihuKSB7CiAgICByZXR1cm4gKHR5cGVvZiBuPT09J251bWJlcicgJiYgbiUxPT0wKTsKICB9CiAgCiAgZnVuY3Rpb24gZ2V0UHJlZihuYW1lKSB7IC8vIGNyb3NzLWJyb3dzZXIgR01fZ2V0VmFsdWUKICAgIHZhciBhPScnLCBiPScnOwogICAgdHJ5IHthPXR5cGVvZiBHTV9nZXRWYWx1ZS50b1N0cmluZzsgYj1HTV9nZXRWYWx1ZS50b1N0cmluZygpfSBjYXRjaChlKXt9ICAgIAogICAgaWYgKHR5cGVvZiBHTV9nZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiAKICAgIChhID09PSAndW5kZWZpbmVkJyB8fCBiLmluZGV4T2YoJ25vdCBzdXBwb3J0ZWQnKSA9PT0gLTEpKSB7CiAgICAgIHJldHVybiBHTV9nZXRWYWx1ZShuYW1lLCBudWxsKTsgLy8gR3JlYXNlbW9ua2V5LCBUYW1wZXJtb25rZXksIEZpcmVmb3ggZXh0ZW5zaW9uCiAgICB9IGVsc2UgewogICAgICAgIHZhciBscz1udWxsOwogICAgICAgIHRyeSB7bHM9d2luZG93LmxvY2FsU3RvcmFnZXx8bnVsbH0gY2F0Y2goZSl7fQogICAgICAgIGlmIChscykgewogICAgICAgICAgcmV0dXJuIGxzLmdldEl0ZW0obmFtZSk7IC8vIENocm9tZSBzY3JpcHQsIE9wZXJhIGV4dGVuc2lvbnMKICAgICAgICB9CiAgICB9CiAgICByZXR1cm47CiAgfQogIAogIGZ1bmN0aW9uIHNldFByZWYobmFtZSwgdmFsdWUpIHsgLy8gIGNyb3NzLWJyb3dzZXIgR01fc2V0VmFsdWUKICAgIHZhciBhPScnLCBiPScnOwogICAgdHJ5IHthPXR5cGVvZiBHTV9zZXRWYWx1ZS50b1N0cmluZzsgYj1HTV9zZXRWYWx1ZS50b1N0cmluZygpfSBjYXRjaChlKXt9ICAgIAogICAgaWYgKHR5cGVvZiBHTV9zZXRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiAKICAgIChhID09PSAndW5kZWZpbmVkJyB8fCBiLmluZGV4T2YoJ25vdCBzdXBwb3J0ZWQnKSA9PT0gLTEpKSB7CiAgICAgIEdNX3NldFZhbHVlKG5hbWUsIHZhbHVlKTsgLy8gR3JlYXNlbW9ua2V5LCBUYW1wZXJtb25rZXksIEZpcmVmb3ggZXh0ZW5zaW9uCiAgICB9IGVsc2UgewogICAgICAgIHZhciBscz1udWxsOwogICAgICAgIHRyeSB7bHM9d2luZG93LmxvY2FsU3RvcmFnZXx8bnVsbH0gY2F0Y2goZSl7fQogICAgICAgIGlmIChscykgewogICAgICAgICAgcmV0dXJuIGxzLnNldEl0ZW0obmFtZSwgdmFsdWUpOyAvLyBDaHJvbWUgc2NyaXB0LCBPcGVyYSBleHRlbnNpb25zCiAgICAgICAgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBjcm9zc1htbEh0dHBSZXF1ZXN0KGRldGFpbHMpIHsgLy8gY3Jvc3MtYnJvd3NlciBHTV94bWxodHRwUmVxdWVzdAogICAgaWYgKHR5cGVvZiBHTV94bWxodHRwUmVxdWVzdCA9PT0gJ2Z1bmN0aW9uJykgeyAvLyBHcmVhc2Vtb25rZXksIFRhbXBlcm1vbmtleSwgRmlyZWZveCBleHRlbnNpb24sIENocm9tZSBzY3JpcHQKICAgICAgR01feG1saHR0cFJlcXVlc3QoZGV0YWlscyk7CiAgICB9IGVsc2UgaWYgKHR5cGVvZiB3aW5kb3cub3BlcmEgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5vcGVyYSAmJiB0eXBlb2Ygb3BlcmEuZXh0ZW5zaW9uICE9PSAndW5kZWZpbmVkJyAmJiAKICAgICAgICAgICAgICAgdHlwZW9mIG9wZXJhLmV4dGVuc2lvbi5wb3N0TWVzc2FnZSAhPT0gJ3VuZGVmaW5lZCcpIHsgLy8gT3BlcmEgMTIgZXh0ZW5zaW9uCiAgICAgICAgdmFyIGluZGV4PW9wZXJhVGFibGUubGVuZ3RoOwogICAgICAgIG9wZXJhLmV4dGVuc2lvbi5wb3N0TWVzc2FnZSh7J2FjdGlvbic6J3hoci0nK2luZGV4LCAndXJsJzpkZXRhaWxzLnVybCwgJ21ldGhvZCc6ZGV0YWlscy5tZXRob2R9KTsKICAgICAgICBvcGVyYVRhYmxlW2luZGV4XT1kZXRhaWxzOwogICAgfSBlbHNlIGlmICh0eXBlb2Ygd2luZG93Lm9wZXJhID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgWE1MSHR0cFJlcXVlc3QgPT09ICdmdW5jdGlvbicpIHsgLy8gT3BlcmEgMTUrIGV4dGVuc2lvbgogICAgICAgIHZhciB4aHI9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICAgICAgaWYgKGRldGFpbHNbJ29ubG9hZCddKSB7CiAgICAgICAgICAgICAgZGV0YWlsc1snb25sb2FkJ10oeGhyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB4aHIub3BlbihkZXRhaWxzLm1ldGhvZCwgZGV0YWlscy51cmwsIHRydWUpOwogICAgICAgIHhoci5zZW5kKCk7CiAgICB9CiAgfQogICAKICBmdW5jdGlvbiBhZGRGaWxlU2l6ZSh1cmwsIGZvcm1hdCkgewogIAogICAgZnVuY3Rpb24gdXBkYXRlVmlkZW9MYWJlbChzaXplLCBmb3JtYXQpIHsKICAgICAgdmFyIGVsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoTElTVElURU1fSUQrZm9ybWF0KTsKICAgICAgaWYgKGVsZW0pIHsKICAgICAgICBzaXplPXBhcnNlSW50KHNpemUsMTApOwogICAgICAgIGlmIChzaXplPj0xMDczNzQxODI0KSB7CiAgICAgICAgICBzaXplPXBhcnNlRmxvYXQoKHNpemUvMTA3Mzc0MTgyNCkudG9GaXhlZCgxKSkrJyBHQic7CiAgICAgICAgfSBlbHNlIGlmIChzaXplPj0xMDQ4NTc2KSB7CiAgICAgICAgICBzaXplPXBhcnNlRmxvYXQoKHNpemUvMTA0ODU3NikudG9GaXhlZCgxKSkrJyBNQic7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNpemU9cGFyc2VGbG9hdCgoc2l6ZS8xMDI0KS50b0ZpeGVkKDEpKSsnIEtCJzsKICAgICAgICB9CiAgICAgICAgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg+MSkgewogICAgICAgICAgICBlbGVtLmxhc3RDaGlsZC5ub2RlVmFsdWU9JyAoJytzaXplKycpJzsKICAgICAgICB9IGVsc2UgaWYgKGVsZW0uY2hpbGROb2Rlcy5sZW5ndGg9PTEpIHsKICAgICAgICAgICAgZWxlbS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnICgnK3NpemUrJyknKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAgICAgCiAgICB2YXIgbWF0Y2hTaXplPWZpbmRNYXRjaCh1cmwsIC9bJlw/XWNsZW49KFswLTldKykmL2kpOwogICAgaWYgKG1hdGNoU2l6ZSkgewogICAgICB1cGRhdGVWaWRlb0xhYmVsKG1hdGNoU2l6ZSwgZm9ybWF0KTsKICAgIH0gZWxzZSB7CiAgICAgIHRyeSB7CiAgICAgICAgY3Jvc3NYbWxIdHRwUmVxdWVzdCh7CiAgICAgICAgICBtZXRob2Q6J0hFQUQnLAogICAgICAgICAgdXJsOnVybCwKICAgICAgICAgIG9ubG9hZDpmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICBpZiAocmVzcG9uc2UucmVhZHlTdGF0ZSA9PSA0ICYmIHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHsgLy8gYWRkIHNpemUKICAgICAgICAgICAgICB2YXIgc2l6ZT0wOwogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgICAgIHNpemU9cmVzcG9uc2UuZ2V0UmVzcG9uc2VIZWFkZXIoJ0NvbnRlbnQtbGVuZ3RoJyk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5yZXNwb25zZUhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJ15Db250ZW50XC1sZW5ndGg6ICguKikkJywnaW0nKTsKICAgICAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcmVnZXhwLmV4ZWMocmVzcG9uc2UucmVzcG9uc2VIZWFkZXJzKTsKICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgc2l6ZT1tYXRjaFsxXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2l6ZSkgewogICAgICAgICAgICAgICAgdXBkYXRlVmlkZW9MYWJlbChzaXplLCBmb3JtYXQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGNhdGNoKGUpIHsgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBmaW5kU2lnbmF0dXJlQ29kZShzb3VyY2VDb2RlKSB7CiAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBzaWduYXR1cmUgc3RhcnQgJytnZXRQcmVmKFNUT1JBR0VfQ09ERSkpOwogICAgdmFyIHNpZ25hdHVyZUZ1bmN0aW9uTmFtZSA9IAogICAgZmluZE1hdGNoKHNvdXJjZUNvZGUsIAogICAgL1wuc2V0XHMqXCgic2lnbmF0dXJlIlxzKixccyooW2EtekEtWjAtOV8kXVtcdyRdKilcKC8pCiAgICB8fCBmaW5kTWF0Y2goc291cmNlQ29kZSwgCiAgICAvXC5zaWdccypcfFx8XHMqKFthLXpBLVowLTlfJF1bXHckXSopXCgvKQogICAgfHwgZmluZE1hdGNoKHNvdXJjZUNvZGUsIAogICAgL1wuc2lnbmF0dXJlXHMqPVxzKihbYS16QS1aXyRdW1x3JF0qKVwoW2EtekEtWl8kXVtcdyRdKlwpLyk7IC8vb2xkCiAgICBpZiAoc2lnbmF0dXJlRnVuY3Rpb25OYW1lID09IG51bGwpIHJldHVybiBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgJ2Vycm9yJyk7CiAgICBzaWduYXR1cmVGdW5jdGlvbk5hbWU9c2lnbmF0dXJlRnVuY3Rpb25OYW1lLnJlcGxhY2UoJyQnLCdcXCQnKTsgICAgCiAgICB2YXIgcmVnQ29kZSA9IG5ldyBSZWdFeHAoc2lnbmF0dXJlRnVuY3Rpb25OYW1lICsgJ1xccyo9XFxzKmZ1bmN0aW9uJyArCiAgICAnXFxzKlxcKFtcXHckXSpcXClcXHMqe1tcXHckXSo9W1xcdyRdKlxcLnNwbGl0XFwoIiJcXCk7XG4qKC4rKTtyZXR1cm4gW1xcdyRdKlxcLmpvaW4nKTsKICAgIHZhciByZWdDb2RlMiA9IG5ldyBSZWdFeHAoJ2Z1bmN0aW9uIFxccyonICsgc2lnbmF0dXJlRnVuY3Rpb25OYW1lICsKICAgICdcXHMqXFwoW1xcdyRdKlxcKVxccyp7W1xcdyRdKj1bXFx3JF0qXFwuc3BsaXRcXCgiIlxcKTtcbiooLispO3JldHVybiBbXFx3JF0qXFwuam9pbicpOyAgICAKICAgIHZhciBmdW5jdGlvbkNvZGUgPSBmaW5kTWF0Y2goc291cmNlQ29kZSwgcmVnQ29kZSkgfHwgZmluZE1hdGNoKHNvdXJjZUNvZGUsIHJlZ0NvZGUyKTsKICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IHNpZ25hdHVyZWZ1bmN0aW9uICcgKyBzaWduYXR1cmVGdW5jdGlvbk5hbWUgKyAnIC0tICcgKyBmdW5jdGlvbkNvZGUpOyAgICAgICAgICAgIAogICAgaWYgKGZ1bmN0aW9uQ29kZSA9PSBudWxsKSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgCiAgICB2YXIgcmV2ZXJzZUZ1bmN0aW9uTmFtZSA9IGZpbmRNYXRjaChzb3VyY2VDb2RlLCAKICAgIC8oW1x3JF0qKVxzKjpccypmdW5jdGlvblxzKlwoXHMqW1x3JF0qXHMqXClccyp7XHMqKD86cmV0dXJuXHMqKT9bXHckXSpcLnJldmVyc2VccypcKFxzKlwpXHMqfS8pOwogICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogcmV2ZXJzZWZ1bmN0aW9uICcgKyByZXZlcnNlRnVuY3Rpb25OYW1lKTsKICAgIGlmIChyZXZlcnNlRnVuY3Rpb25OYW1lKSByZXZlcnNlRnVuY3Rpb25OYW1lPXJldmVyc2VGdW5jdGlvbk5hbWUucmVwbGFjZSgnJCcsJ1xcJCcpOyAgICAgICAgCiAgICB2YXIgc2xpY2VGdW5jdGlvbk5hbWUgPSBmaW5kTWF0Y2goc291cmNlQ29kZSwgCiAgICAvKFtcdyRdKilccyo6XHMqZnVuY3Rpb25ccypcKFxzKltcdyRdKlxzKixccypbXHckXSpccypcKVxzKntccyooPzpyZXR1cm5ccyopP1tcdyRdKlwuKD86c2xpY2V8c3BsaWNlKVwoLitcKVxzKn0vKTsKICAgIGRlYnVnKCdEWVZBTSAtIEluZm86IHNsaWNlZnVuY3Rpb24gJyArIHNsaWNlRnVuY3Rpb25OYW1lKTsKICAgIGlmIChzbGljZUZ1bmN0aW9uTmFtZSkgc2xpY2VGdW5jdGlvbk5hbWU9c2xpY2VGdW5jdGlvbk5hbWUucmVwbGFjZSgnJCcsJ1xcJCcpOyAgICAKICAgIAogICAgdmFyIHJlZ1NsaWNlID0gbmV3IFJlZ0V4cCgnXFwuKD86Jysnc2xpY2UnKyhzbGljZUZ1bmN0aW9uTmFtZT8nfCcrc2xpY2VGdW5jdGlvbk5hbWU6JycpKwogICAgJylcXHMqXFwoXFxzKig/OlthLXpBLVpfJF1bXFx3JF0qXFxzKiwpP1xccyooWzAtOV0rKVxccypcXCknKTsgLy8gLnNsaWNlKDUpIHNhdSAuSGYoYSw1KQogICAgdmFyIHJlZ1JldmVyc2UgPSBuZXcgUmVnRXhwKCdcXC4oPzonKydyZXZlcnNlJysocmV2ZXJzZUZ1bmN0aW9uTmFtZT8nfCcrcmV2ZXJzZUZ1bmN0aW9uTmFtZTonJykrCiAgICAnKVxccypcXChbXlxcKV0qXFwpJyk7ICAvLyAucmV2ZXJzZSgpIHNhdSAuR2YoYSw0NSkKICAgIHZhciByZWdTd2FwID0gbmV3IFJlZ0V4cCgnW1xcdyRdK1xccypcXChcXHMqW1xcdyRdK1xccyosXFxzKihbMC05XSspXFxzKlxcKScpOwogICAgdmFyIHJlZ0lubGluZSA9IG5ldyBSZWdFeHAoJ1tcXHckXStcXFswXFxdXFxzKj1cXHMqW1xcdyRdK1xcWyhbMC05XSspXFxzKiVcXHMqW1xcdyRdK1xcLmxlbmd0aFxcXScpOwogICAgdmFyIGZ1bmN0aW9uQ29kZVBpZWNlcz1mdW5jdGlvbkNvZGUuc3BsaXQoJzsnKTsKICAgIHZhciBkZWNvZGVBcnJheT1bXTsKICAgIGZvciAodmFyIGk9MDsgaTxmdW5jdGlvbkNvZGVQaWVjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgZnVuY3Rpb25Db2RlUGllY2VzW2ldPWZ1bmN0aW9uQ29kZVBpZWNlc1tpXS50cmltKCk7CiAgICAgIHZhciBjb2RlTGluZT1mdW5jdGlvbkNvZGVQaWVjZXNbaV07CiAgICAgIGlmIChjb2RlTGluZS5sZW5ndGg+MCkgewogICAgICAgIHZhciBhcnJTbGljZT1jb2RlTGluZS5tYXRjaChyZWdTbGljZSk7CiAgICAgICAgdmFyIGFyclJldmVyc2U9Y29kZUxpbmUubWF0Y2gocmVnUmV2ZXJzZSk7CiAgICAgICAgZGVidWcoaSsnOiAnK2NvZGVMaW5lKycgLS0nKyhhcnJTbGljZT8nIHNsaWNlIGxlbmd0aCAnK2FyclNsaWNlLmxlbmd0aDonJykgKycgJysoYXJyUmV2ZXJzZT8ncmV2ZXJzZSc6JycpKTsKICAgICAgICBpZiAoYXJyU2xpY2UgJiYgYXJyU2xpY2UubGVuZ3RoID49IDIpIHsgLy8gc2xpY2UKICAgICAgICB2YXIgc2xpY2U9cGFyc2VJbnQoYXJyU2xpY2VbMV0sIDEwKTsKICAgICAgICBpZiAoaXNJbnRlZ2VyKHNsaWNlKSl7IAogICAgICAgICAgZGVjb2RlQXJyYXkucHVzaCgtc2xpY2UpOwogICAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9IGVsc2UgaWYgKGFyclJldmVyc2UgJiYgYXJyUmV2ZXJzZS5sZW5ndGggPj0gMSkgeyAvLyByZXZlcnNlCiAgICAgICAgZGVjb2RlQXJyYXkucHVzaCgwKTsKICAgICAgfSBlbHNlIGlmIChjb2RlTGluZS5pbmRleE9mKCdbMF0nKSA+PSAwKSB7IC8vIGlubGluZSBzd2FwCiAgICAgICAgICBpZiAoaSsyPGZ1bmN0aW9uQ29kZVBpZWNlcy5sZW5ndGggJiYKICAgICAgICAgIGZ1bmN0aW9uQ29kZVBpZWNlc1tpKzFdLmluZGV4T2YoJy5sZW5ndGgnKSA+PSAwICYmCiAgICAgICAgICBmdW5jdGlvbkNvZGVQaWVjZXNbaSsxXS5pbmRleE9mKCdbMF0nKSA+PSAwKSB7CiAgICAgICAgICAgIHZhciBpbmxpbmU9ZmluZE1hdGNoKGZ1bmN0aW9uQ29kZVBpZWNlc1tpKzFdLCByZWdJbmxpbmUpOwogICAgICAgICAgICBpbmxpbmU9cGFyc2VJbnQoaW5saW5lLCAxMCk7CiAgICAgICAgICAgIGRlY29kZUFycmF5LnB1c2goaW5saW5lKTsKICAgICAgICAgICAgaSs9MjsKICAgICAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9IGVsc2UgaWYgKGNvZGVMaW5lLmluZGV4T2YoJywnKSA+PSAwKSB7IC8vIHN3YXAKICAgICAgICB2YXIgc3dhcD1maW5kTWF0Y2goY29kZUxpbmUsIHJlZ1N3YXApOyAgICAgIAogICAgICAgIHN3YXA9cGFyc2VJbnQoc3dhcCwgMTApOwogICAgICAgIGlmIChpc0ludGVnZXIoc3dhcCkgJiYgc3dhcD4wKXsKICAgICAgICAgIGRlY29kZUFycmF5LnB1c2goc3dhcCk7CiAgICAgICAgfSBlbHNlIHJldHVybiBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgJ2Vycm9yJyk7CiAgICAgIH0gZWxzZSByZXR1cm4gc2V0UHJlZihTVE9SQUdFX0NPREUsICdlcnJvcicpOwogICAgICB9CiAgICB9CiAgICAKICAgIGlmIChkZWNvZGVBcnJheSkgewogICAgICBzZXRQcmVmKFNUT1JBR0VfVVJMLCBzY3JpcHRVUkwpOwogICAgICBzZXRQcmVmKFNUT1JBR0VfQ09ERSwgZGVjb2RlQXJyYXkudG9TdHJpbmcoKSk7CiAgICAgIERFQ09ERV9SVUxFPWRlY29kZUFycmF5OwogICAgICBkZWJ1ZygnRFlWQU0gLSBJbmZvOiBzaWduYXR1cmUgJytkZWNvZGVBcnJheS50b1N0cmluZygpKycgJytzY3JpcHRVUkwpOwogICAgICAvLyB1cGRhdGUgZG93bmxvYWQgbGlua3MgYW5kIGFkZCBmaWxlIHNpemVzCiAgICAgIGZvciAodmFyIGk9MDtpPGRvd25sb2FkQ29kZUxpc3QubGVuZ3RoO2krKykgeyAgICAgICAgCiAgICAgICAgdmFyIGVsZW09ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoTElTVElURU1fSUQrZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgICAgIHZhciB1cmw9ZG93bmxvYWRDb2RlTGlzdFtpXS51cmw7CiAgICAgICAgdmFyIHNpZz1kb3dubG9hZENvZGVMaXN0W2ldLnNpZzsKICAgICAgICBpZiAoZWxlbSAmJiB1cmwgJiYgc2lnKSB7CiAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoL1wmc2lnbmF0dXJlPVtcd1wuXSsvLCAnJnNpZ25hdHVyZT0nK2RlY3J5cHRTaWduYXR1cmUoc2lnKSk7CiAgICAgICAgICBlbGVtLnBhcmVudE5vZGUuc2V0QXR0cmlidXRlKCdocmVmJywgdXJsKTsKICAgICAgICAgIGFkZEZpbGVTaXplKHVybCwgZG93bmxvYWRDb2RlTGlzdFtpXS5mb3JtYXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAKICBmdW5jdGlvbiBpc1ZhbGlkU2lnbmF0dXJlQ29kZShhcnIpIHsgLy8gdmFsaWQgdmFsdWVzOiAnNSwtMywwLDIsNScsICdlcnJvcicKICAgIGlmICghYXJyKSByZXR1cm4gZmFsc2U7CiAgICBpZiAoYXJyPT0nZXJyb3InKSByZXR1cm4gdHJ1ZTsKICAgIGFycj1hcnIuc3BsaXQoJywnKTsKICAgIGZvciAodmFyIGk9MDtpPGFyci5sZW5ndGg7aSsrKSB7CiAgICAgIGlmICghaXNJbnRlZ2VyKHBhcnNlSW50KGFycltpXSwxMCkpKSByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgCiAgZnVuY3Rpb24gZmV0Y2hTaWduYXR1cmVTY3JpcHQoc2NyaXB0VVJMKSB7CiAgICB2YXIgc3RvcmFnZVVSTD1nZXRQcmVmKFNUT1JBR0VfVVJMKTsKICAgIHZhciBzdG9yYWdlQ29kZT1nZXRQcmVmKFNUT1JBR0VfQ09ERSk7CiAgICBpZiAoISgvLDAsfF4wLHwsMCR8XC0vLnRlc3Qoc3RvcmFnZUNvZGUpKSkgc3RvcmFnZUNvZGU9bnVsbDsgLy8gaGFjayBmb3Igb25seSBwb3NpdGl2ZSBpdGVtcwogICAgaWYgKHN0b3JhZ2VDb2RlICYmIGlzVmFsaWRTaWduYXR1cmVDb2RlKHN0b3JhZ2VDb2RlKSAmJiBzdG9yYWdlVVJMICYmCiAgICAgICAgc2NyaXB0VVJMLnJlcGxhY2UoL15odHRwcz8vaSwnJyk9PXN0b3JhZ2VVUkwucmVwbGFjZSgvXmh0dHBzPy9pLCcnKSkgcmV0dXJuOwogICAgdHJ5IHsKICAgICAgZGVidWcoJ0RZVkFNIGZldGNoICcrc2NyaXB0VVJMKTsKICAgICAgaXNTaWduYXR1cmVVcGRhdGluZ1N0YXJ0ZWQ9dHJ1ZTsgICAgCiAgICAgIGNyb3NzWG1sSHR0cFJlcXVlc3QoewogICAgICAgIG1ldGhvZDonR0VUJywKICAgICAgICB1cmw6c2NyaXB0VVJMLAogICAgICAgIG9ubG9hZDpmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgZGVidWcoJ0RZVkFNIGZldGNoIHN0YXR1cyAnK3Jlc3BvbnNlLnN0YXR1cyk7CiAgICAgICAgICBpZiAocmVzcG9uc2UucmVhZHlTdGF0ZSA9PT0gNCAmJiByZXNwb25zZS5zdGF0dXMgPT09IDIwMCAmJiByZXNwb25zZS5yZXNwb25zZVRleHQpIHsKICAgICAgICAgICAgZmluZFNpZ25hdHVyZUNvZGUocmVzcG9uc2UucmVzcG9uc2VUZXh0KTsKICAgICAgICAgIH0KICAgICAgICB9IAogICAgICB9KTsKICAgIH0gY2F0Y2goZSkgeyB9CiAgfQogIAogIGZ1bmN0aW9uIGdldERlY29kZVJ1bGVzKHJ1bGVzKSB7CiAgICB2YXIgc3RvcmFnZUNvZGU9Z2V0UHJlZihTVE9SQUdFX0NPREUpOyAgICAKICAgIGlmIChzdG9yYWdlQ29kZSAmJiBzdG9yYWdlQ29kZSE9J2Vycm9yJyAmJiBpc1ZhbGlkU2lnbmF0dXJlQ29kZShzdG9yYWdlQ29kZSkpIHsKICAgICAgdmFyIGFycj1zdG9yYWdlQ29kZS5zcGxpdCgnLCcpOwogICAgICBmb3IgKHZhciBpPTA7IGk8YXJyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYXJyW2ldPXBhcnNlSW50KGFycltpXSwgMTApOwogICAgICB9CiAgICAgIHJ1bGVzPWFycjsKICAgICAgZGVidWcoJ0RZVkFNIC0gSW5mbzogc2lnbmF0dXJlICcrYXJyLnRvU3RyaW5nKCkrJyAnK3NjcmlwdFVSTCk7CiAgICB9CiAgICByZXR1cm4gcnVsZXM7CiAgfQogIAogIGZ1bmN0aW9uIGRlY3J5cHRTaWduYXR1cmUoc2lnKSB7CiAgICBmdW5jdGlvbiBzd2FwKGEsYil7dmFyIGM9YVswXTthWzBdPWFbYiVhLmxlbmd0aF07YVtiXT1jO3JldHVybiBhfTsKICAgIGZ1bmN0aW9uIGRlY29kZShzaWcsIGFycikgeyAvLyBlbmNvZGVkIGRlY3J5cHRpb24KICAgICAgaWYgKCFpc1N0cmluZyhzaWcpKSByZXR1cm4gbnVsbDsKICAgICAgdmFyIHNpZ0E9c2lnLnNwbGl0KCcnKTsKICAgICAgZm9yICh2YXIgaT0wO2k8YXJyLmxlbmd0aDtpKyspIHsKICAgICAgICB2YXIgYWN0PWFycltpXTsKICAgICAgICBpZiAoIWlzSW50ZWdlcihhY3QpKSByZXR1cm4gbnVsbDsKICAgICAgICBzaWdBPShhY3Q+MCk/c3dhcChzaWdBLCBhY3QpOigoYWN0PT0wKT9zaWdBLnJldmVyc2UoKTpzaWdBLnNsaWNlKC1hY3QpKTsKICAgICAgfQogICAgICB2YXIgcmVzdWx0PXNpZ0Euam9pbignJyk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAKICAgIGlmIChzaWc9PW51bGwpIHJldHVybiAnJzsgICAgCiAgICB2YXIgYXJyPURFQ09ERV9SVUxFOwogICAgaWYgKGFycikgewogICAgICB2YXIgc2lnMj1kZWNvZGUoc2lnLCBhcnIpOwogICAgICBpZiAoc2lnMikgcmV0dXJuIHNpZzI7CiAgICB9IGVsc2UgewogICAgICBzZXRQcmVmKFNUT1JBR0VfVVJMLCAnJyk7CiAgICAgIHNldFByZWYoU1RPUkFHRV9DT0RFLCAnJyk7CiAgICB9CiAgICByZXR1cm4gc2lnOyAKICB9ICAKICAgICAgCiAgfQogCn0pKCk7"},{"name":"Anti-Adblock Killer | Reek","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":true,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_excludes":[],"orig_includes":["http://*/*","https://*/*"],"orig_matches":[],"orig_noframes":null,"orig_run_at":"document-start","use_blockers":[],"use_connects":["*"],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"nextchecklist":"s1475975762857","nextcheckupdate":"s1476494165055"},"ts":1475936798698},"enabled":true,"position":6,"file_url":"https://greasyfork.org/scripts/735-anti-adblock-killer-reek/code/Anti-Adblock%20Killer%20%7C%20Reek.user.js","uuid":"ec693dec-33cc-4a51-8a5d-0325972c723e","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgQW50aS1BZGJsb2NrIEtpbGxlciB8IFJlZWsKLy8gQG5hbWVzcGFjZSBodHRwczovL3VzZXJzY3JpcHRzLm9yZy9zY3JpcHRzL3Nob3cvMTU1ODQwCi8vIEBkZXNjcmlwdGlvbiBIZWxwcyB5b3Uga2VlcCB5b3VyIEFkLUJsb2NrZXIgYWN0aXZlLCB3aGVuIHlvdSB2aXNpdCBhIHdlYnNpdGUgYW5kIGl0IGFza3MgeW91IHRvIGRpc2FibGUuCi8vIEBhdXRob3IgUmVlayB8IHJlZWtzaXRlLmNvbQovLyBAdmVyc2lvbiA5LjgKLy8gQGVuY29kaW5nIHV0Zi04Ci8vIEBsaWNlbnNlIGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS80LjAvCi8vIEBpY29uIGh0dHBzOi8vcmF3LmdpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL21hc3Rlci9hbnRpLWFkYmxvY2sta2lsbGVyLWljb24ucG5nCi8vIEBob21lcGFnZSBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyLwovLyBAdHdpdHRlclVSTCBodHRwczovL3R3aXR0ZXIuY29tL2FudGlhZGJraWxsZXIKLy8gQGNvbnRhY3RVUkwgaHR0cHM6Ly9yZWVrLmdpdGh1Yi5pby9hbnRpLWFkYmxvY2sta2lsbGVyLyNjb250YWN0Ci8vIEBzdXBwb3J0VVJMIGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzCi8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlciNkb25hdGUKLy8gQGluY2x1ZGUgaHR0cDovLyovKgovLyBAaW5jbHVkZSBodHRwczovLyovKgovLyBAZ3JhbnQgdW5zYWZlV2luZG93Ci8vIEBncmFudCBHTV9hZGRTdHlsZQovLyBAZ3JhbnQgR01fZ2V0VmFsdWUKLy8gQGdyYW50IEdNX3NldFZhbHVlCi8vIEBncmFudCBHTV94bWxodHRwUmVxdWVzdAovLyBAZ3JhbnQgR01fcmVnaXN0ZXJNZW51Q29tbWFuZAovLyBAZ3JhbnQgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50IEdNX2xpc3RWYWx1ZXMKLy8gQGdyYW50IEdNX2dldFJlc291cmNlVGV4dAovLyBAZ3JhbnQgR01fZ2V0UmVzb3VyY2VVUkwKLy8gQGdyYW50IEdNX2xvZwovLyBAZ3JhbnQgR01fb3BlbkluVGFiCi8vIEBncmFudCBHTV9zZXRDbGlwYm9hcmQKLy8gQGdyYW50IEdNX2luZm8KLy8gQGdyYW50IEdNX2dldE1ldGFkYXRhCi8vIEBydW4tYXQgZG9jdW1lbnQtc3RhcnQKLy8gQGNvbm5lY3QgKgovLyA9PS9Vc2VyU2NyaXB0PT0KLypqc2hpbnQgZXZpbDp0cnVlIG5ld2NhcDpmYWxzZSovCi8qZ2xvYmFsIHVuc2FmZVdpbmRvdywgR01fYWRkU3R5bGUsIEdNX2dldFZhbHVlLCBHTV9zZXRWYWx1ZSwgR01feG1saHR0cFJlcXVlc3QsIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQsIEdNX2RlbGV0ZVZhbHVlLCBHTV9saXN0VmFsdWVzLCBHTV9nZXRSZXNvdXJjZVRleHQsIEdNX2dldFJlc291cmNlVVJMLCBHTV9sb2csIEdNX29wZW5JblRhYiwgR01fc2V0Q2xpcGJvYXJkLCBHTV9pbmZvLCBHTV9nZXRNZXRhZGF0YSwgJCwgZG9jdW1lbnQsIGNvbnNvbGUsIGxvY2F0aW9uLCBzZXRJbnRlcnZhbCwgc2V0VGltZW91dCwgY2xlYXJJbnRlcnZhbCovCi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBUaGFua3MKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIERvbm9yczogTS4gSG93YXJkLCBTaHVuam91LCBDaGFybWluZSwgS2llcmVrOTMsIEcuIEJhcm5hcmQsIEguIFlvdW5nLCBTZWluaG9yOSwgSW1HbG9kYXIsIEl2YW5vc2V2aXRjaCwgSG9tZURpcG8sIFIuIE1hcnRpbiwgRHJGaVosIFRpcHB5LCBCLiBSb2huZXIsIFAuIEtvemljYSwgTS4gUGF0ZWwsIFc0cmVsbCwgVHNjaGVja29mZiwgQWRCbG9jayBQb2xza2EsIEFWRU5JUiBJTlRFUk5FVCwgY29vbE5BTywgQmVuLCBKLiBQYXJrLCBDLiBZb3VuZywgSi4gQm91LCBNLiBDYW5vLCBKLiBKdW5nLCBBLiBTb25pbm8sIEouIExpdHRlbiwgTS4gU2NocnVtcGYsIEcuIFBlcGUsIEEuIFRydWZhbm92LCBSLiBQYWxtZXIsIEouIFJhdXRpYWluZW4sIFMuIEJseXN0b25lLCBNLiBTaWx2ZWlyYSwgSy4gTWFjQXJ0aHVyLCBNLiBJdmFub3YsIEEuIFNjaG1pZHQsIEEuIFdhYWdlLCBGLiBUaXNtZXIsIFMuIEVobmVydCwgSi4gQ29ycHVzLCBKLiBEbHVob3MsIE1ha2xlbWVueiwgU3Ryb2JlbGl4LCBNb2RlbGxwaWxvdC5FVSwgRS4gQmVuZWRldHRpLCBWLiBWZW5kaXR0aSwgU2hha29zLCBBLiBFbGlhc29uLCBBLiBTYWxvcmFudGEsIFMuIEdlaWdlciwgQS4gT3R0ZXJsb28sIE0uIENvcHBlbiwgUy4gRmlzY2hlciwgSC4gQmVja2VyLCBELiBBY2tlcm1hbiwgUy4gUGl0c2NoLCBLLiBQZXJ0Y2hlY2ssIFMuIEFiZWwsIEsuIE8nQ29ubm9yLCBCLiBPYnJpZW4sIFMuIFZvZ2xlciwgUy4gR29lYmwsIEEuIEJpYXIsIFMuIFNjb3R0LCBCYXNzbW9iaWxlLm9yZywgUy4gR3Jvw59lLCBNLiBQZW90LCBSLiBDaGFuIEJhbGFtLCBMLiBCb25kLUtlbm5lZHksIFIuIEVtb25kLCBBLiBQYXZsb3YsIFcuIFRyYWNleSwgQS4gU2VyZ2V5LCBSLiBMw7NwZXogTMOzcGV6LCBSLiBSZWRkeSBLYXNpcmVkZHksIEEuIE1vdWplZXIsIE0uIEJldHosIE0uIExlZsOodnJlLCBSLiBNY0N1cmR5LCBMUiBHZWVrcywgTS4gQmVhdXJlZ2FyZCwgQ2FzcGVyVGVjaCBMdGQsIE0uIER1ZGFzLCBTLiBTY2hhcmYsIFMuIFByb2tob3JvdiwgSy4gUGFwYWxpYXMsIEouIFdvam5vd3NraSwgQi4gQ3VydGlzLCBELiBMYXdyZW5jZSwgRC4gSGUsIE4uIEtlbHNhbGwsIElkb2dld2FsbGV0LCBKLiBTcGF1bGRpbmcsIFMuIExhZm9uLCBNYXQsIEguIFJvYmVydHMsIEMuIEhlZGx1bmQsIEouIEhhd2tpbnMsIEouIEFuZGVyc2VuLCBNLiBCam9ya3N0ZW4sIEIuIFdvbGZlIElJSSwgVC4gWW9jb20sIMWgLiBJbnRhcywgUy4gTW9lbmljaCwgSi4gQ2hhbmcsIEMuIE11bmssIEEuIE5hcnV0YSwg0JEuINCc0LjRhdCw0LjQuywgSi4gQmVueiwgRi4gU2xvb3QsIEouIENyZWVkLCBNLiBHaWxsYW0sIEMuIExlaWNodCwgQS4gR25hbmEsIFMuIFN1bmRhcmFtLCBBLiBLb2xsZXIKCiAgQ29sbGFib3JhdG9yczogSW5maW5pdHlDb2RpbmcsIENvdWNoeSwgRGluZG9nLCBGbG94ZmxvYiwgVSBCbGVzcywgV2F0aWxpbiwgQHByZG9uYWh1ZSwgSG9zaGllLCAzbGYzbkxpM2QsIEFsZXhvLCBDcml0cywgTm9uYW1lMTIwLCBDcnQzMiwgSml4dW5Nb2UsIEF0aG9yY2lzLCBLaWxsZXJiYWRnZXIsIFNNZWQ3OSwgQWxleGFuZGVyMjU1LCBBbm9uc3VibWl0dGVyLCBSYXBvckxvTHBybywgTWF5bmFrMDAsIFJvYm90ZXgsIFZpbmN0dXgsIEJsYWh4LCBNYWpraUlULCBGNHosIEFuZ2Vsc2wsIE1pa2hhZWxrLCBNYXJlaywgSGFtc3RlcmJhY2tlLCBHb3JoaWxsLCBIYWNrZXI5OTksIHh4Y3JpdGljeHgsIFNrcjR0Y2hHcjNhenlNb25raUJhbGxsbGxsWnp6eiwgR2l3YXl1bWUsIE1yU2hlcmxvY2tIb2xtZXMsIHhEYXJrQVJHLCBOb2FocDc4CgogIFVzZXJzOiBUaGFuayB5b3UgdG8gYWxsIHRob3NlIHdobyB1c2UgQW50aSBBZGJsb2NrIEtpbGxlciwgd2hvIHJlcG9ydCBwcm9ibGVtcywgd2hvIHdyaXRlIHRoZSByZXZpZXcsIHdoaWNoIGFkZCB0byB0aGVpciBmYXZvcml0ZXMsIG1ha2luZyBkb25hdGlvbnMsIHdoaWNoIHN1cHBvcnQgdGhlIHByb2plY3QgYW5kIGhlbHAgaW4gaXRzIGRldmVsb3BtZW50IG9yIHByb21vdGUuCgo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgTWlycm9ycwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogIEdpdGh1YjogaHR0cDovL3Rpbnl1cmwuY29tL21jcmEzZG4KICBHcmVhc3lmb3JrOiBodHRwOi8vdGlueXVybC5jb20vcGJiZG5oNgogIE9wZW51c2VyanM6IGh0dHA6Ly90aW55dXJsLmNvbS9ubnFqZTMyCiAgTW9ua2V5R3V0czogaHR0cDovL3Rpbnl1cmwuY29tL2thNWZjcW0KICBVc2Vyc2NyaXB0czogaHR0cDovL3Rpbnl1cmwuY29tL3E4eGNlamwKCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBEb2N1bWVudGF0aW9uCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgR3JlYXNlbW9ua2V5OiBodHRwOi8vdGlueXVybC5jb20veWVlZm5qNQogIFNjcmlwdGlzaDogaHR0cDovL3Rpbnl1cmwuY29tL2NuZDlua2QKICBUYW1wZXJtb25rZXk6IGh0dHA6Ly90aW55dXJsLmNvbS9wZHl0ZmRlCiAgVmlvbGVudG1vbmtleTogaHR0cDovL3Rpbnl1cmwuY29tL24zNHduNmoKICBOaW5qYUtpdDogaHR0cDovL3Rpbnl1cmwuY29tL3Bra205dWcKCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICBTY3JpcHQKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCihmdW5jdGlvbiAod2luZG93KSB7CiAgInVzZSBzdHJpY3QiOwogIAogIHZhciBBYWsgPSB7CiAgICBuYW1lIDogJ0FudGktQWRibG9jayBLaWxsZXInLAogICAgdmVyc2lvbiA6ICc5LjgnLAogICAgc2NyaXB0aWQgOiAnZ0pXRXAwdkInLAogICAgaG9tZVVSTCA6ICdodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyLycsCiAgICBjaGFuZ2Vsb2dVUkwgOiAnaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlciNjaGFuZ2Vsb2cnLAogICAgZG9uYXRlVVJMIDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIjZG9uYXRlJywKICAgIGZlYXR1cmVzVVJMIDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIjZmVhdHVyZXMnLAogICAgcmVwb3J0VVJMIDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvd2lraS9SZXBvcnQtR3VpZGUnLAogICAgY29udGFjdFVSTCA6ICdodHRwczovL3JlZWsuZ2l0aHViLmlvL2FudGktYWRibG9jay1raWxsZXIvI2NvbnRhY3QnLAogICAgc2V0dGluZ3NVUkwgOiAnaHR0cHM6Ly9yZWVrLmdpdGh1Yi5pby9hbnRpLWFkYmxvY2sta2lsbGVyLyNzZXR0aW5ncycsCiAgICB0d2l0dGVyVVJMIDogJ2h0dHBzOi8vdHdpdHRlci5jb20vYW50aWFkYmtpbGxlcicsCiAgICBkb3dubG9hZFVSTCA6ICdodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL21hc3Rlci9hbnRpLWFkYmxvY2sta2lsbGVyLnVzZXIuanMnLAogICAgc3Vic2NyaWJlVVJMIDogJ2h0dHBzOi8vcmVlay5naXRodWIuaW8vYW50aS1hZGJsb2NrLWtpbGxlci8jZmlsdGVybGlzdCcsCiAgICBsaXN0VVJMIDogImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvbWFzdGVyL2FudGktYWRibG9jay1raWxsZXItZmlsdGVycy50eHQiLAogICAgbmF0aXZlVVJMIDogJ2h0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvd2lraS9OYXRpdmUtTW9kZScsCiAgICBpY29uVVJMIDogJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvbWFzdGVyL2FudGktYWRibG9jay1raWxsZXItaWNvbi5wbmcnLAogICAgaW1nQmFpdCA6ICdkYXRhOmltYWdlL3BuZztiYXNlNjQsaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUNBQUFBQWdDQVFBQUFEWmM3Si9BQUFBR2tsRVFWUjQybU5nMEdBWUJhTmdGSXlDVVRBS1JzRW9RQVlBVE44QUtZTloveDRBQUFBQVNVVk9SSzVDWUlJPScsCiAgICBpbml0aWFsaXplIDogZnVuY3Rpb24gKCkgewoKICAgICAgQWFrLnJlZ2lzdGVyU2V0dGluZ3MoKTsgLy8gcmVnaXN0ZXJpbmcgeW91ciBzZXR0aW5ncy4KICAgICAgQWFrLnJlZ2lzdGVyQ29uc29sZSgpOyAvLyByZWdpc3RlcmluZyBjdXN0b216ZWQgY29uc29sZS4KICAgICAgQWFrLnJlZ2lzdGVyQ29tbWFuZHMoKTsgLy8gYWRkIGNvbW1hbmRzIHRvIG1lbnUKICAgICAgQWFrLmNoZWNrVXBkYXRlKHRydWUpOyAvLyBjaGVjayBpZiBBYWtTY3JpcHQgaXMgdXAgdG8gZGF0ZS4KICAgICAgQWFrLmNoZWNrTGlzdCgpOyAvLyBjaGVjayBpZiBBYWtMaXN0IGlzIGVuYWJsZWQuCiAgICAgIEFhay5ibG9ja0RldGVjdCgpOyAvLyBkZXRlY3QgYW5kIGtpbGwgYW50aS1hZGJsb2Nrcy4KCiAgICB9LAogICAgYWFicyA6IHt9LAogICAgb3B0cyA6IHt9LAogICAgb3B0aW9ucyA6IHsKICAgICAgYXV0b1BsYXkgOiB7CiAgICAgICAgZ3JvdXAgOiAnZ2VuZXJhbCcsCiAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgdmFsdWUgOiBmYWxzZSwKICAgICAgICBsYWJlbCA6ICdQbGF5IHZpZGVvIGF1dG9tYXRpY2FsbHkuIConLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICB2aWRlb0hEIDogewogICAgICAgIGdyb3VwIDogJ2dlbmVyYWwnLAogICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgIHZhbHVlIDogZmFsc2UsCiAgICAgICAgbGFiZWwgOiAnUGxheSB2aWRlbyBpbiBIRCBxdWFsaXR5LiAqKicsCiAgICAgICAgaW5mbyA6ICcnCiAgICAgIH0sCiAgICAgIGZvcmNlVkxDIDogewogICAgICAgIGdyb3VwIDogJ2dlbmVyYWwnLAogICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgIHZhbHVlIDogZmFsc2UsCiAgICAgICAgbGFiZWwgOiAnUGxheSB2aWRlbyB3aXRoIFZMQyBwbHVnaW4uIConLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICBjaGVja0xpc3QgOiB7CiAgICAgICAgZ3JvdXAgOiAnZ2VuZXJhbCcsCiAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgdmFsdWUgOiB0cnVlLAogICAgICAgIGxhYmVsIDogJ0NoZWNrIEFha0xpc3Qgc3Vic2NyaXB0aW9uLicsCiAgICAgICAgaW5mbyA6ICcnCiAgICAgIH0sCiAgICAgIGNoZWNrVXBkYXRlIDogewogICAgICAgIGdyb3VwIDogJ2dlbmVyYWwnLAogICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgIHZhbHVlIDogdHJ1ZSwKICAgICAgICBsYWJlbCA6ICdDaGVjayBuZXdlciBBYWtTY3JpcHQgdmVyc2lvbi4nLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICBkZWJ1ZyA6IHsKICAgICAgICBncm91cCA6ICdkZWJ1ZycsCiAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgdmFsdWUgOiBmYWxzZSwKICAgICAgICBsYWJlbCA6ICdFbmFibGUgTG9ncy4nLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICBsb2dJbnNlcnRlZE5vZGVzIDogewogICAgICAgIGdyb3VwIDogJ2RlYnVnJywKICAgICAgICB0eXBlIDogJ2NoZWNrYm94JywKICAgICAgICB2YWx1ZSA6IGZhbHNlLAogICAgICAgIGxhYmVsIDogJ0xvZyBpbnNlcnRlZCBub2Rlcy4nLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICBsb2dSZW1vdmVkTm9kZXMgOiB7CiAgICAgICAgZ3JvdXAgOiAnZGVidWcnLAogICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgIHZhbHVlIDogZmFsc2UsCiAgICAgICAgbGFiZWwgOiAnTG9nIHJlbW92ZWQgbm9kZXMuJywKICAgICAgICBpbmZvIDogJycKICAgICAgfSwKICAgICAgbG9nRXhjbHVkZWQgOiB7CiAgICAgICAgZ3JvdXAgOiAnZGVidWcnLAogICAgICAgIHR5cGUgOiAnY2hlY2tib3gnLAogICAgICAgIHZhbHVlIDogZmFsc2UsCiAgICAgICAgbGFiZWwgOiAnTG9nIGV4Y2x1ZGVzIGRvbWFpbnMuJywKICAgICAgICBpbmZvIDogJycKICAgICAgfSwKICAgICAgbG9nWGhyIDogewogICAgICAgIGdyb3VwIDogJ2RlYnVnJywKICAgICAgICB0eXBlIDogJ2NoZWNrYm94JywKICAgICAgICB2YWx1ZSA6IGZhbHNlLAogICAgICAgIGxhYmVsIDogJ0xvZyBIVFRQIHJlcXVlc3RzJywKICAgICAgICBpbmZvIDogJycKICAgICAgfSwKICAgICAgbG9nUGxheWVyIDogewogICAgICAgIGdyb3VwIDogJ2RlYnVnJywKICAgICAgICB0eXBlIDogJ2NoZWNrYm94JywKICAgICAgICB2YWx1ZSA6IGZhbHNlLAogICAgICAgIGxhYmVsIDogJ0xvZyBwbGF5ZXIgaW5zdGFuY2VzLicsCiAgICAgICAgaW5mbyA6ICcnCiAgICAgIH0sCiAgICAgIGxvZ0ludGVyY2VwdGVkU2NyaXB0cyA6IHsKICAgICAgICBncm91cCA6ICdkZWJ1ZycsCiAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgdmFsdWUgOiBmYWxzZSwKICAgICAgICBsYWJlbCA6ICdMb2cgaW50ZXJjZXB0ZWQgc2NyaXB0cy4nLAogICAgICAgIGluZm8gOiAnJwogICAgICB9LAogICAgICBsb2dEZXRlY3RlZCA6IHsKICAgICAgICBncm91cCA6ICdkZWJ1ZycsCiAgICAgICAgdHlwZSA6ICdjaGVja2JveCcsCiAgICAgICAgdmFsdWUgOiBmYWxzZSwKICAgICAgICBsYWJlbCA6ICdMb2cgZGV0ZWN0ZWQgYW50aS1hZGJsb2Nrcy4nLAogICAgICAgIGluZm8gOiAnJwogICAgICB9CiAgICB9LAogICAgcmVnaXN0ZXJTZXR0aW5ncyA6IGZ1bmN0aW9uICgpIHsKICAgICAgZm9yICh2YXIgb3B0TmFtZSBpbiBBYWsub3B0aW9ucykgewogICAgICAgIGlmIChBYWsub3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShvcHROYW1lKSkKICAgICAgICAgIEFhay5vcHRzW29wdE5hbWVdID0gQWFrLmdldFZhbHVlKG9wdE5hbWUpICE9PSBudWxsID8gQWFrLmdldFZhbHVlKG9wdE5hbWUpIDogQWFrLm9wdGlvbnNbb3B0TmFtZV0udmFsdWU7CiAgICAgIH0KICAgIH0sCiAgICBjb21tYW5kcyA6IFt7CiAgICAgICAgY2FwdGlvbiA6ICdIb21lcGFnZScsCiAgICAgICAgZXhlY3V0ZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5nbyhBYWsuaG9tZVVSTCk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbiA6ICdTZXR0aW5ncycsCiAgICAgICAgZXhlY3V0ZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5nbyhBYWsuc2V0dGluZ3NVUkwpOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIGNhcHRpb24gOiAnVXBkYXRlJywKICAgICAgICBleGVjdXRlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmNoZWNrVXBkYXRlKCk7CiAgICAgICAgfQogICAgICB9CiAgICBdLAogICAgYWRkQ29tbWFuZHMgOiBmdW5jdGlvbiAoY21kKSB7CiAgICAgIGlmIChBYWsudXNlR00gJiYgQWFrLmlzVG9wZnJhbWUgJiYgdHlwZW9mIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBHTV9yZWdpc3Rlck1lbnVDb21tYW5kKFtBYWsubmFtZSwgQWFrLmdldFZlcnNpb24oKSwgY21kLmNhcHRpb25dLmpvaW4oJyAnKSwgY21kLmV4ZWN1dGUpOwogICAgICB9CiAgICB9LAogICAgcmVnaXN0ZXJDb21tYW5kcyA6IGZ1bmN0aW9uICgpIHsKICAgICAgQWFrLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBTY3JpcHRpc2gKICAgICAgICAvLyBub3RlOiBObyBtZW51IGNvbW1hbmQgaXMgY3JlYXRlZCB3aGVuIHRoZSB1c2VyIHNjcmlwdCBpcyBydW4gaW4gYSBpZnJhbWUgd2luZG93LgogICAgICAgIC8vIGRvYzogaHR0cDovL3Rpbnl1cmwuY29tL2t2dnY3eXQKICAgICAgICBBYWsuY29tbWFuZHMuZm9yRWFjaChmdW5jdGlvbiAoY21kKSB7CiAgICAgICAgICBBYWsuYWRkQ29tbWFuZHMoY21kKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgcmVnaXN0ZXJDb25zb2xlIDogZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmxvZyA9IEFhay5vcHRzLmRlYnVnID8gY29uc29sZS5sb2cuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uICgpIHt9OwogICAgICB0aGlzLmluZm8gPSBBYWsub3B0cy5kZWJ1ZyA/IGNvbnNvbGUuaW5mby5iaW5kKGNvbnNvbGUpIDogZnVuY3Rpb24gKCkge307CiAgICAgIHRoaXMuZXJyb3IgPSBBYWsub3B0cy5kZWJ1ZyA/IGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uICgpIHt9OwogICAgICB0aGlzLndhcm4gPSBBYWsub3B0cy5kZWJ1ZyA/IGNvbnNvbGUud2Fybi5iaW5kKGNvbnNvbGUpIDogZnVuY3Rpb24gKCkge307CiAgICB9LAogICAgaXNUb3BmcmFtZSA6ICh3aW5kb3cucGFyZW50ID09IHdpbmRvdy5zZWxmKSwKICAgIHV3IDogdHlwZW9mIHVuc2FmZVdpbmRvdyAhPSAndW5kZWZpbmVkJyA/IHVuc2FmZVdpbmRvdyA6IHdpbmRvdywKICAgIHVzZUdNIDogdHlwZW9mIEdNX2dldFZhbHVlICE9ICd1bmRlZmluZWQnLAogICAgYXBpR00gOiBmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChBYWsuaXNUb3BmcmFtZSkgewogICAgICAgIC8vIEdNIEFQSSAtIGh0dHA6Ly90aW55dXJsLmNvbS95ZWVmbmo1CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0IDogdHlwZW9mIEdNX3htbGh0dHBSZXF1ZXN0ICE9ICd1bmRlZmluZWQnLAogICAgICAgICAgR01fc2V0VmFsdWUgOiB0eXBlb2YgR01fc2V0VmFsdWUgIT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgICBHTV9nZXRWYWx1ZSA6IHR5cGVvZiBHTV9nZXRWYWx1ZSAhPSAndW5kZWZpbmVkJywKICAgICAgICAgIEdNX2FkZFN0eWxlIDogdHlwZW9mIEdNX2FkZFN0eWxlICE9ICd1bmRlZmluZWQnLAogICAgICAgICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZCA6IHR5cGVvZiBHTV9yZWdpc3Rlck1lbnVDb21tYW5kICE9ICd1bmRlZmluZWQnLAogICAgICAgICAgR01faW5mbyA6IHR5cGVvZiBHTV9pbmZvICE9ICd1bmRlZmluZWQnLAogICAgICAgICAgR01fZ2V0TWV0YWRhdGEgOiB0eXBlb2YgR01fZ2V0TWV0YWRhdGEgIT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgICBHTV9kZWxldGVWYWx1ZSA6IHR5cGVvZiBHTV9kZWxldGVWYWx1ZSAhPSAndW5kZWZpbmVkJywKICAgICAgICAgIEdNX2xpc3RWYWx1ZXMgOiB0eXBlb2YgR01fbGlzdFZhbHVlcyAhPSAndW5kZWZpbmVkJywKICAgICAgICAgIEdNX2dldFJlc291cmNlVGV4dCA6IHR5cGVvZiBHTV9nZXRSZXNvdXJjZVRleHQgIT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgICBHTV9nZXRSZXNvdXJjZVVSTCA6IHR5cGVvZiBHTV9nZXRSZXNvdXJjZVVSTCAhPSAndW5kZWZpbmVkJywKICAgICAgICAgIEdNX2xvZyA6IHR5cGVvZiBHTV9sb2cgIT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgICBHTV9vcGVuSW5UYWIgOiB0eXBlb2YgR01fb3BlbkluVGFiICE9ICd1bmRlZmluZWQnLAogICAgICAgICAgR01fc2V0Q2xpcGJvYXJkIDogdHlwZW9mIEdNX3NldENsaXBib2FyZCAhPSAndW5kZWZpbmVkJwogICAgICAgIH07CiAgICAgIH0KICAgIH0sCiAgICBnbyA6IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICB9LAogICAgcmVmcmVzaCA6IGZ1bmN0aW9uICgpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgIH0sCiAgICByZWxvYWQgOiBmdW5jdGlvbiAoKSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7CiAgICB9LAogICAgY29udGFpbnMgOiBmdW5jdGlvbiAoc3RyaW5nLCBzZWFyY2gpIHsKICAgICAgcmV0dXJuIHN0cmluZy5pbmRleE9mKHNlYXJjaCkgIT0gLTE7CiAgICB9LAogICAgZ2V0QnJvd3NlciA6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHVhID0gd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQ7CiAgICAgIGlmIChBYWsuY29udGFpbnModWEsICdGaXJlZm94JykpIHsKICAgICAgICByZXR1cm4gIkZpcmVmb3giOwogICAgICB9IGVsc2UgaWYgKEFhay5jb250YWlucyh1YSwgJ1NsZWlwbmlyJykpIHsKICAgICAgICByZXR1cm4gIlNsZWlwbmlyIjsgLy8gTW9iaWxlCiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnVUNCcm93c2VyJykpIHsKICAgICAgICByZXR1cm4gIlVDQnJvd3NlciI7IC8vIE1vYmlsZQogICAgICB9IGVsc2UgaWYgKEFhay5jb250YWlucyh1YSwgJ0RvbGZpbicpKSB7CiAgICAgICAgcmV0dXJuICJEb2xwaGluIjsgLy8gTW9iaWxlCiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnTVNJRScpKSB7CiAgICAgICAgcmV0dXJuICJJbnRlcm5ldEV4cGxvcmVyIjsKICAgICAgfSBlbHNlIGlmIChBYWsuY29udGFpbnModWEsICdNaWRvcmknKSkgewogICAgICAgIHJldHVybiAiTWlkb3JpIjsKICAgICAgfSBlbHNlIGlmIChBYWsuY29udGFpbnModWEsICdPcGVyYScpIHx8IEFhay5jb250YWlucyh1YSwgJ09QUicpKSB7CiAgICAgICAgcmV0dXJuICJPcGVyYSI7CiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnQ2hyb21lJykpIHsKICAgICAgICByZXR1cm4gIkNocm9tZSI7CiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnU2FmYXJpJykpIHsKICAgICAgICByZXR1cm4gIlNhZmFyaSI7CiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnS29ucXVlcm9yJykpIHsKICAgICAgICByZXR1cm4gIktvbnF1ZXJvciI7CiAgICAgIH0gZWxzZSBpZiAoQWFrLmNvbnRhaW5zKHVhLCAnUGFsZU1vb24nKSkgewogICAgICAgIHJldHVybiAiUGFsZU1vb24iOyAvLyBmb3JrIGZpcmVmb3gKICAgICAgfSBlbHNlIGlmIChBYWsuY29udGFpbnModWEsICdDeWJlcmZveCcpKSB7CiAgICAgICAgcmV0dXJuICJDeWJlcmZveCI7IC8vIGZvcmsgZmlyZWZveAogICAgICB9IGVsc2UgaWYgKEFhay5jb250YWlucyh1YSwgJ1NlYU1vbmtleScpKSB7CiAgICAgICAgcmV0dXJuICJTZWFNb25rZXkiOyAvLyBmb3JrIGZpcmVmb3gKICAgICAgfSBlbHNlIGlmIChBYWsuY29udGFpbnModWEsICdJY2V3ZWFzZWwnKSkgewogICAgICAgIHJldHVybiAiSWNld2Vhc2VsIjsgLy8gZm9yayBmaXJlZm94CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHVhOwogICAgICB9CiAgICB9LAogICAgZ2V0VmVyc2lvbiA6IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIE51bWJlcihBYWsudmVyc2lvbik7CiAgICB9LAogICAgZ2V0U2NyaXB0TWFuYWdlciA6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKHR5cGVvZiBHTV9pbmZvID09ICdvYmplY3QnKSB7CiAgICAgICAgLy8gR3JlYXNlbW9ua2V5IChGaXJlZm94KQogICAgICAgIGlmICh0eXBlb2YgR01faW5mby51dWlkICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICByZXR1cm4gJ0dyZWFzZW1vbmtleSc7CiAgICAgICAgfSAvLyBUYW1wZXJtb25rZXkgKENocm9tZS9PcGVyYSkKICAgICAgICBlbHNlIGlmICh0eXBlb2YgR01faW5mby5zY3JpcHRIYW5kbGVyICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICByZXR1cm4gJ1RhbXBlcm1vbmtleSc7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNjcmlwdGlzaCAoRmlyZWZveCkKICAgICAgICBpZiAodHlwZW9mIEdNX2dldE1ldGFkYXRhID09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIHJldHVybiAnU2NyaXB0aXNoJzsKICAgICAgICB9IC8vIE5pbmphS2l0IChTYWZhcmkvQ2hyb21lKQogICAgICAgIGVsc2UgaWYgKHR5cGVvZiBHTV9zZXRWYWx1ZSAhPSAndW5kZWZpbmVkJyAmJgogICAgICAgICAgdHlwZW9mIEdNX2dldFJlc291cmNlVGV4dCA9PSAndW5kZWZpbmVkJyAmJgogICAgICAgICAgdHlwZW9mIEdNX2dldFJlc291cmNlVVJMID09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICB0eXBlb2YgR01fb3BlbkluVGFiID09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICB0eXBlb2YgR01fc2V0Q2xpcGJvYXJkID09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICByZXR1cm4gJ05pbmphS2l0JzsKICAgICAgICB9IGVsc2UgeyAvLyBOYXRpdmUKICAgICAgICAgIHJldHVybiAnTmF0aXZlJzsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBnZW5lcmF0ZUlEIDogZnVuY3Rpb24gKGxlbikgewogICAgICB2YXIgc3RyID0gJyc7CiAgICAgIHZhciBjaGFyc2V0ID0gImFiY2RlZmdoaWprbG5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWiI7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgKGxlbiA/IGxlbiA6IDEwKTsgKytpKSB7CiAgICAgICAgc3RyICs9IGNoYXJzZXQuY2hhckF0KE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJzZXQubGVuZ3RoKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHN0cjsKICAgIH0sCiAgICBnZW5lcmF0ZVVVSUQgOiBmdW5jdGlvbiAoKSB7CiAgICAgIC8vIFVuaXZlcnNhbGx5IFVuaXF1ZSBJRGVudGlmaWVyCiAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHZhciB1dWlkID0gJ3h4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCcucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgewogICAgICAgICAgdmFyIHIgPSAoZCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpOwogICAgICAgICAgcmV0dXJuIChjID09ICd4JyA/IHIgOiAociAmIDB4NyB8IDB4OCkpLnRvU3RyaW5nKDE2KTsKICAgICAgICB9KTsKICAgICAgcmV0dXJuIHV1aWQ7CiAgICB9LAogICAgZ2V0VVVJRCA6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIG5hbWUgPSAndXVpZCc7CiAgICAgIGlmIChBYWsuZ2V0VmFsdWUobmFtZSkgPT09IG51bGwpIHsKICAgICAgICBBYWsuc2V0VmFsdWUobmFtZSwgQWFrLmdlbmVyYXRlVVVJRCgpKTsKICAgICAgfQogICAgICByZXR1cm4gQWFrLmdldFZhbHVlKG5hbWUpOwogICAgfSwKICAgIHNjaGVkdWxlIDogZnVuY3Rpb24gKGRheXMsIG5hbWUsIGNhbGxiYWNrKSB7CiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbGF0ZXIgPSBpc05hTihBYWsuZ2V0VmFsdWUobmFtZSkpID8gMSA6IE51bWJlcihBYWsuZ2V0VmFsdWUobmFtZSkpOwogICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICBpZiAobGF0ZXIgPCBub3cpIHsKICAgICAgICAgIEFhay5zZXRWYWx1ZShuYW1lLCAobm93ICsgKGRheXMgKiAyNCAqIDYwICogNjAgKiAxMDAwKSkudG9TdHJpbmcoKSk7CiAgICAgICAgICBjYWxsYmFjaygpOwogICAgICAgIH0KICAgICAgfSwgMWUzKTsKICAgIH0sCiAgICBub3RpZmljYXRpb24gOiBmdW5jdGlvbiAobWVzc2FnZSwgZGVsYXkpIHsKICAgICAgaWYgKEFhay5pc1RvcGZyYW1lKSB7CgogICAgICAgIC8vIHJlbW92ZSBvbGQgbm90aWZpY2F0aW9uCiAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJyNhYWstbm90aWNlLWZyYW1lJyk7CgogICAgICAgIC8vIGFkZCBuZXcgbm90aWZpY2F0aW9uCiAgICAgICAgQWFrLmNyZWF0ZUVsZW1lbnQoewogICAgICAgICAgdGFnIDogJ2lmcmFtZScsCiAgICAgICAgICBpZCA6ICdhYWstbm90aWNlLWZyYW1lJywKICAgICAgICAgIHN0eWxlIDogJ3Bvc2l0aW9uOmZpeGVkOyB6LWluZGV4Ojk5OTk5OTsgdG9wOjEwcHg7IGxlZnQ6MTBweDsnLAogICAgICAgICAgd2lkdGggOiAnMzYwcHgnLAogICAgICAgICAgaGVpZ2h0IDogJzEyMHB4JywKICAgICAgICAgIGZyYW1lYm9yZGVyIDogMCwKICAgICAgICAgIHNjcm9sbGluZyA6ICdubycsCiAgICAgICAgICAvL3NyYyA6ICcvL2xvY2FsaG9zdC9naXQvYW50aS1hZGJsb2NrLWtpbGxlci1wYWdlcy9ub3RpZmljYXRpb24uaHRtbCMnICsgYnRvYShtZXNzYWdlKSwKICAgICAgICAgIHNyYyA6ICcvL3JlZWsuZ2l0aHViLmlvL2FudGktYWRibG9jay1raWxsZXIvbm90aWZpY2F0aW9uLmh0bWwjJyArIHdpbmRvdy5idG9hKG1lc3NhZ2UpLAogICAgICAgICAgYXBwZW5kIDogJ2JvZHknLAogICAgICAgICAgY2FsbGJhY2sgOiBmdW5jdGlvbiAoc2VsZikgewoKICAgICAgICAgICAgLy8gbWFudWFsbHkgcmVtb3ZlCiAgICAgICAgICAgIEFhay5vbkV2ZW50KHdpbmRvdywgIm1lc3NhZ2UiLCBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAoZXZlbnQuZGF0YSA9PSAicmVtb3ZlTm90aWZpY2F0aW9uIikgewogICAgICAgICAgICAgICAgc2VsZi5yZW1vdmUoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVtb3ZlCiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBzZWxmLnJlbW92ZSgpOwogICAgICAgICAgICB9LCBkZWxheSB8fCAzZTQpOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgfQogICAgfSwKICAgIGNoZWNrTGlzdCA6IGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKEFhay51c2VHTSAmJiBBYWsub3B0cy5jaGVja0xpc3QgJiYgQWFrLmlzVG9wZnJhbWUpIHsKICAgICAgICBBYWsuc2NoZWR1bGUoMSwgJ25leHRjaGVja2xpc3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsucmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBYWsuY3JlYXRlRWxlbWVudCh7CiAgICAgICAgICAgICAgdGFnIDogJ3NjcmlwdCcsCiAgICAgICAgICAgICAgc3JjIDogd2luZG93LmF0b2IoJ0x5OXlaV1ZyTG1kcGRHaDFZaTVwYnk5aGJuUnBMV0ZrWW14dlkyc3RhMmxzYkdWeUwyc3lWWGMzYVhOSWNrMXROVXBZVURGV2QyUjRZelUyTjFwTFl6RmhXalJKTG1weicpLAogICAgICAgICAgICAgIGFwcGVuZCA6ICdib2R5JywKICAgICAgICAgICAgICBldmVudCA6IHsKICAgICAgICAgICAgICAgIGVycm9yIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICBBYWsuaW5mbygnQWFrTGlzdCBkZXRlY3RlZCAhJyk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9hZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgQWFrLndhcm4oJ0Fha0xpc3Qgbm90IGRldGVjdGVkICEnKTsKICAgICAgICAgICAgICAgICAgQWFrLm5vdGlmaWNhdGlvbignSXQgc2VlbXMgdGhhdCB5b3UgaGF2ZSBub3Qgc3Vic2NyaWJlZCBvciBkaXNhYmxlZCA8Yj5BYWtMaXN0PC9iPi4gPGEgaHJlZj0iJyArIEFhay5zdWJzY3JpYmVVUkwgKyAnIiB0YXJnZXQ9Il9ibGFuayI+U3Vic2NyaWJlPC9hPiBvciA8YSBocmVmPSInICsgQWFrLnNldHRpbmdzVVJMICsgJyIgdGFyZ2V0PSJfYmxhbmsiPkRpc2FibGUgdGhpcyBhbGVydDwvYT4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjaGVja1VwZGF0ZSA6IGZ1bmN0aW9uIChhdXRvKSB7CgogICAgICB2YXIgY2hlY2sgPSBmdW5jdGlvbiAobm90aWZ5RmFsc2UpIHsKICAgICAgICBBYWsucmVxdWVzdCh7CiAgICAgICAgICB1cmwgOiBBYWsuZG93bmxvYWRVUkwsCiAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3BvbnNlLnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1czsKICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgICB2YXIgbG9jYWwgPSBBYWsuZ2V0VmVyc2lvbigpOwogICAgICAgICAgICAgIHZhciByZW1vdGUgPSBOdW1iZXIocmVzLm1hdGNoKC9AdmVyc2lvblxzKyhcZCtcLlxkKykvKVsxXSk7CiAgICAgICAgICAgICAgaWYgKGxvY2FsIDwgcmVtb3RlKSB7CiAgICAgICAgICAgICAgICBBYWsubm90aWZpY2F0aW9uKCdBbnRpLUFkYmxvY2sgS2lsbGVyIHYnICsgcmVtb3RlICsgJyBpcyBhdmFpbGFibGUgPGEgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9IicgKyBBYWsuZG93bmxvYWRVUkwgKyAnIj5JbnN0YWxsPC9hPi4nKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5vdGlmeUZhbHNlKSB7CiAgICAgICAgICAgICAgICBBYWsubm90aWZpY2F0aW9uKCdObyB1cGRhdGUgZm91bmQuJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICBpZiAoYXV0bykgeyAvLyBhdXRvIG1vZGUKICAgICAgICBpZiAoQWFrLnVzZUdNICYmIEFhay5vcHRzLmNoZWNrVXBkYXRlICYmIEFhay5pc1RvcGZyYW1lKSB7CiAgICAgICAgICBBYWsucmVhZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBYWsuc2NoZWR1bGUoNywgJ25leHRjaGVja3VwZGF0ZScsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBjaGVjayhmYWxzZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgeyAvLyBtYW51YWwgbW9kZQogICAgICAgIGlmIChBYWsuaXNUb3BmcmFtZSkgewogICAgICAgICAgY2hlY2sodHJ1ZSk7CiAgICAgICAgfQogICAgICB9CgogICAgfSwKICAgIG9wZW5JblRhYiA6IGZ1bmN0aW9uICh1cmwpIHsKICAgICAgaWYgKHR5cGVvZiBHTV9vcGVuSW5UYWIgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBHTV9vcGVuSW5UYWIodXJsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgbmV3V2luZG93ID0gd2luZG93Lm9wZW4odXJsLCAiX2JsYW5rIik7CiAgICAgICAgbmV3V2luZG93LmZvY3VzKCk7CiAgICAgIH0KICAgIH0sCiAgICByZXF1ZXN0IDogZnVuY3Rpb24gKHNldHRpbmdzKSB7CiAgICAgIHNldHRpbmdzLnVybCA9IHNldHRpbmdzLnVybCB8fCAnJzsKICAgICAgc2V0dGluZ3MubWV0aG9kID0gc2V0dGluZ3MubWV0aG9kIHx8ICdHRVQnOwogICAgICBzZXR0aW5ncy5oZWFkZXJzID0gc2V0dGluZ3MuaGVhZGVycyB8fCB7fTsKICAgICAgc2V0dGluZ3MudGltZW91dCA9IHNldHRpbmdzLnRpbWVvdXQgfHwgMmU0OyAvLyAyMHMKICAgICAgaWYgKHNldHRpbmdzLmRhdGEgfHwgc2V0dGluZ3MubWV0aG9kID09ICdQT1NUJykgewogICAgICAgIHNldHRpbmdzLm1ldGhvZCA9ICdQT1NUJzsKICAgICAgICBzZXR0aW5ncy5kYXRhID0gQWFrLnNlcmlhbGl6ZShzZXR0aW5ncy5kYXRhIHx8IHt9KTsKICAgICAgICBzZXR0aW5ncy5oZWFkZXJzID0gQWFrLnNldFByb3BlcnRpZXMoc2V0dGluZ3MuaGVhZGVycywgewogICAgICAgICAgICAnWC1SZXF1ZXN0ZWQtV2l0aCcgOiAnWE1MSHR0cFJlcXVlc3QnLAogICAgICAgICAgICAnQ29udGVudC1UeXBlJyA6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnCiAgICAgICAgICB9KTsKICAgICAgfQoKICAgICAgLy8gb3ZlcnJpZGUgdG8gaW50ZWdyYXRlIGxvZwogICAgICBzZXR0aW5ncy5fb25sb2FkID0gc2V0dGluZ3Mub25sb2FkOwogICAgICBzZXR0aW5ncy5vbmxvYWQgPSBmdW5jdGlvbiAoeGhyKSB7CiAgICAgICAgaWYgKEFhay5vcHRzLmxvZ1hocikgewogICAgICAgICAgQWFrLmxvZyhBYWsuZ2V0U2NyaXB0TWFuYWdlcigpICsgJyB4aHInLCB4aHIpOwogICAgICAgIH0KICAgICAgICBzZXR0aW5ncy5fb25sb2FkKHhocik7CiAgICAgIH07CgogICAgICBpZiAodHlwZW9mIEdNX3htbGh0dHBSZXF1ZXN0ICE9ICd1bmRlZmluZWQnKSB7CiAgICAgICAgLy8gUmVxdWVzdCB3aXRoIEdNIEFQSQogICAgICAgIC8vIGRvYzogaHR0cDovL3Rpbnl1cmwuY29tLzJ0N3dicgogICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KHNldHRpbmdzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBSZXF1ZXN0IHdpdGggV2ViIEFQSQogICAgICAgIC8vIFVzaW5nIHJlbW90ZSBzZXJ2ZXIgdG8gYWxsb3cgY3Jvc3Mtb3JpZ2luIHJlcXVlc3RzLgogICAgICAgIC8vIGRvYzogaHR0cDovL3Rpbnl1cmwuY29tL29kejY2NGEKICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9wOXpydXpuCiAgICAgICAgdmFyIHhociA9IG5ldyB3aW5kb3cuWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICB4aHIub3BlbignUE9TVCcsICdodHRwOi8vcmVla3NpdGUuY29tL3B1YmxpYy94aHIucGhwJywgdHJ1ZSk7CiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtdHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsKICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHJlcyA9IHhoci5yZXNwb25zZVRleHQ7CiAgICAgICAgICB2YXIganNvbiA9IEpTT04gJiYgSlNPTi5wYXJzZShyZXMpOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHhociwgInJlc3BvbnNlVGV4dCIsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgdmFsdWUgOiBqc29uLnJlc3BvbnNlCiAgICAgICAgICB9KTsKICAgICAgICAgIHNldHRpbmdzLm9ubG9hZCh4aHIpOwogICAgICAgIH07CiAgICAgICAgeGhyLnNlbmQoQWFrLnNlcmlhbGl6ZShzZXR0aW5ncykpOwogICAgICB9CiAgICB9LAogICAgZGVsZXRlVmFsdWUgOiBmdW5jdGlvbiAobmFtZSkgewogICAgICBpZiAodHlwZW9mIEdNX2RlbGV0ZVZhbHVlICE9PSAidW5kZWZpbmVkIiAmJiAhbmFtZSkgewogICAgICAgIHZhciB2YWxzID0gR01fbGlzdFZhbHVlcygpOwogICAgICAgIGZvciAodmFyIGkgaW4gdmFscykgewogICAgICAgICAgaWYgKHZhbHMuaGFzT3duUHJvcGVydHkoaSkpCiAgICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlKHZhbHNbaV0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0eXBlb2YgR01fZGVsZXRlVmFsdWUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgR01fZGVsZXRlVmFsdWUobmFtZSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRWYWx1ZSA6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICBpZiAodHlwZW9mIEdNX3NldFZhbHVlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIEdNX3NldFZhbHVlKG5hbWUsIHZhbHVlKTsKICAgICAgfQogICAgfSwKICAgIGdldFZhbHVlIDogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgaWYgKHR5cGVvZiBHTV9saXN0VmFsdWVzICE9PSAidW5kZWZpbmVkIiAmJiAhbmFtZSkgewogICAgICAgIHZhciBsaXN0ID0ge307CiAgICAgICAgdmFyIHZhbHMgPSBHTV9saXN0VmFsdWVzKCk7CiAgICAgICAgZm9yICh2YXIgaSBpbiB2YWxzKSB7CiAgICAgICAgICBpZiAodmFscy5oYXNPd25Qcm9wZXJ0eShpKSkKICAgICAgICAgICAgbGlzdFt2YWxzW2ldXSA9IEdNX2dldFZhbHVlKHZhbHNbaV0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGlzdDsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgR01fZ2V0VmFsdWUgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBHTV9nZXRWYWx1ZShuYW1lKSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICByZXR1cm4gR01fZ2V0VmFsdWUobmFtZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCiAgICBzZXRMb2NhbCA6IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgewogICAgICB0cnkgewogICAgICAgIC8vIFNlY3VyaXR5RXJyb3I6IFRoZSBvcGVyYXRpb24gaXMgaW5zZWN1cmUuCiAgICAgICAgLy8gZG9jOiBodHRwOi8vdGlueXVybC5jb20vOHBlcXd2ZAogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LmxvY2FsU3RvcmFnZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShuYW1lLCB2YWx1ZS50b1N0cmluZygpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgQWFrLndhcm4oIlNvcnJ5ISBObyBXZWIgU3RvcmFnZSBzdXBwb3J0LiIpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkge30KICAgIH0sCiAgICBnZXRMb2NhbCA6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cubG9jYWxTdG9yYWdlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShuYW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgQWFrLndhcm4oIlNvcnJ5ISBObyBXZWIgU3RvcmFnZSBzdXBwb3J0LiIpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCiAgICBzZXRTZXNzaW9uIDogZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8gRG9jOiBodHRwOi8vdGlueXVybC5jb20vOHBlcXd2ZAogICAgICAgIGlmICh0eXBlb2Ygd2luZG93LnNlc3Npb25TdG9yYWdlICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgd2luZG93LnNlc3Npb25TdG9yYWdlLnNldEl0ZW0obmFtZSwgdmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEFhay53YXJuKCJTb3JyeSEgTm8gV2ViIFN0b3JhZ2Ugc3VwcG9ydC4iKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICB9LAogICAgZ2V0U2Vzc2lvbiA6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICByZXR1cm4gd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0obmFtZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEFhay53YXJuKCJTb3JyeSEgTm8gV2ViIFN0b3JhZ2Ugc3VwcG9ydC4iKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAogICAgc2V0Q29va2llIDogZnVuY3Rpb24gKG5hbWUsIHZhbHVlLCB0aW1lLCBwYXRoKSB7CiAgICAgIHZhciBleHBpcmVzID0gbmV3IERhdGUoKTsKICAgICAgZXhwaXJlcy5zZXRUaW1lKG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgKHRpbWUgfHwgMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCkpOwogICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSArICI7ZXhwaXJlcz0iICsgZXhwaXJlcy50b0dNVFN0cmluZygpICsgIjtwYXRoPSIgKyAocGF0aCB8fCAnLycpOwogICAgfSwKICAgIGdldENvb2tpZSA6IGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHZhciB2YWx1ZSA9ICI7ICIgKyBkb2N1bWVudC5jb29raWU7CiAgICAgIHZhciBwYXJ0cyA9IHZhbHVlLnNwbGl0KCI7ICIgKyBuYW1lICsgIj0iKTsKICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PSAyKQogICAgICAgIHJldHVybiBwYXJ0cy5wb3AoKS5zcGxpdCgiOyIpLnNoaWZ0KCk7CiAgICB9LAogICAgc3RvcFJlZGlyZWN0IDogZnVuY3Rpb24gKCkgewogICAgICBpZiAoJ3dhdGNoJyBpbiB3aW5kb3cpIHsKICAgICAgICBBYWsudXcud2F0Y2goImxvY2F0aW9uIiwgZnVuY3Rpb24gKCkge30pOwogICAgICAgIEFhay51dy5sb2NhdGlvbi53YXRjaCgiaHJlZiIsIGZ1bmN0aW9uICgpIHt9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBBYWsudXcubG9jYXRpb24gPSAiIyI7CiAgICAgICAgdGhyb3cgJ1N0b3AgUmVkaXJlY3QnOwogICAgICB9CiAgICB9LAogICAgY29uZmlybUxlYXZlIDogZnVuY3Rpb24gKCkgewogICAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9OwogICAgfSwKICAgIGNvbmZpcm1SZXBvcnQgOiBmdW5jdGlvbiAoZWxlbSkgewogICAgICBlbGVtLmlubmVySFRNTCA9ICdSZXBvcnQnOwogICAgICBlbGVtLnRpdGxlID0gJ1JlcG9ydCBpc3N1ZSBvciBhbnRpLWFkYmxvY2snOwogICAgICBlbGVtLm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBpZiAod2luZG93LmNvbmZpcm0oIkRvIHlvdSB3YW50IHRvIHJlcG9ydCBpc3N1ZSBvciBhbnRpLWFkYmxvY2sgPyIpKSB7IC8vIENsaWMgb24gT0sKICAgICAgICAgIEFhay5nbyhBYWsucmVwb3J0VVJMKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgQWFrLmdvKGVsZW0uaHJlZik7CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIHVucGFja1NjcmlwdCA6IGZ1bmN0aW9uIChzb3VyY2UpIHsKICAgICAgLy8gZGVvYmZ1c2NhdGU6IHBhYytrZWQsIHBhYytrZXIsIG11bitnZWQsIHdpK3NlCiAgICAgIC8vIG5vdGU6ICJFeGNlcHRpb24gNDAzMDA4IiBjb25jYXRlbmF0aW5nIHN0cmluZ3MgZm9yIGJ5cGFzcyBncmVhc2Vmb3JrIG1hbHdhcmUgZmlsdGVyCiAgICAgIHZhciBzdWJzdHJpbmcgPSBzb3VyY2Uuc3Vic3RyaW5nKHNvdXJjZS5pbmRleE9mKCdldmFsKCcpKzQsIHNvdXJjZS5sYXN0SW5kZXhPZignKScpKzEpOwogICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCdyZXR1cm4gJytzdWJzdHJpbmcpKCk7CiAgICB9LAogICAgaGFzU2NyaXB0IDogZnVuY3Rpb24gKGNvbnRhaW5zLCBkb2MpIHsKICAgICAgLy8gYnk6IFdhdGlsaW4KICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5maWx0ZXIuY2FsbCgKICAgICAgICBkb2MgJiYgZG9jLnNjcmlwdHMgfHwgZG9jdW1lbnQuc2NyaXB0cywKICAgICAgICBmdW5jdGlvbiAoJHNjcmlwdCkgewogICAgICAgIHZhciBzb3VyY2UgPSAkc2NyaXB0LmlubmVySFRNTDsKICAgICAgICByZXR1cm4gc291cmNlICYmIHNvdXJjZS5pbmRleE9mKGNvbnRhaW5zKSAhPSAtMTsKICAgICAgfSlbMF07CiAgICB9LAogICAgYWRkU2NyaXB0IDogZnVuY3Rpb24gKHNvdXJjZSwgYm9keSkgewogICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgIHNjcmlwdC5pbm5lckhUTUwgPSAodHlwZW9mIHNvdXJjZSA9PT0gJ2Z1bmN0aW9uJykgPyBBYWsuaW50b1N0cmluZyhzb3VyY2UpIDogc291cmNlLnRvU3RyaW5nKCk7CiAgICAgIGlmIChib2R5KSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgfQogICAgICBzY3JpcHQucmVtb3ZlKCk7CiAgICB9LAogICAgbG9hZFNjcmlwdCA6IGZ1bmN0aW9uIChzcmMsIGJvZHksIG9ubG9hZCkgewogICAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgIHNjcmlwdC50eXBlID0gInRleHQvamF2YXNjcmlwdCI7CiAgICAgIHNjcmlwdC5zcmMgPSBzcmM7CiAgICAgIGlmIChvbmxvYWQpIHsKICAgICAgICBzY3JpcHQub25sb2FkID0gb25sb2FkOwogICAgICB9CiAgICAgIGlmIChib2R5KSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpOwogICAgICB9IGVsc2UgewogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKICAgICAgfQogICAgfSwKICAgIGltcG9ydFNjcmlwdCA6IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrKSB7CiAgICAgIEFhay5yZXF1ZXN0KHsKICAgICAgICB1cmwgOiB1cmwsCiAgICAgICAgb25sb2FkIDogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgdmFyIHJhd1NjcmlwdCA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgICAgICAgICAobmV3IEZ1bmN0aW9uKCdBYWsnLCByYXdTY3JpcHQgKyAnXG5ccicgKyBBYWsuaW50b1N0cmluZyhjYWxsYmFjaykpKShBYWspOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgaW50b1N0cmluZyA6IGZ1bmN0aW9uIChhKSB7CiAgICAgIGlmICh0eXBlb2YgYSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHZhciBzdHIgPSBhLnRvU3RyaW5nKCk7CiAgICAgICAgdmFyIGZpcnN0ID0gc3RyLmluZGV4T2YoInsiKSArIDE7CiAgICAgICAgdmFyIGxhc3QgPSBzdHIubGFzdEluZGV4T2YoIn0iKTsKICAgICAgICByZXR1cm4gc3RyLnN1YnN0cihmaXJzdCwgbGFzdCAtIGZpcnN0KS50cmltKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVudHJ5ID09PSAnb2JqZWN0JykgewogICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhKTsKICAgICAgfSBlbHNlIHsgLy8gYXJyYXkgb3Igc3RyaW5nCiAgICAgICAgcmV0dXJuIGEudG9TdHJpbmcoKTsKICAgICAgfQogICAgfSwKICAgIGludG9BcnJheSA6IGZ1bmN0aW9uIChhKSB7CiAgICAgIGlmICh0eXBlb2YgYSA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoYSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBhW2tleV07CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoYSk7CiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShhKSkgewogICAgICAgIHJldHVybiBhOwogICAgICB9CiAgICB9LAogICAgaW50b09iamVjdCA6IGZ1bmN0aW9uIChhKSB7CiAgICAgIGlmICh0eXBlb2YgYSA9PT0gJ3N0cmluZycpIHsKICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhKTsKICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGEpKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG8gPSB7fTsgaSA8IGEubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIG9baV0gPSBhW2ldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYSA9PT0gJ29iamVjdCcpIHsKICAgICAgICByZXR1cm4gYTsKICAgICAgfQogICAgfSwKICAgIGhhc0VsZW1lbnQgOiBmdW5jdGlvbiAoc2VsZWN0b3IsIGNhbGxiYWNrLCB0aW1lb3V0KSB7CiAgICAgIHZhciByZXBlYXQgPSB0aW1lb3V0IHx8IDEwOwogICAgICB2YXIgbG9vcCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlbGVtID0gQWFrLmdldEVsZW1lbnQoc2VsZWN0b3IpOwogICAgICAgICAgaWYgKGVsZW0pIHsKICAgICAgICAgICAgY2FsbGJhY2soZWxlbSk7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobG9vcCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXBlYXQgPSAocmVwZWF0KSA/IHJlcGVhdCAtIDEgOiBjbGVhckludGVydmFsKGxvb3ApOwogICAgICAgIH0sIDFlMyk7CiAgICB9LAogICAgcmVtb3ZlRWxlbWVudCA6IGZ1bmN0aW9uIChlbGVtKSB7CiAgICAgIGlmIChlbGVtIGluc3RhbmNlb2Ygd2luZG93LkhUTUxFbGVtZW50KSB7CiAgICAgICAgZWxlbS5yZW1vdmUoKTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZWxlbSA9PT0gInN0cmluZyIpIHsKICAgICAgICBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChlbGVtKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW0ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGVsZW1baV0ucmVtb3ZlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2V0RWxlbWVudCA6IGZ1bmN0aW9uIChzZWxlY3RvciwgY29udGV4dE5vZGUpIHsKICAgICAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHsKICAgICAgICBpZiAoc2VsZWN0b3IuaW5kZXhPZignLycpID09PSAwKSB7IC8vIGV4OiAvL2ltZ1tAY2xhc3M9InBob3RvIl0KICAgICAgICAgIHJldHVybiBkb2N1bWVudC5ldmFsdWF0ZShzZWxlY3RvciwgY29udGV4dE5vZGUgfHwgZG9jdW1lbnQsIG51bGwsIHdpbmRvdy5YUGF0aFJlc3VsdC5GSVJTVF9PUkRFUkVEX05PREVfVFlQRSwgbnVsbCkuc2luZ2xlTm9kZVZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gKGNvbnRleHROb2RlIHx8IGRvY3VtZW50KS5xdWVyeVNlbGVjdG9yKHNlbGVjdG9yKTsKICAgICAgfSBlbHNlIGlmIChzZWxlY3RvciBpbnN0YW5jZW9mIHdpbmRvdy5IVE1MRWxlbWVudCkgewogICAgICAgIHJldHVybiBzZWxlY3RvcjsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZUVsZW1lbnQgOiBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgdmFyIGVsZW0sCiAgICAgIG5vZGUgPSB7fTsKICAgICAgZm9yICh2YXIgbmFtZSBpbiBwcm9wcykgewogICAgICAgIGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgc3dpdGNoIChuYW1lKSB7CiAgICAgICAgICBjYXNlICJ0YWciOgogICAgICAgICAgICBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChwcm9wc1tuYW1lXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgIHZhciB0ZXh0ID0gKCdpbm5lclRleHQnIGluIGRvY3VtZW50KSA/ICdpbm5lclRleHQnIDogJ3RleHRDb250ZW50JzsKICAgICAgICAgICAgbm9kZVt0ZXh0XSA9IHByb3BzW25hbWVdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImh0bWwiOgogICAgICAgICAgICBub2RlLmlubmVySFRNTCA9IHByb3BzW25hbWVdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImNsYXNzaWQiOgogICAgICAgICAgICBub2RlLmNsYXNzTmFtZSA9IHByb3BzW25hbWVdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImFwcGVuZCI6CiAgICAgICAgICAgIGVsZW0gPSBBYWsuZ2V0RWxlbWVudChwcm9wc1tuYW1lXSk7CiAgICAgICAgICAgIGVsZW0uYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAicHJlcGVuZCI6CiAgICAgICAgICAgIGVsZW0gPSBBYWsuZ2V0RWxlbWVudChwcm9wc1tuYW1lXSk7CiAgICAgICAgICAgIGlmIChlbGVtLmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZWxlbS5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbS5jaGlsZE5vZGVzWzBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlbGVtLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVmb3JlIjoKICAgICAgICAgICAgZWxlbSA9IEFhay5nZXRFbGVtZW50KHByb3BzW25hbWVdKTsKICAgICAgICAgICAgZWxlbS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCBlbGVtKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJhZnRlciI6CiAgICAgICAgICAgIGVsZW0gPSBBYWsuZ2V0RWxlbWVudChwcm9wc1tuYW1lXSk7CiAgICAgICAgICAgIGVsZW0ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgZWxlbS5uZXh0U2libGluZyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAicmVwbGFjZSI6CiAgICAgICAgICAgIGVsZW0gPSBBYWsuZ2V0RWxlbWVudChwcm9wc1tuYW1lXSk7CiAgICAgICAgICAgIGVsZW0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobm9kZSwgZWxlbSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiZXZlbnQiOgogICAgICAgICAgICBmb3IgKHZhciBldk5hbWUgaW4gcHJvcHMuZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAocHJvcHMuZXZlbnQuaGFzT3duUHJvcGVydHkoZXZOYW1lKSkKICAgICAgICAgICAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcihldk5hbWUsIHByb3BzLmV2ZW50W2V2TmFtZV0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiY2FsbGJhY2siOgogICAgICAgICAgICBwcm9wc1tuYW1lXShub2RlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBub2RlLnNldEF0dHJpYnV0ZShuYW1lLCBwcm9wc1tuYW1lXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBub2RlOwogICAgfSwKICAgIGFkZEJhaXRFbGVtZW50IDogZnVuY3Rpb24gKHN0ck9wdHMpIHsgLy8gZXg6IGRpdi5hZHMgb3Igc3BhbiNhZHNACiAgICAgIHZhciBvcHRzID0gc3RyT3B0cy5yZXBsYWNlKCcuJywgJzpjbGFzc05hbWU6JykucmVwbGFjZSgnIycsICc6aWQ6Jykuc3BsaXQoJzonKTsKICAgICAgdmFyIGJhaXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG9wdHNbMF0pOwogICAgICBiYWl0LnNldEF0dHJpYnV0ZShvcHRzWzFdLCBvcHRzWzJdKTsKICAgICAgYmFpdC5pbm5lckhUTUwgPSAiPGJyPiI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChiYWl0KTsKICAgICAgcmV0dXJuIGJhaXQ7CiAgICB9LAogICAgcmVwbGFjZUVsZW1lbnQgOiBmdW5jdGlvbiAob2xkTm9kZSwgbmV3Tm9kZSkgewogICAgICBvbGROb2RlLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld05vZGUsIG9sZE5vZGUpOwogICAgfSwKICAgIHNldEVsZW1lbnQgOiBmdW5jdGlvbiAoc2VsZWN0b3IsIHByb3BzKSB7CiAgICAgIHZhciBub2RlID0gQWFrLmdldEVsZW1lbnQoc2VsZWN0b3IpOwogICAgICBpZiAobm9kZSkgewogICAgICAgIGZvciAodmFyIG5hbWUgaW4gcHJvcHMpIHsKICAgICAgICAgIGlmIChwcm9wcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgICAgY2FzZSAidGV4dCI6CiAgICAgICAgICAgICAgdmFyIHRleHQgPSAoJ2lubmVyVGV4dCcgaW4gZG9jdW1lbnQpID8gJ2lubmVyVGV4dCcgOiAndGV4dENvbnRlbnQnOwogICAgICAgICAgICAgIG5vZGVbdGV4dF0gPSBwcm9wc1tuYW1lXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiaHRtbCI6CiAgICAgICAgICAgICAgbm9kZS5pbm5lckhUTUwgPSBwcm9wc1tuYW1lXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiY2xhc3MiOgogICAgICAgICAgICAgIG5vZGUuY2xhc3NOYW1lID0gcHJvcHNbbmFtZV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUobmFtZSwgcHJvcHNbbmFtZV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgYWRkU3R5bGUgOiBmdW5jdGlvbiAoY3NzKSB7CiAgICAgIGNzcyA9IGNzcy5yZXBsYWNlKC87L2csICcgIWltcG9ydGFudDsnKTsKICAgICAgaWYgKHR5cGVvZiBHTV9hZGRTdHlsZSAhPSAndW5kZWZpbmVkJykgewogICAgICAgIEdNX2FkZFN0eWxlKGNzcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpKS5pbm5lckhUTUwgPSBjc3M7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkU3R5bGUgOiBmdW5jdGlvbiAoc3JjKSB7CiAgICAgIHZhciBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTsKICAgICAgc3R5bGUucmVsID0gInN0eWxlc2hlZXQiOwogICAgICBzdHlsZS5ocmVmID0gc3JjOwogICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgIH0sCiAgICBnZXRTdHlsZSA6IGZ1bmN0aW9uIChzZWxlY3RvciwgcHJvcCkgewogICAgICB2YXIgZWxlbSA9IEFhay5nZXRFbGVtZW50KHNlbGVjdG9yKTsKICAgICAgaWYgKGVsZW0uY3VycmVudFN0eWxlKSB7CiAgICAgICAgcmV0dXJuIGVsZW0uY3VycmVudFN0eWxlW3Byb3BdOwogICAgICB9IGVsc2UgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZWxlbSwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShwcm9wKTsKICAgICAgfQogICAgfSwKICAgIGRlY29kZVVSSSA6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzdHIpOwogICAgfSwKICAgIGVuY29kZVVSSSA6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudChzdHIpOwogICAgfSwKICAgIGVuY29kZUhUTUwgOiBmdW5jdGlvbiAoc3RyKSB7CiAgICAgIHJldHVybiBTdHJpbmcoc3RyKS5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7Jyk7CiAgICB9LAogICAgZGVjb2RlSFRNTCA6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgcmV0dXJuIFN0cmluZyhzdHIpLnJlcGxhY2UoLyZhbXA7L2csICcmJykucmVwbGFjZSgvJmx0Oy9nLCAnPCcpLnJlcGxhY2UoLyZndDsvZywgJz4nKS5yZXBsYWNlKC8mcXVvdDsvZywgJyInKTsKICAgIH0sCiAgICBzZXJpYWxpemUgOiBmdW5jdGlvbiAob2JqKSB7CiAgICAgIGlmICh0eXBlb2Ygb2JqID09ICdvYmplY3QnKSB7CiAgICAgICAgdmFyIGFyciA9IFtdOwogICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqKSB7CiAgICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKQogICAgICAgICAgICBhcnIucHVzaChwcm9wICsgJz0nICsgQWFrLmVuY29kZVVSSShvYmpbcHJvcF0pKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGFyci5qb2luKCcmJyk7CiAgICAgIH0KICAgICAgcmV0dXJuIG9iajsKICAgIH0sCiAgICB1bnNlcmlhbGl6ZSA6IGZ1bmN0aW9uIChzdHIpIHsKICAgICAgc3RyID0gQWFrLmRlY29kZUhUTUwoc3RyKTsKICAgICAgdmFyIGFyciA9IHN0ci5zcGxpdCgnJicpOwogICAgICB2YXIgb2JqID0ge307CiAgICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChlbnRyeSkgewogICAgICAgIGlmIChlbnRyeSAhPT0gJycgJiYgZW50cnkuc3BsaXQoJz0nKSkgewogICAgICAgICAgdmFyIHNwbGl0cyA9IGVudHJ5LnNwbGl0KCc9Jyk7CiAgICAgICAgICBvYmpbc3BsaXRzWzBdXSA9IEFhay5kZWNvZGVVUkkoc3BsaXRzWzFdKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gb2JqOwogICAgfSwKICAgIHVuc2V0UHJvcGVydGllcyA6IGZ1bmN0aW9uIChvYmosIHByb3BzKSB7CiAgICAgIHByb3BzID0gKHR5cGVvZiBwcm9wcyA9PSAnc3RyaW5nJykgPyBwcm9wcy5zcGxpdCgnLCcpIDogcHJvcHM7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgcHJvcCA9IHByb3BzW2ldOwogICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcCkpIHsKICAgICAgICAgIGRlbGV0ZSBvYmpbcHJvcF07CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvYmo7CiAgICB9LAogICAgc2V0UHJvcGVydGllcyA6IGZ1bmN0aW9uIChvYmoxLCBvYmoyKSB7CiAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqMikgewogICAgICAgIGlmIChvYmoyLmhhc093blByb3BlcnR5KHByb3ApKQogICAgICAgICAgb2JqMVtwcm9wXSA9IG9iajJbcHJvcF07CiAgICAgIH0KICAgICAgcmV0dXJuIG9iajE7CiAgICB9LAogICAgZml4UHJvdG9jb2xVUkwgOiBmdW5jdGlvbiAodXJsKSB7CiAgICAgIGlmICgvXmh0dHAvLnRlc3QodXJsKSkgeyAvLyBhYnNvbHV0ZQogICAgICAgIHJldHVybiB1cmw7CiAgICAgIH0gZWxzZSBpZiAoL15cL1wvLy50ZXN0KHVybCkpIHsgLy8gcmVsYXRpdmUKICAgICAgICByZXR1cm4gJ2h0dHA6JyArIHVybDsKICAgICAgfSBlbHNlIHsgLy8gbm9uZQogICAgICAgIHJldHVybiAnaHR0cDovLycgKyB1cmw7CiAgICAgIH0KICAgIH0sCiAgICBmYWtlRnVja0FkQmxvY2sgOiBmdW5jdGlvbiAoaW5zdGFuY2VOYW1lLCBjbGFzc05hbWUpIHsKCiAgICAgIC8vIGluamVjdCBmYWtlIGZ1Y2thZGJsdWNrCiAgICAgIEFhay5hZGRTY3JpcHQoQWFrLmludG9TdHJpbmcoZnVuY3Rpb24gKCkgewoKICAgICAgICAgIHZhciBDTEFTU05BTUUgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICAgICAgdmFyIGNhbGxOb3REZXRlY3RlZCA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRlYnVnID0gewogICAgICAgICAgICAgIHNldCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZ2V0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5vbkRldGVjdGVkID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgdGhpcy5vbih0cnVlLCBjYWxsYmFjayk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMub25Ob3REZXRlY3RlZCA9IGZ1bmN0aW9uIChjYWxsYmFjaykgewogICAgICAgICAgICAgIHRoaXMub24oZmFsc2UsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5vbiA9IGZ1bmN0aW9uIChkZXRlY3RlZCwgY2FsbGJhY2spIHsKICAgICAgICAgICAgICBpZiAoIWRldGVjdGVkKSB7CiAgICAgICAgICAgICAgICBjYWxsTm90RGV0ZWN0ZWQgPSBjYWxsYmFjazsKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoY2FsbGJhY2ssIDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zb2xlLmluZm8oWydBbnRpQWRiS2lsbGVyJywgbG9jYXRpb24uaG9zdCwgJ0Z1Y2tBZEJsb2NrJ10pOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLnNldE9wdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gewogICAgICAgICAgICAgIHNldCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgZ2V0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB0aGlzLmNoZWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChjYWxsTm90RGV0ZWN0ZWQpCiAgICAgICAgICAgICAgICBjYWxsTm90RGV0ZWN0ZWQoKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdGhpcy5lbWl0RXZlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHRoaXMuY2xlYXJFdmVudCA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgfTsKCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh3aW5kb3csIHsKICAgICAgICAgICAgQ0xBU1NOQU1FIDogewogICAgICAgICAgICAgIHZhbHVlIDogQ0xBU1NOQU1FLAogICAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMod2luZG93LCB7CiAgICAgICAgICAgIElOU1RBTkNFTkFNRSA6IHsKICAgICAgICAgICAgICB2YWx1ZSA6IG5ldyBDTEFTU05BTUUoKSwKICAgICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICB9KS5yZXBsYWNlKC9JTlNUQU5DRU5BTUUvZywgaW5zdGFuY2VOYW1lIHx8ICdmdWNrQWRCbG9jaycpCiAgICAgICAgLnJlcGxhY2UoL0NMQVNTTkFNRS9nLCBjbGFzc05hbWUgfHwgJ0Z1Y2tBZEJsb2NrJykpOwoKICAgIH0sIC8vIEV2ZW50cwogICAgb25FdmVudCA6IGZ1bmN0aW9uIChlbGVtZW50LCB0eXBlLCBsaXN0ZW5lciwgYnViYmxlcykgewogICAgICBpZiAod2luZG93LmFkZEV2ZW50TGlzdGVuZXIpIHsgLy8gRm9yIGFsbCBtYWpvciBicm93c2VycywgZXhjZXB0IElFIDggYW5kIGVhcmxpZXIKICAgICAgICAoZWxlbWVudCB8fCB3aW5kb3cpLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIsIGJ1YmJsZXMgfHwgZmFsc2UpOwogICAgICB9IGVsc2UgeyAvLyBGb3IgSUUgOCBhbmQgZWFybGllciB2ZXJzaW9ucwogICAgICAgIChlbGVtZW50IHx8IHdpbmRvdykuYXR0YWNoRXZlbnQoJ29uJyArIHR5cGUsIGxpc3RlbmVyKTsKICAgICAgfQogICAgICByZXR1cm4gYXJndW1lbnRzOwogICAgfSwKICAgIG9mZkV2ZW50IDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGxpc3RlbmVyLCBidWJibGVzKSB7CiAgICAgIGlmICh3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcikgeyAvLyBGb3IgYWxsIG1ham9yIGJyb3dzZXJzLCBleGNlcHQgSUUgOCBhbmQgZWFybGllcgogICAgICAgIChlbGVtZW50IHx8IHdpbmRvdykucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lciwgYnViYmxlcyB8fCBmYWxzZSk7CiAgICAgIH0gZWxzZSB7IC8vIEZvciBJRSA4IGFuZCBlYXJsaWVyIHZlcnNpb25zCiAgICAgICAgKGVsZW1lbnQgfHwgd2luZG93KS5kZXRhY2hFdmVudCgnb24nICsgdHlwZSwgbGlzdGVuZXIpOwogICAgICB9CiAgICB9LAogICAgZW1pdEV2ZW50IDogZnVuY3Rpb24gKGVsZW1lbnQsIHR5cGUsIGRldGFpbCwgYnViYmxlcywgY2FuY2VsYWJsZSkgewogICAgICB2YXIgZXZlbnQ7CiAgICAgIGlmICh3aW5kb3cuQ3VzdG9tRXZlbnQpIHsKICAgICAgICBldmVudCA9IG5ldyB3aW5kb3cuQ3VzdG9tRXZlbnQodHlwZSwgewogICAgICAgICAgICAiZGV0YWlsIiA6IGRldGFpbCB8fCB1bmRlZmluZWQKICAgICAgICAgIH0sIGJ1YmJsZXMgfHwgZmFsc2UsIGNhbmNlbGFibGUgfHwgZmFsc2UpOwogICAgICB9IGVsc2UgewogICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0N1c3RvbUV2ZW50Jyk7CiAgICAgICAgZXZlbnQuaW5pdEN1c3RvbUV2ZW50KCdvbicgKyB0eXBlLCBidWJibGVzIHx8IGZhbHNlLCBjYW5jZWxhYmxlIHx8IGZhbHNlLCB7CiAgICAgICAgICAiZGV0YWlsIiA6IGRldGFpbCB8fCB1bmRlZmluZWQKICAgICAgICB9KTsKICAgICAgfQogICAgICAoZWxlbWVudCB8fCB3aW5kb3cpLmRpc3BhdGNoRXZlbnQoZXZlbnQpOwogICAgfSwKICAgIGRldGVjdGVkIDogZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgaWYgKEFhay5vcHRzLmRlYnVnICYmIEFhay5vcHRzLmxvZ0RldGVjdGVkKSB7CiAgICAgICAgQWFrLmVtaXRFdmVudCh3aW5kb3csICdkZXRlY3RlZCcsIG5hbWUpOwogICAgICB9CiAgICB9LAogICAgcmVhZHkgOiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgICAgQWFrLm9uRXZlbnQod2luZG93LCAnbG9hZCcsIGNhbGxiYWNrKTsKICAgIH0sCiAgICBwbGF5ZXIgOiBmdW5jdGlvbiAoKSB7CgogICAgICB2YXIgUGxheWVyID0gZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudGFyZ2V0ID0ge307CiAgICAgICAgdGhpcy5wbGF5ZXIgPSB7fTsKICAgICAgICB0aGlzLm5hbWUgPSBudWxsOwogICAgICAgIHRoaXMudmVyc2lvbiA9IG51bGw7CiAgICAgICAgdGhpcy5saWJyYXJ5ID0gbnVsbDsKICAgICAgICB0aGlzLmZhbGxiYWNrID0gJ3ZsYyc7CiAgICAgICAgdGhpcy5hdXRvcGxheSA9IEFhay5vcHRzLmF1dG9QbGF5OwogICAgICAgIHRoaXMuYXJncyA9IG51bGw7CiAgICAgICAgdGhpcy5zZXR1cCA9IHt9OwogICAgICAgIHRoaXMub3B0aW9ucyA9IHsKICAgICAgICAgIGJ1aWxkIDogJ2VtYmVkJywKICAgICAgICAgIGluc2VydCA6ICdyZXBsYWNlJywKICAgICAgICAgIGNyb3NzU2V0dXAgOiB0cnVlCiAgICAgICAgfTsKICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7IC8vIGZsYXNoCiAgICAgICAgICB3bW9kZSA6ICdvcGFxdWUnLAogICAgICAgICAgcXVhbGl0eSA6ICdoaWdoJywKICAgICAgICAgIGJnY29sb3IgOiAnIzAwMDAwMCcsCiAgICAgICAgICB0eXBlIDogJ2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJywKICAgICAgICAgIHBsdWdpbnNwYWdlIDogJ2h0dHA6Ly93d3cuYWRvYmUuY29tL2dvL2dldGZsYXNoJywKICAgICAgICAgIGFsbG93c2NyaXB0YWNjZXNzIDogJ2Fsd2F5cycsIC8vIG5ldmVyIC8gYWx3YXlzCiAgICAgICAgICBhbGxvd2Z1bGxzY3JlZW4gOiB0cnVlCiAgICAgICAgfTsKICAgICAgfTsKCiAgICAgIFBsYXllci5wcm90b3R5cGUgPSB7IC8vIGh0dHA6Ly90aW55dXJsLmNvbS9wYjZmdGhqCiAgICAgICAgZ2V0VGFyZ2V0Tm9kZSA6IGZ1bmN0aW9uIChlbGVtZW50KSB7CgogICAgICAgICAgdGhpcy50YXJnZXQubm9kZSA9IEFhay5nZXRFbGVtZW50KGVsZW1lbnQpOwogICAgICAgICAgdGhpcy50YXJnZXQuaHRtbCA9IHRoaXMudGFyZ2V0Lm5vZGUub3V0ZXJIVE1MOwogICAgICAgICAgdGhpcy50YXJnZXQucGFyZW50ID0gdGhpcy50YXJnZXQubm9kZS5wYXJlbnROb2RlOwogICAgICAgICAgdGhpcy50YXJnZXQudGFnID0gdGhpcy50YXJnZXQubm9kZS50YWdOYW1lOwoKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5pZCA9IHRoaXMuYXR0cmlidXRlcy5uYW1lID0gQWFrLmdlbmVyYXRlSUQoKTsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5oZWlnaHQgPSB0aGlzLnRhcmdldC5ub2RlLmhlaWdodCB8fCB0aGlzLnRhcmdldC5ub2RlLmNsaWVudEhlaWdodCB8fCAnNDgwcHgnOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLndpZHRoID0gdGhpcy50YXJnZXQubm9kZS53aWR0aCB8fCB0aGlzLnRhcmdldC5ub2RlLmNsaWVudFdpZHRoIHx8ICc2NDBweCc7CiAgICAgICAgfSwKICAgICAgICBnZXRNaW1lVHlwZSA6IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9qcnM4Zmd6CiAgICAgICAgICBzd2l0Y2ggKHR5cGUudG9Mb3dlckNhc2UoKSkgewogICAgICAgICAgY2FzZSAnbXA0JzoKICAgICAgICAgICAgcmV0dXJuICd2aWRlby9tcDQnOwogICAgICAgICAgY2FzZSAnd2VibSc6CiAgICAgICAgICAgIHJldHVybiAndmlkZW8vd2VibSc7CiAgICAgICAgICBjYXNlICdvZ2cnOgogICAgICAgICAgY2FzZSAnb2d2JzoKICAgICAgICAgICAgcmV0dXJuICd2aWRlby9vZ2cnOwogICAgICAgICAgY2FzZSAnZmx2JzoKICAgICAgICAgICAgcmV0dXJuICd2aWRlby94LWZsdic7CiAgICAgICAgICBjYXNlICdobHMnOgogICAgICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL3gtbXBlZ1VSTCc7CiAgICAgICAgICBjYXNlICdoZHMnOgogICAgICAgICAgICByZXR1cm4gJ2FwcGxpY2F0aW9uL2Y0bSt4bWwnOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBidWlsZGluZyA6IGZ1bmN0aW9uICh0YWdOYW1lKSB7CiAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CgogICAgICAgICAgaWYgKEFhay5vcHRzLmZvcmNlVkxDICYmIHRoaXMubmFtZSAhPT0gJ3ZsYycpIHsKICAgICAgICAgICAgQWFrLmluZm8oJ2ZvcmNlIHBsYXlpbmcgd2l0aCBWTEMnKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMudmxjLmFwcGx5KHRoaXMsIHRoaXMuYXJncyk7CiAgICAgICAgICB9CgogICAgICAgICAgc3dpdGNoICh0YWdOYW1lKSB7CiAgICAgICAgICBjYXNlICdpZnJhbWUnOgogICAgICAgICAgICB0aGlzLnBsYXllci5ub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKCdzcmMnLCB0aGlzLmF0dHJpYnV0ZXMuc3JjIHx8IGxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGxvY2F0aW9uLmhvc3QgKyAnLycpOwogICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLnNyY2RvYykgewogICAgICAgICAgICAgIGlmICh0aGlzLnBsYXllci5ub2RlLmhhc0F0dHJpYnV0ZSgic3JjZG9jIikgfHwgJ3NyY2RvYycgaW4gdGhpcy5wbGF5ZXIubm9kZSkgewogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIubm9kZS5zZXRBdHRyaWJ1dGUoJ3NyY2RvYycsIHRoaXMuYXR0cmlidXRlcy5zcmNkb2MpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBkb2VzIG5vdCB3b3JrIGNvcnJlY3RseSB3aXRoIGZsb3dwbGF5ZXIKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKCdzcmMnLCAiZGF0YTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCwiICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuYXR0cmlidXRlcy5zcmNkb2MpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5wbGF5ZXIubm9kZS5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgdGhpcy5zZXR1cC53aWR0aCk7CiAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCB0aGlzLnNldHVwLmhlaWdodCk7CiAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKCdzdHlsZScsICdoZWlnaHQ6JyArIHRoaXMuc2V0dXAuaGVpZ2h0ICsgJ3B4OyB3aWR0aDonICsgdGhpcy5zZXR1cC53aWR0aCArICdweDsnKTsKICAgICAgICAgICAgdGhpcy5wbGF5ZXIubm9kZS5zZXRBdHRyaWJ1dGUoJ2ZyYW1lYm9yZGVyJywgMCk7CiAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKCdzY3JvbGxpbmcnLCAnbm8nKTsKICAgICAgICAgICAgdGhpcy5wbGF5ZXIubm9kZS5zZXRBdHRyaWJ1dGUoJ2FsbG93ZnVsbHNjcmVlbicsIHRydWUpOyAvLyBodHRwOi8vdGlueXVybC5jb20vb3l5ZWhhYgogICAgICAgICAgICAvLyBhbGxvd2Z1bGxzY3JlZW4gd2Via2l0YWxsb3dmdWxsc2NyZWVuIG1vemFsbG93ZnVsbHNjcmVlbiBvYWxsb3dmdWxsc2NyZWVuIG1zYWxsb3dmdWxsc2NyZWVuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAndmlkZW8nOgogICAgICAgICAgICB2YXIgYXR0ck5hbWU7CiAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpOwogICAgICAgICAgICBmb3IgKGF0dHJOYW1lIGluIHRoaXMuYXR0cmlidXRlcykgewogICAgICAgICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoYXR0ck5hbWUpKQogICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIubm9kZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIHRoaXMuYXR0cmlidXRlc1thdHRyTmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLmF1dG9wbGF5KSB7IC8vIGZpeCBidWcgZHVwbGljYXRlIHBsYXlpbmcgb24gZmlyZWZveC9jaHJvbWUKICAgICAgICAgICAgICB0aGlzLnBsYXllci5ub2RlLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy90aGlzLnBsYXkoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnBsYXllci5ub2RlLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7IC8vIHN3aXRjaCB0byBwbHVnaW4gcGxheWVyCiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBzZWxmLmFyZ3NbMF0gPSBzZWxmLnBsYXllci5ub2RlOwogICAgICAgICAgICAgICAgc2VsZi52bGNwbGF5ZXIuYXBwbHkoc2VsZiwgc2VsZi5hcmdzKTsKICAgICAgICAgICAgICB9LCA1MDAwKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OiAvLyBlbWJlZAogICAgICAgICAgICB0aGlzLnBsYXllci5ub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZW1iZWQnKTsKICAgICAgICAgICAgZm9yIChhdHRyTmFtZSBpbiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLmhhc093blByb3BlcnR5KGF0dHJOYW1lKSkKICAgICAgICAgICAgICAgIHRoaXMucGxheWVyLm5vZGUuc2V0QXR0cmlidXRlKGF0dHJOYW1lLCB0aGlzLmF0dHJpYnV0ZXNbYXR0ck5hbWVdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5wbGF5ZXIuaHRtbCA9IHRoaXMucGxheWVyLm5vZGUub3V0ZXJIVE1MOwogICAgICAgICAgdGhpcy5wbGF5ZXIudGFnID0gdGhpcy5wbGF5ZXIubm9kZS50YWdOYW1lOwogICAgICAgICAgdGhpcy5pbnNlcnRpbmcoKTsKICAgICAgICB9LAogICAgICAgIGluc2VydGluZyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLmluc2VydCkgewogICAgICAgICAgY2FzZSAnaW5uZXInOgogICAgICAgICAgICB0aGlzLnRhcmdldC5ub2RlLmlubmVySFRNTCA9IHRoaXMucGxheWVyLmh0bWw7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnYXBwZW5kJzoKICAgICAgICAgICAgdGhpcy50YXJnZXQucGFyZW50LnJlcGxhY2VDaGlsZCh0aGlzLnBsYXllci5ub2RlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OiAvLyByZXBsYWNlCiAgICAgICAgICAgIHRoaXMudGFyZ2V0LnBhcmVudC5yZXBsYWNlQ2hpbGQodGhpcy5wbGF5ZXIubm9kZSwgdGhpcy50YXJnZXQubm9kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoQWFrLm9wdHMubG9nUGxheWVyKSB7CiAgICAgICAgICAgIEFhay5sb2coJ3BsYXllcicsIHRoaXMpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfSwKICAgICAgICBlZGl0aW5nIDogZnVuY3Rpb24gKGVsZW0sIG9wdHMpIHsgLy8gcmV2aWV3CiAgICAgICAgICBBYWsuaGFzRWxlbWVudChlbGVtLCBmdW5jdGlvbiAodGhpc0VsZW1lbnQpIHsKICAgICAgICAgICAgdmFyIG9iaiwKICAgICAgICAgICAgc3dmLAogICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgcGFydHMsCiAgICAgICAgICAgIHBhcmFtLAogICAgICAgICAgICBhdHRyaWJ1dGVzLAogICAgICAgICAgICBhdHRyTmFtZTsKICAgICAgICAgICAgdmFyIHNvID0gdGhpc0VsZW1lbnQ7CiAgICAgICAgICAgIHZhciBjbG9uZSA9IHNvLmNsb25lTm9kZSh0cnVlKTsKCiAgICAgICAgICAgIC8vIHNldCBhdHRyaWlidXRlcwogICAgICAgICAgICBpZiAob3B0cy5zZXRBdHRyaWJ1dGUpIHsKICAgICAgICAgICAgICBhdHRyaWJ1dGVzID0gb3B0cy5zZXRBdHRyaWJ1dGU7CiAgICAgICAgICAgICAgZm9yIChhdHRyTmFtZSBpbiBhdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xvbmUucXVlcnlTZWxlY3RvcigncGFyYW1bbmFtZT0iJyArIGF0dHJOYW1lICsgJyJdJykpIHsKICAgICAgICAgICAgICAgICAgY2xvbmUucXVlcnlTZWxlY3RvcigncGFyYW1bbmFtZT0iJyArIGF0dHJOYW1lICsgJyJdJykudmFsdWUgPSBhdHRyaWJ1dGVzW2F0dHJOYW1lXTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2xvbmUuZ2V0QXR0cmlidXRlKGF0dHJOYW1lKSkgewogICAgICAgICAgICAgICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGF0dHJpYnV0ZXNbYXR0ck5hbWVdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHVuc2V0IGF0dHJpYnV0ZXMKICAgICAgICAgICAgaWYgKG9wdHMudW5zZXRBdHRyaWJ1dGVzKSB7CiAgICAgICAgICAgICAgYXR0cmlidXRlcyA9IG9wdHMuZGVsQXR0cmlidXRlczsKICAgICAgICAgICAgICBmb3IgKGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgICAgIGlmIChjbG9uZS5xdWVyeVNlbGVjdG9yKCdwYXJhbVtuYW1lPSInICsgYXR0ck5hbWUgKyAnIl0nKSkgewogICAgICAgICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudChjbG9uZS5xdWVyeVNlbGVjdG9yKCdwYXJhbVtuYW1lPSInICsgYXR0ck5hbWUgKyAnIl0nKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNsb25lLmdldEF0dHJpYnV0ZShhdHRyTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbYXR0ck5hbWVdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdHMuc2V0Rmxhc2h2YXJzIHx8IG9wdHMudW5zZXRGbGFzaHZhcnMpIHsKICAgICAgICAgICAgICBpZiAoY2xvbmUucXVlcnlTZWxlY3RvcigncGFyYW1bbmFtZT0iZmxhc2h2YXJzIl0nKSkgewogICAgICAgICAgICAgICAgcGFyYW0gPSBjbG9uZS5xdWVyeVNlbGVjdG9yKCdwYXJhbVtuYW1lPSJmbGFzaHZhcnMiXScpOwogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJhbS52YWx1ZTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNsb25lLmdldEF0dHJpYnV0ZSgnZmxhc2h2YXJzJykpIHsKICAgICAgICAgICAgICAgIHZhbHVlID0gY2xvbmUuZ2V0QXR0cmlidXRlKCdmbGFzaHZhcnMnKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNsb25lLmdldEF0dHJpYnV0ZSgnZGF0YScpICYmIGNsb25lLmdldEF0dHJpYnV0ZSgnZGF0YScpLmluZGV4T2YoJz8nKSA+PSAwKSB7CiAgICAgICAgICAgICAgICBwYXJ0cyA9IGNsb25lLmdldEF0dHJpYnV0ZSgnZGF0YScpLnNwbGl0KCc/JywgMik7CiAgICAgICAgICAgICAgICBzd2YgPSBwYXJ0cy5zaGlmdCgpOwogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJ0cy5zaGlmdCgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgb2JqID0gQWFrLnVuc2VyaWFsaXplKHZhbHVlKTsKICAgICAgICAgICAgICBpZiAob3B0cy5zZXRGbGFzaHZhcnMpIHsKICAgICAgICAgICAgICAgIG9iaiA9IEFhay5zZXRQcm9wZXJ0aWVzKG9iaiwgb3B0cy5zZXRGbGFzaHZhcnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAob3B0cy51bnNldEZsYXNodmFycykgewogICAgICAgICAgICAgICAgb2JqID0gQWFrLnVuc2V0UHJvcGVydGllcyhvYmosIG9wdHMudW5zZXRGbGFzaHZhcnMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB2YWx1ZSA9IEFhay5zZXJpYWxpemUob2JqKTsKCiAgICAgICAgICAgICAgaWYgKHBhcmFtKSB7CiAgICAgICAgICAgICAgICBwYXJhbS52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3dmKSB7CiAgICAgICAgICAgICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoJ2RhdGEnLCBzd2YgKyAnPycgKyB2YWx1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNsb25lLnNldEF0dHJpYnV0ZSgnZmxhc2h2YXJzJywgdmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXBsYWNlCiAgICAgICAgICAgIEFhay5sb2coc28sIGNsb25lLCBvYmopOwogICAgICAgICAgICBBYWsucmVwbGFjZUVsZW1lbnQoc28sIGNsb25lKTsKICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgZW1iZWRkaW5nIDogZnVuY3Rpb24gKGlkLCBzZXR1cCwgYXR0cmlidXRlcywgb3B0aW9ucykgeyAKICAgICAgICAKICAgICAgICAgIHRoaXMuZ2V0VGFyZ2V0Tm9kZShpZCk7CiAgICAgICAgICB0aGlzLmFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBBYWsuc2V0UHJvcGVydGllcyh0aGlzLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZXMgfHwge30pOwogICAgICAgICAgdGhpcy5vcHRpb25zID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5vcHRpb25zLCBvcHRpb25zIHx8IHt9KTsKCiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuc3JjID0gc2V0dXAuc3dmOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmlkID0gdGhpcy5hdHRyaWJ1dGVzLm5hbWUgPSBBYWsuZ2VuZXJhdGVJRCgpOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmhlaWdodCA9IHNldHVwLmhlaWdodCB8fCB0aGlzLmF0dHJpYnV0ZXMuaGVpZ2h0OwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLndpZHRoID0gc2V0dXAud2lkdGggfHwgdGhpcy5hdHRyaWJ1dGVzLndpZHRoOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmZsYXNodmFycyA9IEFhay5zZXJpYWxpemUoc2V0dXApOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnVuc2V0UHJvcGVydGllcyh0aGlzLmF0dHJpYnV0ZXMsICdzd2YnKTsKCiAgICAgICAgICB0aGlzLmJ1aWxkaW5nKCdlbWJlZCcpOwogICAgICAgIH0sCiAgICAgICAgandwbGF5ZXIgOiBmdW5jdGlvbiAoaWQsIHNldHVwLCBhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAvLyBKd1BsYXllciA3IChmbGFzaC9odG1sNSkKICAgICAgICAgIC8vIG5vdGU6IHByb2JsZW0gd2l0aCBzc2wKICAgICAgICAgIC8vIHNldHVwOiBodHRwOi8vdGlueXVybC5jb20vaGhyZ2phcCwgaHR0cDovL3Rpbnl1cmwuY29tL2dxczQ2dG0KICAgICAgICAgIC8vIGFwaTogaHR0cHM6Ly9kZXZlbG9wZXIuandwbGF5ZXIuY29tL2p3LXBsYXllci9kb2NzL2RldmVsb3Blci1ndWlkZS9hcGkvamF2YXNjcmlwdF9hcGlfcmVmZXJlbmNlLwogICAgICAgICAgLy8gaGxzOiBodHRwOi8vdGlueXVybC5jb20vcHhsOXNjcQogICAgICAgICAgLy8gaGxzLXRlc3RlcjogaHR0cDovL2RlbW8uandwbGF5ZXIuY29tL3N0cmVhbS10ZXN0ZXIvCiAgICAgICAgICAvLyBydG1wLWRlbW86IGh0dHBzOi8vd3d3LnNjYWxlZW5naW5lLmNvbS9qdzYKICAgICAgICAgIC8vIGlmcmFtZTogaHR0cDovL3Rpbnl1cmwuY29tLzg2YWdnNjgKCiAgICAgICAgICB0aGlzLmdldFRhcmdldE5vZGUoaWQpOwogICAgICAgICAgdGhpcy5hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzIHx8IHt9KTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IEFhay5zZXRQcm9wZXJ0aWVzKHRoaXMub3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7CgogICAgICAgICAgdGhpcy5zZXR1cCA9IHNldHVwOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcm9zc1NldHVwID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuc2V0dXAgPSB7CiAgICAgICAgICAgICAgY29udHJvbHMgOiB0cnVlLAogICAgICAgICAgICAgIGZpbGUgOiBzZXR1cC5zb3VyY2UsCiAgICAgICAgICAgICAgYWJvdXR0ZXh0IDogQWFrLm5hbWUsCiAgICAgICAgICAgICAgYWJvdXRsaW5rIDogQWFrLmhvbWVVUkwsCiAgICAgICAgICAgICAgd2lkdGggOiBzZXR1cC53aWR0aCB8fCB0aGlzLmF0dHJpYnV0ZXMud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0IDogc2V0dXAuaGVpZ2h0IHx8IHRoaXMuYXR0cmlidXRlcy5oZWlnaHQsCiAgICAgICAgICAgICAgYXV0b3N0YXJ0IDogc2V0dXAuYXV0b3BsYXkgfHwgdGhpcy5hdXRvcGxheSwKICAgICAgICAgICAgICBwcmltYXJ5IDogJ2h0bWw1JywKICAgICAgICAgICAgICBwcmVsb2FkIDogJ2F1dG8nLAogICAgICAgICAgICAgIHNraW4gOiB7IC8vIFNldmVuIHwgU2l4IHwgRml2ZSB8IEdsb3cgfCBCZWVsZGVuIHwgVmFwb3IgfCBCZWtsZSB8IFJvdW5kc3RlciB8IFN0b3JtdHJvb3BlcgogICAgICAgICAgICAgICAgbmFtZSA6IHNldHVwLnNraW4gfHwgInNpeCIgLy8gZGVmYXVsdCBza2luIEpXUDYKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChbJ21wNCcsICd3ZWJtJywgJ29nZycsICdvZ3YnXS5pbmRleE9mKHNldHVwLnR5cGUpID09PSAtMSkgewogICAgICAgICAgICAgIHRoaXMuc2V0dXAucHJpbWFyeSA9ICdmbGFzaCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNldHVwLnR5cGUgPT09ICdobHMnKSB7CiAgICAgICAgICAgICAgdGhpcy5zZXR1cC5obHNodG1sID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5zcmNkb2MgPSAnPGh0bWw+PGhlYWQ+PHN0eWxlIHR5cGU9InRleHQvY3NzIj5AZm9udC1mYWNle2ZvbnQtZmFtaWx5Omp3LWljb25zO3NyYzp1cmwoJyArIGxvY2F0aW9uLnByb3RvY29sICsgJ3NzbC5wLmp3cGNkbi5jb20vcGxheWVyL3YvNy40LjMvanctaWNvbnMud29mZikgZm9ybWF0KCJ3b2ZmIiksdXJsKCcgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL3NzbC5wLmp3cGNkbi5jb20vcGxheWVyL3YvNy40LjMvanctaWNvbnMudHRmKSBmb3JtYXQoInRydWV0eXBlIik7Zm9udC13ZWlnaHQ6NDAwO2ZvbnQtc3R5bGU6bm9ybWFsfTwvc3R5bGU+PHNjcmlwdCBzcmM9IicgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL2NvbnRlbnQuandwbGF0Zm9ybS5jb20vbGlicmFyaWVzL1Y2TmZFelQ3LmpzIj48L3NjcmlwdD48c3R5bGUgdHlwZT0idGV4dC9jc3MiPmh0bWwsIGJvZHl7cGFkZGluZzowOyBtYXJnaW46MDt9PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0ianctbW92aWUiPjwvZGl2PjxzY3JpcHQ+andwbGF5ZXIoImp3LW1vdmllIikuc2V0dXAoJyArIEpTT04uc3RyaW5naWZ5KHRoaXMuc2V0dXApICsgJyk7PC9zY3JpcHQ+PC9ib2R5PjwvaHRtbD4nOwoKICAgICAgICAgIHRoaXMuYnVpbGRpbmcoJ2lmcmFtZScpOwogICAgICAgIH0sCiAgICAgICAgdmlkZW9qcyA6IGZ1bmN0aW9uIChpZCwgc2V0dXAsIGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsgCiAgICAgICAgICAvLyBWaWRlb0pzIDUgKGZsYXNoL2h0bWw1KQogICAgICAgICAgLy8gc2V0dXA6IGh0dHA6Ly90aW55dXJsLmNvbS9wY2d4Mm9iCiAgICAgICAgICAvLyBwbGF5YmFjazogaHR0cDovL3Rpbnl1cmwuY29tL25zY3p0bW0KICAgICAgICAgIC8vIGRlbW86IGh0dHA6Ly9qc2ZpZGRsZS5uZXQvTjhaczUvMTgvCiAgICAgICAgICAvLyBwbHVnaW5zOiBodHRwczovL2dpdGh1Yi5jb20vdmlkZW9qcy92aWRlby5qcy93aWtpL1BsdWdpbnMKCiAgICAgICAgICB0aGlzLmdldFRhcmdldE5vZGUoaWQpOwogICAgICAgICAgdGhpcy5hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzIHx8IHt9KTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IEFhay5zZXRQcm9wZXJ0aWVzKHRoaXMub3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7CgogICAgICAgICAgdGhpcy5zZXR1cCA9IHNldHVwOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcm9zc1NldHVwID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuc2V0dXAgPSB7CiAgICAgICAgICAgICAgY29udHJvbHMgOiB0cnVlLAogICAgICAgICAgICAgIHByZWxvYWQgOiAnYXV0bycsCiAgICAgICAgICAgICAgd2lkdGggOiBzZXR1cC53aWR0aCB8fCB0aGlzLmF0dHJpYnV0ZXMud2lkdGgsCiAgICAgICAgICAgICAgaGVpZ2h0IDogc2V0dXAuaGVpZ2h0IHx8IHRoaXMuYXR0cmlidXRlcy5oZWlnaHQsCiAgICAgICAgICAgICAgdGVjaE9yZGVyIDogWyJodG1sNSIsICJmbGFzaCJdLAogICAgICAgICAgICAgIGF1dG9wbGF5IDogc2V0dXAuYXV0b3BsYXkgfHwgdGhpcy5hdXRvcGxheSwKICAgICAgICAgICAgICBzb3VyY2VzIDogW3sKICAgICAgICAgICAgICAgICAgdHlwZSA6IHRoaXMuZ2V0TWltZVR5cGUoc2V0dXAudHlwZSksCiAgICAgICAgICAgICAgICAgIHNyYyA6IHNldHVwLnNvdXJjZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgLyogZG9uJ3Qgd29yayAKICAgICAgICAgICAgaWYgKHNldHVwLnR5cGUgPT09ICdobHMnKSB7CiAgICAgICAgICAgICAgdGVjaE9yZGVyIDogWyJmbGFzaCIsICJodG1sNSJdLAogICAgICAgICAgICAgIHRoaXMuc2V0dXAuZmxhc2ggPSB7CiAgICAgICAgICAgICAgICAvL3N3ZiA6ICIvL3JlZWtzaXRlLmNvbS9wdWJsaWMvc3dmL3ZpZGVvanMtZmxhc2hscy5zd2YiCiAgICAgICAgICAgICAgICBzd2YgOiAnaHR0cDovL3d3dy5mbGFzaGxzLm9yZy92aWRlb2pzL3ZpZGVvLWpzLnN3ZicKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgICovCiAgICAgICAgICB9CgogICAgICAgICAgLy8gCiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuc3JjZG9jID0gJzxodG1sPjxoZWFkPjxsaW5rIGhyZWY9IicgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy92aWRlby5qcy81LjEwLjUvYWx0L3ZpZGVvLWpzLWNkbi5taW4uY3NzIiByZWw9InN0eWxlc2hlZXQiPjxzY3JpcHQgc3JjPSInICsgbG9jYXRpb24ucHJvdG9jb2wgKyAnLy9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvdmlkZW8uanMvNS4xMC41L3ZpZGVvLm1pbi5qcyI+PC9zY3JpcHQ+PHNjcmlwdCBzcmM9IicgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy92aWRlb2pzLWNvbnRyaWItaGxzLzMuMS4wL3ZpZGVvanMtY29udHJpYi1obHMubWluLmpzIj48L3NjcmlwdD48c3R5bGUgdHlwZT0idGV4dC9jc3MiPmh0bWwsIGJvZHl7cGFkZGluZzowOyBtYXJnaW46MDt9LnZqcy1kZWZhdWx0LXNraW57Y29sb3I6I2VlZX0udmpzLWRlZmF1bHQtc2tpbiAudmpzLXBsYXktcHJvZ3Jlc3MsLnZqcy1kZWZhdWx0LXNraW4gLnZqcy12b2x1bWUtbGV2ZWx7YmFja2dyb3VuZC1jb2xvcjojZWVlfS52anMtZGVmYXVsdC1za2luIC52anMtYmlnLXBsYXktYnV0dG9uLC52anMtZGVmYXVsdC1za2luIC52anMtY29udHJvbC1iYXJ7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4yKX0udmpzLWRlZmF1bHQtc2tpbiAudmpzLXNsaWRlcntiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjMpfTwvc3R5bGU+PC9oZWFkPjxib2R5Pjx2aWRlbyBpZD0idmpzLW1vdmllIiBjbGFzcz0idmlkZW8tanMgdmpzLWRlZmF1bHQtc2tpbiB2anMtYmlnLXBsYXktY2VudGVyZWQiPjwvdmlkZW8+PHNjcmlwdD52aWRlb2pzKCJ2anMtbW92aWUiLCAnICsgSlNPTi5zdHJpbmdpZnkodGhpcy5zZXR1cCkgKyAnKTwvc2NyaXB0PjwvYm9keT48L2h0bWw+JzsKCiAgICAgICAgICB0aGlzLmJ1aWxkaW5nKCdpZnJhbWUnKTsKICAgICAgICB9LAogICAgICAgIGZsb3dwbGF5ZXIgOiBmdW5jdGlvbiAoaWQsIHNldHVwLCBhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAvLyBGbG93UGxheWVyIDYgKGZsYXNoKQogICAgICAgICAgLy8gbm90ZTogcHJvYmxlbSB3aXRoIGZsYXNocGxheWVyCiAgICAgICAgICAvLyBzdXBwb3J0OiBtcDQsIGZsdiwgZjR2LCBtNHYsIG1vdgogICAgICAgICAgLy8gc2V0dXA6IGh0dHBzOi8vZmxvd3BsYXllci5vcmcvZG9jcy9zZXR1cC5odG1sCiAgICAgICAgICAvLyBhcGk6IGh0dHBzOi8vZmxvd3BsYXllci5vcmcvZG9jcy9hcGkuaHRtbAogICAgICAgICAgLy8gZGVtbzogaHR0cDovL2RlbW9zLmZsb3dwbGF5ZXIub3JnL2Jhc2ljcy9qcy1zZXR1cC1hdXRvcGxheS5odG1sCiAgICAgICAgICAvLyBoZHM6IGh0dHBzOi8vZmxvd3BsYXllci5lbGVjdHJvdGVxdWUub3JnL2h0dHBzdHJlYW1pbmctaGRzL2ZwNgogICAgICAgICAgLy8gaGxzOiBodHRwOi8vZGVtb3MuZmxvd3BsYXllci5vcmcvYXBpL2hsc2pzLmh0bWwKICAgICAgICAgIC8vIGZsdjogaHR0cDovL2RlbW9zLmZsb3dwbGF5ZXIub3JnL2Jhc2ljcy9mbHYuaHRtbAoKICAgICAgICAgIHRoaXMuZ2V0VGFyZ2V0Tm9kZShpZCk7CiAgICAgICAgICB0aGlzLmFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBBYWsuc2V0UHJvcGVydGllcyh0aGlzLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZXMgfHwge30pOwogICAgICAgICAgdGhpcy5vcHRpb25zID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5vcHRpb25zLCBvcHRpb25zIHx8IHt9KTsKCiAgICAgICAgICB0aGlzLnNldHVwID0gc2V0dXA7CiAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmNyb3NzU2V0dXAgPT09IHRydWUpIHsKICAgICAgICAgICAgdGhpcy5zZXR1cCA9IHsKICAgICAgICAgICAgICB3aWR0aCA6IHNldHVwLndpZHRoIHx8IHRoaXMuYXR0cmlidXRlcy53aWR0aCwKICAgICAgICAgICAgICBoZWlnaHQgOiBzZXR1cC5oZWlnaHQgfHwgdGhpcy5hdHRyaWJ1dGVzLmhlaWdodCwKICAgICAgICAgICAgICBhdXRvcGxheSA6IHNldHVwLmF1dG9wbGF5IHx8IHRoaXMuYXV0b3BsYXksCiAgICAgICAgICAgICAgcHJlbG9hZCA6ICdhdXRvJwogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc2V0dXAudHlwZSA9PT0gJ2hscycpIHsKICAgICAgICAgICAgICB0aGlzLnNldHVwLnN3ZiA9IGxvY2F0aW9uLnByb3RvY29sICsgJy8vcmVsZWFzZXMuZmxvd3BsYXllci5vcmcvNi4wLjUvZmxvd3BsYXllcmhscy5zd2YnOwogICAgICAgICAgICAgIHRoaXMuc2V0dXAuZW5naW5lID0gJ2hsc2pzJzsKICAgICAgICAgICAgfSBlbHNlIGlmIChbJ21wNCcsICd3ZWJtJywgJ29nZycsICdvZ3YnXS5pbmRleE9mKHNldHVwLnR5cGUpID09PSAtMSkgewogICAgICAgICAgICAgIHRoaXMuc2V0dXAuc3dmID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy9yZWxlYXNlcy5mbG93cGxheWVyLm9yZy82LjAuNS9mbG93cGxheWVyLnN3Zic7CiAgICAgICAgICAgICAgdGhpcy5zZXR1cC5lbmdpbmUgPSAnZmxhc2gnOwogICAgICAgICAgICAgIHRoaXMuc2V0dXAudHlwZSA9ICd2aWRlby9mbGFzaCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zZXR1cC5jbGlwID0gewogICAgICAgICAgICAgIHNvdXJjZXMgOiBbewogICAgICAgICAgICAgICAgICB0eXBlIDogdGhpcy5nZXRNaW1lVHlwZSh0aGlzLnNldHVwLnR5cGUgfHwgc2V0dXAudHlwZSksCiAgICAgICAgICAgICAgICAgIHNyYyA6IHNldHVwLnNvdXJjZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIF0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuc3JjZG9jID0gJzxodG1sPjxoZWFkPjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iJyArIGxvY2F0aW9uLnByb3RvY29sICsgJy8vcmVsZWFzZXMuZmxvd3BsYXllci5vcmcvNi4wLjUvc2tpbi9mdW5jdGlvbmFsLmNzcyI+PC9zY3JpcHQ+PHNjcmlwdCBzcmM9IicgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL2NvZGUuanF1ZXJ5LmNvbS9qcXVlcnktMS4xMS4yLm1pbi5qcyI+PC9zY3JpcHQ+PHNjcmlwdCBzcmM9IicgKyBsb2NhdGlvbi5wcm90b2NvbCArICcvL3JlbGVhc2VzLmZsb3dwbGF5ZXIub3JnLzYuMC41L2Zsb3dwbGF5ZXIubWluLmpzIj48L3NjcmlwdD48c3R5bGUgdHlwZT0idGV4dC9jc3MiPmh0bWwsIGJvZHl7cGFkZGluZzowOyBtYXJnaW46MDt9PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0iZnAtbW92aWUiPjwvZGl2PjxzY3JpcHQ+Zmxvd3BsYXllcigiI2ZwLW1vdmllIiwgJyArIEpTT04uc3RyaW5naWZ5KHRoaXMuc2V0dXApICsgJyk7PC9zY3JpcHQ+PC9ib2R5PjwvaHRtbD4nOwoKICAgICAgICAgIHRoaXMuYnVpbGRpbmcoJ2lmcmFtZScpOwogICAgICAgIH0sCiAgICAgICAgZ3JpbmRwbGF5ZXIgOiBmdW5jdGlvbiAoaWQsIHNldHVwLCBhdHRyaWJ1dGVzLCBvcHRpb25zKSB7CiAgICAgICAgICAvLyBHcmluZFBsYXllciAxIChmbGFzaCkKICAgICAgICAgIC8vIHNldHVwOiBodHRwOi8vb3NtZmhscy5rdXR1LnJ1L2RvY3MvZ3JpbmQvCiAgICAgICAgICAvLyBzdXBwb3J0OiBobHMsIHJ0bXAKCiAgICAgICAgICB0aGlzLmdldFRhcmdldE5vZGUoaWQpOwogICAgICAgICAgdGhpcy5hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzIHx8IHt9KTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IEFhay5zZXRQcm9wZXJ0aWVzKHRoaXMub3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7CgogICAgICAgICAgdGhpcy5zZXR1cCA9IHNldHVwOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcm9zc1NldHVwID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuc2V0dXAgPSB7CiAgICAgICAgICAgICAgc3JjIDogc2V0dXAuc291cmNlLAogICAgICAgICAgICAgIHN0cmVhbVR5cGUgOiAibGl2ZSIsCiAgICAgICAgICAgICAgc2NhbGVNb2RlIDogImxldHRlcmJveCIsCiAgICAgICAgICAgICAgYXV0b1BsYXkgOiBzZXR1cC5hdXRvcGxheSB8fCB0aGlzLmF1dG9wbGF5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChzZXR1cC50eXBlID09PSAnaGxzJykgewogICAgICAgICAgICAgIHRoaXMuc2V0dXAucGx1Z2luX2hscyA9ICIvL3JlZWtzaXRlLmNvbS9wdWJsaWMvc3dmL2ZsYXNobHNPU01GLnN3ZiI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNldHVwLnByb3h5ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgdGhpcy5zZXR1cC5zcmMgPSAnLy93d3cuZGlhbnNoaWJvLmNvbS9mZXRjaC5waHAvJyArIHNldHVwLnNvdXJjZS5zdWJzdHJpbmcoc2V0dXAuc291cmNlLmluZGV4T2YoJy8vJykgKyAyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5zcmMgPSBzZXR1cC5zd2YgfHwgdGhpcy5hdHRyaWJ1dGVzLnNyYyB8fCAiLy9yZWVrc2l0ZS5jb20vcHVibGljL3N3Zi9HcmluZFBsYXllci5zd2YiOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmhlaWdodCA9IHNldHVwLmhlaWdodCB8fCB0aGlzLmF0dHJpYnV0ZXMuaGVpZ2h0OwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLndpZHRoID0gc2V0dXAud2lkdGggfHwgdGhpcy5hdHRyaWJ1dGVzLndpZHRoOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmZsYXNodmFycyA9IEFhay5zZXJpYWxpemUodGhpcy5zZXR1cCk7CgogICAgICAgICAgdGhpcy5idWlsZGluZygnZW1iZWQnKTsKICAgICAgICB9LAogICAgICAgIHZsYyA6IGZ1bmN0aW9uIChpZCwgc2V0dXAsIGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsKICAgICAgICAgIC8vIFZMQyBXZWIgUGx1Z2luIChwbHVnaW4pCiAgICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9vbWx6cDM5CiAgICAgICAgICAvLyBwbHVnaW5zOiBhYm91dDpwbHVnaW5zCiAgICAgICAgICAvLyBjaHJvbWU6Ly9mbGFncy8jZW5hYmxlLW5wYXBpCiAgICAgICAgICAvLyBodHRwczovL3d3dy5jaHJvbWl1bS5vcmcvZGV2ZWxvcGVycy9ucGFwaS1kZXByZWNhdGlvbgogICAgICAgICAgLy8gSW4gU2VwdGVtYmVyIDIwMTUgKENocm9tZSA0NSkgd2Ugd2lsbCByZW1vdmUgdGhlIG92ZXJyaWRlIGFuZCBOUEFQSSBzdXBwb3J0IHdpbGwgYmUgcGVybWFuZW50bHkgcmVtb3ZlZCBmcm9tIENocm9tZS4gSW5zdGFsbGVkIGV4dGVuc2lvbnMgdGhhdCByZXF1aXJlIE5QQVBJIHBsdWdpbnMgd2lsbCBubyBsb25nZXIgYmUgYWJsZSB0byBsb2FkIHRob3NlIHBsdWdpbnMuCgogICAgICAgICAgdGhpcy5uYW1lID0gJ3ZsYyc7CiAgICAgICAgICB0aGlzLmdldFRhcmdldE5vZGUoaWQpOwogICAgICAgICAgdGhpcy5hcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnNldFByb3BlcnRpZXModGhpcy5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGVzIHx8IHt9KTsKICAgICAgICAgIHRoaXMub3B0aW9ucyA9IEFhay5zZXRQcm9wZXJ0aWVzKHRoaXMub3B0aW9ucywgb3B0aW9ucyB8fCB7fSk7CgogICAgICAgICAgdGhpcy5zZXR1cCA9IHNldHVwOwogICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5jcm9zc1NldHVwID09PSB0cnVlKSB7CiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5zcmMgPSBzZXR1cC5zb3VyY2U7CiAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5oZWlnaHQgPSBzZXR1cC5oZWlnaHQgfHwgdGhpcy5hdHRyaWJ1dGVzLmhlaWdodDsKICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLndpZHRoID0gc2V0dXAud2lkdGggfHwgdGhpcy5hdHRyaWJ1dGVzLndpZHRoOwogICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuY29udHJvbHMgPSB0cnVlOwogICAgICAgICAgICBpZiAoc2V0dXAuYXV0b3BsYXkgfHwgdGhpcy5hdXRvcGxheSkgewogICAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5hdXRvcGxheSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMudHlwZSA9ICJhcHBsaWNhdGlvbi94LXZsYy1wbHVnaW4iOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLnBsdWdpbnNwYWdlID0gImh0dHA6Ly93d3cudmlkZW9sYW4ub3JnIjsKICAgICAgICAgIHRoaXMuYnVpbGRpbmcoJ2VtYmVkJyk7CiAgICAgICAgfSwKICAgICAgICBodG1sNSA6IGZ1bmN0aW9uIChpZCwgc2V0dXAsIGF0dHJpYnV0ZXMsIG9wdGlvbnMpIHsgCiAgICAgICAgICAvLyBWaWRlbyBUYWcgKGh0bWw1KQogICAgICAgICAgLy8gYmFzaWNzOiBodHRwczovL2h0bWw1cm9ja3MuY29tL2VuL3R1dG9yaWFscy92aWRlby9iYXNpY3MvCiAgICAgICAgICAvLyB0YWc6IGh0dHA6Ly93d3cudzNzY2hvb2xzLmNvbS90YWdzL3RhZ192aWRlby5hc3AKICAgICAgICAgIC8vIHN1cHBvcnQ6IG1wNCwgd2VibSwgb2dnCiAgICAgICAgICAvLyB0ZXN0OiBodHRwOi8vd3d3LnF1aXJrc21vZGUub3JnL2h0bWw1L3Rlc3RzL3ZpZGVvLmh0bWwKCiAgICAgICAgICB0aGlzLm9wdGlvbnMgPSBBYWsuc2V0UHJvcGVydGllcyh0aGlzLm9wdGlvbnMsIG9wdGlvbnMgfHwge30pOwoKICAgICAgICAgIHRoaXMuZ2V0VGFyZ2V0Tm9kZShpZCk7CiAgICAgICAgICB0aGlzLmFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBBYWsuc2V0UHJvcGVydGllcyh7fSwgc2V0dXAgfHwge30pOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLnNyYyA9IHNldHVwLnNvdXJjZTsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5pZCA9IHRoaXMuYXR0cmlidXRlcy5uYW1lID0gQWFrLmdlbmVyYXRlSUQoKTsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5oZWlnaHQgPSB0aGlzLmF0dHJpYnV0ZXMuaGVpZ2h0IHx8IHRoaXMudGFyZ2V0Lm5vZGUuY2xpZW50SGVpZ2h0IHx8ICIxMDAlIjsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy53aWR0aCA9IHRoaXMuYXR0cmlidXRlcy53aWR0aCB8fCB0aGlzLnRhcmdldC5ub2RlLmNsaWVudFdpZHRoIHx8ICIxMDAlIjsKICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy50eXBlID0gdGhpcy5nZXRNaW1lVHlwZSh0aGlzLmF0dHJpYnV0ZXMudHlwZSk7CiAgICAgICAgICB0aGlzLmF0dHJpYnV0ZXMuY29udHJvbHMgPSAnY29udHJvbHMnOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLnByZWxvYWQgPSAnbm9uZSc7CiAgICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVzLmF1dG9wbGF5IHx8IHRoaXMuYXV0b3BsYXkpIHsKICAgICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzLmF1dG9wbGF5ID0gJ2F1dG9wbGF5JzsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5zdHlsZSA9ICdkaXNwbGF5OiBibG9jazsgbWFyZ2luOjAgYXV0bzsnOwogICAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gQWFrLnVuc2V0UHJvcGVydGllcyh0aGlzLmF0dHJpYnV0ZXMsICdzb3VyY2UnKTsKCiAgICAgICAgICB0aGlzLmJ1aWxkaW5nKCd2aWRlbycpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgCiAgICAgIHJldHVybiBuZXcgUGxheWVyKCk7CiAgICB9LAogICAgcnVsZXMgOiB7CiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIC8vIEFudGktQWRibG9jayBLaWxsZXIKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgc2V0dGluZ3MgOiB7CiAgICAgICAgaG9zdCA6IFsnbG9jYWxob3N0JywgJ3JlZWsuZ2l0aHViLmlvJywgJ3JlZWtzaXRlLmNvbSddLAogICAgICAgIG9uRW5kIDogZnVuY3Rpb24gKCkgewoKICAgICAgICAgIGlmICgvXC9hbnRpLWFkYmxvY2sta2lsbGVyKC1wYWdlcyk/XC8kLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkgewogICAgICAgICAgICB2YXIgc2V0dGluZ3NCb3ggPSBBYWsuZ2V0RWxlbWVudCgnI2Fhay1zZXR0aW5ncy1ib3gnKTsKICAgICAgICAgICAgdmFyIHNldHRpbmdzTm90aWNlID0gQWFrLmdldEVsZW1lbnQoJyNhYWstc2V0dGluZ3Mtbm90aWNlJyk7CgogICAgICAgICAgICBpZiAoIUFhay51c2VHTSkgewogICAgICAgICAgICAgIHNldHRpbmdzTm90aWNlLnF1ZXJ5U2VsZWN0b3IoJ2RpdicpLmlubmVySFRNTCA9ICdJbiBuYXRpdmUgbW9kZSwgeW91IG11c3QgZWRpdCB0aGUgb3B0aW9ucyBtYW51YWxseTogPGEgaHJlZj0iJyArIEFhay5uYXRpdmVVUkwgKyAnIj5TZWU8L2E+JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzZXR0aW5nc0JveCAmJiBzZXR0aW5nc05vdGljZSkgewogICAgICAgICAgICAgIHNldHRpbmdzTm90aWNlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICAgICAgc2V0dGluZ3NCb3guc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgICAgICAgICAgICAgQWFrLmluZm8oJ0dNIHN0b3JhZ2U6JywgQWFrLmdldFZhbHVlKCkpOwogICAgICAgICAgICAgIEFhay5pbmZvKCdHTSBvcHRpb25zOicsIEFhay5vcHRzKTsKICAgICAgICAgICAgICBBYWsuaW5mbygnR00gYXBpOicsIEFhay51c2VHTSAmJiBBYWsuYXBpR00oKSk7CgogICAgICAgICAgICAgIC8vIHVzZXIgY29uZmlnCiAgICAgICAgICAgICAgQWFrLmNyZWF0ZUVsZW1lbnQoewogICAgICAgICAgICAgICAgdGFnIDogJ2RpdicsCiAgICAgICAgICAgICAgICBodG1sIDogJ1ZlcnNpb246ICcgKyBBYWsuZ2V0VmVyc2lvbigpICsgJyA8YnI+QWFrU2NyaXB0OiB0cnVlIDxicj5BYWtMaXN0OiAnICsgKCFBYWsuZ2V0RWxlbWVudCgnI2syVXc3aXNIck1tNUpYUDFWd2R4YzU2N1pLYzFhWjRJJykpICsgJyA8YnI+QnJvd3NlcjogJyArIEFhay5nZXRCcm93c2VyKCkgKyAnIDxicj5TY3JpcHRNYW5hZ2VyOiAnICsgQWFrLmdldFNjcmlwdE1hbmFnZXIoKSwKICAgICAgICAgICAgICAgIGFwcGVuZCA6ICcjYWFrLXNldHRpbmdzLWNvbmZpZycKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgLy8gY3JlYXRlIG9wdGlvbnMgCiAgICAgICAgICAgICAgZm9yICh2YXIgb3B0TmFtZSBpbiBBYWsub3B0aW9ucykgewogICAgICAgICAgICAgICAgaWYgKEFhay5vcHRpb25zLmhhc093blByb3BlcnR5KG9wdE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBvcHQgPSBBYWsub3B0aW9uc1tvcHROYW1lXTsKICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSBBYWsub3B0c1tvcHROYW1lXSA9PT0gdHJ1ZSA/ICJjaGVja2VkIiA6ICcnOwogICAgICAgICAgICAgICAgICBBYWsuY3JlYXRlRWxlbWVudCh7CiAgICAgICAgICAgICAgICAgICAgdGFnIDogJ2RpdicsCiAgICAgICAgICAgICAgICAgICAgaHRtbCA6ICc8aW5wdXQgaWQ9IicgKyBvcHROYW1lICsgJyIgY2xhc3M9ImNzcy1jaGVja2JveCIgJyArIGNoZWNrZWQgKyAnIHR5cGU9IicgKyBvcHQudHlwZSArICciLz48bGFiZWwgZm9yPSInICsgb3B0TmFtZSArICciIHRpdGxlPSInICsgb3B0LmluZm8gKyAnIiBjbGFzcz0iY3NzLWxhYmVsIj4nICsgb3B0LmxhYmVsICsgJzwvbGFiZWw+JywKICAgICAgICAgICAgICAgICAgICBhcHBlbmQgOiAnI2Fhay1zZXR0aW5ncy0nICsgb3B0Lmdyb3VwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gc2F2ZSBvcHRpb25zIAogICAgICAgICAgICAgIEFhay5vbkV2ZW50KEFhay5nZXRFbGVtZW50KCIjYWFrLXNldHRpbmdzLXNhdmUiKSwgImNsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgdmFyIGVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNzcy1jaGVja2JveCcpOwogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICB2YXIgZWxlbSA9IGVsZW1zW2ldOwogICAgICAgICAgICAgICAgICBpZiAoZWxlbS5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgQWFrLnNldFZhbHVlKGVsZW0uaWQsIHRydWUpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIEFhay5zZXRWYWx1ZShlbGVtLmlkLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgnU2F2ZWQgIScpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAvLyBDbGVhciBHTSBzdG9yYWdlCiAgICAgICAgICAgICAgQWFrLmFkZENvbW1hbmRzKHsKICAgICAgICAgICAgICAgIGNhcHRpb24gOiAnQ2xlYXIgR00gc3RvcmFnZScsCiAgICAgICAgICAgICAgICBleGVjdXRlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBBYWsuZGVsZXRlVmFsdWUoKTsKICAgICAgICAgICAgICAgICAgd2luZG93LmFsZXJ0KCdDbGVhcmVkICEnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgdXNlcnNjcmlwdHNfZG9tYWlucyA6IHsgLy8gUmVkaXJlY3QgdG8gR2l0aHViCiAgICAgICAgaG9zdCA6IFsndXNlcnNjcmlwdHMub3JnJywgJ3VzZXJzY3JpcHRzLm9yZzo4MDgwJywgJ3VzZXJzY3JpcHRzLW1pcnJvci5vcmcnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKC8xNTU4NDAkLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkgewogICAgICAgICAgICBBYWsuZ28oQWFrLmhvbWVVUkwpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgb3BlbnVzZXJqc19vcmcgOiB7CiAgICAgICAgaG9zdCA6IFsnb3BlbnVzZXJqcy5vcmcnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IEFhay5nZXRFbGVtZW50KCdhW2hyZWYkPSIvaXNzdWVzIl0nKTsKICAgICAgICAgIGlmICgvQW50aS1BZGJsb2NrX0tpbGxlcl9SZWVrLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSAmJiBlbGVtZW50KSB7CiAgICAgICAgICAgIEFhay5jb25maXJtUmVwb3J0KGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZ3JlYXN5Zm9ya19vcmcgOiB7CiAgICAgICAgaG9zdCA6IFsnZ3JlYXN5Zm9yay5vcmcnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IEFhay5nZXRFbGVtZW50KCdhW2hyZWYkPSIvZmVlZGJhY2siXScpOwogICAgICAgICAgaWYgKC8tYW50aS1hZGJsb2NrLWtpbGxlci1yZWVrLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSAmJiBlbGVtZW50KSB7CiAgICAgICAgICAgIEFhay5jb25maXJtUmVwb3J0KGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgbW9ua2V5Z3V0c19jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnbW9ua2V5Z3V0cy5jb20nXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZWxlbWVudCA9IEFhay5nZXRFbGVtZW50KCdhW2hyZWYqPSJjb2RlLnBocD9uYXY9Zm9ydW0iXScpOwogICAgICAgICAgaWYgKC9tb25rZXlndXRzLmNvbVwvY29kZS5waHBcP2lkPTM1MS8udGVzdChsb2NhdGlvbi5ocmVmKSAmJiBlbGVtZW50KSB7CiAgICAgICAgICAgIEFhay5jb25maXJtUmVwb3J0KGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgLy8gU3BlY2lmaWMKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgYmxvZ3Nwb3QgOiB7CiAgICAgICAgLy8gTm8gQ291bnRyeSBSZWRpcmVjdCAoTkNSKQogICAgICAgIC8vIFByZXZlbnQgQmxvZ2dlciBmcm9tIFJlZGlyZWN0aW5nIHRvIENvdW50cnktU3BlY2lmaWMgRG9tYWlucwogICAgICAgIC8vIGRvYzogaHR0cDovL3Rpbnl1cmwuY29tLzdybTM0am8KICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mci9mb3J1bS9kaXNjdXNzaW9uLzU5NTMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNDkwCiAgICAgICAgLy8gdGVzdDogaHR0cDovL3Rpbnl1cmwuY29tL25vbWN4a2MKICAgICAgICBob3N0IDogWycuYmxvZ3Nwb3QuJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChBYWsuaXNUb3BmcmFtZSkgeyAvLyBmaXggcmVkaXJldGlvbiBsb29wCiAgICAgICAgICAgIHZhciBibG9nID0gbG9jYXRpb24uaG9zdC5yZXBsYWNlKCd3d3cuJywgJycpLnNwbGl0KCIuIik7CiAgICAgICAgICAgIGlmIChibG9nW2Jsb2cubGVuZ3RoIC0gMV0gIT0gImNvbSIpIHsKICAgICAgICAgICAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLmhyZWYuc3BsaXQoIi8iKS5zbGljZSgzKS5qb2luKCcvJyk7CiAgICAgICAgICAgICAgQWFrLmdvKCJodHRwOi8vIiArIGJsb2dbMF0gKyAiLmJsb2dzcG90LmNvbS9uY3IvIiArIHBhdGgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBibG9nc3BvdF9rbm93bGV0MzM4OSA6IHsKICAgICAgICAvLyBub3RlOiBhbHNvIGFkZGVkIGFicCBydWxlCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgzCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0EzbUNYUTVpCiAgICAgICAgaG9zdCA6IFsna25vd2xldDMzODkuYmxvZ3Nwb3QuJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRMb2NhbCgnbm9hZCcsIGZhbHNlKTsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2dBZHMgeyBoZWlnaHQ6IDE3cHg7IH0gI2dBZDIgeyBoZWlnaHQ6IDE3cHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHVwdG9ib3hfdXB0b3N0cmVhbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzUxCiAgICAgICAgaG9zdCA6IFsndXB0b2JveC5jb20nLCAndXB0b3N0cmVhbS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gT2xkIHNvbHV0aW9uIFtkZXByZWNhdGVkXQogICAgICAgICAgdmFyIGlkID0gbG9jYXRpb24ucGF0aG5hbWUubWF0Y2goL1swLTlhLXpdezEyfS8pOwogICAgICAgICAgaWYgKGlkICE9PSBudWxsKSB7CiAgICAgICAgICAgIEFhay5hZGRTdHlsZSgiIyIgKyBpZFswXSArICIgeyBoZWlnaHQ6IDEycHg7IH0iKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIE5ldyAxMi4wNS4yMDE0CiAgICAgICAgICAvLyArIGFicCBydWxlIChhbHRlcm5hdGl2ZSBzb2x1dGlvbikKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2FkYmxvY2t0cmFwIHsgaGVpZ2h0OiAxMnB4OyB9Iik7CiAgICAgICAgfSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyByZW1vdmUgYWRzCiAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnKltzcmNePSJodHRwOi8vYWRzLnVwdG9ib3guY29tLyJdLCpbaHJlZl49Imh0dHA6Ly9hZHMudXB0b2JveC5jb20vIl0nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFuaXN1YnNpYV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnYW5pc3Vic2lhLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyArIGFicCBydWxlICNAIy5hZHNhbnRpbG9rCiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5hZHNhbnRpbG9rIHsgaGVpZ2h0OiA1cHg7IH0iKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5qQW50aUJsb2NrID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBBYWsudXcuQ2VrQmxvayA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZnJlZWdhbWVzZXJ2ZXJob3N0X2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTUxMgogICAgICAgIGhvc3QgOiBbJ2ZyZWVnYW1lc2VydmVyaG9zdC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjZmFiMTMgeyBoZWlnaHQ6IDExcHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGVsYWhtYWRfY29tIDogewogICAgICAgIGhvc3QgOiBbJ2VsYWhtYWQuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2FkYmxvY2sgeyBoZWlnaHQ6IDFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXJ0emNtcDNfbmV0IDogewogICAgICAgIGhvc3QgOiBbJ21ydHpjbXAzLm5ldCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5ydG1fYWQgeyBoZWlnaHQ6IDFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGVpZ2h0X215VGVzdEFkIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjQxCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzk4MwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yOTEKICAgICAgICBob3N0IDogWydia25pbWUuY29tJywgJ2dvNHVwLmNvbScsICdkZWJyaWRvLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5teVRlc3RBZCB7IGhlaWdodDogMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWJyaWRmYXN0X25ldHdvcmsgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZW4vZm9ydW0vZGlzY3Vzc2lvbi85NDA2CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZW4vZm9ydW0vZGlzY3Vzc2lvbi83MDEzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEyNzIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNzY5CiAgICAgICAgaG9zdCA6IFsnZGVicmlkZmFzdC5jb20nLCAnZ2V0ZGVicmlkLmNvbScsICdkZWJyaWQudXMnLCAnbGVlY2hlci51cyddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5teVRlc3RBZCwgLm15MjRBZCwgLm5hYmlsIHsgaGVpZ2h0OiAxcHg7IH0iKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaW1wbGVBZCcpLmlubmVySFRNTCA9ICc8cCBzdHlsZT0iZGlzcGxheTpub25lOyI+ZGVicmlkZmFzdC5jb208L3A+JzsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJnX2dsZWRhaV90diA6IHsKICAgICAgICBob3N0IDogWydiZy1nbGVkYWkudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIubXlBZCB7IGhlaWdodDogMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICB0aGVwY3NweV9jb20gOiB7IC8vIGh0dHA6Ly90aGVwY3NweS5jb20vcmVhZC9ob3dfdG9fYmxvY2tfYWRibG9jay8KICAgICAgICBob3N0IDogWyd0aGVwY3NweS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIubXlUZXN0QWQgeyBoZWlnaHQ6IDFweDsgfSIpOwogICAgICAgICAgQWFrLmFkZFN0eWxlKCIuYmxvY2tlZCB7IGRpc3BsYXk6IG5vbmU7IH0iKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcuYmxvY2tlZCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdmdfZTI0X25vIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yOTIKICAgICAgICBob3N0IDogWyd2Zy5ubycsICdlMjQubm8nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gQWRkIHRoaXMgcnVsZSwgYmVjYXVzZSBFYXN5TGlzdCBhbGxvdyBhbGwgaGlkZGVuIGVsZW1lbnRzLgogICAgICAgICAgQWFrLmFkZFN0eWxlKCIuYWQgeyBkaXNwbGF5OiBub25lOyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBhdXRvbW9iaWxlX3Nwb3J0aXZlX2NvbSA6IHsKICAgICAgICBob3N0IDogWydhdXRvbW9iaWxlLXNwb3J0aXZlLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5teVRlc3RBZCB7IGhlaWdodDogNTFweDsgZGlzcGxheTogbm9uZTsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc25zd191cyA6IHsKICAgICAgICBob3N0IDogWydzbnN3LnVzJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2FkXzEgeyBoZWlnaHQ6IDFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdXJsY2hlY2tlcl9uZXQgOiB7CiAgICAgICAgaG9zdCA6IFsndXJsY2hlY2tlci5uZXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjYWRjaGVja2VyIHsgaGVpZ2h0OiAyMHB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBza2lwbGltaXRlX3R2IDogewogICAgICAgIGhvc3QgOiBbJ3NraXBsaW1pdGUudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCJkaXYuYWRkdGhpc19uYXRpdmVfdG9vbGJveCArIGRpdltpZF0geyBoZWlnaHQ6IDEycHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZpbGVjb3JlX2NvX256IDogewogICAgICAgIGhvc3QgOiBbJ2ZpbGVjb3JlLmNvLm56J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiLmFkc2Vuc2UgeyBoZWlnaHQ6IDVweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdGhvbWFzX25fcnV0aF9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzExMTEKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vZnU3dmtVQTEKICAgICAgICBob3N0IDogWyd0aG9tYXMtbi1ydXRoLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5Hb29nbGUgeyBoZWlnaHQ6IDVweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW50ZXJmYW5zX29yZyA6IHsKICAgICAgICAvLyB0ZXN0OiBodHRwOi8vd3d3LmludGVyZmFucy5vcmcvZm9ydW0vCiAgICAgICAgaG9zdCA6IFsnaW50ZXJmYW5zLm9yZyddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5hZF9nbG9iYWxfaGVhZGVyIHsgaGVpZ2h0OiAxcHg7IGRpc3BsYXk6IG5vbmU7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1heGRlYnJpZGV1cl9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnbWF4ZGVicmlkZXVyLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5jbGVhciArIGRpdltpZF0geyBoZWlnaHQ6IDEycHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHRvcHpvbmVfaXQgOiB7CiAgICAgICAgaG9zdCA6IFsndG9wem9uZS5sdCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5mb3J1bUFkIHsgaGVpZ2h0OiAxcHg7IGRpc3BsYXk6IG5vbmU7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG5hbmExMF9jb19pbCA6IHsKICAgICAgICBob3N0IDogWycubmFuYTEwLiddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNhZHZlcnQtdHJhY2tlciB7IGhlaWdodDogMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBwbGVqX3R2IDogewogICAgICAgIGhvc3QgOiBbJ3BsZWoudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIuYWR2ZXJ0X2JveCB7IGhlaWdodDogMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtYW5nYW1pbnRfY29tIDogewogICAgICAgIC8vIG5vdGU6IGFkZGVkIHJ1bGUgdG8gYWxsb3cgIi5hZDcyOCIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9pZC9mb3J1bS9kaXNjdXNzaW9uLzg1MjQKICAgICAgICBob3N0IDogWydtYW5nYW1pbnQuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiLmFkNzI4IHsgaGVpZ2h0OiAzMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWJyaWRldXJzdHJlYW1fZnIgOiB7CiAgICAgICAgaG9zdCA6IFsnZGVicmlkZXVyc3RyZWFtLmZyJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2NvbnRlbnQgZGl2W2lkXVthbGlnbj1jZW50ZXJdIHsgaGVpZ2h0OiAxMnB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBwcmVlbWxpbmtzX2NvbSA6IHsKICAgICAgICBob3N0IDogWydwcmVlbWxpbmtzLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNkaXZhZHMgeyBoZWlnaHQ6IDFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGVudGFpX3RvIDogewogICAgICAgIGhvc3QgOiBbJ2hlbnRhaS50byddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNoZW50YWl0bzEyMyB7IGhlaWdodDogMTFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcHJvdG90dXJrX2NvbSA6IHsKICAgICAgICBob3N0IDogWydwcm90b3R1cmsuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI3Jla2xhbSB7IGhlaWdodDogMXB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtdWZhX2RlIDogewogICAgICAgIGhvc3QgOiBbJ211ZmEuZGUnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjbGVhZGVyYm9hcmQgeyBoZWlnaHQ6IDVweDsgfSIpOwogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjbGFyZ2UtcmVjdGFuZ2xlIHsgaGVpZ2h0OiA1cHg7IH0iKTsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2FkLWhlYWRlci00Njh4NjAgeyBoZWlnaHQ6IDVweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgd2F0Y2hhcmFiX2NvbSA6IHsKICAgICAgICBob3N0IDogWyd3YXRjaGFyYWIuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vICsgYWRwIHJ1bGUgd2F0Y2hhcmFiLmNvbSNAIyNhZGJsb2NrCiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNhZGJsb2NrIHsgaGVpZ2h0OiA1cHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZyZWVkb21pcF9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnZnJlZWRvbS1pcC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIucHViX3ZlcnRpY2FsIGlucywgLnB1Yl92ZXJ0aWNhbCBkaXYgeyBoZWlnaHQ6IDExcHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHdha2FuaW1fdHYgOiB7CiAgICAgICAgaG9zdCA6IFsnd2FrYW5pbS50diddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNkZXRlY3RvciB7IGRpc3BsYXk6IG5vbmU7IH0iKTsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI25vcHViIHsgZGlzcGxheTogYmxvY2s7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNpbXBseV9kZWJyaWRfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8zMzIKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vYjdNQVlYczQKICAgICAgICBob3N0IDogWydzaW1wbHktZGVicmlkLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRzYnlnb29nbGUgPSB7fTsKICAgICAgICAgIEFhay51dy5hZHNieWdvb2dsZS5sb2FkZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbWFuZ2E5X2NvbSA6IHsKICAgICAgICBob3N0IDogWydtYW5nYTkuY29tJywgJ21hbmdhYmVlLmNvJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiLmFkYmxvY2sgeyBoZWlnaHQ6IDMxcHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9uZW1hbmdhMl9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnb25lbWFuZ2EyLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5hZnNfYWRzIHsgaGVpZ2h0OiA1cHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1hbmdhYmlyZF9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnbWFuZ2FiaXJkLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIi5hZnNfYWRzIHsgaGVpZ2h0OiA1cHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGtvZGlsaXZlX2V1IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNTI4CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1p4dlhLcXRjCiAgICAgICAgaG9zdCA6IFsna29kaWxpdmUuZXUnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIuQWQgeyBoZWlnaHQ6IDVweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmFja2luX25ldCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTM4MwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMDYxCiAgICAgICAgaG9zdCA6IFsnYmFja2luLm5ldCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNkaXZ4ZyB7IGhlaWdodDogOHB4OyB9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBtb2JpbGVfdHJhY2tlcl9mcmVlX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTA4MgogICAgICAgIGhvc3QgOiBbJ21vYmlsZS10cmFja2VyLWZyZWUuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI215QWRzIHsgaGVpZ2h0OiAxcHg7IH0iKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHdvcmt1cGxvYWRfY29tIDogewogICAgICAgIC8vIG5vdGU6IG9iZnVzY2F0ZWQKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTMzNAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjkwCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0NQemQyU3d4CiAgICAgICAgaG9zdCA6IFsnd29ya3VwbG9hZC5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiLmFkQmxvY2ssIC5hZHNieWdvb2dsZSwgI3NhZCB7IGhlaWdodDogMTFweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgamNfbXBfY29tIDogewogICAgICAgIC8vIGJ5OiBHaXdheXVtZQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNTk3CiAgICAgICAgaG9zdCA6IFsiamMtbXAuY29tIl0sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCcuYWRzZW5zZSB7d2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHZpc2liaWxpdHk6IGhpZGRlbjsgZGlzcGxheTogYmxvY2s7IHBvc2l0aW9uOiBhYnNvbHV0ZTt9Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmb3JiZXNfY29tIDogewogICAgICAgIC8vIGJ5OiBHaXdheXVtZQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84NjUKICAgICAgICBob3N0IDogWydmb3JiZXMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuaW5kZXhPZignL3dlbGNvbWUnKSA+IC0xKSB7CiAgICAgICAgICAgIEFhay5zZXRDb29raWUoJ3dlbGNvbWVBZCcsICd0cnVlJywgODY0MDAwMDAsICcvJyk7CiAgICAgICAgICAgIEFhay5zZXRDb29raWUoJ2RhaWx5V2VsY29tZUNvb2tpZScsICd0cnVlJywgODY0MDAwMDAsICcvJyk7CiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IEFhay5nZXRDb29raWUoJ3RvVXJsJykgfHwgJ2h0dHA6Ly93d3cuZm9yYmVzLmNvbS8nOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgYmFpdF9hZHNieWdvb2dsZSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTQ3CiAgICAgICAgaG9zdCA6IFsnYml0Y29pbmFsaWVucy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdpbnMuYWRzYnlnb29nbGUnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJhaXRfdGVzdGVyIDogewogICAgICAgIGhvc3QgOiBbJ29zb2FyY2FkZS5jb20nLCAnZDNicmlkNHkwdS5pbmZvJywgJ2ZpbGVpY2UubmV0JywgJ25vc3RlYW0ucm8nLCAnb3BlbnJ1bm5lci5jb20nLCAnZWFzeWJpbGxldHMuY29tJywgJ3Nwb3guZnInLCAneW92b3lhZ2VzLmNvbScsICd0djMuY28ubnonLCAnZnJlZWFsbG11c2ljLmluZm8nLCAncHV0bG9ja2VyLmNvbScsICdzb2Nrc2hhcmUuY29tJywgJ2RyYW1hcGFzc2lvbi5jb20nLCAneW9vY2xpY2suY29tJywgJ29ubGluZS51YSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiN0ZXN0ZXInKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJhaXRfYWRkIDogewogICAgICAgIGhvc3QgOiBbJ2ZpbGVjb20ubmV0JywgJ3Vwc2hhcmUub3JnJywgJ3NraXBweWZpbGUuY29tJywgJ213ZmlsZXMubmV0JywgJ3VwLWZsb3cub3JnJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2FkZCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmFpdF9hZHBidGVzdCA6IHsKICAgICAgICBob3N0IDogWydsZWFndWVzZWNyZXRhcnkuY29tJywgJ3Rla25vZ29kcy5jb20nLCAnaGVsbHNtZWRpYS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRwYnRlc3QnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJhaXRfYWR0ZXN0ZXIgOiB7CiAgICAgICAgaG9zdCA6IFsnZnJlZXNwb3J0c2JldC5jb20nLCAnc3BvcnRzcGxheXMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2FkLXRlc3RlcicpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdGdvX3R2X2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzAzCiAgICAgICAgaG9zdCA6IFsndGdvLXR2LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNhZGIsICNiYW5uZXJhZDEsIC5sb2FkX3N0cmVhbSB7IGRpc3BsYXk6IG5vbmU7IH0iKTsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I3Rlc3RlcicpOwogICAgICAgIH0sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcudGhyZXNob2xkID0gMTAwMDsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcuY2hhdF9mcmFtZScpOyAvLyBidWcgcmVsb2FkIGlmcmFtZQogICAgICAgIH0KICAgICAgfSwKICAgICAgZnJlZWdhbWVob3N0aW5nX25sIDogewogICAgICAgIGhvc3QgOiBbJ2ZyZWVnYW1laG9zdGluZy5ubCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNhZHRlc3QnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHRoZXdlYXRoZXJzcGFjZV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsndGhld2VhdGhlcnNwYWNlLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNhYi1ibC1hZHZlcnRpc2VtZW50Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjbGVvZGVza3RvcF9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzcxMQogICAgICAgIGhvc3QgOiBbJ2NsZW9kZXNrdG9wLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNteVRlc3RBZCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW1hZ2VyYWlkZXJfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84MjYKICAgICAgICBob3N0IDogWydpbWFnZXJhaWRlci5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjbXlHQ29udGFpbmVyJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICB2b2ljaV9mciA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mci9mb3J1bS9kaXNjdXNzaW9uLzEwMDkzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgyNgogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS96RVZRSFRpRAogICAgICAgIGhvc3QgOiBbJ3ZvaWNpLmZyJywgJ3Byb2dyYW1tZS10di5uZXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjc2FzX3NjcmlwdDInKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1pbF9pbmsgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE2NTIKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vNDc0Tlp6UEoKICAgICAgICBob3N0IDogWydtaWwuaW5rJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2Fkc19kaXYnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHByZW1fbGluayA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTE1MgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy85MTgKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNzk0CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzY5MgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81NzIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTQxCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL3UxbkZ4SmJxCiAgICAgICAgaG9zdCA6IFsncHJlbS5saW5rJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmNyZWF0ZUVsZW1lbnQoewogICAgICAgICAgICB0YWcgOiAnYScsCiAgICAgICAgICAgIGhyZWYgOiAnaHR0cDovL3d3dy5saXZlYWRleGNoYW5nZXIuY29tJywKICAgICAgICAgICAgYXBwZW5kIDogJyNpbWdfbmV3JwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjdWJldXBsb2FkX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi9mb3J1bS9kaXNjdXNzaW9uLzU5MTkKICAgICAgICBob3N0IDogWydjdWJldXBsb2FkLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuY3JlYXRlRWxlbWVudCh7CiAgICAgICAgICAgIHRhZyA6ICdpZnJhbWUnLAogICAgICAgICAgICBuYW1lIDogJ2lmcmFtZScsCiAgICAgICAgICAgIHNyYyA6ICdhYm91dDpibGFuaycsCiAgICAgICAgICAgIHN0eWxlIDogJ2Rpc3BsYXk6bm9uZTsnLAogICAgICAgICAgICBhcHBlbmQgOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc3RyZWFtNGZyZWVfZXUgOiB7CiAgICAgICAgaG9zdCA6IFsnc3RyZWFtNGZyZWUuZXUnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gK2FicCBhbHQgc29sdXRpb24KICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2pwYXlkYXknKTsKICAgICAgICAgIEFhay51dy5qcGF5ZGF5X2FsZXJ0ID0gMTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF8zZG5ld3NfcnUgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvcnUvZm9ydW0vZGlzY3Vzc2lvbi81NzUwCiAgICAgICAgaG9zdCA6IFsnM2RuZXdzLnJ1J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2FkYmxvY2t3YXJuJywgMSk7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNlYXJBZHMgeyB3aWR0aDogNDAxcHg7IH0iKTsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2VhckFkcycpOwogICAgICAgICAgQWFrLnV3Ll9fQVRfZGV0ZWN0ZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwKICAgICAgXzNkc3RoZW1fZXMgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9M2RzdGhlbQogICAgICAgIGhvc3QgOiBbJzNkc3RoZW0uZXMnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy9BYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHt9KTsKICAgICAgICB9LAogICAgICAgIG9uQmVmb3JlU2NyaXB0IDogZnVuY3Rpb24gKCkgewogICAgICAgIC8qCiAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICBjb250YWlucyA6ICdtYWluLmpzJywKICAgICAgICAgICAgICBleHRlcm5hbCA6IHRydWUsCiAgICAgICAgICAgICAgb3ZlcnJpZGUgOiAnLy9wYXN0ZWJpbi5jb20vcmF3LzJ5R1JQaFJaJwogICAgICAgICAgICB9CiAgICAgICAgICBdOwogICAgICAgICovCiAgICAgICAgfQogICAgICB9LAogICAgICBfOG11c2VzX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT04bXVzZXMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mb3J1bS9kaXNjdXNzaW9uLzg1MTUKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi9mb3J1bS9kaXNjdXNzaW9uLzY0MDcKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vYk1ORHhlY3MKICAgICAgICBob3N0IDogWyc4bXVzZXMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTY3JpcHQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgX3NldFRpbWVvdXQgPSB3aW5kb3cuc2V0VGltZW91dDsKICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQgPSBmdW5jdGlvbiAoZm4sIGRlbGF5KSB7CiAgICAgICAgICAgICAgaWYgKGZuLnRvU3RyaW5nKCkuaW5kZXhPZigiJCh3aW5kb3cpLnRyaWdnZXIoJ2FkYmxvY2snKTsiKSA+IC0xKSB7CiAgICAgICAgICAgICAgICBmbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKFsnQW50aUFkYktpbGxlcicsIGxvY2F0aW9uLmhvc3QsICdBbnRpLUFkQmxvY2sgaW50ZXJjZXB0ZWQgOi0pJ10pOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgX3NldFRpbWVvdXQuY2FsbCh0aGlzLCBmbiwgZGVsYXkpOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB0aGVjaGl2ZV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE0NTMKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vVGRwUHlyYmIKICAgICAgICBob3N0IDogWyd0aGVjaGl2ZS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHdpbmRvdywgewogICAgICAgICAgICAgIHN0ZXBoYW5lRGV0ZWN0b3IgOiB7CiAgICAgICAgICAgICAgICB2YWx1ZSA6IHsKICAgICAgICAgICAgICAgICAgaG9vayA6IGZ1bmN0aW9uIChjYikgewogICAgICAgICAgICAgICAgICAgIGNiKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgaW5pdCA6IGZ1bmN0aW9uICgpIHt9LAogICAgICAgICAgICAgICAgICBicm9hZGNhc3RSZXN1bHQgOiBmdW5jdGlvbiAoKSB7fQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICByaWNob25yYWlsc19jb20gOiB7CiAgICAgICAgLy8gYnk6IEdpd2F5dW1lCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE0NDcKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vRXdmd2c4QkcKICAgICAgICBob3N0IDogWydyaWNob25yYWlscy5jb20nXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGFkc0J5R29vZ2xlSHRtbCA9ICciPGlucytpZD0iYXN3aWZ0XzBfZXhwYW5kIitzdHlsZT0iZGlzcGxheTppbmxpbmUtdGFibGU7Ym9yZGVyOm5vbmU7aGVpZ2h0OjkwcHg7bWFyZ2luOjA7cGFkZGluZzowO3Bvc2l0aW9uOnJlbGF0aXZlO3Zpc2liaWxpdHk6dmlzaWJsZTt3aWR0aDo3NTBweDtiYWNrZ3JvdW5kLWNvbG9yOnRyYW5zcGFyZW50Ij48aW5zK2lkPSJhc3dpZnRfMF9hbmNob3IiK3N0eWxlPSJkaXNwbGF5OmJsb2NrO2JvcmRlcjpub25lO2hlaWdodDo5MHB4O21hcmdpbjowO3BhZGRpbmc6MDtwb3NpdGlvbjpyZWxhdGl2ZTt2aXNpYmlsaXR5OnZpc2libGU7d2lkdGg6NzUwcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudCI+PGlmcmFtZSttYXJnaW53aWR0aD0iMCIrbWFyZ2luaGVpZ2h0PSIwIit2c3BhY2U9IjAiK2hzcGFjZT0iMCIrYWxsb3d0cmFuc3BhcmVuY3k9InRydWUiK3Njcm9sbGluZz0ibm8iK2FsbG93ZnVsbHNjcmVlbj0idHJ1ZSIrb25sb2FkPSJ2YXIraT10aGlzLmlkLHM9d2luZG93Lmdvb2dsZV9pZnJhbWVfb25jb3B5LEg9cyZhbXA7JmFtcDtzLmhhbmRsZXJzLGg9SCZhbXA7JmFtcDtIW2ldLHc9dGhpcy5jb250ZW50V2luZG93LGQ7dHJ5e2Q9dy5kb2N1bWVudH1jYXRjaChlKXt9aWYoaCZhbXA7JmFtcDtkJmFtcDsmYW1wOyghZC5ib2R5fHwhZC5ib2R5LmZpcnN0Q2hpbGQpKXtpZihoLmNhbGwpe3NldFRpbWVvdXQoaCwwKX1lbHNlK2lmKGgubWF0Y2gpe3RyeXtoPXMudXBkKGgsaSl9Y2F0Y2goZSl7fXcubG9jYXRpb24ucmVwbGFjZShoKX19IitpZD0iYXN3aWZ0XzAiK25hbWU9ImFzd2lmdF8wIitzdHlsZT0ibGVmdDowO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowOyIrd2lkdGg9Ijc1MCIrZnJhbWVib3JkZXI9IjAiK2hlaWdodD0iOTAiPjwvaWZyYW1lPjwvaW5zPjwvaW5zPiInOwogICAgICAgICAgICAkLmFqYXgoewogICAgICAgICAgICAgIHVybCA6ICQoIi5hcnRpY2xlLWNvbnRlbnQiKS5kYXRhKCJ1cmwiKSwKICAgICAgICAgICAgICBkYXRhVHlwZSA6ICJzY3JpcHQiLAogICAgICAgICAgICAgIG1ldGhvZCA6ICJwb3N0IiwKICAgICAgICAgICAgICBkYXRhIDogewogICAgICAgICAgICAgICAgaHRtbCA6IGFkc0J5R29vZ2xlSHRtbAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgc3VjY2VzcyA6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIHZhciBleGVjID0gcmVzdWx0LnJlcGxhY2UoIiQoJy5hcnRpY2xlLWNvbnRlbnQnKSIsICIkKCcuYXJ0aWNsZS1jb250ZW50LTInKSIpOwogICAgICAgICAgICAgICAgbmV3IEZ1bmN0aW9uKGV4ZWMpKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgJCgiLmFydGljbGUtY29udGVudCIpLmFmdGVyKCc8ZGl2IGNsYXNzPSJhcnRpY2xlLWNvbnRlbnQtMiI+PC9kaXY+JykucmVtb3ZlKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJtcHJlcHVzYl9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsncm1wcmVwdXNiLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCdqb3Rfdmlld2VyJywgMyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBuZW9kcml2ZV9jbyA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTAwMQogICAgICAgIGhvc3QgOiBbJ25lb2RyaXZlLmNvJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBQcmV2ZW50IHBvcHVuZGVyCiAgICAgICAgICBBYWsuc2V0Q29va2llKCdLaWZQb3BDbnQnLCAxLCBudWxsLCAnL2VtYmVkLycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaGVudGFpaGF2ZW5fb3JnIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vZ29yaGlsbC91QmxvY2svaXNzdWVzLzEzNDAKICAgICAgICBob3N0IDogWydoZW50YWloYXZlbi5vcmcnXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIFByZXZlbnQgcG9wdW5kZXIKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2hoX3BwbmRyMScsIDEpOwogICAgICAgICAgQWFrLnNldENvb2tpZSgnaGhfcHBuZHIyJywgMSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBwcmltZXNoYXJlX3R2IDogewogICAgICAgIGhvc3QgOiBbJ3ByaW1lc2hhcmUudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRibG9jaycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmx1ZXNhdG9zaGlfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84NzMKICAgICAgICBob3N0IDogWydibHVlc2F0b3NoaS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjdGVzdCB7IGhlaWdodDogMjgwcHg7IH0iKTsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I3Rlc3QnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJhemVyY3J5cHRfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84NzAKICAgICAgICBob3N0IDogWydyYXplcmNyeXB0LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiN0ZXN0IHsgaGVpZ2h0OiAyNTBweDsgfSIpOwogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjdGVzdCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2F0b3NoaWVtcGlyZV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg3MgogICAgICAgIGhvc3QgOiBbJ3NhdG9zaGllbXBpcmUuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI3Rlc3QgeyBoZWlnaHQ6IDI1MHB4OyB9Iik7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiN0ZXN0Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBvbmVhZGZhdWNldF9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg3MQogICAgICAgIGhvc3QgOiBbJ29uZWFkZmF1Y2V0LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiN0ZXN0IHsgaGVpZ2h0OiAyNTBweDsgfSIpOwogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjdGVzdCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgamthbmltZV9uZXQgOiB7CiAgICAgICAgaG9zdCA6IFsnamthbmltZS5uZXQnXSwKICAgICAgICAvLyBAQHx8amthbmltZS5uZXQvYXNzZXRzL2pzL2FkdmVydGlzZW1lbnQyLmpzCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I3JlY28nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF83MjBwbWt2X2NvbSA6IHsKICAgICAgICBob3N0IDogWyc3MjBwbWt2LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNhZHZlcnQnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBhaWR2ZXJ0c19jb20gOiB7CiAgICAgICAgaG9zdCA6IFsncGFpZHZlcnRzLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2Rpdi5hZnNfYWRzJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBpdGFsaWF0dl9vcmcgOiB7CiAgICAgICAgaG9zdCA6IFsnaXRhbGlhdHYub3JnJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2ZhYjEzJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjaHJpc3Ntb292ZV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnY2hyaXNzbW9vdmUuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRzZXJ2ZXInKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGV2ZW50aHVic19jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnZXZlbnRodWJzLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNibGFoeWJsYWNpMScpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc3VwZXJhbmltZXNfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjk1CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0ZEUEFLalRRCiAgICAgICAgaG9zdCA6IFsnc3VwZXJhbmltZXMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2Jhbm5lckxvamEnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZvcnVtX3BhY19yb21fY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yNDMKICAgICAgICBob3N0IDogWydmb3J1bS5wYWMtcm9tLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2Rpdi5iYW5uZXJfYWRzJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBsaXR2X3R2IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjk5CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL3pjZGR2VHVDCiAgICAgICAgaG9zdCA6IFsnbGl0di50diddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2Rpdi5wbGF5ZXJfbWFzaycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGV2ZWxkb3duX2ZyIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81OTUKICAgICAgICBob3N0IDogWydsZXZlbGRvd24uZnInXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRibG9jaycpOwogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRibG9ja3Rlc3QnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdsb2Jlc2xvdF9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzkyNAogICAgICAgIGhvc3QgOiBbJ2dsb2Jlc2xvdC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWRkJyk7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNhZGQxJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhbnRlbm5lc3BvcnRfY29tIDogewogICAgICAgIGhvc3QgOiBbJ2FudGVubmVzcG9ydC5jb20nLCAnc2VydmVyaGQuZXUnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7IC8vIGZvciBhbnRlbm5lc3BvcnQKICAgICAgICAgIC8vIFJlbW92ZSBQdWIKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCIjcHViIC5wdWJjbG9zZSIpOwogICAgICAgICAgLy8gUmVkaXJlY3QgdG8gUGxheWVyCiAgICAgICAgICBBYWsuc2V0RWxlbWVudCgnI3B1YiAuZW1iZWQgaWZyYW1lJywgewogICAgICAgICAgICBzcmMgOiAnL2VtYmVkL2VtYmVkLnBocCcKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGlzYWJsZUFsZXJ0Ym94IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL2ZvcnVtL2Rpc2N1c3Npb24vODYxMQogICAgICAgIGhvc3QgOiBbJ2RyaXZlYXJhYmlhLmNvbScsICdwdXRsb2NrZXIuY29tJywgJ2RvYXRvb2xzaXRhLmFsdGVydmlzdGEub3JnJywgJ3NvY2tzaGFyZS5jb20nLCAnZnJlZS1tb3ZpZS1ob21lLmNvbScsICdwYy5vbmxpbmUxNDMuY29tJywgJ2tvb29yYS5jb20nLCAnc3RyM2FtdHYuY28ubnInLCAnc3RyM2FtdHYuYWx0ZXJ2aXN0YS5vcmcnLCAnc3RyM2FtLmFsdGVydmlzdGEub3JnJywgJ2ZpbGVjb20ubmV0JywgJ3BpcG9jYXMudHYnLCAnZ2VuZXJhdHVwcmVtaXVtLmJpeicsICdtZWdhLWRlYnJpZC5ldScsICdwcmVtaXVtc3QwcmUuYmxvZ3Nwb3QuY29tJywgJ2RsLXByb3RlY3QuY29tJywgJ25ld3NpbmxldmVscy5jb20nLCAndmlwcmFjaW5nLmJpeiddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFsZXJ0ID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgfQogICAgICB9LAogICAgICBnZW5lcmF0dXByZW1pdW1fYml6IDogewogICAgICAgIGhvc3QgOiBbJ2dlbmVyYXR1cHJlbWl1bS5iaXonXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gRGlzYWJsZSBDb25maXJtIEJveAogICAgICAgICAgLy9BYWsudXcuY29uZmlybSA9IGZ1bmN0aW9uICgpe307CiAgICAgICAgICBBYWsuc2V0Q29va2llKCdnZW5lcmEnLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhZHN3aXp6X2NvbSA6IHsKICAgICAgICAvLyBieTogU2tyNHRjaEdyM2F6eU1vbmtpQmFsbGxsbGxaenp6CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgwOQogICAgICAgIGhvc3QgOiBbJ3llcy5mbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2luZG93LmNvbV9hZHN3aXp6X3N5bmNocm9faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZXJzdGFuZGFyZF9hdCA6IHsKICAgICAgICAvLyBieTogQWxleGFuZGVyMjU1CiAgICAgICAgLy8gcGF0Y2g6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vcmF3LnBocD9pPXI3UTREcmZCCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEwNQogICAgICAgIGhvc3QgOiBbJ2RlcnN0YW5kYXJkLmF0J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICB2YXIgbWFrZUlTT1RpbWVzdGFtcFVUQyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBhZCA9IGZ1bmN0aW9uIChhbW91bnQsIHdpZHRoKSB7CiAgICAgICAgICAgICAgdmFyIHBhZGRpbmcgPSAiIjsKICAgICAgICAgICAgICB3aGlsZSAocGFkZGluZy5sZW5ndGggPCB3aWR0aCAtIDEgJiYgYW1vdW50IDwgTWF0aC5wb3coMTAsIHdpZHRoIC0gcGFkZGluZy5sZW5ndGggLSAxKSkgewogICAgICAgICAgICAgICAgcGFkZGluZyArPSAiMCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBwYWRkaW5nICsgYW1vdW50LnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgIHJldHVybiBbcGFkKGRhdGUuZ2V0VVRDRnVsbFllYXIoKSwgNCksICItIiwKICAgICAgICAgICAgICBwYWQoZGF0ZS5nZXRVVENNb250aCgpICsgMSwgMiksICItIiwKICAgICAgICAgICAgICBwYWQoZGF0ZS5nZXRVVENEYXRlKCksIDIpLCAiVCIsCiAgICAgICAgICAgICAgcGFkKGRhdGUuZ2V0VVRDSG91cnMoKSwgMiksICI6IiwKICAgICAgICAgICAgICBwYWQoZGF0ZS5nZXRVVENNaW51dGVzKCksIDIpLCAiOiIsCiAgICAgICAgICAgICAgcGFkKGRhdGUuZ2V0VVRDU2Vjb25kcygpLCAyKV0uam9pbigpOwogICAgICAgICAgfTsKCiAgICAgICAgICBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsgJykuZm9yRWFjaChmdW5jdGlvbiAoY29va2llKSB7CiAgICAgICAgICAgIC8vIEZpbmQgbWFpbiBzdG9yYWdlIGNvb2tpZQogICAgICAgICAgICBpZiAoY29va2llLnN1YnN0cigwLCA2KSA9PSAiTUdVSUQ9IikgewogICAgICAgICAgICAgIC8vIERlY29tcG9zZSBpbmZvcm1hdGlvbiBmcm9tIG1haW4gc3RvcmFnZSBjb29raWUKICAgICAgICAgICAgICB2YXIgdmFsdWVzID0ge307CiAgICAgICAgICAgICAgY29va2llLnN1YnN0cig2KS5zcGxpdCgiJiIpLmZvckVhY2goZnVuY3Rpb24gKGFzc2lnbm1lbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwb3MgPSBhc3NpZ25tZW50LmluZGV4T2YoJz0nKTsKICAgICAgICAgICAgICAgIGlmIChwb3MgPiAtMSkgewogICAgICAgICAgICAgICAgICB2YWx1ZXNbYXNzaWdubWVudC5zdWJzdHIoMCwgcG9zKV0gPSBhc3NpZ25tZW50LnN1YnN0cihwb3MgKyAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgLy8gVXBkYXRlICJmaXJzdCB2aWV3ZWQiIHRpbWVzdGFtcAogICAgICAgICAgICAgIHZhbHVlcy5UaW1lc3RhbXAgPSBtYWtlSVNPVGltZXN0YW1wVVRDKCk7CgogICAgICAgICAgICAgIC8vIFJlY29tcG9zZSBpbmZvcm1hdGlvbiBpbiBtYWluIHN0b3JhZ2UgY29va2llCiAgICAgICAgICAgICAgY29va2llID0gIk1HVUlEPSI7CiAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHZhbHVlcykgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgICAgICAgIGNvb2tpZSArPSBrZXkgKyAiPSIgKyB2YWx1ZXNba2V5XSArICImIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29va2llID0gY29va2llLnN1YnN0cigwLCAoY29va2llLmxlbmd0aCAtIDEpKTsKCiAgICAgICAgICAgICAgLy8gVXBkYXRlIGNvb2tpZQogICAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGNvb2tpZTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB0ZWtfZG9tYWlucyA6IHsKICAgICAgICAvLyBieTogUmVlaywgQWxleGFuZGVyMjU1CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzc4OAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81MTIKICAgICAgICBob3N0IDogWyd0ZWsubm8nLCAnZ2FtZXIubm8nLCAndGVrbm9maWwubm8nLCAnaW5zaWRldGVsZWNvbS5ubycsICdwcmlzZ3VpZGUubm8nLCAnZGlza3Vzam9uLm5vJywgJ3Rla25vam9iYi5ubycsICdha2FtLm5vJywgJ2hhcmR3YXJlLm5vJywgJ2Ftb2JpbC5ubyddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAvKgogICAgICAgICAgdmFyIGFkX2ZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaWZyYW1lIik7CiAgICAgICAgICBhZF9mcmFtZS5uYW1lID0gIl9mcmFtZSI7CiAgICAgICAgICBhZF9mcmFtZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhZF9mcmFtZSk7CiAgICAgICAgICBhZF9mcmFtZS5jb250ZW50V2luZG93LndyYXBwZWRKU09iamVjdC5pbkZJRiA9IHRydWU7CiAgICAgICAgICAgKi8KCiAgICAgICAgICAvLyBmaXggMjcuMTEuMjAxNQogICAgICAgICAgQWFrLmNyZWF0ZUVsZW1lbnQoewogICAgICAgICAgICB0YWcgOiAnZGl2JywKICAgICAgICAgICAgaWQgOiAnZ29vZ2xlX2Fkc19pZnJhbWVfJywKICAgICAgICAgICAgaHRtbCA6ICc8cD48L3A+JywKICAgICAgICAgICAgYXBwZW5kIDogJ2JvZHknCiAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgICB9LAogICAgICBwbGFuZXRhdHZvbmxpbmVoZF9uZXR3b3JrIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDY3CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE1OQogICAgICAgIGhvc3QgOiBbJ3BsYW5ldGF0dm9ubGluZWhkLmJsb2dzcG90LicsICdwbGFuZXRhdHZvbmxpbmVoZC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCcuYWRzYW50aWxvayB7IGhlaWdodDogMXB4OyB9Jyk7CiAgICAgICAgICAvL0Fhay51dy5qUUFudGlBZHNCbG9jayA9IGZ1bmN0aW9uICgpe307IC8vIGRvbid0IHdvcmsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJldGFfc3BlZWR0ZXN0X25ldCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNjI4CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU2MgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80ODQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZTIub3JnLzUzeW1naFgxCiAgICAgICAgaG9zdCA6IFsnYmV0YS5zcGVlZHRlc3QubmV0J10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRzT29rbGFDb21SZWFjaGFibGUgPSB0cnVlOwogICAgICAgICAgQWFrLnV3LnNjcmlwdHNMb2FkZWQgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJpbmJ1Y2tzX2NvbSA6IHsKICAgICAgICAvLyBieTogQWxleGFuZGVyMjU1CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU0NQogICAgICAgIGhvc3QgOiBbJ2JpbmJ1Y2tzLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy50ZXN0SnVpY3lQYXkgPSB0cnVlOwogICAgICAgICAgQWFrLnV3LnRlc3RTZW5zZVBheSA9IHRydWU7CiAgICAgICAgfQogICAgICB9LAogICAgICB3aGlza3lwcmljZXNfZG9tYWlucyA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTI4NAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9FcHI1dFJFTAogICAgICAgIGhvc3QgOiBbJ3doaXNreXByaWp6ZW4uY29tJywgJ3doaXNreXByaWNlcy5jby51aycsICd3aGlza3lwcmVpc2UuY29tJywgJ3doaXNreXByaXguZnInXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5PQV9zaG93ID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG5pY29ibG9nX29yZyA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTE4NAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9NTkhwTHMyVgogICAgICAgIGhvc3QgOiBbJ25pY29ibG9nLm9yZyddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zcmMnKTsKICAgICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRpX3NlIDogewogICAgICAgIC8vIG5vdGU6IGFkZCB0aGlzIHJ1bGUgZm9yIGNocm9tZSB1c2VyCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEzMTkKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vOWJEUFF6TVgKICAgICAgICBob3N0IDogWydkaS5zZSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjaGVhZGVyX292ZXJsYXknKTsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjbWVzc2FnZV9tb2RhbCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbWVnb2dvX25ldCA6IHsKICAgICAgICAvLyBpc3N1ZTogUE0KICAgICAgICAvLyBzb3VyY2UxOiBodHRwOi8vcGFzdGViaW4uY29tL2NjSFFnM2huCiAgICAgICAgLy8gc291cmNlMjogaHR0cDovL3Bhc3RlYmluLmNvbS9nazB2RVFITgogICAgICAgIC8vIG5vdGU6IHR3byBhZGJsb2NrIGNoZWNrCiAgICAgICAgaG9zdCA6IFsnbWVnb2dvLm5ldCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAiYWRCbG9jayIsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgInNob3dBZEJsb2NrTWVzc2FnZSIsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDogZnVuY3Rpb24gKCkge30KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGliZXJ0YWRkaWdpdGFsX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTY0MgogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS82RnpwMHZyRQogICAgICAgIGhvc3QgOiBbJ2xpYmVydGFkZGlnaXRhbC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgImFkX2FscmVhZHlfcGxheWVkIiwgewogICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgd3JpdGFibGUgOiBmYWxzZSwKICAgICAgICAgICAgdmFsdWUgOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYWsudXcsICJwdWVkZU1vc3RyYXJBZHMiLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwgICAgIAogICAgICBmb2xoYV91b2xfY29tX2JyIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMzk2CiAgICAgICAgLy8gc291cmNlOiBmKCAoIHR5cGVvZiBwYXl3YWxsX2FjY2VzcyA9PSAidW5kZWZpbmVkIiB8fCBwYXl3YWxsX2FjY2VzcyAhPSB0cnVlICkgJiYgKCB0eXBlb2YgZm9saGFfYWRzID09ICJ1bmRlZmluZWQiIHx8IGZvbGhhX2FkcyAhPSB0cnVlICkgKSB7CiAgICAgICAgaG9zdCA6IFsnZm9saGEudW9sLmNvbS5iciddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAicGF5d2FsbF9hY2Nlc3MiLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgImZvbGhhX2FkcyIsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBnYW1lcl9jb21fdHcgOiB7CiAgICAgICAgLy8gYnk6IG1taXMxMDAwCiAgICAgICAgLy8gdXNlcnNjcmlwdDogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi9zY3JpcHRzLzE2NTI1CiAgICAgICAgLy8gaXNzdWU6IDogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTc1CiAgICAgICAgaG9zdCA6IFsnZ2FtZXIuY29tLnR3J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYWsudXcsICdBbnRpQWQnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IG51bGwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYXJtb3JnYW1lc19jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg0NQogICAgICAgIGhvc3QgOiBbJ2FybW9yZ2FtZXMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYWsudXcsICdnYV9kZXRlY3QnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IG51bGwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbWFuZ2Fob3N0X2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTU3CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU1OAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9HcnBiSkVOQQogICAgICAgIGhvc3QgOiBbJ21hbmdhaG9zdC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgInRlc3REaXNwbGF5IiwgewogICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgd3JpdGFibGUgOiBmYWxzZSwKICAgICAgICAgICAgdmFsdWUgOiBmYWxzZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB2aWRlb3dvb2RfdHYgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEzMzkKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly92aWRlb3dvb2QudHYvYnVpbGQvYXNzZXRzL2pzL3BlbWJlZC05N2E2NDBmNjI1LmpzCiAgICAgICAgaG9zdCA6IFsndmlkZW93b29kLnR2J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5vcGVuID0gZnVuY3Rpb24gKCkge307IC8vIHByZXZlbnQgcG9wdXAKICAgICAgICAgIEFhay51dy5jb25maWcgPSB7fTsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBYWsudXcuY29uZmlnLCAiYWRiX3JlbWluZCIsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDogZmFsc2UKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW5mb2pvYnNfY29tX2JyIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMzM5CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0xQZzYwOTNVCiAgICAgICAgLy8gcmVkaXJlY3Q6IGh0dHA6Ly93d3cuaW5mb2pvYnMuY29tLmJyL25vcHVibGljaXR5LmFzcHgKICAgICAgICBob3N0IDogWydpbmZvam9icy5jb20uYnInXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB3ZWJVSSA9IHdlYlVJIHx8IHt9OwogICAgICAgICAgICB3ZWJVSS5VdGlscyA9IHdlYlVJLlV0aWxzIHx8IHt9OwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2ViVUkuVXRpbHMsICJTdG9wQWRCbG9jayIsIHsKICAgICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICAgIHZhbHVlIDogZnVuY3Rpb24gKCkge30KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBjbG91ZHdlYmNvcHlfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy83MTQKICAgICAgICBob3N0IDogWydjbG91ZHdlYmNvcHkuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBzZXRUaW1lb3V0Q2xvbmUgPSBBYWsudXcuc2V0VGltZW91dDsKICAgICAgICAgIEFhay51dy5zZXRUaW1lb3V0ID0gbnVsbDsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBBYWsudXcuc2V0VGltZW91dCA9IHNldFRpbWVvdXRDbG9uZTsKICAgICAgICAgIH0sIDUwMDApOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbmFya2l2ZV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU2OQogICAgICAgIGhvc3QgOiBbJ25hcmtpdmUuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRibG9ja19zdGF0dXMgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBwcmVnZW5fbmV0IDogewogICAgICAgIGhvc3QgOiBbJ3ByZWdlbi5uZXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gc2tpcCBwYWdlIGluZm8KICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BnbicsIDEpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcGh5c19vcmcgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzc2OAogICAgICAgIGhvc3QgOiBbJ3BoeXMub3JnJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuY2hrQUIgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9udmFzb3J0aXJfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8zMzgKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzMzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzMzMAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy85MQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84OQogICAgICAgIGhvc3QgOiBbJ29udmFzb3J0aXIuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyArYWJwIHJ1bGUgYWx0IHNvbHV0aW9uCiAgICAgICAgICBBYWsudXcuc2FzID0ge307CiAgICAgICAgfQogICAgICB9LAogICAgICB2aWxsZV9pZGVhbGVfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yNTgKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vMTZtbm1lTWMKICAgICAgICBob3N0IDogWyd2aWxsZS1pZGVhbGUuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyArYWJwIHJ1bGUgYWx0IHNvbHV0aW9uCiAgICAgICAgICBBYWsudXcuZXhlY3NwID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgfQogICAgICB9LAogICAgICBub3RyZV9wbGFuZXRlX2luZm8gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzI1OAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9xclM2UUdHRQogICAgICAgIGhvc3QgOiBbJ25vdHJlLXBsYW5ldGUuaW5mbyddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gK2FicCBydWxlIGFsdCBzb2x1dGlvbgogICAgICAgICAgQWFrLnV3LnB1YnBvcCA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgYXBrbWlycm9yX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzc4CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzIyNAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy83OAogICAgICAgIGhvc3QgOiBbJ2Fwa21pcnJvci5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5kb0NoZWNrID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgfQogICAgICB9LAogICAgICBtdGxibG9nX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTQ4CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZm9ydW0vZGlzY3Vzc2lvbi83NzUzCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0JGckRQTTZiCiAgICAgICAgaG9zdCA6IFsnbXRsYmxvZy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgJ3B1YWJzJywgewogICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgdmFsdWUgOiBmdW5jdGlvbiAoKSB7fQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhbml6bV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsnYW5pem0uY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuc3RvcEFkQmxvY2sgPSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRpYXJpb2luZm9ybWFjaW9uX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTU1MAogICAgICAgIGhvc3QgOiBbJ2RpYXJpb2luZm9ybWFjaW9uLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAncHJfb2t2YWxpZGEnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB2YWx1ZSA6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgY25iZXRhX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTMwMQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS92WE5DenR3eAogICAgICAgIGhvc3QgOiBbJ2NuYmV0YS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgJ0pCJywgewogICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgdmFsdWUgOiBmdW5jdGlvbiAoKSB7fQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB0aGVtYXJrZXJfaGFhcmV0eiA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTI5MgogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9tMDhka0RUNAogICAgICAgIGhvc3QgOiBbJ3RoZW1hcmtlci5jb20nLCAnaGFhcmV0ei5jby5pbCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAnQWRCbG9ja1V0aWwnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB2YWx1ZSA6IHt9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBpcG9jYXNfdHYgOiB7CiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsncGlwb2Nhcy50diddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBBbHNvIGFkZGVkIGluIGRpc2FibGVBbGVydGJveAogICAgICAgICAgLy8gTm8gcG9wdXAKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BvcHVwX3VzZXJfbG9naW4nLCAneWVzJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBfMTVtaW5fbHQgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9MTVtaW4uaXQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vWVdmM0hUcXIKICAgICAgICBob3N0IDogWycxNW1pbi5sdCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAnX19hZGJsb2NrX2pzX3Rlc3QnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IHRydWUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2MyY2FzdHNfY29tIDogewogICAgICAgIC8vIGJ5OiBHaXdheXVtZQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNTk5CiAgICAgICAgaG9zdCA6IFsnc2MyY2FzdHMuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbigpIHsKICAgICAgICAgICAgd2luZG93Ll9nYXEgPSB7IHB1c2g6ZnVuY3Rpb24oKSB7fSB9OwogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAic2hvd2RpYWxvZyIsIHsKICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24oKSB7fSwKICAgICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlLAogICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgInNob3dQb3B1cDIiLCB7CiAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkge30sCiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwKICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHZndW5ldHdvcmtfY29tIDogewogICAgICAgIC8vIGlzc3VlOgogICAgICAgIGhvc3QgOiBbJ3ZndW5ldHdvcmsuY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnNldENvb2tpZSgnc3RvcEl0JywgMSk7CiAgICAgICAgICB2YXIgY2xvc2UgPSBBYWsuZ2V0RWxlbWVudCgnI3NvbWVfYWRfYmxvY2tfa2V5X2Nsb3NlJyk7CiAgICAgICAgICBpZiAoY2xvc2UpIHsKICAgICAgICAgICAgY2xvc2UuY2xpY2soKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNlZWtpbmdhbHBoYV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IAogICAgICAgIGhvc3QgOiBbJ3NlZWtpbmdhbHBoYS5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5TQS5QYWdlcy5BcnRpY2xlLmlzX2duaWtjb2xiZGEgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBsaW5rY3J5cHRfd3MgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzI4NgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL3B1bGwvNjcKICAgICAgICBob3N0IDogWydsaW5rY3J5cHQud3MnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuc2V0RWxlbWVudCgnI2FkX2NvbnQnLCB7CiAgICAgICAgICAgIGlkIDogJycsCiAgICAgICAgICAgIHN0eWxlIDogJ2Rpc3BsYXk6YmxvY2s7JwogICAgICAgICAgfSk7CiAgICAgICAgICBBYWsuc2V0RWxlbWVudCgnI2NvbnRhaW5lcl9jaGVjaycsIHsKICAgICAgICAgICAgc3R5bGUgOiAnZGlzcGxheTpub25lOycKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZXZlbnRvc3Bwdl9tZSA6IHsKICAgICAgICAvLyBpc3N1ZTogCiAgICAgICAgaG9zdCA6IFsnZXZlbnRvc3Bwdi5tZSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjbmYzNycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYm9sb3JfdG9saV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU1MgogICAgICAgIGhvc3QgOiBbJ2JvbG9yLXRvbGkuY29tJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYWRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYmFubmVyJyk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgYWQgPSBhZHNbaV07CiAgICAgICAgICAgIGFkLmlubmVySFRNTCA9ICc8YnI+JzsKICAgICAgICAgICAgYWQuc3R5bGUuaGVpZ2h0ID0gJzFweCc7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICB2aXZvX3N4IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yODAKICAgICAgICBob3N0IDogWyd2aXZvLnN4J10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgYWxlcnQgPSBBYWsuZ2V0RWxlbWVudCgnI2FsZXJ0LXRocm90dGxlJyk7CiAgICAgICAgICBpZiAoYWxlcnQpIHsKICAgICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoYWxlcnQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJ1dHRvbiA9IEFhay5nZXRFbGVtZW50KCdidXR0b24jYWNjZXNzJyk7CiAgICAgICAgICBpZiAoYnV0dG9uKSB7CiAgICAgICAgICAgIGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2lkJyk7CiAgICAgICAgICAgIGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7CiAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAnQ29udGludWUgdG8gdmlkZW8nOwogICAgICAgICAgfQogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpbnB1dCA9IEFhay5nZXRFbGVtZW50KCdpbnB1dFtuYW1lPSJ0aHJvdHRsZSJdJyk7CiAgICAgICAgICAgIGlmIChpbnB1dCkgewogICAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KGlucHV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBsdXh5YWRfY29tIDogeyAvLyBza2lwIHJlZGlyZWN0IG15YW5pbWVzLmxpCiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsnbHV4eWFkLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICgnL0luZm9ybWF0aW9uLnBocCcgPT0gbG9jYXRpb24ucGF0aG5hbWUpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSBsb2NhdGlvbi5ocmVmOwogICAgICAgICAgICBsb2NhdGlvbi5ocmVmID0gaHJlZi5zdWJzdHIoaHJlZi5pbmRleE9mKCd1cmw9JykgKyA0LCBocmVmLmxlbmd0aCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBtcnBpcmFjeV9kb21haW5zIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDA1CiAgICAgICAgaG9zdCA6IFsnbXJwaXJhY3kueHl6JywgJ21ycGlyYWN5LmNsdWInXSwKICAgICAgICBvbkJlZm9yZVNjcmlwdCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgIGNvbnRhaW5zIDogJ0Rlc2F0aXZhIG8gQWRCbG9jayBwYXJhIGNvbnRpbnVhcicsCiAgICAgICAgICAgICAgZXh0ZXJuYWwgOiBmYWxzZSwKICAgICAgICAgICAgICByZW1vdmUgOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIF07CiAgICAgICAgfQogICAgICB9LAogICAgICBkYnBsYW5ldF9uZXQgOiB7CiAgICAgICAgLy8gaXNzdWU6IFBNCiAgICAgICAgaG9zdCA6IFsnZGJwbGFuZXQubmV0J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ25ld25vTW9yZUFkc05vdycsIDEpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWlkZW11X2ZyIDogewogICAgICAgIC8vIGlzc3VlOgogICAgICAgIGhvc3QgOiBbJ2FpZGVtdS5mciddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCdhZGJsb2NrUG9wdXAnLCB0cnVlKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGVhbWlfaW4gOiB7CiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsnZWFtaS5pbiddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnNldENvb2tpZSgnYWRfbG9ja2VkJywgMSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBiaWdkb3dubG9hZGVyX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZToKICAgICAgICBob3N0IDogWydiaWdkb3dubG9hZGVyLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjYW50aV9hZGJsb2NrJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmcmVlc2tpZXJfY29tIDogewogICAgICAgIC8vIGJ5OiBHb3JoaWxsCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzYzOQogICAgICAgIC8vIG5vdGU6IGFsc28gYWRkZWQgbGlzdCBydWxlCiAgICAgICAgaG9zdCA6IFsnZnJlZXNraWVyLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZGItbm90LWVuYWJsZWQiKTsKICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiZGlzcGxheSIpOwogICAgICAgICAgfQogICAgICAgICAgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmlkZW9Db250YWluZXIiKTsKICAgICAgICAgIGlmIChlbCAhPT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiZGlzcGxheSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZ2FtZXRyYWlsZXJzX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZToKICAgICAgICBob3N0IDogWydnYW1ldHJhaWxlcnMuY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJyNhZF9ibG9ja2luZycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgc2Nhbl9vbmVwaWVjZV9uYXJ1dG9fbXggOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU4MgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yNzkKICAgICAgICBob3N0IDogWydzY2FuLW14LmNvbScsICdvbmVwaWVjZS1teC5uZXQnLCAnbmFydXRvLW14Lm5ldCddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFkX2Jsb2NrX3Rlc3QgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRFbGVtZW50KCcjeW9wJywgewogICAgICAgICAgICBpZCA6ICcnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIEJpdGNvaW5zCiAgICAgIGJpdGNvaW5rZXJfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yMzAKICAgICAgICBob3N0IDogWydiaXRjb2lua2VyLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuY2xhaW0gPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjRTMzRkNDY1gyZlcnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1vb25kb2dlX2NvX2luIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8zODQKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMjMyCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzIzMwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yMzYKICAgICAgICBob3N0IDogWydtb29uZG9nZS5jby5pbicsICdtb29ubGl0ZWNvLmluJywgJ21vb25iaXQuY28uaW4nLCAnYml0Y29pbnplYnJhLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjQUIsICNFNDQyRHYsICNlQ0M1aCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYml0Y29pbmVyX25ldCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzQ5CiAgICAgICAgaG9zdCA6IFsnYml0Y29pbmVyLm5ldCcsICdsaXRlY29pbmVyLm5ldCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiN0ZXN0ZXInKTsKICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2FkLXRvcCcpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYml0Y29pbnNfbnhfdGMgOiB7CiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsnZnJlZWJpdGNvaW5zLm54LnRjJywgJ2dldGJpdGNvaW5zLm54LnRjJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRfYmxvY2tfdGVzdCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZyZWVjb2luczRfbWUgOiB7CiAgICAgICAgLy8gaXNzdWU6CiAgICAgICAgaG9zdCA6IFsnZnJlZWNvaW5zNC5tZSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmNoZWNrID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgdG9ycmVudF90dl9ydSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTM3CiAgICAgICAgaG9zdCA6IFsndG9ycmVudC10di5ydSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmNfT29fQWR2ZXJ0X1Nob3duID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGN3dHZfY29tIDogewogICAgICAgIC8vIGJ5OiBLYWxiYXNpdAogICAgICAgIC8vIHB1bGw6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvcHVsbC83NjMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzQwCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzc2MgogICAgICAgIGhvc3QgOiBbJ2N3dHYuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuQ1dUVklzQWRCbG9ja2luZyA9IHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGJpbGRfZGUgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9YmlsZAogICAgICAgIGhvc3QgOiBbJ2JpbGQuZGUnXSwKICAgICAgICBvbkJlZm9yZVNjcmlwdCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgIGNvbnRhaW5zIDogJ2h0dHA6Ly93d3cuYmlsZC5kZS93YS9sbC9iaWxkLWRlL3VuYW5nZW1lbGRldC00MjkyNTUxNi5iaWxkLmh0bWwnLAogICAgICAgICAgICAgIGV4dGVybmFsIDogZmFsc2UsCiAgICAgICAgICAgICAgcmVwbGFjZSA6IFsnamF2YXNjcmlwdCcsICd2b2lkKDApOyddLmpvaW4oJzonKQogICAgICAgICAgICB9CiAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgfSwKICAgICAgaW5uX2NvX2lsIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81MzIKICAgICAgICBob3N0IDogWydpbm4uY28uaWwnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBUUkMgPSB7fTsKICAgICAgICAgICAgVFJDLmJsb2NrZXIgPSB7CiAgICAgICAgICAgICAgc3RhdGVzIDogewogICAgICAgICAgICAgICAgQUJQX0RFVEVDVElPTl9ESVNBQkxFRCA6IC0yLAogICAgICAgICAgICAgICAgQUJQX05PVF9ERVRFQ1RFRCA6IDAsCiAgICAgICAgICAgICAgICBBQlBfREVURUNURUQgOiAxCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBjcmVhdGVCbG9ja0RldGVjdGlvbkRpdiA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGlzQmxvY2tEZXRlY3RlZE9uRGl2IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpc0Jsb2NrRGV0ZWN0ZWRPbkNsYXNzTmFtZXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGdldEJsb2NrZWRTdGF0ZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdHVya2FuaW1lX3R2IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80NDYKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTM5CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvdHIvZm9ydW0vZGlzY3Vzc2lvbi80MjgyLwogICAgICAgIGhvc3QgOiBbJ3R1cmthbmltZS50diddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFkYmxvY2tibG9jayA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgQWFrLnV3LkJsb2tLb250cm9sID0ge307CiAgICAgICAgfQogICAgICB9LAogICAgICB3dGZiaXRfY2ggOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzQwNwogICAgICAgIGhvc3QgOiBbJ3d0ZmJpdC5jaCddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LndyaXRlSFRNTGFzSlMgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFyYW56dWxsYV9pdCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT1hcmFuenVsbGEuaXQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20veU1NNllneFcKICAgICAgICBob3N0IDogWydhcmFuenVsbGEuaXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgImFiQ2hlY2siLCB7CiAgICAgICAgICAgIHZhbHVlIDoge30sCiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZSA6IGZhbHNlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGxlc2VjaG9zX2ZyIDogewogICAgICAgIC8vIFJlZWssIEdpd2F5dW1lCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9bGVzZWNob3MuZnIKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vQ01NOFdHTGoKICAgICAgICBob3N0IDogWydsZXNlY2hvcy5mcicsICdsZXNlY2hvcy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAiY2hlY2tBZEJsb2NrIiwgewogICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHt9LAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5jYWxsX0FkID0gMTsKICAgICAgICAgIEFhay51dy5wYXl3YWxsX2FkYmxvY2tfYXJ0aWNsZSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwgICAgIAogICAgICBiaXR2aXNpdHNfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yNjYKICAgICAgICBob3N0IDogWydiaXR2aXNpdHMuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYmxvY2tBZGJsb2NrVXNlciA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZXhyYXBpZGxlZWNoX2luZm8gOiB7CiAgICAgICAgLy8gYnk6IEFsZXhhbmRlcjI1NSwgUmVlaywgR2l3YXl1bWUKICAgICAgICAvLyBwYXRjaDogaHR0cDovL3Bhc3RlYmluLmNvbS9RNjY0ZGlRMgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcz9xPWV4cmFwaWRsZWVjaAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS81ZTI3c3lqQQogICAgICAgIGhvc3QgOiBbJ2V4cmFwaWRsZWVjaC5pbmZvJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICB2YXIgdG9tb3Jyb3cgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgdG9tb3Jyb3cuc2V0RGF0ZSh0b21vcnJvdy5nZXREYXRlKCkgKyAxKTsKCiAgICAgICAgICAvLyBwcmV2ZW50IHBvcHVwCiAgICAgICAgICBBYWsuc2V0Q29va2llKCdwb3BjYXNocHVDYXAnLCAxKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BvcGNhc2hwdScsIDEpOwogICAgICAgICAgQWFrLnNldENvb2tpZSgnbm9wb3BhdGFsbCcsIHRvbW9ycm93LmdldFRpbWUoKS50b1N0cmluZygpKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ25vYWR2dGRheScsIDApOwogICAgICAgICAgLy9BYWsuc2V0Q29va2llKCdidl9EU0tza2Rja19zMWQnLCAnYnZEU0tza2Rja3MxZCcpOwoKICAgICAgICAgIC8vIGhpZGUgbm90aWNlCiAgICAgICAgICBBYWsuYWRkU3R5bGUoJ2Rpdi5jb250YWluZXIgZGl2LnJvdyBkaXYuY29sLW1kLTUgZGl2LnJvdyBmaWVsZHNldCBkaXYuYWxlcnQuYWxlcnQtZGFuZ2VyLmxlYWQsIGRpdi5jb250YWluZXIgZGl2LnJvdyBkaXYucGFuZWwucGFuZWwtZGVmYXVsdCBkaXYucGFuZWwtYm9keSBwIHtkaXNwbGF5Om5vbmU7fScpOwogICAgICAgICAgCiAgICAgICAgICAvLyBwcmV2ZW50IHJlZGlyZWN0IHRvIHZlcmlmeSBwYWdlCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAnYmR2Ym5yX3BpZCcsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHZhbHVlIDogW10KICAgICAgICAgIH0pOwoKICAgICAgICAgIEFhay5hZGRTY3JpcHQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIC8vIHByZXZlbnQgcG9wdXAKICAgICAgICAgICAgICB3aW5kb3cub3BlbiA9IGZ1bmN0aW9uICgpIHt9OwoKICAgICAgICAgICAgICAvLyBwcmV2ZW50IHJlZGlyZWN0IHRvIHZlcmlmeSBwYWdlCiAgICAgICAgICAgICAgdmFyIGZyYW1lMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogICAgICAgICAgICAgIGZyYW1lMS5zcmMgPSAnaHR0cDovL2JkZnJtLmJpZHZlcnRpc2VyLmNvbS9CaWRWZXJ0aXNlci5kYm0/cGlkPTM4Mzg2NSZiaWQ9MTczNzQxOCZSRD0nOwogICAgICAgICAgICAgIGZyYW1lMS5pZCA9ICdiZHZpJzsKICAgICAgICAgICAgICBmcmFtZTEuc3R5bGUgPSAnZGlzcGxheTpub25lJzsKICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJhbWUxKTsKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdmlwbGVhZ3VlX2RvbWFpbnMgOiB7CiAgICAgICAgLy8gbm90ZTogYWxzbyBraWxsZWQgYnkgQWFrTGlzdAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcz9xPXZpcGJveAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcz9xPXZpcGxlYWd1ZQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9ORVJWekh6UwogICAgICAgIGhvc3QgOiBbInZpcGxlYWd1ZS5pcyIsICJ2aXBsZWFndWUud3MiLCAidmlwbGVhZ3VlLnR2IiwgInZpcGxlYWd1ZS5zZSIsICJ2aXBsZWFndWUudHYiLCAidmlwbGVhZ3VlLm1lIiwgInZpcGxlYWd1ZS5tb2JpIiwgInZpcGxlYWd1ZS5jbyIsICJ2aXBsZWFndWUuc3giLCAidmlwbGVhZ3VlLmNoIiwgInZpcGJveC50diIsICJ2aXBib3guY28iLCAidmlwYm94LmJpeiIsICJ2aXBib3guc3giLCAidmlwYm94LmV1IiwgInZpcGJveC5zbyIsICJ2aXBib3gubnUiLCAidmlwYm94c2EuY28iLCAic3RyaWtlb3V0LmNvIiwgInN0cmlrZW91dC5tZSIsICJob21lcnVuLnJlIiwgInZpcGJveHR2LmNvIiwgInZpcGFwcC5tZSJdLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuaUV4aXN0ID0gdHJ1ZTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3hjbHN2aXAnLCAxKTsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiLnZpcF8wNTJ4MDAzIHsgaGVpZ2h0OiAyNTBweDsgfSIpOwogICAgICAgICAgQWFrLmFkZFN0eWxlKCIudmlwXzA5eDgyNyB7IGhlaWdodDogMjZweDsgfSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdmdfbm8gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzI5MgogICAgICAgIC8vICthYnAgcnVsZQogICAgICAgIGhvc3QgOiBbJ3ZnLm5vJywgJ2UyNC5ubyddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3Ll9fQUJfXyA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgcG9ybnZlX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTQ3CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tLzdUUFBrcTEyCiAgICAgICAgaG9zdCA6IFsncG9ybnZlLmNvbSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFkeGp3dXBkYXRlID0gMTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGxvbF9tb2FfdHcgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzExMTQKICAgICAgICBob3N0IDogWydsb2wubW9hLnR3J10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBNb2FPYmogPSBNb2FPYmogfHwge307CiAgICAgICAgICAgIE1vYU9iai5hZCA9IE1vYU9iai5hZCB8fCB7fTsJCQkKICAgICAgICAgICAgTW9hT2JqLmFkLmhhc0FkYmxvY2sgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwogICAgICAgICAgICBNb2FPYmouYWQuY2hlY2tBQlAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBtdWx0aXVwX29yZyA6IHsKICAgICAgICAvLyBieTogV2F0aWxpbgogICAgICAgIC8vIG5vdGU6IGFsdGVybmF0aXZlIHNvbHV0aW9uCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzY3NwogICAgICAgIGhvc3QgOiBbJ211bHRpdXAub3JnJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJhLmJ0bltzdHlsZV0iKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlua3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKCJub25lIiA9PT0gbGlua3NbaV0uc3R5bGUuZGlzcGxheSkKICAgICAgICAgICAgICBsaW5rc1tpXS5zdHlsZS5kaXNwbGF5ID0gIiI7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgYnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImJ1dHRvbi5kZXRlY3QiKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBidXR0b25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGJ1dHRvbnNbaV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGRhaWx5Yml0Y29pbnNfb3JnIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMDcKICAgICAgICBob3N0IDogWydkYWlseWJpdGNvaW5zLm9yZyddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcuYWQtaW1nJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBrb3phY3pla196ZWJlcmthIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80MTQKICAgICAgICBob3N0IDogWydrb3phY3play5wbCcsICd6ZWJlcmthLnBsJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2FibGMnLCAxKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2Nvb2tpZV9wb2xpY3knLCAxKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNwYW5rd2lyZV9zaXRlcyA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvODg3CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1RGQjFkdGdiCiAgICAgICAgaG9zdCA6IFsnc3Bhbmt3aXJlLmNvbScsICdrZWV6bW92aWVzLmNvbScsICdleHRyZW1ldHViZS5jb20nLCAnbW9mb3NleC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnNldENvb2tpZSgiYWJDbG9zZWQiLCAidHJ1ZSIpOwogICAgICAgICAgQWFrLnNldENvb2tpZSgiaGlkZV9hZF9tc2ciLCAiMSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgeW91cG9ybl9uZXR3b3JrIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84ODcKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vVEZCMWR0Z2IKICAgICAgICBob3N0IDogWyd5b3Vwb3JuLmNvbScsICd5b3Vwb3JuZ2F5LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCJhZGJsb2NrX21lc3NhZ2UiLCAiY2xvc2VkIik7CiAgICAgICAgfQogICAgICB9LAogICAgICBwc2FyaXBzX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTUzCiAgICAgICAgaG9zdCA6IFsncHNhcmlwcy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZEJhaXRFbGVtZW50KCdkaXYjYWR2ZXJ0Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBleHRyYXRvcnJlbnRfZG9tYWlucyA6IHsKICAgICAgICBob3N0IDogWydleHRyYXRvcnJlbnQuY2MnLCAnZXh0cmF0b3JyZW50LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBwcmV2ZW50IHBvcHVwCiAgICAgICAgICAvLyBzb3VyY2UgYXJlIG9iZnVzY2F0ZWQgaW4gZXh0ZXJuYWwganMKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BwdV9kZWxheScsIDEpOwogICAgICAgICAgQWFrLnNldENvb2tpZSgncHB1X21haW4nLCAxKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BwdV9zdWInLCAxKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BwdV9zaG93X29uJywgMSk7CiAgICAgICAgfQogICAgICB9LAogICAgICB0bnlfY3ogOiB7CiAgICAgICAgaG9zdCA6IFsndG55LmN6JywgJ3Bhc3RlZC5jbyddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBwcmV2ZW50IHBvcHVwCiAgICAgICAgICBBYWsuc2V0Q29va2llKCdfXy5wb3B1bmRlckNhcCcsIDEpOwogICAgICAgICAgQWFrLnNldENvb2tpZSgnX18ucG9wdW5kZXInLCAxKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGNsdWJlZG9oYXJkd2FyZV9jb21fYnIgOiB7IC8vIHR3byBhbnRpYWRibG9jawogICAgICAgIGhvc3QgOiBbJ2NsdWJlZG9oYXJkd2FyZS5jb20uYnInXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKEFhay5jb250YWlucyhsb2NhdGlvbi5ob3N0LCAnZm9ydW0nKSkgewogICAgICAgICAgICAvLyBTb2x1dGlvbiAxCiAgICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2Jhbm5lciwgc2NyaXB0IHsgaGVpZ2h0OiA1MXB4OyB9Iik7CiAgICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2I2Jhbm5lcicpOwogICAgICAgICAgfSBlbHNlIHsgLy8gV2Vic2l0ZQogICAgICAgICAgICAvLyBTb2x1dGlvbiAxCiAgICAgICAgICAgIEFhay5hZGRCYWl0RWxlbWVudCgnZGl2LmJhbm5lcl90b3BvJyk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoQWFrLmNvbnRhaW5zKGxvY2F0aW9uLmhvc3QsICdmb3J1bScpKSB7CiAgICAgICAgICAgIC8vIFNvbHV0aW9uIDIKICAgICAgICAgICAgQWFrLnV3LmFkZEJsb2NraW5nLmhpZGUoKTsKICAgICAgICAgICAgQWFrLnV3LmFkZEJsb2NraW5nLmtpbGwoKTsKICAgICAgICAgIH0gZWxzZSB7IC8vIFdlYnNpdGUKICAgICAgICAgICAgLy8gU29sdXRpb24gMgogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmlkID0gJyc7CiAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcuYWRibG9jaycpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVicmFzdGFnaV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnZGVicmFzdGFnaS5jb20nXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnI3N0cC1tYWluJyk7CiAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnI3N0cC1iZycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGRsZnJlbmNoX29yZyA6IHsKICAgICAgICBob3N0IDogWydkZGxmcmVuY2gub3JnJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gRml4IGJ1ZyBkaXNwbGF5IGNvbnRlbnQKICAgICAgICAgIEFhay5zZXRFbGVtZW50KCcjZGxlLWNvbnRlbnQgLmQtY29udGVudCcsIHsKICAgICAgICAgICAgJ2NsYXNzJyA6ICcnCiAgICAgICAgICB9KTsKICAgICAgICAgIEFhay5zZXRFbGVtZW50KCcjY29udGVudCcsIHsKICAgICAgICAgICAgJ2lkJyA6ICcnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1lZ2FkZWJyaWRfZXUgOiB7CiAgICAgICAgaG9zdCA6IFsnbWVnYS1kZWJyaWQuZXUnXSwKICAgICAgICBvbkVuZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIEFjdGl2YXRlIGJ1dHRvbiBkZWJyaWQKICAgICAgICAgIEFhay5zZXRFbGVtZW50KCcucmVhbGJ1dHRvbicsIHsKICAgICAgICAgICAgJ29uY2xpY2snIDogJycsCiAgICAgICAgICAgICd0eXBlJyA6ICdzdWJtaXQnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHNsaWRlcGxheWVyX2RvbWFpbnMgOiB7CiAgICAgICAgLy8gYnk6IEFsZXhhbmRlcjI1NQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMzMzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzUxNQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8yOTYKICAgICAgICAvLyBkZW1vOiBodHRwOi8vc2xpZGVwbGF5ZXIuZnIvc2xpZGUvMTMwNDAyNi8jCiAgICAgICAgaG9zdCA6IFsnc2xpZGVwbGF5ZXIuKiddLAogICAgICAgIG9uRW5kIDogZnVuY3Rpb24gKCkgewoKICAgICAgICAgIC8vIERpc2FibGUgYW50aS1hZGJsb2NrZXIKICAgICAgICAgIEFhay51dy5mb3JjZV9yZW1vdmVfYWRzID0gdHJ1ZTsKCiAgICAgICAgICAvLyBDaXJjdW12ZW50ICJzaGFyZSB0byBkb3dubG9hZCIgcnVsZQogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzbGlkZV9pZCA9IHdpbmRvdy5nZXRfY3VycmVudF9zbGlkZV9pZCgpOwogICAgICAgICAgICB2YXIgc2xpZGVfc3J2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllcl9mcmFtZSIpLnNyYy5zcGxpdCgiLyIpWzNdOwogICAgICAgICAgICB2YXIgdGltZSA9IDg2NDAwICsgTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgICAgICAgICAgIHZhciBzZWNyZXQgPSBlbmNvZGVVUklDb21wb25lbnQod2luZG93LnN0cnRyKHdpbmRvdy5NRDUuYmFzZTY0KCJzZWNyZXRfcHJldmVkIHNsaWRlcGxheWVyIG5ldmVyIHNvbHZlZCAiICsgdGltZSArIHNsaWRlX2lkICsgIi5wcHQiKSwgIisvIiwgIi0gIikpOwoKICAgICAgICAgICAgdmFyIHVybCA9ICJodHRwOi8vcGxheWVyLnNsaWRlcGxheWVyLm9yZy9kb3dubG9hZC8iICsgc2xpZGVfc3J2ICsgIi8iICsgc2xpZGVfaWQgKyAiLyIgKyBzZWNyZXQgKyAiLyIgKyB0aW1lICsgIi8iICsgc2xpZGVfaWQgKyAiLnBwdCI7CiAgICAgICAgICAgIHZhciBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImEuZG93bmxvYWRfbGluayIpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmtzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgLyogUmVtb3ZlIG9yaWdpbmFsICJzaGFyZSB0byBkb3dubG9hZCIgcG9wdXAgZXZlbnQgbGlzdGVuZXIgKi8KICAgICAgICAgICAgICB2YXIgZXZlbnRzID0gJC5fZGF0YShsaW5rc1tpXSkuZXZlbnRzLmNsaWNrOwogICAgICAgICAgICAgIGV2ZW50cy5zcGxpY2UoMCwgZXZlbnRzLmxlbmd0aCk7CgogICAgICAgICAgICAgIC8qIFNldCBub3JtYWwgbGluayBocmVmIGluc3RlYWQgKi8KICAgICAgICAgICAgICBsaW5rc1tpXS5ocmVmID0gdXJsOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgfQogICAgICB9LAogICAgICBib2tlcHNwb3RfY29tIDogewogICAgICAgIGhvc3QgOiBbJ2Jva2Vwc3BvdC5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gSGlkZSBEaXNjbGFpbWVyCiAgICAgICAgICBBYWsuc2V0Q29va2llKCdoaWRlRGlhbG9nJywgJ2hpZGUnKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIFJlbW92ZSBEaXNhYmxlIEFkQmxvY2sKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjdHVwaWtsYW4nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBpY2xvYWRfY29tIDogewogICAgICAgIGhvc3QgOiBbJ3BpY2xvYWQub3JnJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3BsX2FkYmxvY2tlcicsIGZhbHNlKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5hZHNfbG9hZGVkID0gdHJ1ZTsKICAgICAgICAgIEFhay51dy5pbWFnZUFkcyA9IGZhbHNlOwogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJ2RpdltvbmNvbnRleHRtZW51PSJyZXR1cm4gZmFsc2U7Il0nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZyZWV6ZWRvd25sb2FkX2NvbSA6IHsKICAgICAgICBob3N0IDogWydmcmVlemVkb3dubG9hZC5jb20nXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoL2ZyZWV6ZWRvd25sb2FkLmNvbVwvZG93bmxvYWRcLy8udGVzdChsb2NhdGlvbi5ocmVmKSkgewogICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnYm9keSA+IGRpdltpZF0nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1vbm5zdXRvZ2F0eWFfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBQTQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS8xTHc2MGg2awogICAgICAgIGhvc3QgOiBbJ21vbm5zdXRvZ2F0eWEuY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIjc2l0ZS1ib3gge2Rpc3BsYXk6YmxvY2s7fSIpOwogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJyNmb3ItYWQtYmxvY2tlcicpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmFwaWQ4X2NvbSA6IHsKICAgICAgICBob3N0IDogWydyYXBpZDguY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJ2Rpdi5iYWNrayArICNibGNva016ZycpOwogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJ2Rpdi5iYWNraycpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdHVya2Rvd25fY29tIDogewogICAgICAgIGhvc3QgOiBbJ3R1cmtkb3duLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIHJlbW92ZSBmYWNlYm9vayBib3gKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjZHV5dXJ1Jyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmaWxtb3ZpemlqYV9kb21haW5zIDogewogICAgICAgIGhvc3QgOiBbJ2ZpbG1vdml6aWphLm1lJywgJ2ZpbG1vdml6aWphLmNvbScsICdmaWxtb3ZpemlqYS5pbicsICdmaWxtb3ZpemlqYS5uZXQnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvKgogICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgdmFyIHdlZWtkYXkgPSBbIlN1bmRheSIsICJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwgIlNhdHVyZGF5Il07CiAgICAgICAgICB2YXIgbiA9IHdlZWtkYXlbZC5nZXREYXkoKV07CiAgICAgICAgICBBYWsuc2V0RWxlbWVudCgnIycgKyBuLCB7CiAgICAgICAgICBodG1sIDogJycKICAgICAgICAgIH0pOwogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJyMnICsgbik7CiAgICAgICAgICAgKi8KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGhhY2tpbnRvc2hfem9uZSA6IHsKICAgICAgICAvLyBieTogQWxleGFuZGVyMjU1CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU1OQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80MjcKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTg3CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvcHVsbC8xMTQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZTIub3JnL0RuQjlPajRmCiAgICAgICAgaG9zdCA6IFsnaGFja2ludG9zaC56b25lJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2lwczRfbGFzdHZpc2l0JywgMCwgZmFsc2UsIGxvY2F0aW9uLnBhdGhuYW1lKTsKICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07CiAgICAgICAgICAvLyBGYWtlIEdvb2dsZSBhZCBmcmFtZSBjb250ZW50CiAgICAgICAgICB2YXIgYWQxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5zIik7CiAgICAgICAgICBhZDEuY2xhc3NOYW1lID0gImFkc2J5Z29vZ2xlIjsKICAgICAgICAgIGFkMS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiQUFLIikpOwogICAgICAgICAgaGVhZC5pbnNlcnRCZWZvcmUoYWQxLCBoZWFkLmNoaWxkTm9kZXNbMF0pOwoKICAgICAgICAgIC8qCiAgICAgICAgICAvLyBGYWtlIENsZWFuTXlNYWMgYWQgZnJhbWUgc2l6ZQogICAgICAgICAgdmFyIGFkMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgYWQyLmlkICA9ICJueWN1aGV2Z3FpIjsKICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhZDIud3JhcHBlZEpTT2JqZWN0LCAnY2xpZW50SGVpZ2h0Jywge3ZhbHVlOiAxfSk7CiAgICAgICAgICBoZWFkLmluc2VydEJlZm9yZShhZDIsIGhlYWQuY2hpbGROb2Rlc1swXSk7CiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgZWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYWRzZW5zZWdyZXknKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsKICAgICAgICAgICAgbm9kZS5zcmMgPSBBYWsuaW1nQmFpdDsKICAgICAgICAgICAgZWxlbXNbaV0uYXBwZW5kQ2hpbGQobm9kZSk7CiAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgb25CZWZvcmVTY3JpcHQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICBjb250YWlucyA6ICdkaXNhYmxlIEFEQmxvY2sgY29tcGxldGVseScsCiAgICAgICAgICAgICAgZXh0ZXJuYWwgOiBmYWxzZSwKICAgICAgICAgICAgICByZW1vdmUgOiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIF07CiAgICAgICAgfQogICAgICB9LAogICAgICBwcml2YXRlaW5zdGFfY29tIDogewogICAgICAgIGhvc3QgOiBbJ3ByaXZhdGVpbnN0YS5jb20nXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyArIGFicCBydWxlCiAgICAgICAgICBBYWsudXcuZG9udF9zY3JvbGwgPSBmYWxzZTsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCIjb3ZlcmxheV9kaXYiKTsKICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCIjb3ZlcmxheV9tYWluX2RpdiIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgcmlzaWtvZ2VzdW5kaGVpdF9kZSA6IHsKICAgICAgICBob3N0IDogWydyaXNpa28tZ2VzdW5kaGVpdC5kZSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB3aW5kb3cuc3RvcCgpOwogICAgICAgICAgfSwgNTAwMCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBvbmVwbGF5bGlzdF9ldV9wbiA6IHsKICAgICAgICBob3N0IDogWydvbmVwbGF5bGlzdC5ldS5wbiddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIGtpbGwgcG9wdW5kZXIKICAgICAgICAgIEFhay51dy5tYWtlUG9wdW5kZXIgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9ubWVkYV9kZSA6IHsKICAgICAgICAvLyBub3RlOiBzY3JpcHQgb2JmdXNjYXRlZCBsaW5lIDExMTAKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mb3J1bS9kaXNjdXNzaW9uLzg1NzYKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTA2NwogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9xZjQ2Yk4zegogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9Sd0h5RjBOTAogICAgICAgIGhvc3QgOiBbJ29ubWVkYS5kZSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LiRBRFAgPSB0cnVlOwogICAgICAgICAgQWFrLnV3LnNhc19jYWxsQWQgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgIEFhay51dy5zYXNfY2FsbEFkcyA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgdHVyYm9kZWJyaWRldXJfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81OTkKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTYzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzUyNgogICAgICAgIGhvc3QgOiBbJ3R1cmJvZGVicmlkZXVyLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5jcmVhdGVFbGVtZW50KHsKICAgICAgICAgICAgdGFnIDogJ2RpdicsCiAgICAgICAgICAgIGlkIDogJ3B1YmRpcmVjdGUnLAogICAgICAgICAgICBodG1sIDogJzxpbWcgIHNyYz0iJyArIEFhay5pbWdCYWl0ICsgJyIvPjxhICBocmVmPSIjIj4mbmJzcDs8L2E+JywKICAgICAgICAgICAgYXBwZW5kIDogJ2JvZHknCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJvY2tmaWxlX2V1IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjU2CiAgICAgICAgaG9zdCA6IFsncm9ja2ZpbGUuZXUnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuY3JlYXRlRWxlbWVudCh7CiAgICAgICAgICAgIHRhZyA6ICdpZnJhbWUnLAogICAgICAgICAgICBzcmMgOiAnYWJvdXQ6YmxhbmsnLAogICAgICAgICAgICBzdHlsZSA6ICd2aXNpYmlsaXR5OmhpZGRlbjsnLAogICAgICAgICAgICBhcHBlbmQgOiAnYm9keScKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGlua2J1Y2tzX2FudGlhZGJsb2NrIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy85MzIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNDY5CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzI3NwogICAgICAgIC8vIHYzOiBodHRwOi8vcGFzdGViaW4uY29tLzBnaDhMTUdICiAgICAgICAgLy8gbm90ZTogbm8gc29sdXRpb24sIGFudGktYWRibG9jayBkaWZmaWN1bHQgdG8gYnlwYXNzIC0tPiBodHRwOi8vcGFzdGViaW4uY29tLzFOUnE3V3ZaCiAgICAgICAgaG9zdCA6IFsnbGlua2J1Y2tzLmNvbScsICdtaW5pdXJscy5jbycsICdwaWNidWNrcy5jb20nLCAncGljdHVyZXNldGMubmV0JywgJ3BsYWNlcGljdHVyZXMuY29tJywgJ3Bvb250b3duLm5ldCcsICdxcWMuY28nLCAncXZ2by5jb20nLCAncmVhbGZpbGVzLm5ldCcsICdycXEuY28nLCAnc2VyaW91c2RlYWxzLm5ldCcsICdzZXJpb3VzZmlsZXMuY29tJywgJ3NlcmlvdXN1cmxzLmNvbScsICdzZXhwYWxhY2UuZ3MnLCAndGhlc2VibG9ncy5jb20nLCAndGhlc2VmaWxlcy5jb20nLCAndGhlc2Vmb3J1bXMuY29tJywgJ3Rob3NlZ2FsbGVyaWVzLmNvbScsICd0aW55YnVja3MubmV0JywgJ3RpbnlsaW5rcy5jbycsICd0bmFidWNrcy5jb20nLCAndHViZXZpcmFsLmNvbScsICd1YmVycGljei5jb20nLCAndWJlcnZpZHouY29tJywgJ3VidWNrcy5uZXQnLCAndWdhbGxlcmllcy5uZXQnLCAndWx0cmFmaWxlcy5uZXQnLCAndXJsYmVhdC5uZXQnLCAndXJscHVsc2UubmV0JywgJ3doYWNreXZpZHouY29tJywgJ3lvdWZhcC5tZScsICd5eXYuY28nLCAnenh4by5uZXQnLCAnemZmLmNvJywgJ2xpbmtidWNrc2Rucy5jbycsICdtaW5pdXJscy5jb20nLCAnZHlvLmdzJywgJ2dvbmV2aXJhbC5jb20nLCAnZWFmeWZzdWgubmV0JywgJ3Nhc29udG53Yy5uZXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gZG8gbm90aGluZy4uLgogICAgICAgIH0KICAgICAgfSwKICAgICAgbGlua2J1Y2tzX3Zpc2l0c2NyaXB0IDogewogICAgICAgIC8vIGlzc3VlOgogICAgICAgIGhvc3QgOiBbJ3JlZmVyZW5jZW1lZ2EuY29tJywgJ2ZwYWJkLmNvbScsICdjcmFja2FjYy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gU2tpcCB2aXNpdFNjcmlwdCB3aGVuIHNpdGUgdXNlIENsb3VkRmxhcmUgUm9ja2V0IFNjcmlwdAogICAgICAgICAgQWFrLnNldENvb2tpZSgnX2xiR2F0ZVBhc3NlZCcsIHRydWUpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGlua190bCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT1saW5rLnRsCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZnIvZm9ydW0vZGlzY3Vzc2lvbi84NDM3CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tLzFNa0NubUw3CiAgICAgICAgaG9zdCA6IFsnbGluay50bCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoJy5hZGJsb2NrIHsgaGVpZ2h0OjFweDsgfScpOwogICAgICAgICAgQWFrLnV3LmFkYmxvY2tlciA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSwKICAgICAgd3N0cmVhbV92aWRlbyA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTM4MgogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9FaUFSVlFYdAogICAgICAgIGhvc3QgOiBbJ3dzdHJlYW0udmlkZW8nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCcjYWRpdiB7IGhlaWdodDo0cHg7IH0nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIF80c2hhcmVkX2NvbSA6IHsKICAgICAgICBob3N0IDogWyc0c2hhcmVkLmNvbSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIEhpZGUgIkRpc2FibGUgQWRCbG9kayIgbWVzc2FnZXMKICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKS5jbGFzc0xpc3QucmVtb3ZlKCJqc0Jsb2NrRGV0ZWN0Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBwcm9fZG9tYWlucyA6IHsKICAgICAgICBob3N0IDogWydwcm8temlrLndzJywgJ3Byby10ZWN0LndzJywgJ3Byby1kZGwud3MnLCAncHJvLXNwb3J0LndzJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3Zpc2l0ZWRmJywgdHJ1ZSk7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCd2aXNpdGVkaCcsIHRydWUpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgY29tcHRvaXJoYXJkd2FyZV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnY29tcHRvaXItaGFyZHdhcmUuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRibG9jayA9ICdub24nOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmFrZXJzZmllbGRfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy82NTcKICAgICAgICAvLyBub3RlOiBhbHNvIHNvbHV0aW9uIHRvIEFha0xpc3QKICAgICAgICBob3N0IDogWydiYWtlcnNmaWVsZC5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5BRF9TTE9UX1JFTkRFUkVEID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGVrc3RyYWJsYWRldF9kayA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT1la3N0cmFibGFkZXQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vUjAyOVhwQ3IKICAgICAgICBob3N0IDogWydla3N0cmFibGFkZXQuZGsnLCAnZWIuZGsnXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5BRFRFQ0ggPSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHBjZ2FtZXNfZG93bmxvYWRfbmV0IDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDUxCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZm9ydW0vZGlzY3Vzc2lvbi85MzI4CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL0VCVlpnM1ZCCiAgICAgICAgaG9zdCA6IFsncGNnYW1lcy1kb3dubG9hZC5uZXQnXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ25vQWRibG9ja05pY2VNZXNzYWdlJywgMSk7CiAgICAgICAgICBBYWsudXcubWdDYW5Mb2FkMzA1NDcgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbGFjaGFpbmVtZXRlb19jb20gOiB7CiAgICAgICAgLy8gbm90ZTogYWxzbyBraWxsZWQgYnkgQWFrTGlzdAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81OTAKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMjQ1CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzIxNQogICAgICAgIGhvc3QgOiBbJ2xhY2hhaW5lbWV0ZW8uY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuanNfbG9hZGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1hYzRldmVyX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTk3CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1JRbkNFWUs2CiAgICAgICAgaG9zdCA6IFsnbWFjNGV2ZXIuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuY29xdWlub3UgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHRoZXNpbXNyZXNvdXJjZV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9dGhlc2ltc3Jlc291cmNlLmNvbQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9ERTlyYmp4WQogICAgICAgIGhvc3QgOiBbJ3RoZXNpbXNyZXNvdXJjZS5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5nYWRzaXplID0gdHJ1ZTsKICAgICAgICAgIEFhay51dy5pSGF2ZUxvYWRlZEFkcyA9IHRydWU7CiAgICAgICAgfQogICAgICB9LAogICAgICB5ZWxsb3dicmlkZ2VfY29tIDogewogICAgICAgIGhvc3QgOiBbJ3llbGxvd2JyaWRnZS5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5maW5hbGl6ZVBhZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9LAogICAgICBnYW1lX2RlYmF0ZV9jb20gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEzNjYKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vVXpzaVgwRksKICAgICAgICBob3N0IDogWydnYW1lLWRlYmF0ZS5jb20nXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy5hZF9ibG9ja190ZXN0ID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgfQogICAgICB9LAogICAgICBhZHNjZW5kbWVkaWEgOiB7CiAgICAgICAgaG9zdCA6IFsnYWRzY2VuZG1lZGlhLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBhZHNjZW5kbWVkaWEgLSBodHRwczovL3d3dy5hZHNjZW5kbWVkaWEuY29tLwogICAgICAgICAgdmFyIHJlZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKS5ocmVmID0gZG9jdW1lbnQucmVmZXJyZXI7CiAgICAgICAgICB2YXIgaG9zdCA9IGxvY2F0aW9uLmhvc3Q7CiAgICAgICAgICB2YXIgcGF0aCA9IGxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgaWYgKEFhay5jb250YWlucyhwYXRoLCAnL3dpZGdldF9hZGJsb2NrLnBocCcpICYmICFBYWsuY29udGFpbnMocmVmLmhvc3QsIGhvc3QpKSB7CiAgICAgICAgICAgIC8vIEF1dG8gcmVwb3J0CiAgICAgICAgICAgIEFhay5kZXRlY3RlZCgnQWRzY2VuZG1lZGlhJywgcmVmLmhvc3QsIGhvc3QpOwogICAgICAgICAgICAvLyBOb3RpZmljYXRpb24KICAgICAgICAgICAgQWFrLm5vdGlmaWNhdGlvbignWW91IG11c3Qgc3Vic2NyaWJlIHRvIDxiPkFha0xpc3QgKEFudGktQWRibG9jayBLaWxsZXIgKTwvYj4gPGEgaHJlZj0iJyArIEFhay5zdWJzY3JpYmVVUkwgKyAnIiB0YXJnZXQ9Il9ibGFuayI+U3Vic2NyaWJlPC9hPicpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgYWR3b3JrbWVkaWEgOiB7CiAgICAgICAgaG9zdCA6IFsnYWR3b3JrbWVkaWEuY29tJywgJ2xveHRrLmNvbScsICdjb250ZW50bG9ja2luZ25ldHdvcmtzLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBBZFdvcmtNZWRpYSAtIGh0dHBzOi8vd3d3LmFkd29ya21lZGlhLmNvbS8KICAgICAgICAgIHZhciByZWYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykuaHJlZiA9IGRvY3VtZW50LnJlZmVycmVyOwogICAgICAgICAgdmFyIGhvc3QgPSBsb2NhdGlvbi5ob3N0OwogICAgICAgICAgdmFyIHBhdGggPSBsb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgIGlmIChBYWsuY29udGFpbnMocGF0aCwgJy9oZWxwL3JlbW92ZUFCLnBocCcpICYmICFBYWsuY29udGFpbnMocmVmLmhvc3QsIGhvc3QpKSB7CiAgICAgICAgICAgIC8vIEF1dG8gcmVwb3J0CiAgICAgICAgICAgIEFhay5pbmZvKCdBZHdvcmttZWRpYScsIHJlZi5ob3N0LCBob3N0KTsKICAgICAgICAgICAgLy8gTm90aWZpY2F0aW9uCiAgICAgICAgICAgIEFhay5ub3RpZmljYXRpb24oJ1lvdSBtdXN0IHN1YnNjcmliZSB0byA8Yj5BYWtMaXN0IChBbnRpLUFkYmxvY2sgS2lsbGVyICk8L2I+IDxhIGhyZWY9IicgKyBBYWsuc3Vic2NyaWJlVVJMICsgJyIgdGFyZ2V0PSJfYmxhbmsiPlN1YnNjcmliZTwvYT4nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIC8vIFBsYXllcnMKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAga2lzc2FuaW1lX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNDUxCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzM4MQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8zMDIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMjU3CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE3OAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xOTYKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTYKICAgICAgICBob3N0IDogWydraXNzYW5pbWUuY29tJywgJ2tpc3NhbmltZS50byddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBNYXNraW5nIGFkcwogICAgICAgICAgQWFrLmFkZFN0eWxlKCdpZnJhbWVbaWRePSJhZHNJZnJtZSJdLCAuZGl2Q2xvc2VCdXQgeyBkaXNwbGF5Om5vbmU7IH0nKTsKICAgICAgICAgIC8vIFNvbHV0aW9uIDEKICAgICAgICAgIEFhay51dy5Eb0RldGVjdDIgPSBudWxsOwogICAgICAgIH0sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewoKICAgICAgICAgIC8vIFNvbHV0aW9uIDEgYWJwIHJ1bGUKICAgICAgICAgIC8vIEBAfHxraXNzYW5pbWUuY29tXiRlbGVtaGlkZQoKICAgICAgICAgIHZhciBkaXZDb250ZW50VmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZGl2Q29udGVudFZpZGVvJyk7CgogICAgICAgICAgLy8gU29sdXRpb24gMgogICAgICAgICAgaWYgKEFhay51dy5Eb0RldGVjdDIpIHsKICAgICAgICAgICAgQWFrLnV3LkRvRGV0ZWN0MiA9IG51bGw7CiAgICAgICAgICAgIEFhay51dy5DaGVja0FkSW1hZ2UgPSBudWxsOwogICAgICAgICAgICBBYWsuaW5mbygnU29sdXRpb24gMicpOwogICAgICAgICAgfSAvL1NvbHV0aW9uIDMKICAgICAgICAgIGVsc2UgaWYgKGRpdkNvbnRlbnRWaWRlbykgewoKICAgICAgICAgICAgdmFyIGRpdkRvd25sb2FkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RpdkRvd25sb2FkJykuY2xvbmVOb2RlKHRydWUpOwoKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZGl2Q29udGVudFZpZGVvLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAgIEFhay51dy5Eb0hpZGVGYWtlKCk7CiAgICAgICAgICAgICAgZGl2Q29udGVudFZpZGVvLmFwcGVuZENoaWxkKGRpdkRvd25sb2FkKTsKICAgICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnaWZyYW1lW2lkXj0iYWRzSWZybWUiXSwgLmRpdkNsb3NlQnV0Jyk7CiAgICAgICAgICAgICAgQWFrLmluZm8oJ1NvbHV0aW9uIDMnKTsKICAgICAgICAgICAgfSwgNTUwMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBLaXNzY2FydG9vbl9tZSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNDg4CiAgICAgICAgaG9zdCA6IFsna2lzc2NhcnRvb24ubWUnXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy54YVpsRSA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJ2lmcmFtZVtpZF49ImFkc0lmcm1lIl0nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG9wZW5sb2FkX2RvbWFpbnMgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9b3BlbmxvYWQKICAgICAgICBob3N0IDogWydvcGVubG9hZC5jbycsICdvcGVubG9hZC5pbycsICdvcGVubG9hZC50diddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRibG9jayA9IGZhbHNlOwogICAgICAgICAgQWFrLnV3LmFkYmxvY2syID0gZmFsc2U7CiAgICAgICAgICBBYWsudXcucG9wQWRzTG9hZGVkID0gdHJ1ZTsKICAgICAgICAgIC8vIGhpZGUgZmFrZSBwbGF5IGJ1dHRvbiB1c2VkIHRvIG9wZW4gcG9wdW5kZXIKICAgICAgICAgIC8vQWFrLmFkZFN0eWxlKCcjdmlkZW9vdmVybGF5IHsgZGlzcGxheTpub25lOyB9JykKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHlvdXdhdGNoX25ldHdvcmsgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEyOTMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzA4CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzUyOQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81MzUKICAgICAgICAvLyB0ZXN0OiBodHRwOi8veW91d2F0Y2gub3JnL2VtYmVkLTU5cDdpM2Nka3NlMC00NTN4MzIwLmh0bWwKICAgICAgICAvLyB0ZXN0OiBodHRwOi8veW91d2F0Y2gub3JnLzU5cDdpM2Nka3NlMAogICAgICAgIGhvc3QgOiBbJ3lvdXdhdGNoLm9yZycsICdjaG91aGFhLmluZm8nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gc2tpcCBhbnRpLWFkYmxvY2sKICAgICAgICAgIEFhay51dy5hZHNTaG93UG9wdXAgPSAxOwogICAgICAgIH0sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gcmVub3ZlIGFkcyArIGZha2UgcGxheSBidXR0b24KICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjcGxheWVyX2ltZywgI3BsYXllcl9pbWcgKyBkaXZbaWRdJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBleGFzaGFyZV9jb20gOiB7CiAgICAgICAgLy8gYnk6IFdhdGlsaW4KICAgICAgICAvLyBwdWxsOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL3B1bGwvNTE5CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzYyNAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80ODYKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTA2CiAgICAgICAgLy8gdGVzdDogIGh0dHA6Ly9leGFzaGFyZS5jb20vZ2FsdzJnZTJrenN2CiAgICAgICAgaG9zdCA6IFsnZXhhc2hhcmUuY29tJywgJ2NoZWZ0aS5pbmZvJywgJ2JvamVtM2EuaW5mbycsICdhamloZXpvLmluZm8nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gc2tpcCBhbnRpLWFkYmxvY2sKICAgICAgICAgIEFhay51dy5hZHNTaG93UG9wdXAgPSAxOwogICAgICAgIH0sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gcmVub3ZlIGFkcyArIGZha2UgcGxheSBidXR0b24KICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjcGxheWVyX2ltZywgI3BsYXllcl9pbWcgKyBkaXZbaWRdJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBhbjFtZV9zZSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTkwCiAgICAgICAgaG9zdCA6IFsnYW4xbWUuc2UnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgQWFrLnV3LmlzQmxvY2tBZHMyID0gZmFsc2U7CiAgICAgICAgICB9LCAxMDAwMCk7CiAgICAgICAgfQogICAgICB9LAogICAgICBocXFfdHYgOiB7IC8vIHB1dGxvY2tlci5pcwogICAgICAgIGhvc3QgOiBbJ2hxcS50diddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vICsgYWJwIHJ1bGUKICAgICAgICAgIC8vIGh0dHA6Ly9ocXEudHYvcGxheWVyL2VtYmVkX3BsYXllci5waHA/dmlkPVIzREdIRzNHS1hYNyZhdXRvcGxheT1ubwogICAgICAgICAgaWYgKCcvcGxheWVyL2VtYmVkX3BsYXllci5waHAnID09IGxvY2F0aW9uLnBhdGhuYW1lKSB7CiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Zvcm1baWRePSJmb3JtLSJdJykuc3VibWl0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICAvLyBQb2xhbmQKICAgICAgd3BfZG9tYWlucyA6IHsKICAgICAgICAvLyBOb3RlOiBkaXNhYmxlIEVhc3lQcml2YWN5CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzk1NgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy85MDUKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMzAwCiAgICAgICAgaG9zdCA6IFsnYml6dG9rLnBsJywgJ3dwLnR2JywgJ3dwLnBsJywgJ3Nwb3J0b3dlZmFrdHkucGwnLCAna2FmZXRlcmlhLnR2JywgJ2thZmV0ZXJpYS5wbCcsICcud3J6dXRhLnBsJywgJ3B1ZGVsZWsudHYnLCAna29tZWRpb3dvLnBsJywgJ3Nmb3JhLnBsJywgJ2F1dG9rcmF0YS5wbCcsICdzcG9ydGZhbi5wbCcsICd3YXdhbG92ZS5wbCcsICdob3Rtb25leS5wbCcsICdhbGVzZXJpYWxlLnBsJywgJ2JhYm9sLnBsJywgJ3Nub2JrYS5wbCcsICdub2NvdHkucGwnLCAnbW9uZXkucGwnLCAnYWJjemRyb3dpZS5wbCcsICdnYWR6ZXRvbWFuaWEucGwnLCAnYXV0b2t1bHQucGwnLCAna29tb3Jrb21hbmlhLnBsJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIHByZXZlbnQgcG9wdXAgYW50aS1hZGJsb2NrIGZyb20gYWJjemRyb3dpZS5wbAogICAgICAgICAgQWFrLnNldENvb2tpZSgnQUJDQUJDJywgdHJ1ZSk7CiAgICAgICAgfSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAKICAgICAgICAgIEFhay5oYXNFbGVtZW50KCcud3AtcGxheWVyJywgZnVuY3Rpb24gKCkgewogICAgICAgICAgCiAgICAgICAgICAgIHZhciByZXBsYWNlUGxheWVyV1AgPSBmdW5jdGlvbiAobWlkLCBwbGF5ZXIpIHsKICAgICAgICAgICAgICAvKiBSZXF1ZXN0CiAgICAgICAgICAgICAgaHR0cDovL2dldC53cC50di8/bWlkPTE2NjEwNTYKICAgICAgICAgICAgICBodHRwOi8vd3AudHYvcGxheWVyL21pZCwxNjYxMDU2LGVtYmVkLmpzb24KICAgICAgICAgICAgICBodHRwOi8vZ2V0LndwLnR2Lz9mPTI4OTY0NjIuMTQyNjMyOTA1NjkwNC5sLndlYm0mcm5kPTEKICAgICAgICAgICAgICBodHRwczovL3dwLnR2L3BsYXllci9taWQsMTc0NzExNyxlbWJlZC5qc29uCiAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgQWFrLnJlcXVlc3QoewogICAgICAgICAgICAgICAgdXJsIDogJ2h0dHA6Ly93cC50di9wbGF5ZXIvbWlkLCcgKyBtaWQgKyAnLGVtYmVkLmpzb24nLAogICAgICAgICAgICAgICAgb25sb2FkIDogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdWx0LnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgICAgdmFyIG9iaiA9IEpTT04ucGFyc2UocmVzKTsKICAgICAgICAgICAgICAgICAgQWFrLmxvZyhvYmopOwoKICAgICAgICAgICAgICAgICAgdmFyIFBsYXllciA9IG5ldyBBYWsucGxheWVyKCk7CiAgICAgICAgICAgICAgICAgIFBsYXllci52aWRlb2pzKHBsYXllciwgewogICAgICAgICAgICAgICAgICAgIHNvdXJjZSA6IEFhay5maXhQcm90b2NvbFVSTChvYmouY2xpcC51cmxbMV0udXJsKSwgLy8gSEQKICAgICAgICAgICAgICAgICAgICB0eXBlIDogJ21wNCcsCiAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXkgOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciByZXBsYWNlUGxheWVyV3J6dXRhID0gZnVuY3Rpb24gKGtleSwgY2hhbm5lbCwgZWxlbSkgewogICAgICAgICAgICAgIEFhay5yZXF1ZXN0KHsKICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly93d3cud3J6dXRhLnBsL25wcC9lbWJlZC93b2xuYXBvbHNrYTIvMEkwSFEybXV0SmMKICAgICAgICAgICAgICAgIHVybCA6ICdodHRwOi8vd3d3LndyenV0YS5wbC9ucHAvZW1iZWQvJyArIGNoYW5uZWwgKyAnLycgKyBrZXksCiAgICAgICAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN1bHQucmVzcG9uc2VUZXh0OwogICAgICAgICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShyZXMpOwogICAgICAgICAgICAgICAgICBBYWsubG9nKG9iaik7CgogICAgICAgICAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgUGxheWVyLnZpZGVvanMoZWxlbSwgewogICAgICAgICAgICAgICAgICAgIHNvdXJjZSA6IEFhay5maXhQcm90b2NvbFVSTChvYmoudXJsWzBdLnVybCksIC8vSEQKICAgICAgICAgICAgICAgICAgICB0eXBlIDogJ21wNCcsCiAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXkgOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIFVzaW5nIGFuIGV4dGVybmFsIGZsYXNoIHBsYXllciBpcyBpbXBvc3NpYmxlIGJlY2F1c2UgcHJvdGVjdGVkIGJ5IGNyb3NzZG9tYWluLnhtbAogICAgICAgICAgICB2YXIgcGxheWVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy53cC1wbGF5ZXInKTsgLy8gICNQbGF5ZXIwLCAjUGxheWVyMSwgI21haW5QbGF5ZXIKICAgICAgICAgICAgaWYgKHBsYXllcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgLy8gZml4YnVnIGdtX3hociBsb29wIHJlcXVlc3QgLSBodHRwOi8vdGlueXVybC5jb20vcHFhOWh0cQogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIG1pZCA9IG51bGw7CiAgICAgICAgICAgICAgICB2YXIgcGxheWVyID0gcGxheWVyc1tpXTsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnQgPSBwbGF5ZXIucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgIHZhciBzY3JpcHQgPSBwbGF5ZXIucHJldmlvdXNTaWJsaW5nOwogICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gcGxheWVyLnF1ZXJ5U2VsZWN0b3IoJy50aXRsZUNvbnQgYS50aXRsZScpOwogICAgICAgICAgICAgICAgdmFyIGVtYmVkdmlkZW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0W3NyYyo9Ii9lbWJlZF92aWRlby5qcyJdJyk7CiAgICAgICAgICAgICAgICBBYWsubG9nKHBsYXllciwgcGFyZW50LCBzY3JpcHQsIHRpdGxlKTsKCiAgICAgICAgICAgICAgICBpZiAoZW1iZWR2aWRlb3MubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIC8vIHB1ZGVsZWsud3J6dXRhLnBsOiBodHRwOi8vdGlueXVybC5jb20vbDhqbzV2MgogICAgICAgICAgICAgICAgICAvLyBwdWRlbGVrLnR2OiBodHRwOi8vdGlueXVybC5jb20va2x5emg2ciwgaHR0cDovL3Rpbnl1cmwuY29tL3o3ZnI4OXYKICAgICAgICAgICAgICAgICAgLy8gcHVkZWxlay50diAodHJpcGxlKTogaHR0cDovL3Rpbnl1cmwuY29tL245YjI3bzIKICAgICAgICAgICAgICAgICAgLy8gZmlsbS53cC5wbDogaHR0cDovL3Rpbnl1cmwuY29tL3E3azVieHAKICAgICAgICAgICAgICAgICAgdmFyIGVtYmVkdmlkZW8gPSBlbWJlZHZpZGVvc1tpXTsKICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IC9rZXk9KFx3KykvLmV4ZWMoZW1iZWR2aWRlby5zcmMpWzFdOwogICAgICAgICAgICAgICAgICB2YXIgY2hhbm5lbCA9IC9sb2dpbj0oXHcrKS8uZXhlYyhlbWJlZHZpZGVvLnNyYylbMV07CiAgICAgICAgICAgICAgICAgIHZhciBhdXRvc3RhcnQgPSAvYXV0b3BsYXkvLnRlc3QoZW1iZWR2aWRlby5zcmMpOwogICAgICAgICAgICAgICAgICByZXBsYWNlUGxheWVyV3J6dXRhKGtleSwgY2hhbm5lbCwgcGxheWVyLCBhdXRvc3RhcnQpOwogICAgICAgICAgICAgICAgICBBYWsubG9nKCdlbWJlZF92aWRlby5qcycpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aXRsZSAmJiAvbWlkLy50ZXN0KHRpdGxlLmhyZWYpKSB7CiAgICAgICAgICAgICAgICAgIC8vIHNwb3J0b3dlZmFrdHkucGw6IGh0dHA6Ly90aW55dXJsLmNvbS9sNnphYmN4CiAgICAgICAgICAgICAgICAgIG1pZCA9IHRpdGxlLmhyZWYubWF0Y2goL21pZFs9LF0oWzAtOV0rKS8pOwogICAgICAgICAgICAgICAgICBBYWsubG9nKCd0aXRsZS5ocmVmJyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmVudC5pZCkgewogICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmRhdGFzZXQudXJsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gd3AudHY6IGh0dHA6Ly90aW55dXJsLmNvbS9wemRlMjl0CiAgICAgICAgICAgICAgICAgICAgbWlkID0gcGFyZW50LmRhdGFzZXQudXJsLm1hdGNoKC9taWRbPSxdKFswLTldKykvKTsKICAgICAgICAgICAgICAgICAgICBBYWsubG9nKCdwYXJlbnQuZGF0YXNldC51cmwnKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LnByZXZpb3VzU2libGluZy5pbm5lckhUTUwpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIHdpYWRvbW9zY2kud3AucGw6IGh0dHA6Ly90aW55dXJsLmNvbS9ncXR0OWNhCiAgICAgICAgICAgICAgICAgICAgICBtaWQgPSBwYXJlbnQucHJldmlvdXNTaWJsaW5nLmlubmVySFRNTC5tYXRjaCgvbWlkWz0sXShbMC05XSspLyk7CiAgICAgICAgICAgICAgICAgICAgICBBYWsubG9nKCdzY3JpcHQuaW5saW5lLmlubmVySFRNTCcpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBrYWZldGVyaWEudHY6IGh0dHA6Ly90aW55dXJsLmNvbS9ub2ZwNThhCiAgICAgICAgICAgICAgICAgICAgICAvLyBhYmN6ZHJvd2llLnBsOiBodHRwOi8vdGlueXVybC5jb20vaHg2czVldAogICAgICAgICAgICAgICAgICAgICAgbWlkID0gcGFyZW50LmlubmVySFRNTC5tYXRjaCgvbWlkWz0sXShbMC05XSspLyk7CiAgICAgICAgICAgICAgICAgICAgICBBYWsubG9nKCdwYXJlbnQuaW5uZXJIVE1MJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNjcmlwdCAmJiBzY3JpcHQudGFnTmFtZSA9PSAnU0NSSVBUJykgewogICAgICAgICAgICAgICAgICAvLyBmaWxtLndwLnBsOiBodHRwOi8vdGlueXVybC5jb20vbWg5b25mdwogICAgICAgICAgICAgICAgICAvLyBwdWRlbGVrLnR2IChkb3VibGUpOiBodHRwOi8vdGlueXVybC5jb20vbGVmdnd0eAogICAgICAgICAgICAgICAgICBtaWQgPSBzY3JpcHQuaW5uZXJIVE1MLm1hdGNoKC9taWRbPSxdKFswLTldKykvKTsKICAgICAgICAgICAgICAgICAgQWFrLmxvZygnc2NyaXB0LnNyYy5pbm5lckhUTUwnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChtaWQgIT09IG51bGwgJiYgbWlkLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICAgIHJlcGxhY2VQbGF5ZXJXUChtaWRbMV0sIHBsYXllcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1vamVfZmlsbXlfdGsgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEwMTAKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vN0cyUkJucXEKICAgICAgICBob3N0IDogWydtb2plLWZpbG15LnRrJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHNlYXJjaHZhbHVlID0gWyd2YXIgcGxheWVySW5zdGFuY2UnLCAnfSk7J107CiAgICAgICAgICB2YXIgc2NyaXB0ID0gQWFrLmhhc1NjcmlwdChzZWFyY2h2YWx1ZVswXSk7CgogICAgICAgICAgaWYgKHNjcmlwdCkgewogICAgICAgICAgICB2YXIgc291cmNlID0gc2NyaXB0LmlubmVySFRNTDsKICAgICAgICAgICAgdmFyIHN0ciA9IHNvdXJjZS5zdWJzdHJpbmcoc291cmNlLmxhc3RJbmRleE9mKHNlYXJjaHZhbHVlWzBdKSwgc291cmNlLmxhc3RJbmRleE9mKHNlYXJjaHZhbHVlWzFdKSArIHNlYXJjaHZhbHVlWzFdLmxlbmd0aCk7CiAgICAgICAgICAgIEFhay5hZGRTY3JpcHQoc3RyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHR2bl9wbCA6IHsKICAgICAgICAvLyBieTogUmVlaywgTWFyZWsKICAgICAgICAvLyBzb2x1dGlvbjogaHR0cDovL3Rpbnl1cmwuY29tL29oYnZ6NHIsIGh0dHA6Ly90aW55dXJsLmNvbS9qcThzNDYyCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU4MQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81MTAKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMjkzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE5MgogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly90aW55dXJsLmNvbS9vNmQ5aDY2LCBodHRwOi8vdGlueXVybC5jb20vejc3bTR6aAogICAgICAgIGhvc3QgOiBbJ3R2bi5wbCcsICd0dm4yNC5wbCcsICdwbGF5ZXIucGwnXSwKICAgICAgICBvbkVuZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5oYXNFbGVtZW50KCdoZWFkZXIuZGV0YWlsSW1hZ2UnLCBmdW5jdGlvbiAodGhpc0VsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKEFhay5nZXRDb29raWUoJ2NvdW50cnlfY29kZScpICYmIEFhay5nZXRTZXNzaW9uKCdnZW5lcmF0ZVRva2VuJykpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJ0cyA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYuc3BsaXQoL1suLF0vKTsKICAgICAgICAgICAgICAgIHZhciBpZCA9IHBhcnRzW3BhcnRzLmxlbmd0aCAtIDJdOwogICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgcGxhdGZvcm0gOiAiTW9iaWxlIiwKICAgICAgICAgICAgICAgICAgdGVybWluYWwgOiAiQW5kcm9pZCIsCiAgICAgICAgICAgICAgICAgIGZvcm1hdCA6ICJqc29uIiwKICAgICAgICAgICAgICAgICAgdiA6ICIyLjAiLAogICAgICAgICAgICAgICAgICBhdXRoS2V5IDogImI0YmM5NzE4NDBkZTYzZDEwNWIzMTY2NDAzYWExYmVhIiwKICAgICAgICAgICAgICAgICAgdHlwZSA6ICJlcGlzb2RlIiwKICAgICAgICAgICAgICAgICAgaWQgOiBpZCwKICAgICAgICAgICAgICAgICAgc29ydCA6ICJuZXdlc3QiLAogICAgICAgICAgICAgICAgICBtIDogImdldEl0ZW0iLAogICAgICAgICAgICAgICAgICBkZXZpY2VTY3JlZW5IZWlnaHQgOiAxNjAwLAogICAgICAgICAgICAgICAgICBkZXZpY2VTY3JlZW5XaWR0aCA6IDI1NjAKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB2YXIgYXBpID0gJ2h0dHBzOi8vYXBpLnR2bnBsYXllci5wbC9hcGkvPycgKyBBYWsuc2VyaWFsaXplKHBhcmFtcyk7CiAgICAgICAgICAgICAgICB2YXIgcHJveHkgPSAnaHR0cDovL3d3dy5wcm94eS54bWMucGwvaW5kZXgucGhwP2hsPTNlNSZxPSc7CQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBHZXQgdmlkZW9VcmwKICAgICAgICAgICAgICAgIEFhay5yZXF1ZXN0KHsKICAgICAgICAgICAgICAgICAgdXJsIDogQWFrLmdldENvb2tpZSgnY291bnRyeV9jb2RlJykgIT0gJ1BMJyA/IHByb3h5ICsgQWFrLmVuY29kZVVSSShhcGkpIDogYXBpLAogICAgICAgICAgICAgICAgICBoZWFkZXJzIDogewogICAgICAgICAgICAgICAgICAgICJVc2VyLUFnZW50IiA6ICJNb3ppbGxhLzUuMCAoTGludXg7IFU7IEFuZHJvaWQgNC4yOyBlbi11czsgTmV4dXMgMTAgQnVpbGQvSlZQMTVJKSBBcHBsZVdlYktpdC81MzQuMzAgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzQuMCBTYWZhcmkvNTM0LjMwIgogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgQWFrLmxvZyhyZXMpOwogICAgICAgICAgICAgICAgICAgIHZhciBvID0gSlNPTi5wYXJzZShyZXMpOwogICAgICAgICAgICAgICAgICAgIHZhciB2aWRlb1VybCA9IG8uaXRlbS52aWRlb3MubWFpbi52aWRlb19jb250ZW50W051bWJlcihBYWsub3B0cy52aWRlb0hEKV0udXJsOwogICAgICAgICAgICAgICAgICAgIHZhciBnZW5lcmF0ZVRva2VuID0gbmV3IEZ1bmN0aW9uKCd2aWRlb1VybCcsIEFhay5nZXRTZXNzaW9uKCdnZW5lcmF0ZVRva2VuJykpOwogICAgICAgICAgICAgICAgICAgIHZhciB2aWRlb1VybFdpdGhTZWVkID0gZ2VuZXJhdGVUb2tlbih2aWRlb1VybCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIFBsYXllciA9IG5ldyBBYWsucGxheWVyKCk7CiAgICAgICAgICAgICAgICAgICAgUGxheWVyLnZpZGVvanModGhpc0VsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZSA6IHZpZGVvVXJsV2l0aFNlZWQsCiAgICAgICAgICAgICAgICAgICAgICB0eXBlIDogJ21wNCcsCiAgICAgICAgICAgICAgICAgICAgICBhdXRvcGxheTogZmFsc2UKICAgICAgICAgICAgICAgICAgICB9LCB7fSwge2luc2VydDonaW5uZXInfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEFhay5yZXF1ZXN0KHsgLy8gZ2V0IGFuZCBzdG9yZSBnZW5lcmF0ZVRva2VuIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICB1cmwgOiAnaHR0cDovL3Bhc3RlYmluLmNvbS9yYXcvRDlxTTREUjMnLAogICAgICAgICAgICAgICAgb25sb2FkIDogZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXNwb25zZS5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgIEFhay5zZXRTZXNzaW9uKCdnZW5lcmF0ZVRva2VuJywgcmVzKTsKICAgICAgICAgICAgICAgICAgQWFrLnJlcXVlc3QoeyAvLyBnZXQgdXNlciBpcAogICAgICAgICAgICAgICAgICAgIHVybCA6ICdodHRwOi8vaXAtYXBpLmNvbS9qc29uJywKICAgICAgICAgICAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXNwb25zZS5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgICB2YXIganNvbiA9IEpTT04ucGFyc2UocmVzKTsKICAgICAgICAgICAgICAgICAgICAgIEFhay5zZXRDb29raWUoJ2NvdW50cnlfY29kZScsIGpzb24uY291bnRyeUNvZGUpOwogICAgICAgICAgICAgICAgICAgICAgQWFrLnJlZnJlc2goKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGlwbGFfdHYgOiB7CiAgICAgICAgLy8gYnk6IE1hcmVrCiAgICAgICAgLy8gc29sdXRpb246IGh0dHA6Ly90aW55dXJsLmNvbS9wdGI0eWJnCiAgICAgICAgLy8gaXNzdWUuIGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzUyMgogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly90aW55dXJsLmNvbS9oejdncHh4CiAgICAgICAgaG9zdCA6IFsnaXBsYS50diddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgnLmh0bWw1LXBsYXllci13cmFwcGVyIHsgZGlzcGxheTpub25lOyB9Jyk7IC8vIGNocm9tZS9vcGVyYQogICAgICAgICAgdmFyIG9sZFBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5odG1sNS1wbGF5ZXItd3JhcHBlciwgI3ZvZC1wbGF5ZXInKTsKICAgICAgICAgIEFhay5yZXF1ZXN0KHsKICAgICAgICAgICAgdXJsIDogJy9WT0QvcGxheS1pbi1pcGxhLycgKyBsb2NhdGlvbi5ocmVmLm1hdGNoKC9cL3ZvZC0oXGQrKS8pWzFdLAogICAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgdmFyIHZpZGVvVVJMOwogICAgICAgICAgICAgIHZhciByZXMgPSByZXN1bHQucmVzcG9uc2VUZXh0OwogICAgICAgICAgICAgIHZhciBpZG4gPSByZXMubWF0Y2goL2lwbGE6XC9cL3BsYXl2b2QtMVx8KFthLXowLTldKykvKVsxXTsKICAgICAgICAgICAgICBBYWsubG9nKGlkbik7CiAgICAgICAgICAgICAgQWFrLnJlcXVlc3QoewogICAgICAgICAgICAgICAgdXJsIDogJ2h0dHA6Ly9nZXRtZWRpYS5yZWRlZmluZS5wbC92b2RzL2dldF92b2QvP2NwaWQ9MSZ1YT1taXBsYS8yMyZtZWRpYV9pZD0nICsgaWRuLAogICAgICAgICAgICAgICAgb25sb2FkIDogZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdWx0LnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgICAgdmFyIG8gPSBKU09OLnBhcnNlKHJlcyk7CiAgICAgICAgICAgICAgICAgIEFhay5sb2cobyk7CiAgICAgICAgICAgICAgICAgIGlmIChvLnZvZC52aWRlb19oZCkgewogICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMID0gby52b2QudmlkZW9faGQ7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoby52b2QudmlkZW8pIHsKICAgICAgICAgICAgICAgICAgICB2aWRlb1VSTCA9IG8udm9kLnZpZGVvOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZpZGVvVVJMID0gby52b2QuY29waWVzWzBdLnVybDsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdmFyIFBsYXllciA9IG5ldyBBYWsucGxheWVyKCk7CiAgICAgICAgICAgICAgICAgIFBsYXllci52aWRlb2pzKG9sZFBsYXllciwgewogICAgICAgICAgICAgICAgICAgIHNvdXJjZSA6IHZpZGVvVVJMLAogICAgICAgICAgICAgICAgICAgIHR5cGUgOiAnbXA0JywKICAgICAgICAgICAgICAgICAgICB3aWR0aCA6IDgyMCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgOiA0NTAsCiAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXkgOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBrb3NjaWFuX25ldCA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvOTE0CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL3lHU1BCUnFlCiAgICAgICAgaG9zdCA6IFsna29zY2lhbi5uZXQnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgZWxlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYmFuJyk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGVsZW1zW2ldLnJlbW92ZSgpOwogICAgICAgICAgICAvL2VsZW1zW2ldLmlubmVySFRNTCA9ICc8YnI+JzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIEZyYW5jZQogICAgICBwbGF5dHZfZnIgOiB7IC8vIHJlc2VhcmNoIHNvbHV0aW9uCiAgICAgICAgaG9zdCA6IFsncGxheS50dicsICdwbGF5dHYuZnInXSwKICAgICAgICBvbkFsd2F5cyA6IGZ1bmN0aW9uICgpIHt9LAogICAgICAgIG9uRW5kIDogZnVuY3Rpb24gKCkge30KICAgICAgfSwKICAgICAgcm1jc3BvcnRiZm10dl9jb20gOiB7IC8vIHdlYnJhZGlvCiAgICAgICAgaG9zdCA6IFsncm1jc3BvcnQuYmZtdHYuY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewoKICAgICAgICAgIHZhciBmbGFzaHZhcnMgPSB7CiAgICAgICAgICAgIHVybFJhZGlvIDogImh0dHA6Ly9tcDNsZzQudGRmLWNkbi5jb20vMTAxNjAvcm1jLm1wMyIsCiAgICAgICAgICAgIG5vbSA6ICJsaXZlIiwKICAgICAgICAgICAgY2F0ZWdvcmllIDogImxpdmUiLAogICAgICAgICAgICB1cmxTbWFydCA6ICIiIC8vIHNldCBlbXB0eSB0byByZW1vdmUgYXVkaW8gYWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgcGFyYW1zID0gewogICAgICAgICAgICB3bW9kZSA6ICJ0cmFuc3BhcmVudCIKICAgICAgICAgIH07CgogICAgICAgICAgQWFrLnV3LnN3Zm9iamVjdC5lbWJlZFNXRigiL3N3Zi9STUNMSVZFLnN3ZiIsICJsaXZlcGxheWVyIiwgIjcwIiwgIjkwIiwgIjEwLjAuMCIsICIiLCBmbGFzaHZhcnMsIHBhcmFtcyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBlY2x5cHNpYV9jb20gOiB7CiAgICAgICAgaG9zdCA6IFsnZWNseXBzaWEuY29tJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBTb2x1dGlvbiAxCiAgICAgICAgICAvLyBhYnAgcnVsZXMKCiAgICAgICAgICAvLyBTb2x1dGlvbiAyCiAgICAgICAgICBBYWsudXcuaXNBQkFjdGl2YXRlZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfTsgLy8gS2lsbCBhbnRpYWRibG9jawogICAgICAgICAgQWFrLnV3LnJlZnJlc2hfaWZyYW1lID0gZnVuY3Rpb24gKCkge307IC8vIFN0b3AgYWRzIHRvIGJlIGxvYWRlZAogICAgICAgIH0sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBTb2x1dGlvbiAzCiAgICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2RpdltpZF49IndlYnR2X2lmcmFtZV8iXScpOwogICAgICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHsKICAgICAgICAgICAgdmFyIHZpZGVvSWQgPSBlbGVtZW50LmlkLnNwbGl0KCdfJylbMl07CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGVsZW1lbnQuaW5uZXJIVE1MID0gJzxpZnJhbWUgZnJhbWVib3JkZXI9IjAiIHdpZHRoPSI4MTIiIGhlaWdodD0iNTAwIiBzcmM9Imh0dHA6Ly93d3cuZGFpbHltb3Rpb24uY29tL2VtYmVkL3ZpZGVvLycgKyB2aWRlb0lkICsgJz9sb2dvPTAmYXV0b1BsYXk9MSZhdXRvTXV0ZT0wIj48L2lmcmFtZT4nOwogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIG02d2ViX2ZyIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80NjEKICAgICAgICAvLyB0ZXN0OiBodHRwOi8vdGlueXVybC5jb20vcHRuMnZybAogICAgICAgIGhvc3QgOiBbJ202d2ViLmZyJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcignb2JqZWN0W2lkJD0iX2ZsYXNoX2FwaSJdJyk7CiAgICAgICAgICB2YXIgc2NyaXB0ID0gQWFrLmhhc1NjcmlwdCgnTTYuUGxheWVyLmNvbmZpZycpOwoKICAgICAgICAgIGlmIChwbGF5ZXIgIT09IG51bGwgJiYgc2NyaXB0ICE9PSBudWxsKSB7CiAgICAgICAgICAgIHZhciBmb3VuZCA9IHNjcmlwdC5pbm5lckhUTUwubWF0Y2goL002LlBsYXllci5jb25maWcgPSAoXHsuK1x9KTsvKTsKICAgICAgICAgICAgdmFyIGNvbmZpZyA9IEpTT04ucGFyc2UoZm91bmQucG9wKCkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmVwbGFjZSBwbGF5ZXIKICAgICAgICAgICAgdmFyIFBsYXllciA9IG5ldyBBYWsucGxheWVyKCk7CiAgICAgICAgICAgIFBsYXllci52aWRlb2pzKHBsYXllci5wYXJlbnROb2RlLCB7CiAgICAgICAgICAgICAgc291cmNlIDogY29uZmlnLnNvdXJjZXNbMV0uc3JjLAogICAgICAgICAgICAgIHR5cGUgOiAnbXA0JywKICAgICAgICAgICAgICBhdXRvcGxheSA6IGZhbHNlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdhbWluZ3Jvb21fdHYgOiB7CiAgICAgICAgaG9zdCA6IFsnZ2FtaW5ncm9vbS50diddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFkYmxvY2tfZGV0ZWN0ID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBBYWsudXcuR1JfYWRibG9ja19oaWRlX3ZpZGVvID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBBYWsudXcuYWRibG9ja192aWRlb19tc2dfc3RhcnQgPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgIEFhay51dy5hZGJsb2NrX3ZpZGVvX21zZ19zdG9wID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBBYWsudXcuZGlzYWJsZV9jaGF0ID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgfQogICAgICB9LAogICAgICAvLyBHZXJtYW55CiAgICAgIG5vd19kb21haW5zIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8zMzYKICAgICAgICAvLyB0ZXN0OiBodHRwOi8vdGlueXVybC5jb20vcGVlb2JvdQogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly9qc2Jpbi5jb20vdnVjb2Jlam9mbwogICAgICAgIGhvc3QgOiBbJ3ZveG5vdy5kZScsICdydGwtbm93LnJ0bC5kZScsICdydGwybm93LnJ0bDIuZGUnLCAnbi10dm5vdy5kZScsICdzdXBlcnJ0bG5vdy5kZScsICdydGxuaXRyb25vdy5kZScsICdub3d0di5kZSddLAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8qCiAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgIFBsYXllci5lZGl0aW5nKCcjdmlkZW9wbGF5ZXInLCB7CiAgICAgICAgICB1bnNldEZsYXNodmFycyA6ICdhYmNoZWNrX2VuYWJsZWQsYWRjYWxsLGFkY2xhc3NlcyxhZGNvbmZpZyxhZG1ldGEsYWRzbG9nLGFnb2YsYW1hLGFuZ2Vib3QsYXMsYXNwYXJ0cyxicmVha2FkLGNvbm5lY3Rpb25jaGVjayxjc2xvZyxkZXYsZGltbWVyLGVycm9ybG9nLGZlZWRiYWNrLGZtc2lkZW50LGd0dixoaWdobGlnaHRzLGl2dyxpdndfcGxheSxqcyxqc19ldmVudF9mdW5jdGlvbixsb2dvLGxvZ29fYmFzZXdpZHRoLGxvZ29wb3MsbmllbHNlbixvcmQsb3NtZixzdm0sdGlsZSx2aWRlb3BsYXphLHZpZGVvcGxhemFfYmFzZV91cmwsdmlkZW9wbGF6YV9zaGFyZSx2aWRlb3BsYXphX3RhZyx2cEVudmlyb25tZW50VVJMLHhsJwogICAgICAgICAgfSk7CiAgICAgICAgICAgKi8KICAgICAgICB9CiAgICAgIH0sCiAgICAgIHJ0bF9kZSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTU0MQogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly90aW55dXJsLmNvbS9oN2NjdnFxCiAgICAgICAgaG9zdCA6IFsncnRsLmRlJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnZGl2W2RhdGEtd2lkZ2V0PSJ2aWRlbyJdJykpLm1hcChmdW5jdGlvbiAodmlkZW8pIHsKICAgICAgICAgICAgdmFyIGNmZyA9IEFhay5pbnRvT2JqZWN0KHZpZGVvLmRhdGFzZXQucGxheWVyTGF5ZXJDZmcpOwogICAgICAgICAgICB2YXIgZmlsZSA9IGNmZy52aWRlb2luZm8ubXA0dXJsOwogICAgICAgICAgICBBYWsubG9nKHZpZGVvLCBjZmcsIGZpbGUpOwoKICAgICAgICAgICAgLy8gUmVwbGFjZSBwbGF5ZXIKICAgICAgICAgICAgdmFyIFBsYXllciA9IG5ldyBBYWsucGxheWVyKCk7CiAgICAgICAgICAgIFBsYXllci52aWRlb2pzKHZpZGVvLCB7CiAgICAgICAgICAgICAgc291cmNlIDogZmlsZSwKICAgICAgICAgICAgICB0eXBlIDogJ21wNCcsCiAgICAgICAgICAgICAgYXV0b3BsYXkgOiBmYWxzZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbXlzcGFzc19kZSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNzYKICAgICAgICAvLyB0ZXN0OiBodHRwOi8vdGlueXVybC5jb20vbHRvOXB5ZAogICAgICAgIGhvc3QgOiBbJ215c3Bhc3MuZGUnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgdmlkZW9pZCA9IGxvY2F0aW9uLnBhdGhuYW1lLm1hdGNoKC9cLyhcZCspXC8kLyk7CgogICAgICAgICAgaWYgKHZpZGVvaWQgIT09IG51bGwpIHsKICAgICAgICAgICAgQWFrLnJlcXVlc3QoewogICAgICAgICAgICAgIHVybCA6ICdodHRwOi8vd3d3Lm15c3Bhc3MuZGUvbXlzcGFzcy9pbmNsdWRlcy9hcHBzL3ZpZGVvL2dldHZpZGVvbWV0YWRhdGF4bWwucGhwP2lkPScgKyB2aWRlb2lkWzFdLAogICAgICAgICAgICAgIG9ubG9hZCA6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN1bHQucmVzcG9uc2VUZXh0OwogICAgICAgICAgICAgICAgQWFrLmxvZyhyZXMpOwoKICAgICAgICAgICAgICAgIC8vIEdldCB2aWRlbwogICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyB3aW5kb3cuRE9NUGFyc2VyKCk7CiAgICAgICAgICAgICAgICB2YXIgZG9tID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhyZXMsICJhcHBsaWNhdGlvbi94bWwiKTsKICAgICAgICAgICAgICAgIHZhciBmaWxlID0gZG9tLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ1cmxfZmx2IikuaXRlbSgwKS50ZXh0Q29udGVudDsKCiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgZWxlbWVudHMKICAgICAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCdkaXYubG9hZGluZ0dpZicpOwoKICAgICAgICAgICAgICAgIC8vIFJlcGxhY2UgcGxheWVyCiAgICAgICAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgICAgICAgIFBsYXllci52aWRlb2pzKCcjcGxheWVyJywgewogICAgICAgICAgICAgICAgICBzb3VyY2UgOiBmaWxlLAogICAgICAgICAgICAgICAgICB0eXBlIDogJ21wNCcsCiAgICAgICAgICAgICAgICAgIGF1dG9wbGF5IDogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gTmVkZXJsYW5kCiAgICAgIHJ0bHhsX25sIDogewogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly90aW55dXJsLmNvbS9sMnprdjNkCiAgICAgICAgaG9zdCA6IFsncnRseGwubmwnLCAncnRsbmlldXdzLm5sJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgIFBsYXllci5lZGl0aW5nKCcjX3J0bG9zbWYwJywgewogICAgICAgICAgICBzZXRGbGFzaHZhcnMgOiB7CiAgICAgICAgICAgICAgYWRibG9jayA6IGZhbHNlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gTm9yd2F5CiAgICAgIHZndHZfbmV0d29yayA6IHsKICAgICAgICAvLyBub3RlOiBza2lwIHZpZGVvIGFkcyArIGFudGktYWRibG9jawogICAgICAgIC8vIGp3cGxheWVyOiBodHRwOi8vdGlueXVybC5jb20venl2NzloZwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDAyCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzM2NwogICAgICAgIC8vIHRlc3Q6IGh0dHA6Ly90aW55dXJsLmNvbS9ud3A4NXQsIGh0dHA6Ly90aW55dXJsLmNvbS9ud3A4NXQKICAgICAgICBob3N0IDogWyd2Z3R2Lm5vJywgJ3ZnLm5vJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgb2xkSGFzaCA9IG51bGw7CiAgICAgICAgICB2YXIgdmlkZW9JZCA9IG51bGw7CiAgICAgICAgICB2YXIgdmlkZW9JZFJlZ2V4ID0gLyNcIVwvdmlkZW9cLyhcZCspXC8vOwoKICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBsb2NhdGlvbiBoYXNoIGNoYW5nZXMKICAgICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHBsYXllciA9IEFhay5nZXRFbGVtZW50KCcudmlkZW8tcGxheWVyJyk7CgogICAgICAgICAgICBpZiAocGxheWVyICYmIGxvY2F0aW9uLmhhc2ggIT0gb2xkSGFzaCAmJiB2aWRlb0lkUmVnZXgudGVzdChsb2NhdGlvbi5oYXNoKSkgewogICAgICAgICAgICAgIG9sZEhhc2ggPSBsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgIHZpZGVvSWQgPSBvbGRIYXNoLm1hdGNoKHZpZGVvSWRSZWdleClbMV07Ci8qCiAgICAgICAgICAgICAgdmFyIGhsc3VybCA9ICdodHRwczovL3N2cHNlY3VyZWhkdm9kLXZoLmFrYW1haWhkLm5ldC9pLzIwMTYvMDMvMjAxNjAzMTJfNTZlNDIxZjg2YWY0NV92ZzAxLywxMjgwXzcyMF8zNTAwLDk2MF81NDBfMTUwMCw2NDBfMzYwXzgwMCw0ODBfMjcwXzUwMCwubXA0LmNzbWlsL21hc3Rlci5tM3U4JzsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwbGF5ZXIpCgogICAgICAgICAgICAgIC8vIGRvbid0IHdvcmsgd2l0aCBjaHJvbWUKICAgICAgICAgICAgICAvLyBwbGF5ZXIuaW5uZXJIVE1MID0gJzxkaXYgaWQ9Im5vQWRQbGF5ZXIiPlRoaXMgdGV4dCB3aWxsIGJlIHJlcGxhY2VkIHdpdGggYSBwbGF5ZXIuPC9kaXY+JzsKCgogICAgICAgICAgICAgIC8vIGNhbid0IGxvYWQgbTN1OCA0MDMyIHN0YXR1cyBjb2RlCiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh1bnNhZmVXaW5kb3cuandwbGF5ZXIpCgogICAgICAgICAgICAgIEFhay5yZXF1ZXN0KHsKICAgICAgICAgICAgICAgIHVybCA6ICdodHRwOi8vc3ZwLnZnLm5vL3N2cC9hcGkvdjEvdmd0di9hc3NldHMvJyArIHZpZGVvSWQgKyAnP2FkZGl0aW9uYWw9c2V0dGluZ3N8Y2hhcHRlcnN8Y3VlUG9pbnRzfGV4dGVybmFsSWR8YmFycmVsc3xleHRlcm5hbENhdGVnb3J5SWR8bmV4dEFzc2V0JmFwcE5hbWU9dmd0di13ZWJzaXRlJywKICAgICAgICAgICAgICAgIG9ubG9hZCA6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKHJlcyk7CiAgICAgICAgICAgICAgICAgIEFhay5sb2cob2JqKTsKCiAgICAgICAgICAgICAgICAgIC8vIHJlcGxhY2UgcGxheWVyCiAgICAgICAgICAgICAgICAgIHZhciBQbGF5ZXIgPSBuZXcgQWFrLnBsYXllcigpOwogICAgICAgICAgICAgICAgICBQbGF5ZXIudmxjKHBsYXllciwgewogICAgICAgICAgICAgICAgICAgIHNvdXJjZSA6IG9iai5zdHJlYW1VcmxzLmhscywgLy8gbTN1OAogICAgICAgICAgICAgICAgICAgIHR5cGUgOiAnaGxzJywKICAgICAgICAgICAgICAgICAgICBhdXRvcGxheSA6IGZhbHNlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHt9LCB7CiAgICAgICAgICAgICAgICBpbnNlcnQgOiAnaW5uZXInCiAgICAgICAgICAgICAgfSk7CiovCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDFlMyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBtdGdfcmFkaW8gOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE0OTUKICAgICAgICBob3N0IDogWydwbGF5LnJhZGlvMS5zZScsICdwbGF5LmJhbmRpdC5zZScsICdwbGF5Lmx1Z25hZmF2b3JpdGVyLmNvbScsICdwbGF5LnJpeGZtLnNlJ10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgd2luZG93LnBsYXllcl9sb2FkX2xpdmUod2luZG93LnN0cmVhbV9pZCk7CiAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkcGxheV9uZXR3b3JrIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDYzCiAgICAgICAgaG9zdCA6IFsnZHBsYXkuY29tJywgJ2RwbGF5LmRrJywgJ2RwbGF5LnNlJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDM2NSk7CiAgICAgICAgICB2YXIgdGltZXN0YW1wID0gZGF0ZS5nZXRUaW1lKCkudG9TdHJpbmcoKTsKICAgICAgICAgIHZhciB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAibm90aWZpY2F0aW9uU3VibWlzc2lvbiIgOiAic3VibWl0dGVkIiwKICAgICAgICAgICAgICAicmVwb3J0aW5nRXhwaXJ5IiA6IHRpbWVzdGFtcCwKICAgICAgICAgICAgICAibm90aWZpY2F0aW9uRXhwaXJ5IiA6IHRpbWVzdGFtcAogICAgICAgICAgICB9KTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ2RzYy1hZGJsb2NrJywgdmFsdWUpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgdmlhc2F0X3R2IDogewogICAgICAgIC8vIG5vdGU6IHNraXAgdmlkZW8gYWRzICsgYW50aS1hZGJsb2NrCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9dHYzcGxheQogICAgICAgIC8qIHRlc3Q6IGh0dHA6Ly93d3cudHYzcGxheS5uby9wcm9ncmFtbWVyL3JlZG5pbmdzc2tveXRhIGhkcy9obHMKICAgICAgICAgICAgICAgICAgIGh0dHA6Ly93d3cudHYzcGxheS5kay9wcm9ncmFtbWVyL2xpbnNlLW9nLWRpZGRlLWVrc3RyYSBoZHMvaGxzCiAgICAgICAgICAgICAgICAgICBodHRwOi8vd3d3LnR2M3BsYXkuc2UvcHJvZ3JhbS9nbGFtb3VyYW1hIGhkcy9obHMKICAgICAgICAgICAgICAgICAgIGh0dHA6Ly93d3cudHY2cGxheS5zZS9wcm9ncmFtLzk5LXNha2VyLW1hbi1tYXN0ZS1nb3JhLWlubmFuLW1hbi1kb3IgaGRzL2hscwogICAgICAgICAgICAgICAgICAgaHR0cDovL3d3dy50djhwbGF5LnNlL3Byb2dyYW0vZWZ0ZXJseXN0LS0xIGhkcy9obHMKICAgICAgICAgICAgICAgICAgIGh0dHA6Ly93d3cudHYxMHBsYXkuc2UvcHJvZ3JhbS9nYXJwZW5zLWV1cm9wYSBoZHMvaGxzCiAgICAgICAgICAgICAgICAgICBodHRwOi8vdHZwbGF5LnNrYXRpZXMubHYvcGFycmFpZGVzL3R2My16aW5hcyBoZHMvaGxzCiAgICAgICAgICAgICAgICAgICBodHRwOi8vcGxheS50djMubHQvcHJvZ3JhbW9zL2JlYXRvcy12aXJ0dXZlIHJ0bXAvaGxzCiAgICAgICAgICAgICAgICAgICBodHRwOi8vdHYzcGxheS50djMuZWUvc2lzdS9wdWhhcGFldi1zZXBvZ2EgcnRtcC9obHMgKi8KICAgICAgICBob3N0IDogWyd0djNwbGF5Lm5vJywgJ3R2M3BsYXkuZGsnLCAndHYzcGxheS5zZScsICd0djZwbGF5LnNlJywgJ3R2OHBsYXkuc2UnLCAndHYxMHBsYXkuc2UnLCAndHZwbGF5LnNrYXRpZXMubHYnLCAncGxheS50djMubHQnLCAndHYzcGxheS50djMuZWUnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuaGFzRWxlbWVudCgnI3ZpZGVvLXBsYXllcicsIGZ1bmN0aW9uICh0aGlzRWxlbWVudCkgewogICAgICAgICAgICB0aGlzRWxlbWVudC5pZCA9ICcnOwogICAgICAgICAgICAvL3ZhciB2aWRlb0lkID0gbG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKS5wb3AoKTsKICAgICAgICAgICAgdmFyIHZpZGVvSWQgPSB0aGlzRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtdmlkZW8taWQnKTsKICAgICAgICAgICAgQWFrLmxvZyh0aGlzRWxlbWVudCwgdmlkZW9JZCk7CgogICAgICAgICAgICAvLyBnZXQgdmlkZW8gc291cmNlcwogICAgICAgICAgICBBYWsucmVxdWVzdCh7CiAgICAgICAgICAgICAgdXJsIDogJ2h0dHA6Ly9wbGF5YXBpLm10Z3gudHYvdjMvdmlkZW9zL3N0cmVhbS8nICsgdmlkZW9JZCwKICAgICAgICAgICAgICBvbmxvYWQgOiBmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdWx0LnJlc3BvbnNlVGV4dDsKICAgICAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKHJlcyk7CiAgICAgICAgICAgICAgICBBYWsubG9nKG9iaik7CgogICAgICAgICAgICAgICAgLyogSW5uaG9sZGV0IGR1IHByw7h2ZXIgw6Ugc2UgZXIga3VuIHRpbGdqZW5nZWxpZyBmb3IgYnJ1a2VyZSBpIE5vcmdlCiAgICAgICAgICAgICAgICBQcm9ncmFtbWV0IGVyIGJsb2tlcmV0IGZvciB2aXNuaW5nIGZyYSBkZW5uZSBnZW9ncmFmaXNrZSBwb3NpdGlvbi4KICAgICAgICAgICAgICAgIFByb2dyYW3EhSBnYWxpdGUgbWF0eXRpIHRpayBqdW5nZGFtaWVzaSBpxaEgTGlldHV2b3MgaW50ZXJuZXRvIHRpZWvEl2rFsyB0aW5rbMWzICovCiAgICAgICAgICAgICAgICBpZiAob2JqLm1zZykgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc0VsZW1lbnQuaW5uZXJIVE1MID0gb2JqLm1zZzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaG9zdCA9PT0gJ3R2M3BsYXkudHYzLmVlJykgewogICAgICAgICAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgICAgICAgICAgUGxheWVyLmdyaW5kcGxheWVyKHRoaXNFbGVtZW50LCB7CiAgICAgICAgICAgICAgICAgICAgc291cmNlIDogb2JqLnN0cmVhbXMubWVkaXVtLAogICAgICAgICAgICAgICAgICAgIHR5cGUgOiAncnRtcC9tcDQnLAogICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5IDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSB2aWRlbyB0YWcgZm9yIG5ldyBwbGF5ZXIKICAgICAgICAgICAgICAgICAgQWFrLmNyZWF0ZUVsZW1lbnQoewogICAgICAgICAgICAgICAgICAgIHRhZyA6ICd2aWRlbycsCiAgICAgICAgICAgICAgICAgICAgaWQgOiAnbm9BZFBsYXllcicsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NpZCA6ICd2aWRlby1qcyB2anMtZGVmYXVsdC1za2luJywKICAgICAgICAgICAgICAgICAgICB3aWR0aCA6IHRoaXNFbGVtZW50LmNsaWVudFdpZHRoIHx8IDczMCwKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgOiB0aGlzRWxlbWVudC5jbGllbnRIZWlnaHQgfHwgNDEwLAogICAgICAgICAgICAgICAgICAgIHByZWxvYWQgOiAnYXV0bycsCiAgICAgICAgICAgICAgICAgICAgY29udHJvbHMgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5IDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICByZXBsYWNlIDogdGhpc0VsZW1lbnQKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAvLyBwYXJzZSBzb3VyY2VzCiAgICAgICAgICAgICAgICAgIHZhciBzcmNBcnJheSA9IFtdOwogICAgICAgICAgICAgICAgICBpZiAob2JqLnN0cmVhbXMuaGlnaCAmJiBvYmouc3RyZWFtcy5oaWdoICE9PSAnJykgewogICAgICAgICAgICAgICAgICAgIHNyY0FycmF5LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdHlwZSA6ICJ2aWRlby9tcDQiLCAvLyBtcDQKICAgICAgICAgICAgICAgICAgICAgIHNyYyA6IG9iai5zdHJlYW1zLmhpZ2gKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSAgaWYgKG9iai5zdHJlYW1zLmhscyAmJiBvYmouc3RyZWFtcy5obHMgIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgc3JjQXJyYXkucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlIDogImFwcGxpY2F0aW9uL3gtbXBlZ1VSTCIsIC8vIG0zdTgKICAgICAgICAgICAgICAgICAgICAgIHNyYyA6IG9iai5zdHJlYW1zLmhscwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9ICBpZiAob2JqLnN0cmVhbXMubWVkaXVtICYmIG9iai5zdHJlYW1zLm1lZGl1bSAhPT0gJycpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdHlwZSA9IG9iai5zdHJlYW1zLm1lZGl1bS5pbmRleE9mKCdydG1wJykgPT09IDAgPyAncnRtcC9tcDQnIDogJ2FwcGxpY2F0aW9uL2Y0bSt4bWwnOwogICAgICAgICAgICAgICAgICAgIHNyY0FycmF5LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgdHlwZSA6IHR5cGUsCiAgICAgICAgICAgICAgICAgICAgICBzcmMgOiBvYmouc3RyZWFtcy5tZWRpdW0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBBYWsubG9nKHNyY0FycmF5LCBKU09OLnN0cmluZ2lmeShzcmNBcnJheSkpOwogICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBuZXcgcGxheWVyCiAgICAgICAgICAgICAgICAgIEFhay5hZGRTY3JpcHQoQWFrLmludG9TdHJpbmcoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb25WanNSZWFkeSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy52aWRlb2pzICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblZqc1JlYWR5KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy52aWRlb2pzKCJub0FkUGxheWVyIikuc3JjKC9fU09VUkNFU18vKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb25WanNSZWFkeSgpOwogICAgICAgICAgICAgICAgICAgICAgfSkoKTsKICAgICAgICAgICAgICAgICAgICB9KS5yZXBsYWNlKCIvX1NPVVJDRVNfLyIsIEpTT04uc3RyaW5naWZ5KHNyY0FycmF5KSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIFJ1c3NpYQogICAgICBydXR1YmVfcnUgOiB7IC8vIHJlc2VhcmNoIHNvbHV0aW9uCiAgICAgICAgLyogdGVzdDogaHR0cDovL3J1dHViZS5ydS92aWRlby9iZDVmNjA0NzY1N2YwYmRjYmZiYjBlZGFkMmJiN2M2MS8gKi8KICAgICAgICBob3N0IDogWydydXR1YmUucnUnXSwKICAgICAgICBvbkVuZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5oYXNFbGVtZW50KCcjcnV0dWJlUGxheWVySG9sZGVyJywgZnVuY3Rpb24gKCkgeyAgICAgICAgICAgIC8vZG1GeUlHOXdkSE1nUFNCQllXc3VaMlYwUld4bGJXVnVkQ2dpSTI5d2RHbHZibk1pS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJSFpoY2lCdklEMGdRV0ZyTG1sdWRHOVBZbXBsWTNRb2IzQjBjeTVrWVhSaGMyVjBMblpoYkhWbEtUc05DaUFnSUNBZ0lDQWdJQ0FnSUhaaGNpQnRNM1U0VlhKc0lEMGdieTUyYVdSbGIxOWlZV3hoYm1ObGNpNXRNM1U0T3cwS0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzI5c1pTNXNiMmNvYlROMU9GVnliQ2s3RFFvTkNpQWdJQ0FnSUNBZ0lDQWdJSFpoY2lCUWJHRjVaWElnUFNCdVpYY2dRV0ZyTG5Cc1lYbGxjaWdwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdVR3hoZVdWeUxuWnBaR1Z2YW5Nb0p5TnlkWFIxWW1WUWJHRjVaWEpJYjJ4a1pYSW5MQ0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnYzI5MWNtTmxJRG9nYlROMU9GVnliQ3dOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0IwZVhCbElEb2dKMmhzY3ljc0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0x5OXdjbTk0ZVRvZ2RISjFaU3dOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JoZFhSdmNHeGhlU0E2SUhSeWRXVU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ2ZUc2dLVHM9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIEl0YWx5CiAgICAgIHJhaV90diA6IHsgLy8gcmVzZWFyY2ggc29sdXRpb24KICAgICAgICBob3N0IDogWydyYWkudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkge30sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkge30KICAgICAgfSwKICAgICAgLy8gVFYgU3RyZWFtCiAgICAgIGJsb2NrX3N0cmVhbXNfdHYgOiB7CiAgICAgICAgLy8gbm90ZTogcmVkaXJlY3QgdG8gaHR0cDovL2Jsb2NrLnN0cmVhbXMudHYvCiAgICAgICAgaG9zdCA6IFsnZmlyc3Ryb3cuY28nLCAnZmlyc3Ryb3dzLnJ1JywgJ2ZpcnN0cm93cy50dicsICdmaXJzdHJvd3Mub3JnJywgJ2ZpcnN0cm93cy5jbycsICdmaXJzdHJvd3MuYml6JywgJ2ZpcnN0cm93dXMuZXUnLCAnZmlyc3Ryb3cxdXMuZXUnLCAnZmlyc3Rzcm93c3BvcnRzLmV1JywgJ2ZpcnN0cm93c3BvcnRlcy50dicsICdmaXJzdHJvd3Nwb3J0ZXMuY29tJywgJ2p1c3RmaXJzdHJvd3Nwb3J0cy5jb20nLCAnaGFoYXNwb3J0Lm1lJywgJ3dpeml3aWcucnUnLCAnd2l6aXdpZy5zeCcsICd3aXppd2lnLnRvJywgJ3dpeml3aWcudHYnLCAnbXlwMnAuYml6JywgJ215cDJwLnR2JywgJ215cDJwLmxhJywgJ215cDJwLmVjJywgJ215cDJwLmV1JywgJ215cDJwLnN4JywgJ215cDJwLndzJywgJ215cDJwLmNvbScsICdhdGRoZS5ydScsICdhdGRoZS5zZScsICdhdGRoZS5ieicsICdhdGRoZS50b3AnLCAnYXRkaGUudG8nLCAnYXRkaGUubWUnLCAnYXRkaGUubXgnLCAnIGF0ZGhlLmxpJywgJ2F0ZGhlLmFsJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCJhZGIiLCAxKTsgLy8gcHJldmVudCBhbnRpLWFkYmxvY2sKICAgICAgICAgIEFhay51dy5vcGVuID0gZnVuY3Rpb24gKCkge307IC8vIHByZXZlbnQgcG9wdXAKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2Jhbm5lckluQ2VudGVyLCAjaGlkZGVuQmFubmVyQ2FudmFzIHsgZGlzcGxheTogbm9uZTsgfSIpOyAvLyBoaWRlIGFkcwogICAgICAgIH0KICAgICAgfSwKICAgICAgYnV6aW5hX3h5eiA6IHsKICAgICAgICAvLyBub3RlOiBkaXNhYmxlIHJlZmNvbnRyb2wsIHVzZWQgYnkgZmlyc3Ryb3dzcG9ydHMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTI2OAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjQzCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg4OQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dyZWFzeWZvcmsub3JnL2ZvcnVtL2Rpc2N1c3Npb24vODk3NQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS84VlRya3ZTOQogICAgICAgIGhvc3QgOiBbJ2J1emluYS54eXonLCAnZmFybWV0LmluZm8nLCAncmltbGFkaS5jb20nLCAna2l0b3JlbG8uY29tJywgJ29tbmlwb2xhLmNvbScsICdwb3Jvc2luLmNvLnVrJywgJ3JpbWxlbm8uY29tJywgJ3NpbXBsZTRhbGxzLmNvbScsICdhcnNvcG8uY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5hZGRTdHlsZSgiI2Fkc2ZyYW1lIHsgaGVpZ2h0OiAxNTFweDsgfSIpOwogICAgICAgIH0sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKC9idXppbmEueHl6Ly50ZXN0KGxvY2F0aW9uLmhvc3QpKSB7IC8vIGtlZXBzIHNhbWUgaG9zdCBzdHJlYW0KICAgICAgICAgICAgQWFrLmhhc0VsZW1lbnQoJ2lmcmFtZVtzcmMqPSIucGhwP2hhc2g9Il0nLCBmdW5jdGlvbiAodGhpc0VsZW1lbnQpIHsKICAgICAgICAgICAgICAvLyBodHRwOi8vYXJzb3BvLmNvbS93Mi5waHA/aGFzaD1wYW5kYTU4CiAgICAgICAgICAgICAgLy8gaHR0cDovL3d3dy5idXppbmEueHl6L25hbmExdjEucGhwP29udGhldG9wCiAgICAgICAgICAgICAgdmFyIHBhcnRzID0gdGhpc0VsZW1lbnQuc3JjLnNwbGl0KCcvJyk7CiAgICAgICAgICAgICAgcGFydHNbMl0gPSBBYWsucnVsZXMuYnV6aW5hX3h5ei5ob3N0LnBvcCgpOwogICAgICAgICAgICAgIEFhay5sb2codGhpc0VsZW1lbnQsIHBhcnRzKTsKICAgICAgICAgICAgICB0aGlzRWxlbWVudC5zcmMgPSBwYXJ0cy5qb2luKCcvJyk7CgogICAgICAgICAgICAgICAgLyoJZG1GeUlHOGdQU0I3Q2drSkNTQWdJQ0FpY0d4aGVXeHBjM1FpSURvZ1czc0tDUWtKSUNBZ0lDQWdJQ0FpY0hKdmRtbGtaWElpSURvZ0luSjBiWEFpTEFvSkNRa2dJQ0FnSUNBZ0lDSjFjbXdpSURvZ0luQmhibVJoTVQ5bEpUTkVNVFEyTlRBM01ETXlOaVV5Tm5OMEpUTkVVSEowU0ZsNWRrSjZaRGxhWkRkb1JGOW1Va2hVWnpFeE1URXpNQ0lLQ1FrSklDQWdJQ0FnZlFvSkNRa2dJQ0FnWFN3S0NRa0pJQ0FnSUNKd2JIVm5hVzV6SWlBNklIc0tDUWtKSUNBZ0lDQWdJbkowYlhBaUlEb2dld29KQ1FrZ0lDQWdJQ0FnSUNKMWNtd2lJRG9nSW1ac2IzZHdiR0Y1WlhJdWNuUnRjQzB6TGpJdU1URXVjM2RtSWl3Z0Nna0pDUWtKTHk4aWRYSnNJam9nSW1oMGRIQTZMeTl5Wld4bFlYTmxjeTVtYkc5M2NHeGhlV1Z5TG05eVp5OXpkMll2Wm14dmQzQnNZWGxsY2k1eWRHMXdMVE11TWk0eE1TNXpkMllpTEFvSkNRa2dJQ0FnSUNBZ0lDSnVaWFJEYjI1dVpXTjBhVzl1VlhKc0lpQTZJQ0p5ZEcxd09pOHZNVGcxTGpneUxqSXhOUzQwTlRvek5UYzVMM1p2WkM4aUNna0pDU0FnSUNBZ0lIMHNDZ2tKQ1NBZ0lDQWdJQ0pqYjI1MGNtOXNjeUlnT2lCN0Nna0pDUWtnSUNBZ0luVnliQ0k2SUNKb2RIUndPaTh2Y21Wc1pXRnpaWE11Wm14dmQzQnNZWGxsY2k1dmNtY3ZjM2RtTDJac2IzZHdiR0Y1WlhJdVkyOXVkSEp2YkhNdE15NHlMakUyTG5OM1ppSXNJQzh2SUdGa1pHVmtJR0psWTJGMWMyVWdiV2x6YzJsdVp3b0pDUWtnSUNBZ0lDQWdJQ0p3YkdGNUlpQTZJR1poYkhObExBb0pDUWtnSUNBZ0lDQWdJQ0p6WTNKMVltSmxjaUlnT2lCbVlXeHpaUW9KQ1FrZ0lDQWdJQ0I5Q2drSkNTQWdJQ0I5TEFvSkNRa2dJQ0FnSW5Cc1lYbGxja2xrSWlBNklDSndiR0Y1WlhJaUxBb0pDUWtnSUNBZ0ltTnNhWEFpSURvZ2V3b0pDUWtnSUNBZ0lDQWlkWEpzSWlBNklDSndZVzVrWVRFL1pTVXpSREUwTmpVd056QXpNallsTWpaemRDVXpSRkJ5ZEVoWmVYWkNlbVE1V21RM2FFUmZabEpJVkdjeE1URXhNekFpQ2drSkNTQWdJQ0I5Q2drSkNTQWdmUW9LQ1FrSklDQjJZWElnYm1WM1ZYSnNJRDBnY0dGeWRITXVjMnhwWTJVb01Dd2dNeWt1YW05cGJpZ25MeWNwSUNzZ0p5OW1iRzkzY0d4aGVXVnlMVE11TWk0eE5pNXpkMlkvWTI5dVptbG5QU2NnS3lCbGMyTmhjR1VvU2xOUFRpNXpkSEpwYm1kcFpua29ieWtwT3dvSkNRa2dJQzh2ZG1GeUlHNWxkMVZ5YkNBOUlDZG9kSFJ3T2k4dmNtVnNaV0Z6WlhNdVpteHZkM0JzWVhsbGNpNXZjbWN2YzNkbUwyWnNiM2R3YkdGNVpYSXRNeTR5TGpFMkxuTjNaajlqYjI1bWFXYzlKeUFySUdWelkyRndaU2hLVTA5T0xuTjBjbWx1WjJsbWVTaHZLU2s3Q2drSkNTQWdZMjl1YzI5c1pTNXNiMmNvYm1WM1ZYSnNLVHNLQ1FrSklDQjBhR2x6Uld4bGJXVnVkQzV6Y21NZ1BTQnVaWGRWY213NwogICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgeyAvLyBza2lwIGFudGktYWRibG9jawogICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnI2Fkc2ZyYW1lJyk7CiAgICAgICAgICAgIEFhay5nZXRFbGVtZW50KCcjcmVtb3ZlLW92ZXInKS5jbGljaygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgYWxsbXl2aWRlb3NfbmV0IDogewogICAgICAgIC8vIG5vdGU6IG9iZnVzY2F0ZWQKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMjc0CiAgICAgICAgaG9zdCA6IFsnYWxsbXl2aWRlb3MubmV0JywgJ2FtdnR2Lm5ldCddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBza2lwIGZha2UgcGxheSBidXR0b24KICAgICAgICAgIEFhay5zZXRDb29raWUoJ19mYXZidDMzJywgMSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBpbGl2ZV9kb21haW5zIDogewogICAgICAgIGhvc3QgOiBbJ2lsaXZlLnRvJywgJ3N0cmVhbWxpdmUudG8nXSwKICAgICAgICBvbkVuZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICgvXlwvZW1iZWRwbGF5ZXIucGhwL2kudGVzdChsb2NhdGlvbi5wYXRobmFtZSkpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8gU2tpcCB0aW1lcgogICAgICAgICAgICAgIEFhay51dy5yZW1vdmVPdmVybGF5SFRNTCgpOwogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIG1pY2FzdF90diA6IHsKICAgICAgICBob3N0IDogWydtaWNhc3QudHYnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gcHJldmVudCBwb3B1bmRlcgogICAgICAgICAgQWFrLnNldENvb2tpZSgndmlkX21haW4nLCB0cnVlKTsKICAgICAgICAgIEFhay5zZXRDb29raWUoJ3ZpZF9zdWInLCB0cnVlKTsKICAgICAgICAgIC8vIHJlbW92ZSBvdmVybGF5CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAod2luZG93LnJlbW92ZU92ZXJsYXlIVE1MKQogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZU92ZXJsYXlIVE1MKCk7CiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIHB4c3RyZWFtX3R2IDogewogICAgICAgIGhvc3QgOiBbJ3B4c3RyZWFtLnR2J10sCiAgICAgICAgb25FbmQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoL15cL2VtYmVkcm91dGVyLnBocC8udGVzdChsb2NhdGlvbi5wYXRobmFtZSkpIHsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgLy8gU2tpcCB0aW1lciBhbmQgY2xvc2UgYWRzCiAgICAgICAgICAgICAgQWFrLnV3LmNsb3NlQWQoKTsKICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBzYXdsaXZlX3R2IDogewogICAgICAgIGhvc3QgOiBbJ3Nhd2xpdmUudHYnXSwKICAgICAgICBvbklkbGUgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoL15cL2VtYmVkXC93YXRjaFwvL2kudGVzdChsb2NhdGlvbi5wYXRobmFtZSkpIHsKICAgICAgICAgICAgLy8gU2tpcCB0aW1lciBhbmQgY2xvc2UgYWRzCiAgICAgICAgICAgIEFhay51dy5kaXNwbGF5ID0gZmFsc2U7CiAgICAgICAgICAgIEFhay51dy5jbG9zZU15QWQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdvb2RjYXN0X2NvIDogewogICAgICAgIGhvc3QgOiBbJ2dvb2RjYXN0LmNvJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKC9eXC9zdHJlYW0ucGhwLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkgewogICAgICAgICAgICAvLyByZW1vdmUgYWRzIGFsbG93ZWQgYnkgZWFzeWxpc3QKICAgICAgICAgICAgQWFrLnV3LiQoIi5hZHZlcnRpc2VtZW50IikuaGlkZSgpOwogICAgICAgICAgICBBYWsudXcuJCgnLmFkc2t5IGlmcmFtZScpLmF0dHIoInNyYyIsICJhYm91dDpibGFuayIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgc2hvd3Nwb3J0X3R2X2NvbSA6IHsKICAgICAgICBob3N0IDogWydzaG93c3BvcnQtdHYuY29tJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKC9eXC9jaC5waHAvLnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSB7CiAgICAgICAgICAgIC8vIHJlbW92ZSBhZHMgYWxsb3dlZCBieSBlYXN5bGlzdAogICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudCgnI2FkdmVydGlzZW1lbnQsIC5hZHZlcnRpc2VtZW50Jyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICBzaGFyZWNhc3RfdG8gOiB7CiAgICAgICAgaG9zdCA6IFsnc2hhcmVjYXN0LnRvJ10sCiAgICAgICAgb25JZGxlIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKC9eXC9lbWJlZC5waHAvLnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSB7CgogICAgICAgICAgICAvLyBEaXNhYmxlIHBvcHVuZGVycwogICAgICAgICAgICB2YXIgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBBYWsuc2V0Q29va2llKCd2aWRfbWFpbicsIHRydWUpOwogICAgICAgICAgICAgICAgQWFrLnNldENvb2tpZSgndmlkX3N1YicsIDIpOwogICAgICAgICAgICAgICAgQWFrLnNldENvb2tpZSgndmlkX2RlbGF5JywgdHJ1ZSk7CiAgICAgICAgICAgICAgfSwgMTAwKTsKCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogICAgICAgICAgICB9LCA1MDAwKTsKCiAgICAgICAgICAgIC8vIFJlbW92ZSB0cmFuc3BhcmVudCBvdmVybGF5CiAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjdGFibGUxJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICB2aWRlb21lZ2FfdHYgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9dmlkZW9tZWdhCiAgICAgICAgaG9zdCA6IFsndmlkZW9tZWdhLnR2J10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmICgvXlwvdmlldy5waHAvLnRlc3QobG9jYXRpb24ucGF0aG5hbWUpKSB7CiAgICAgICAgICAgIC8vIHByZXZlbnQgcG9wdW5kZXIKICAgICAgICAgICAgQWFrLnNldENvb2tpZSgndmlkX21haW5wdScsIHRydWUpOwogICAgICAgICAgICBBYWsuc2V0Q29va2llKCd2aWRfc3VicHUnLCB0cnVlKTsKICAgICAgICAgICAgQWFrLnNldENvb2tpZSgndmlkX2RlbGF5JywgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBvbkVuZCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIGtpbGwgYWJjCiAgICAgICAgICAvLyBmaXggYnVnIG9uIGZpcmVmb3g6IFRoZSB2aWRlbyBjb3VsZCBub3QgYmUgbG9hZGVkLCBlaXRoZXIgYmVjYXVzZSB0aGUgc2VydmVyIG9yIG5ldHdvcmsgZmFpbGVkIG9yIGJlY2F1c2UgdGhlIGZvcm1hdCBpcyBub3Qgc3VwcG9ydGVkLgogICAgICAgICAgdmFyIHNjcmlwdCA9IEFhay5oYXNTY3JpcHQoJ1BsZWFzZSBkaXNhYmxlIEFkQmxvY2sgUGx1Z2luIHRvIHdhdGNoIHRoZSB2aWRlbycpOwogICAgICAgICAgaWYgKHNjcmlwdCkgewogICAgICAgICAgICB2YXIgc291cmNlID0gc2NyaXB0LmlubmVySFRNTDsKICAgICAgICAgICAgdmFyIHN1YnN0cmluZyA9IHNvdXJjZS5zdWJzdHJpbmcoc291cmNlLmxhc3RJbmRleE9mKCdldmFsKCcpLCBzb3VyY2UubGFzdEluZGV4T2YoJyknKSArIDEpOwogICAgICAgICAgICB2YXIgZGVvYmZ1c2NhdGVkID0gQWFrLnVucGFja1NjcmlwdChzdWJzdHJpbmcpOwogICAgICAgICAgICB2YXIgbmV3U2NyaXB0ID0gJ2lmKCcrZGVvYmZ1c2NhdGVkLnN1YnN0cmluZyhkZW9iZnVzY2F0ZWQuaW5kZXhPZigndHJ1ZScpKTsKICAgICAgICAgICAgQWFrLmFkZFNjcmlwdChuZXdTY3JpcHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZmxvd3BsYXllcl9hbnRpYWRibG9jayA6IHsKICAgICAgICBob3N0IDogWyd2aWRlb2Z1bi5tZScsICd2aWRlb2J1Zy5uZXQnLCAndmlkZW80NC5uZXQnLCAncGxheTQ0Lm5ldCcsICdieXpvby5vcmcnLCAncGxheWJiLm1lJywgJ3ZpZGVvd2luZy5tZScsICd2aWRlb3pvby5tZScsICdlYXN5dmlkZW8ubWUnLCAncGxheXBhbmRhLm5ldCddLAogICAgICAgIG9uRW5kIDogZnVuY3Rpb24gKCkgewogICAgICAgIAogICAgICAgICAgLyoKICAgICAgICAgIGh0dHA6Ly93d3cuYW5pbWV0b29uLnR2L2JsYWNrLWxhZ29vbi1lcGlzb2RlLTEKICAgICAgICAgIGh0dHA6Ly92aWRlb3dpbmcubWUvZW1iZWQ/dz03MTgmaD00MzgmdmlkZW89b25nb2luZy95dS1naS1vaF9hcmMtdl8tXzUzLm1wNAogICAgICAgICAgaHR0cDovL3BsYXliYi5tZS9lbWJlZC5waHA/dz03MTgmaD00MzgmdmlkPWF0L253L3l1LWdpLW9oX2FyYy12Xy1fNTMubXA0CiAgICAgICAgICBodHRwOi8vdmlkZW96b28ubWUvZW1iZWQucGhwP3c9NzE4Jmg9NDM4JnZpZD1hdC9udy95dS1naS1vaF9hcmMtdl8tXzUzLm1wNAogICAgICAgICAgaHR0cDovL3d3dy5lYXN5dmlkZW8ubWUvZ29nby8/dz03MTgmaD00MzgmZmlsZT15dS1naS1vaF9hcmMtdl8tXzUzLm1wNCZzdj0xCiAgICAgICAgICBodHRwOi8vcGxheXBhbmRhLm5ldC9lbWJlZC5waHA/dz03MTgmaD00MzgmdmlkPWF0L253L3l1LWdpLW9oX2FyYy12Xy1fNTMubXA0CiAgICAgICAgICAgKi8KCiAgICAgICAgICAvLyBhbGxvdyBmdWxsc2NyZWVuIHdoZW4gYWJwIGlzIGVuYWJsZWQgYW5kIHJlbW92ZSBhZCBsYXllcgogICAgICAgICAgLy8gYWRzIGJsb2NrZWQgYnkgYWJwIHJ1bGUKICAgICAgICAgIGlmICgvXlwvKGVtYmVkfGdvZ298Z3BsdXMpLy50ZXN0KGxvY2F0aW9uLnBhdGhuYW1lKSkgewogICAgICAgICAgICB2YXIgUGxheWVyID0gbmV3IEFhay5wbGF5ZXIoKTsKICAgICAgICAgICAgUGxheWVyLmVkaXRpbmcoJyNmbG93cGxheWVyX2FwaScsIHsKICAgICAgICAgICAgICBzZXRBdHRyaWJ1dGVzIDogewogICAgICAgICAgICAgICAgYWxsb3dmdWxsc2NyZWVuIDogdHJ1ZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9LAogICAgICByM3ogOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE1NDUKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTMyMwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84ODQKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vQzE1OWtldm4KICAgICAgICBob3N0IDogWydjaXR5YW0uY29tJywgJ2NvbXB1dGVyd29ybGR1ay5jb20nLCAndGVjaHdvcmxkLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvKiBkb24ndCB3b3JrIHdpdGggY2hyb21lCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAnX3IzeicsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDoge30KICAgICAgICAgIH0pOwogICAgICAgICAgKi8KICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay51dy4kKCIjcjN6LXdhaXQiKS5yZW1vdmUoKTsKICAgICAgICAgIEFhay51dy4kKCIucjN6LWhpZGUiKS5yZW1vdmVDbGFzcygicjN6LWhpZGUiKTsKICAgICAgICAgIEFhay51dy5fcjN6ID0gbnVsbDsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdvb2dsZV9qb2JydW5uZXIgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZW4vZm9ydW0vbWVzc2FnZXMvNDA1CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEzNDMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTM0MgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84MzEKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTI3NAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjYyCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU2MQogICAgICAgIGhvc3QgOiBbJ25leHQtZXBpc29kZS5uZXQnLCAna2luZ21ha2VyLm5ld3MnLCAnZ2FtZXNwb3dlcml0YS5jb20nLCAndG9kYXlpZG9sLmNvbScsICdyZWNlaXZlLWEtc21zLmNvbScsICd3YWtldXBjYWxsbWUuY29tJywgJ3JpbmdteWNlbGxwaG9uZS5jb20nLCAnZmFxbW96aWxsYS5vcmcnLCAndGhlbWVteXBjLmNvbSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3Lmdvb2dsZV9qb2JydW5uZXIgPSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8vIGZ1Y2thZGJvY2sgY3VzdG9taXplZAogICAgICBmYWJfc3BvcnRzX2ZyIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjE3CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1NwRU41ZHVTCiAgICAgICAgaG9zdCA6IFsnc3BvcnRzLmZyJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5mYWtlRnVja0FkQmxvY2soJ2ZhYkluc3RhbmNlJywgJ0ZhYkluc3RhbmNlJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmYWJfZXVyb3BlMV9mciA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTE4OAogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9VTGUxdnpRUgogICAgICAgIGhvc3QgOiBbJ2V1cm9wZTEuZnInXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmZha2VGdWNrQWRCbG9jaygnZmFiSW5zdGFuY2UnLCAnRmFiSW5zdGFuY2UnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZhYl9uZXd5b3JrZXJfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMTc3CiAgICAgICAgaG9zdCA6IFsnbmV3eW9ya2VyLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuZmFrZUZ1Y2tBZEJsb2NrKCdzbmlmZkFkQmxvY2snLCAnU25pZmZBZEJsb2NrJyk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmYWJfd2lyZWRfY29tIDogewogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMDYxCiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZnIvZm9ydW0vZGlzY3Vzc2lvbi84MjM1CiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1BxMTR2NEZDCiAgICAgICAgaG9zdCA6IFsnd2lyZWQuY29tJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5mYWtlRnVja0FkQmxvY2soJ3NuaWZmQWRCbG9jaycsICdTbmlmZkFkQmxvY2snKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZhYl9tYW5nYXNwcm9qZWN0X2RvbWFpbnMgOiB7CiAgICAgICAgLy8gbm90ZTogZnVja2FkYmxvY2sgd2l0aCBjdXN0b20gaW5zdGFuY2UgbmFtZQogICAgICAgIC8vIG5vdGU6IGFsc28gYWRkZWQgYWJwIHJ1bGUKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTEyNwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dyZWFzeWZvcmsub3JnL2ZyL2ZvcnVtL2Rpc2N1c3Npb24vNDEzMgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84NTgKICAgICAgICAvLyBzb3VyY2U6IGh0dHBzOi8vbWFuZ2FzLnpseC5jb20uYnIvbWFuZ2F6b3JkX2xpYi9qcy9saWIvY29udHJvbGxlcnMvTGVpdG9yL0xlaXRvci5taW4uanMKICAgICAgICBob3N0IDogWydtYW5nYXNwcm9qZWN0LmNvbS5icicsICdtYW5nYXNwcm9qZWN0Lm5ldC5icicsICdtYW5nYXMuemx4LmNvbS5iciddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuZmFrZUZ1Y2tBZEJsb2NrKCdtYW5nYXNMZWl0b3JTbGlkZXInLCBBYWsuZ2VuZXJhdGVJRCgpKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZhYl9xbmltYXRlX2NvbSA6IHsKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNzM5CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzcwNQogICAgICAgIC8vIG5vdGU6IGZ1Y2thZGJsb2NrIGN1c3RvbWl6ZWQKICAgICAgICBob3N0IDogWydxbmltYXRlLmNvbSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnV3LmFkQmxvY2tEZXRlY3RlZCA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgZmFiX2V1cm90cmFuc3BvcnRfZGUgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg1OAogICAgICAgIC8vIG5vdGU6IGZ1Y2thZGJsb2NrIHdpdGggY3VzdG9tIGluc3RhbmNlIG5hbWUKICAgICAgICBob3N0IDogWydldXJvdHJhbnNwb3J0LmRlJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5mYWtlRnVja0FkQmxvY2soJ2FudGlBZEJsb2NrJywgQWFrLmdlbmVyYXRlSUQoKSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBmYWJfY2FkZXRlY3QgOiB7CiAgICAgICAgLy8gYnk6IFNrcjR0Y2hHcjNhenlNb25raUJhbGxsbGxsWnp6egogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy83ODQKICAgICAgICAvLyBub3RlOiBmdWNrYWRibG9jayB3aXRoIGN1c3RvbSBpbnN0YW5jZSBuYW1lCiAgICAgICAgaG9zdCA6IFsndHpldHplLml0JywgJ2JlcHBlZ3JpbGxvLml0JywgJ2xhLWNvc2EuaXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmZha2VGdWNrQWRCbG9jaygnY2FkZXRlY3QnLCAnQ0FEZXRlY3QnKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZhYl9hZ2FyX2dhbWUgOiB7CiAgICAgICAgLy8gbm90ZTogZnVja2FkYmxvY2sgd2l0aCBjdXN0b20gaW5zdGFuY2UgbmFtZQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjU3CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzExMzUKICAgICAgICBob3N0IDogWydhZ2FyaW8uc3gnLCAnYWdhcmFiaS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmZha2VGdWNrQWRCbG9jaygnYWdhcmlvX1NYX2FkcycsIEFhay5nZW5lcmF0ZUlEKCkpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZmFiX2ZpbGVzcGFjZV9jb20gOiB7CiAgICAgICAgLy8gbm90ZTogZnVja2FkYmxvY2sgd2l0aCBjdXN0b20gaW5zdGFuY2UgbmFtZQogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9ZQVMwQXM4NwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMDM3CiAgICAgICAgaG9zdCA6IFsnZmlsZXNwYWNlLmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuZmFrZUZ1Y2tBZEJsb2NrKCdmQUInLCBBYWsuZ2VuZXJhdGVJRCgpKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGZhYl90b3BzZXJpYWx5X3NrIDogewogICAgICAgIC8vIG5vdGU6IGZ1Y2thZGJsb2NrIHdpdGggY3VzdG9tIGluc3RhbmNlIG5hbWUKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vNDJ0VVE5YVYKICAgICAgICBob3N0IDogWyd0b3BzZXJpYWx5LnNrJ10sCiAgICAgICAgb25TdGFydCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIEFhay5mYWtlRnVja0FkQmxvY2soJ3NyYXROYVZhcycsIEFhay5nZW5lcmF0ZUlEKCkpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZmFiX2N1c3RvbWl6ZWQgOiB7CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE0NTUKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTY1NwogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS9ONDJhNUJqRQogICAgICAgIGhvc3QgOiBbJ2VwaWN1cmlvdXMuY29tJywgJ2Rlc2t0b3Bzb2x1dGlvbi5vcmcnLCAnaW5kaWF0aW1lcy5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIEFhay5hZGRTY3JpcHQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBfc2V0QXR0cmlidXRlID0gd2luZG93LkVsZW1lbnQucHJvdG90eXBlLnNldEF0dHJpYnV0ZTsKICAgICAgICAgICAgICB3aW5kb3cuRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZSA9PSAnY2xhc3MnICYmIHZhbHVlLmluZGV4T2YoJ3RleHRfYWRzJykgIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnJzsKICAgICAgICAgICAgICAgICAgY29uc29sZS5pbmZvKHRoaXMsICdmYWIgaW50ZXJjZXB0ZWQgOi0pJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBfc2V0QXR0cmlidXRlLmNhbGwodGhpcywgbmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGQzeHQzZXJfYW50aWFkYmxvY2sgOiB7CiAgICAgICAgLy8gc2l0ZTogaHR0cDovL2QzeHQzci5jb20vYW50aS1hZGJsb2NrCiAgICAgICAgLy8gY2FzZTogaHR0cDovL3Nwb3J0LXNob3cuZnIvanMvYWR2ZXJ0aXNlbWVudC1BZEJsb2NrLmpzCiAgICAgICAgLy8gY2FzZTogaHR0cDovL3d3dy4yc2l0ZS5tZS9hZHZlcnRpc2VtZW50LUFkQmxvY2suanMKICAgICAgICBob3N0IDogWydzcG9ydC1zaG93LmZyJywgJ3ZpcGZsYXNoLm5ldCcsICcyc2l0ZS5tZSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkU3R5bGUoIiNibG9ja2Jsb2NrQSB7dmlzaWJpbGl0eTppbnZpc2libGU7ZGlzcGxheTpub25lO30gI2Jsb2NrYmxvY2tBIHRkIHt2aXNpYmlsaXR5OmludmlzaWJsZTtkaXNwbGF5Om5vbmU7fSAjYmxvY2tibG9ja0EgdGQgcCB7dmlzaWJpbGl0eTppbnZpc2libGU7ZGlzcGxheTpub25lO30gI2Jsb2NrYmxvY2tCIHt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTpibG9jazt9Iik7CiAgICAgICAgfQogICAgICB9LAogICAgICBhZGJsb2NrX25vdGlmeSA6IHsKICAgICAgICAvLyBieTogU2tyNHRjaEdyM2F6eU1vbmtpQmFsbGxsbGxaenp6CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzEzOTIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTAzOQogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy81OTIKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvODEzCiAgICAgICAgaG9zdCA6IFsnZ2FtZXRyYW5zZmVycy5jb20nLCAnd2luYW5kbWFjLmNvbScsICdmcmVlLXN0ZWFtLWdpdmVhd2F5cy5jb20nLCAnY2FuYWx3cC5jb20nLCAnYWxwaGFoaXN0b3J5LmNvbSddLAogICAgICAgIG9uQWx3YXlzIDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLnNldENvb2tpZSgnYW5Db29raWUnLCB0cnVlKTsKICAgICAgICAgIEFhay51dy5hbk9wdGlvbnMgPSB7fTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGx1dHRlX2FkYmxvY2sgOiB7CiAgICAgICAgLy8gc2l0ZTogaHR0cDovL2x1dHRlYWRibG9jay5ibG9nc3BvdC5jb20vMjAxNC8xMS9sZS1zY3JpcHQuaHRtbAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy85MzgKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvNTgwCiAgICAgICAgaG9zdCA6IFsnbGV3ZWJ0dmJvdXF1ZXRmcmFuY29waG9uZS5vdmVyYmxvZy5jb20nLCAnd2VidHYuYmxvZ3Vlei5jb20nLCAnbGF0ZWxlZ3JhdHVpdGUuYmxvZ3Nwb3QuY29tJywgJ3RvdGFsZGVicmlkLm9yZycsICczNy4xODcuMTczLjIwNSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsuYWRkQmFpdEVsZW1lbnQoJ2RpdiNteV9hZF9kaXYnKTsKICAgICAgICAgIEFhay51dy5qYWJiYWh1ZCA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgIH0KICAgICAgfSwKICAgICAgYW50aWJsb2NrIDogewogICAgICAgIC8vIHNpdGU6IGFudGlibG9jay5vcmcKICAgICAgICAvLyBub3RlOiBjdXN0b21pemVkCiAgICAgICAgLy8gaXNzdWU6IAogICAgICAgIGhvc3QgOiBbJ215YmFuay5wbCcsICdyYXBpZGdyYWIucGwnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIF9hZGRFdmVudExpc3RlbmVyID0gd2luZG93LmFkZEV2ZW50TGlzdGVuZXI7CiAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lci50b1N0cmluZygpLmluZGV4T2YoJy5uZXh0RnVuY3Rpb24oKX0nKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhbJ0FudGlBZGJLaWxsZXInLCBsb2NhdGlvbi5ob3N0LCAnQW50aUJsb2Nre2N1c3RvbWl6ZWR9J10pOwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX2FkZEV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCB0eXBlLCBsaXN0ZW5lciwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYmxvY2thZGJsb2NrIDogewogICAgICAgIC8vIHNpdGU6IGJsb2NrYWRibG9jay5jb20KICAgICAgICAvLyBub3RlOiByYW5kb20gaW5zdGFuY2UgbmFtZQogICAgICAgIC8vIHNvdXJjZTogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vV2F0aWxpbi9hZjc1ZTBhMmU4MmEyZWZiMzg0YmRlOWM3YjQxZGVjOAogICAgICAgIC8vIGlzc3VlczogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT1sYWJlbDpCbG9ja0FkQmxvY2sKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mb3J1bS9kaXNjdXNzaW9uLzgyNzMKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9mb3J1bS9kaXNjdXNzaW9uLzc2MjUKICAgICAgICBob3N0IDogWydibG9ja2FkYmxvY2suY29tJywgJ2xpbmtkcm9wLm5ldCcsICdyZXZjbG91ZHMuY29tJywgJ2xlcG9ybm8ub3JnJywgJ3VwbG9hZHNodWIuY29tJywgJ2Rhc29sby5vcmcnLCAnZnVsbHN0dWZmLm5ldCcsICd6ZXVzbmV3cy5pdCcsICdjaGVtaW5vdHMubmV0JywgJ2xvbHN5LnR2JywgJ2FuaW1lcy1tYW5nYXMtZGRsLmNvbScsICdub3RpY2lhc2F1dG9tb3RpdmFzLmNvbS5icicsICdkYXJrc3RhcnMub3JnJywgJ2NvcmVwYWNrcy5jb20nLCAnbmF0dXJhbGJkLmNvbScsICdjb29sc29mdC5hbHRlcnZpc3RhLm9yZycsICdvcGVubG9hZC51cycsICdjZGEtb25saW5lLnBsJywgJ3VyYmFucGxhbmV0Lm9yZycsICdtYW1haGQuY29tJywgJ3NhZGVlbXBjLmNvbScsICdhdm1vby5jb20nLCAndGhhaWxhbmRlLWZyLmNvbScsICdidGFpYS5jb20nLCAndHVzb2Z0Lm9yZycsICdoaXNzZS5uZXQnLCAnZXVyb3BldXAuY29tJywgJ25yai5mcicsICdzcm5rLmNvJywgJ2FuaW1tZXguY28nLCAnc29ja2V0bG9vcC5jb20nLCAnY3JhY2toZXguY29tJywgJ3JldmVhbGVkdHJpY2tzNHUuY29tJywgJ3BpenphbWFraW5nLmNvbScsICdjb21wdXRlcndvcm0ubmV0JywgJ3lvdXJsaWZldXBkYXRlZC5uZXQnXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFNjcmlwdChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIF9zZXRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQ7CiAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQgPSBmdW5jdGlvbiAoZm4sIGRlbGF5KSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnc3RyaW5nJyAmJiBmbi5pbmRleE9mKCdiYWJfZWxlbWVudGlkJykgPiAtMSkgewogICAgICAgICAgICAgICAgICBmbiA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oWydBbnRpQWRiS2lsbGVyJywgbG9jYXRpb24uaG9zdCwgJ0Jsb2NrQWRCbG9jayddKTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9zZXRUaW1lb3V0LmNhbGwodGhpcywgZm4sIGRlbGF5KTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBncHRfc3AgOiB7CiAgICAgICAgLy8gYnk6IFJlZWssIEdpd2F5dW1lCiAgICAgICAgLy8gbm90ZTogd2hlbiBhZGJsb2NrIGRldGVjdGVkIGluamVjdCBuZXcgYWRzLCByZWRpcmVjdCB0byBodHRwOi8vdGlueXVybC5jb20venEyejVvNgogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNjM2CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE1OTYKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTI5NwogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMTQ0CiAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzE1NDIKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vOEFqaXRmYjIKICAgICAgICBob3N0IDogWydtYXJrZXR3YXRjaC5jb20nLCAnZGVhZGxpbmUuY29tJywgJ3R3ZWFrdG93bi5jb20nLCAnbnlwb3N0LmNvbScsICdyZWFsZ20uY29tJywgJ25hc2RhcS5jb20nXSwKICAgICAgICBvblN0YXJ0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgQWFrLmFkZFN0eWxlKCIuY29udGFpbmVyLS1iYW5uZXJBZCwgLmNvbC0tYWQgeyBkaXNwbGF5OiBub25lOyB9Iik7CiAgICAgICAgICBBYWsuYWRkU2NyaXB0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAvLyBHaXdheXVtZSAKICAgICAgICAgICAgICB3aW5kb3cuX3NwXyA9IHdpbmRvdy5fc3BfIHx8IHt9OwogICAgICAgICAgICAgIHdpbmRvdy5fc3BfLmNvbmZpZyA9IHdpbmRvdy5fc3BfLmNvbmZpZyB8fCB7fTsKICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93Ll9zcF8uY29uZmlnLCAiY29udGVudF9jb250cm9sX2NhbGxiYWNrIiwgewogICAgICAgICAgICAgICAgdmFsdWUgOiBmdW5jdGlvbiAoKSB7fSwKICAgICAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGUgOiBmYWxzZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vIFJlZWsKICAgICAgICAgICAgICB2YXIgX2FkZEV2ZW50TGlzdGVuZXIgPSB3aW5kb3cuRXZlbnRUYXJnZXQucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXI7CiAgICAgICAgICAgICAgd2luZG93LkV2ZW50VGFyZ2V0LnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVyID0gZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PSAnc3AuYmxvY2tpbmcnKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhbJ0FudGlBZGJLaWxsZXInLCBsb2NhdGlvbi5ob3N0LCAnR1BUe3NwLWJsb2NraW5nfSddKTsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF9hZGRFdmVudExpc3RlbmVyLmNhbGwodGhpcywgdHlwZSwgbGlzdGVuZXIsIG9wdGlvbnMpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGtydXhfYXNsIDogewogICAgICAgIC8vIG5vdGU6IHdoZW4gYWRibG9jayBkZXRlY3RlZCBpbmplY3QgbmV3IGFkcwogICAgICAgIC8vIHNvdXJjZTogaHR0cDovL3Bhc3RlYmluLmNvbS8wSEQ3Tjg0aQogICAgICAgIGhvc3QgOiBbJ2NvbW1lbnRjYW1hcmNoZS5uZXQnLCAnam91cm5hbGRlc2ZlbW1lcy5jb20nLCAnbGludGVybmF1dGUuY29tJ10sCiAgICAgICAgb25CZWZvcmVTY3JpcHQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgICBkZXRlY3RlZCA6ICdLcnV4e2FzbH0nLAogICAgICAgICAgICAgIGNvbnRhaW5zIDogJ0FzbC5wcm90b3R5cGUuaW5qZWN0JywKICAgICAgICAgICAgICBleHRlcm5hbCA6IGZhbHNlLAogICAgICAgICAgICAgIHJlbW92ZSA6IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGtydXhfYWRwIDogewogICAgICAgIC8vIG5vdGU6IHdoZW4gYWRibG9jayBkZXRlY3RlZCBpbmplY3QgbmV3IGFkcwogICAgICAgIC8vIHNvdXJjZTogCiAgICAgICAgaG9zdCA6IFsnZm91cmNoZXR0ZS1ldC1iaWtpbmkuZnInLCAnbWV0ZW9jaXR5LmNvbSddLAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBBYWsudXcuYWRQcm90ZWN0ID0gMTsKICAgICAgICB9CiAgICAgIH0sCSAKICAgICAgcGhvZW5peF9nb3lhdmVsYWIgOiB7CiAgICAgICAgLy8gbm90ZTogd2hlbiBhZGJsb2NrIGRldGVjdGVkIGluamVjdCBuZXcgYWRzCiAgICAgICAgLy8gbm90ZTogc2NyaXB0IGFudGktYWRibG9jayBvYmZ1c2NhdGVkLAogICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8KICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9nbDNnaHEyCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL2hzQW1kU3VmCiAgICAgICAgaG9zdCA6IFsnZGVtby1waG9lbml4LmNvbScsICdkcHN0cmVhbS5uZXQnLCAnZ3VtLWd1bS1zdHJlYW1pbmcuY29tJywgJ2pldS5pbmZvJywgJ3NvZm9vdC5jb20nLCAnZ2FhcmEtZnIuY29tJywgJ2dheXR1YmUuY29tJywgJ3R1eGJvYXJkLmNvbScsICd4c3RvcnktZnIuY29tJywgJ2hlbnRhaWZyLm5ldCcsICdmaWxtc3RyZWFtaW5nLWhkLmNvbScsICdmaWxtdmYubmV0JywgJ2hlbnRhaWhhdmVuLm9yZycsICduYXJ1dG9zaGlwcHVkZW52Zi5jb20nLCAndGhlYmFkYnV6ei5jb20nLCAnbWFuZ2EtbmV3cy5jb20nLCAnamV1LnZpZGVvJ10sCiAgICAgICAgb25BbHdheXMgOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvL0Fhay51dy5fXyRkYyA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgQWFrLmFkZFN0eWxlKCdib2R5IHt2aXNpYmlsaXR5OiB2aXNpYmxlO30nKTsKICAgICAgICB9LAogICAgICAgIG9uQmVmb3JlU2NyaXB0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFt7IAogICAgICAgICAgICAgIGRldGVjdGVkIDogJ1Bob2VuaXhHb3lhdmVsYWInLAogICAgICAgICAgICAgIGNvbnRhaW5zIDogJ1BIRU5WJywKICAgICAgICAgICAgICBleHRlcm5hbCA6IGZhbHNlLAogICAgICAgICAgICAgIHJlbW92ZTogdHJ1ZQogICAgICAgICAgICB9CiAgICAgICAgICBdOwogICAgICAgIH0KICAgICAgfSwKICAgICAgYWRfZGVmZW5kX3VhYnAgOiB7CiAgICAgICAgLy8gbm90ZTogd2hlbiBhZGJsb2NrIGRldGVjdGVkIGluamVjdCBuZXcgYWRzCiAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL2NGUUNwODBXCiAgICAgICAgaG9zdCA6IFsndHZzcGllbGZpbG0uZGUnLCAnZmluYW56ZW4uY2gnXSwKICAgICAgICBvbkJlZm9yZVNjcmlwdCA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBbewogICAgICAgICAgICAgIGRldGVjdGVkIDogJ0FkRGVmZW5ke1VBQlBJbmplY3R9JywKICAgICAgICAgICAgICBjb250YWlucyA6ICdVQUJQSW5qZWN0JywKICAgICAgICAgICAgICBleHRlcm5hbCA6IGZhbHNlLAogICAgICAgICAgICAgIHJlbW92ZSA6IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGFkX2RlZmVuZF91YWIgOiB7CiAgICAgICAgLy8gbm90ZTogd2hlbiBhZGJsb2NrIGRldGVjdGVkIGluamVjdCBuZXcgYWRzCiAgICAgICAgLy8gdXNlcnNjcmlwdDogaHR0cHM6Ly9vcGVudXNlcmpzLm9yZy9zY3JpcHRzL3NjaHdhcnp0ZWUvQWREZWZlbmRfS2xhdHNjaGUKICAgICAgICAvLyB1c2Vyc2NyaXB0OiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9hbm9ueW1vdXMvYTliOTk1NmJhZjFkNTlhMTA3YzUKICAgICAgICAvLyBzb3VyY2U6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vMVZ5VzB1OW0sIGh0dHA6Ly9wYXN0ZWJpbi5jb20vQVpxaFJ4V1UKICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXM/cT1sYWJlbDpBZERlZmVuZAogICAgICAgIC8vIHB1bGw6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvcHVsbC80NjcKICAgICAgICBob3N0IDogWyd3YXRjaGdlbmVyYXRpb24uZnInLCAndHVyYm8uZnInLCAnMjRtYXRpbnMuZnInLCAnZm9vdDAxLmNvbScsICdjbHViaWMuY29tJywgJ21hY2cuY28nLCAnYmVnZWVrLmZyJywgJ2lnZW4uZnInLCAnZ2FtZXN0YXIuZGUnLCAnZm9jdXMuZGUnLCAnc3Rlcm4uZGUnLCAnc2F0MS4nLCAncHJvc2llYmVuLicsICdrYWJlbGVpbnMuJywgJ3NhdDFnb2xkLicsICdzaXh4LicsICdwcm9zaWViZW5tYXh4LicsICdmZW0uY29tJywgJ3RoZS12b2ljZS1vZi1nZXJtYW55LicsICd3ZXR0ZXIuY29tJywgJ3dldHRlcm9ubGluZS5kZScsICdwY3dlbHQuZGUnLCAnYm9lcnNlLW9ubGluZS5kZScsICdzcG9ydGF1dG8uZGUnLCAnYXV0by1tb3Rvci11bmQtc3BvcnQuZGUnLCAnbW90b3Ita2xhc3Npay5kZScsICc0d2hlZWxmdW4uZGUnLCAnYXV0b3N0cmFzc2VudmVya2Voci5kZScsICdsdXN0aWNoLmRlJywgJ3Nwb3guY29tJywgJ3Noei5kZScsICd0cmFuc2Zlcm1hcmt0LmRlJywgJ3JwLW9ubGluZS5kZScsICdtb3RvcnJhZG9ubGluZS5kZScsICcyMG1pbi5jaCcsICdtYWluLXNwaXR6ZS5kZScsICd3b3Jtc2VyLXplaXR1bmcuZGUnLCAnbGFtcGVydGhlaW1lci16ZWl0dW5nLmRlJywgJ3dpZXNiZGVuZXItdGFnYmxhdHQuZGUnLCAnYnVlcnN0YWVkdGVyLXplaXR1bmcuZGUnLCAnd2llc2JkZW5lci1rdXJpZXIuZGUnLCAncmhlaW4tbWFpbi1wcmVzc2UuZGUnLCAnYWxsZ2VtZWluZS16ZWl0dW5nLmRlJywgJ2FyaXZhLmRlJywgJ3NwaWVnZWwuZGUnLCAnYnJpZ2l0dGUuZGUnLCAnZHNoaW5pLm5ldCcsICdnYWxhLmRlJywgJ2dhbWVwcm8uZGUnLCAnZ2Ftb25hLmRlJywgJ3Bubi5kZScsICdwcm9tb2JpbC5kZScsICdzcG9ydGFsLmRlJywgJ3dlYmZhaWwuY29tJywgJ2NvbXB1dGVyYmlsZC5kZScsICdmaW5hbnplbi5uZXQnLCAnY29tdW5pby5kZScsICdtZWRpc2l0ZS5mciddLAogICAgICAgIG9uQmVmb3JlU2NyaXB0IDogZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFt7CiAgICAgICAgICAgICAgZGV0ZWN0ZWQgOiAnQWREZWZlbmR7dWFiSW5qZWN0fScsCiAgICAgICAgICAgICAgY29udGFpbnMgOiAndWFiSW5qZWN0JywKICAgICAgICAgICAgICBleHRlcm5hbCA6IGZhbHNlLAogICAgICAgICAgICAgIHJlbW92ZSA6IHRydWUKICAgICAgICAgICAgfQogICAgICAgICAgXTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIC8qIHNvbHZlZCBieSBBYWtMSXN0CiAgICAgIHRpc29vbWlfaW5kaXJla3QgOiB7CiAgICAgIC8vIGlubGluZTogaHR0cDovL3Bhc3RlYmluLmNvbS9ucG1YVFVIdwogICAgICAvLyBleHRlcm5hbDogaHR0cDovL3Bhc3RlYmluLmNvbS9odlduQ3VEdwogICAgICBob3N0IDogWydlbmVyZ3kuZGUnLCAnZ2V0dmlkcy5kZScsICdnZXdpbmRlLW5vcm1lbi5kZScsICdwb2RjYXN0LmRlJywgJ3NwaWVsZXNwaWVsZW4yNC5kZScsICdkaWFsby5kZSddLAogICAgICBvbkJlZm9yZVNjcmlwdCA6IGZ1bmN0aW9uIChlKSB7CiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7CiAgICAgIHZhciB0ZXh0ID0gdGFyZ2V0LnRleHQ7CiAgICAgIGlmIChBYWsuY29udGFpbnModGV4dCwgJ249ImFiY2RlZmdoaWprbG0iLHI9Im5vcHFyc3R1dnd4eXoiLGk9IjAxMjM0NTY3ODkiO3ZhciBzPXQ9PTA/aTp0PT0xP24nKSkgewogICAgICBBYWsuc3RvcFNjcmlwdChlKTsKICAgICAgQWFrLmxvZygnVGlzb29taSBJbmRpcmVrdCcpOwogICAgICB9CiAgICAgIH0KICAgICAgfSwKICAgICAgICovCiAgICAgIC8qIHNvbHZlZCBieSBBYWtMSXN0CiAgICAgIHRpc29vbWlfZGlyZWt0IDogewogICAgICAvLyBpbmxpbmU6IGh0dHA6Ly9wYXN0ZWJpbi5jb20vMnZxMzhKWFkKICAgICAgaG9zdCA6IFsnYXV0b3plaXR1bmcuZGUnLCAnZm9ybWVsMS5kZScsICdmcmVtZHdvcnQuZGUnLCAnaW5zaWRlLWhhbmR5LmRlJywgJ21vdG9yc3BvcnQtdG90YWwuY29tJywgJ2F1c3NlbndpcnRzY2hhZnRzbHVwZS5kZScsICdkb25uZXJ3ZXR0ZXIuZGUnLCAnd2ludG90YWwuZGUnXSwKICAgICAgb25CZWZvcmVTY3JpcHQgOiBmdW5jdGlvbiAoZSkgewogICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50OwogICAgICB2YXIgdGV4dCA9IHRhcmdldC50ZXh0OwogICAgICBpZiAoQWFrLmNvbnRhaW5zKHRleHQsICdmdW5jdGlvbiBkZXRlY3QoKScpKSB7CiAgICAgIEFhay5zdG9wU2NyaXB0KGUpOwogICAgICBBYWsubG9nKCdUaXNvb21pIERpcmVrdCcpOwogICAgICB9CiAgICAgIH0KICAgICAgfSwKICAgICAgICovCiAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAgIC8vIEdlbmVyaWMKICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICAgZ2VuZXJpYyA6IHsKICAgICAgICBob3N0IDogWycuKj8nXSwKICAgICAgICBvblJlbW92ZSA6IGZ1bmN0aW9uIChyZW1vdmVkTm9kZSkgewogICAgICAgICAgaWYgKEFhay5vcHRzLnJlbW92ZWQpIHsKICAgICAgICAgICAgaWYgKHJlbW92ZWROb2RlLnNyYyB8fAogICAgICAgICAgICAgIHJlbW92ZWROb2RlLmlkIHx8CiAgICAgICAgICAgICAgcmVtb3ZlZE5vZGUuY2xhc3NOYW1lICYmCiAgICAgICAgICAgICAgIS9eZmlyZWJ1Zy8udGVzdChyZW1vdmVkTm9kZS5jbGFzc05hbWUpKSB7CiAgICAgICAgICAgICAgLy8gTm9kZSByZW1vdmVkCiAgICAgICAgICAgICAgQWFrLmxvZyhyZW1vdmVkTm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uU3RhcnQgOiBmdW5jdGlvbiAoKSB7CgogICAgICAgICAgLy8gRnVja0FkQmxvY2sgJiBCbG9ja0FkQmxvY2sgdjMgYW5kIHY0CiAgICAgICAgICAvLyBzaXRlOiBodHRwOi8vd3d3LnNpdGV4dy5mci9mdWNrYWRibG9jay8KICAgICAgICAgIC8vIHJlcG86IGh0dHBzOi8vZ2l0aHViLmNvbS9zaXRleHcvRnVja0FkQmxvY2sKICAgICAgICAgIC8vIHJlcG86IGh0dHBzOi8vZ2l0aHViLmNvbS9zaXRleHcvQmxvY2tBZEJsb2NrCiAgICAgICAgICAvLyBub3RlOiB3aGVuIGZ1Y2thZGJsb2NrLmpzIG9yIGJsb2NrYWRibG9jay5qcyBpcyBibG9ja2VkCiAgICAgICAgICAvLyBkZW1vIHYzOiBodHRwOi8vc2guc3Qvdm92SEUKICAgICAgICAgIC8vIGRlbW8gdjQ6IGh0dHA6Ly9hbC5seS9xQmJYSAogICAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzg4OAogICAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgyNAogICAgICAgICAgQWFrLmZha2VGdWNrQWRCbG9jaygnZnVja0FkQmxvY2snLCAnRnVja0FkQmxvY2snKTsKICAgICAgICAgIEFhay5mYWtlRnVja0FkQmxvY2soJ2Jsb2NrQWRCbG9jaycsICdCbG9ja0FkQmxvY2snKTsKCiAgICAgICAgICAvLyBjYW5SdW5BZHMKICAgICAgICAgIC8vIHJlcG86IGh0dHBzOi8vZ2l0aHViLmNvbS9NYXR0aGV3R3Jvc3MvQ2FuUnVuQWRzCiAgICAgICAgICAvLyBub3RlOiB1c2UgZXh0ZXJuYWxsIHNjcmlwdCAiL2pzL2Fkcy5qcyIgLT4gdmFyIGNhblJ1bkFkcyA9IHRydWU7CiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWFrLnV3LCAnY2FuUnVuQWRzJywgewogICAgICAgICAgICBlbnVtZXJhYmxlIDogdHJ1ZSwKICAgICAgICAgICAgd3JpdGFibGUgOiBmYWxzZSwKICAgICAgICAgICAgdmFsdWUgOiB0cnVlCiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyBjYW5TaG93QWRzCiAgICAgICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvMTE5NwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgJ2NhblNob3dBZHMnLCB7CiAgICAgICAgICAgIGVudW1lcmFibGUgOiB0cnVlLAogICAgICAgICAgICB3cml0YWJsZSA6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZSA6IHRydWUKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIEFkYmxvY2tlciBEZXRlY3RpbmcgU2NyaXB0czogTWV0aG9kIDIKICAgICAgICAgIC8vIGdpc3Q6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2lyYXphc3llZC8zZDI0N2QzZDEyMWU3ODFhMzg3MgogICAgICAgICAgLy8gbm90ZTogdXNlIGV4dGVybmFsbCBzY3JpcHQgIi9qcy9hZHMuanMiIC0+IGlzQWRCbG9ja0FjdGl2ZSA9IGZhbHNlOwogICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFhay51dywgJ2lzQWRCbG9ja0FjdGl2ZScsIHsKICAgICAgICAgICAgZW51bWVyYWJsZSA6IHRydWUsCiAgICAgICAgICAgIHdyaXRhYmxlIDogZmFsc2UsCiAgICAgICAgICAgIHZhbHVlIDogZmFsc2UKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8qCiAgICAgICAgICB3aW5kb3cuaUhhdmVMb2FkZWRBZHMgPSB0cnVlOwogICAgICAgICAgdmFyIG5pY2VBZHNDaGVjaz10cnVlOwogICAgICAgICAgYWRibG9jayA9IGZhbHNlCiAgICAgICAgICBpc19ibG9ja2VyID0gZmFsc2U7CiAgICAgICAgICAgKi8KICAgICAgICB9LAogICAgICAgIG9uSWRsZSA6IGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAvLyBBZEJsb2NrIERldGVjdG9yIChYZW5Gb3JvIFJlbGxlY3QpCiAgICAgICAgICAvLyBzaXRlOiBodHRwOi8vdGlueXVybC5jb20vcGEyOHhkbgogICAgICAgICAgLy8gY2xvbmVJbnRvOiBodHRwOi8vdGlueXVybC5jb20vazZxcGhtZQogICAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgwNQogICAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzgwNAogICAgICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzU5MQogICAgICAgICAgaWYgKEFhay51dy5YZW5Gb3JvICYmIHR5cGVvZiBBYWsudXcuWGVuRm9yby5yZWxsZWN0ID09ICdvYmplY3QnKSB7CiAgICAgICAgICAgIEFhay51dy5YZW5Gb3JvLnJlbGxlY3QgPSB7CiAgICAgICAgICAgICAgQWRCbG9ja0RldGVjdG9yIDogewogICAgICAgICAgICAgICAgc3RhcnQgOiBmdW5jdGlvbiAoKSB7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdBZEJsb2NrIERldGVjdG9yIChYZW5Gb3JvIFJlbGxlY3QpJyk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoKICAgICAgICAgIC8vIEFkdW5ibG9jayAtIGh0dHA6Ly9hZHVuYmxvY2suY29tLwogICAgICAgICAgaWYgKEFhay5nZXRDb29raWUoJ2FkYmxvY2snKSA9PSAxKSB7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCdhZGJsb2NrJywgMCk7CiAgICAgICAgICBBYWsuc2V0Q29va2llKCdiYXJfY2xvc2VkJywgMSk7CiAgICAgICAgICB9CiAgICAgICAgICAgKi8KCiAgICAgICAgICAvLyBBZGJsb2NrIEJsb2NrZXIKICAgICAgICAgIC8vIGh0dHBzOi8vd29yZHByZXNzLm9yZy9wbHVnaW5zL2FkZGJsb2NrYmxvY2tlci8KICAgICAgICAgIC8vIGh0dHA6Ly90aW55dXJsLmNvbS9uc3duNmZ6CiAgICAgICAgICAvLyBodHRwOi8vcGFzdGViaW4uY29tL2Q2NXpyMzdtCiAgICAgICAgICAvKiBjYW4gY2F1c2UgYSBidWcKICAgICAgICAgIHZhciBhZHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhZnNfYWRzJyk7CiAgICAgICAgICB2YXIgYWQgPSBhZHMubGVuZ3RoICYmIGFkc1thZHMubGVuZ3RoIC0gMV07CiAgICAgICAgICBpZiAoYWQgJiYgYWQuaW5uZXJIVE1MLmxlbmd0aCA9PT0gMCB8fCBhZC5jbGllbnRIZWlnaHQgPT09IDApIHsKICAgICAgICAgIEFhay5hZGRTY3JpcHQoZnVuY3Rpb24gKCkgewogICAgICAgICAgZ2V0RWxlbWVudHNCeUNsYXNzTmFtZU5hdGl2ZSA9IEhUTUxEb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZTsKICAgICAgICAgIEhUTUxEb2N1bWVudC5wcm90b3R5cGUuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IGZ1bmN0aW9uIChjbGFzc05hbWUpIHsKICAgICAgICAgIGlmIChjbGFzc05hbWUgPT0gJ2Fmc19hZHMnKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oWydBbnRpQWRiS2lsbGVyJywgbG9jYXRpb24uaG9zdCwgJ0FkYmxvY2tCbG9ja2VyJywgY2xhc3NOYW1lXSk7CiAgICAgICAgICB2YXIgdW5pcWlkID0gRGF0ZS5ub3coKTsKICAgICAgICAgIHZhciBiYWl0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICBiYWl0LmlubmVySFRNTCA9ICc8YnI+JzsKICAgICAgICAgIGJhaXQuY2xhc3NOYW1lID0gdW5pcWlkOwogICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChiYWl0KTsKICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHVuaXFpZCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZ2V0RWxlbWVudHNCeUNsYXNzTmFtZU5hdGl2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfTsKICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgICovCgogICAgICAgICAgLy8gQWRidWRkeQogICAgICAgICAgaWYgKHR5cGVvZiBBYWsudXcuY2xvc2VBZGJ1ZGR5ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIEFhay51dy5jbG9zZUFkYnVkZHkoKTsKICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdBZGJ1ZGR5Jyk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQWRCbG9jayBBbGVydGVyIChXUCkKICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS93cC1wbHVnaW5zL2FkYmxvY2stYWxlcnRlcgogICAgICAgICAgLy8KICAgICAgICAgIGlmIChBYWsuZ2V0RWxlbWVudCgnZGl2LmFkYl9vdmVybGF5ID4gZGl2LmFkYl9tb2RhbF9pbWcnKSkgewogICAgICAgICAgICAvLyBSZW1vdmUgQWxlcnQgKyBBbGxvdyBTY3JvbGwKICAgICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoJ2Rpdi5hZGJfb3ZlcmxheScpOwogICAgICAgICAgICBBYWsuYWRkU3R5bGUoJ2h0bWwsYm9keSB7aGVpZ2h0OmF1dG87IG92ZXJmbG93OiBhdXRvO30nKTsKICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdBZEJsb2NrQWxlcnRlcicpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIFVua25vdyBBbnRpIEFkQmxvY2sgc3lzdGVtCiAgICAgICAgICBpZiAoQWFrLmdldEVsZW1lbnQoJyNibG9ja2RpdicpICYmIEFhay5jb250YWlucyhBYWsuZ2V0RWxlbWVudCgnI2Jsb2NrZGl2JykuaW5uZXJIVE1MLCAnZGlzYWJsZSBhZCBibG9ja2luZyBvciB1c2UgYW5vdGhlciBicm93c2VyIHdpdGhvdXQgYW55IGFkYmxvY2tlciB3aGVuIHlvdSB2aXNpdCcpKSB7CiAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KCcjYmxvY2tkaXYnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBbnRpYmxvY2sub3JnIHYyCiAgICAgICAgICAvLyBub3RlOiBkZXRlY3QgYW5kIHN0b3JlIGJsb2NrIGlkCiAgICAgICAgICAvLyBkZW1vOiBodHRwOi8vdGlueXVybC5jb20vbmh5aHB6awogICAgICAgICAgdmFyIHN0eWxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3N0eWxlJyk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0eWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgc3R5bGUgPSBzdHlsZXNbaV07CiAgICAgICAgICAgIHZhciBjc3NSdWxlcyA9IHN0eWxlLnNoZWV0LmNzc1J1bGVzOwogICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNzc1J1bGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgdmFyIGNzc1J1bGUgPSBjc3NSdWxlc1tqXTsKICAgICAgICAgICAgICB2YXIgY3NzVGV4dCA9IGNzc1J1bGUuY3NzVGV4dDsKICAgICAgICAgICAgICB2YXIgcGF0dGVybiA9IC9eIyhbYS16MC05XXs0LDEwfSkgfiBcKiBceyBkaXNwbGF5OiBub25lOyBcfS87CiAgICAgICAgICAgICAgaWYgKHBhdHRlcm4udGVzdChjc3NUZXh0KSkgewogICAgICAgICAgICAgICAgdmFyIGlkID0gcGF0dGVybi5leGVjKGNzc1RleHQpWzFdOwogICAgICAgICAgICAgICAgaWYgKEFhay5oYXNTY3JpcHQoIncuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIiArIGlkICsgIixmYWxzZSkiKSkgewogICAgICAgICAgICAgICAgICBBYWsuYWFicy5hYm8yID0gaWQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciB3aW4gPSBBYWsudXc7CiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIHdpbikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGlmICghL153ZWJraXQvLnRlc3QocHJvcCkgJiYgL15bYS16MC05XXs0LDEyfSQvaS50ZXN0KHByb3ApICYmIHdpbi5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiB0eXBlb2Ygd2luW3Byb3BdID09PSAnb2JqZWN0JykgewogICAgICAgICAgICAgICAgdmFyIG1ldGhvZCA9IHdpbltwcm9wXTsKCiAgICAgICAgICAgICAgICAvLyBBbnRpYmxvY2sub3JnIHYzICYgQmV0dGVyU3RvcEFkYmxvY2sKICAgICAgICAgICAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy84MzMKICAgICAgICAgICAgICAgIGlmIChtZXRob2QuZGVmZXJFeGVjdXRpb24gJiYKICAgICAgICAgICAgICAgICAgbWV0aG9kLmRpc3BsYXlNZXNzYWdlICYmCiAgICAgICAgICAgICAgICAgIG1ldGhvZC5nZXRFbGVtZW50QnkgJiYKICAgICAgICAgICAgICAgICAgbWV0aG9kLmdldFN0eWxlICYmCiAgICAgICAgICAgICAgICAgIG1ldGhvZC5pbnNlcnQgJiYKICAgICAgICAgICAgICAgICAgbWV0aG9kLm5leHRGdW5jdGlvbikgewogICAgICAgICAgICAgICAgICBpZiAobWV0aG9kLnRvZ2dsZSkgewogICAgICAgICAgICAgICAgICAgIEFhay5hYWJzLmJzYSA9IHByb3A7CiAgICAgICAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdCZXR0ZXJTdG9wQWRibG9ja3tkb219Jyk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgQWFrLmFhYnMuYWJvMyA9IHByb3A7CiAgICAgICAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdBbnRpYmxvY2sze2RvbX0nKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB3aW5bcHJvcF0gPSBudWxsOyAvLyBraWxsIGluc3RhbmNlCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQmxvY2tBZEJsb2NrCiAgICAgICAgICAgICAgICAvLyBzaXRlOiBibG9ja2FkYmxvY2suY29tCiAgICAgICAgICAgICAgICAvLyBub3RlOiByYW5kb20gaW5zdGFuY2UgbmFtZQogICAgICAgICAgICAgICAgLy8gc291cmNlOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9XYXRpbGluL2FmNzVlMGEyZTgyYTJlZmIzODRiZGU5YzdiNDFkZWM4CiAgICAgICAgICAgICAgICAvLyBpc3N1ZXM6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzP3E9bGFiZWwlM0FCbG9ja0FkQmxvY2sKICAgICAgICAgICAgICAgIGlmIChtZXRob2QuYmFiKSB7CiAgICAgICAgICAgICAgICAgIEFhay5kZXRlY3RlZCgnQmxvY2tBZEJsb2Nre2RvbX0nKTsKICAgICAgICAgICAgICAgICAgd2luW3Byb3BdID0gbnVsbDsgLy8ga2lsbCBpbnN0YW5jZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2Vycm9yJywgcHJvcCkKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIEFudGktQWRibG9ja2VycwogICAgICAgICAgdmFyIGFhYnMgPSB7CiAgICAgICAgICAgIC8vIFBsdWdpbnMgV29yZFByZXNzCiAgICAgICAgICAgIE5vQWRCbG9jayA6ICcoL3BsdWdpbnMvbm8tYWRibG9jay98L2Jsb2NrQmxvY2svYmxvY2tCbG9jay5qcXVlcnkuanMpJywKICAgICAgICAgICAgQmV0dGVyU3RvcEFkYmxvY2sgOiAnKC9wbHVnaW5zL2JldHRlci1zdG9wLWFkYmxvY2svfGJzYS1zY3JpcHQtZG9jdHlwZS5qc3xic2Etc2NyaXB0LW5vLWRvY3R5cGUuanMpJywKICAgICAgICAgICAgQWRCbG9ja0Jsb2NrZXIgOiAnL3BsdWdpbnMvd29yZHByZXNzLWFkYmxvY2stYmxvY2tlci8nLAogICAgICAgICAgICBBbnRpQmxvY2tCdWtzc2FBeW1hbiA6ICcvcGx1Z2lucy9hbnRpLWJsb2NrLycsCiAgICAgICAgICAgIEJsb2NrQWx5emVyIDogJy9wbHVnaW5zL2Jsb2NrYWx5emVyLWFkYmxvY2stY291bnRlci8nLAogICAgICAgICAgICBBZEJsb2NraW5nRGV0ZWN0b3IgOiAnL3BsdWdpbnMvYWQtYmxvY2tpbmctZGV0ZWN0b3IvJywKICAgICAgICAgICAgLy8gUGx1Z2lucyBXZWJzaXRlCiAgICAgICAgICAgIEFkd29ya21lZGlhIDogJyhhZHdvcmttZWRpYXxsb3h0a3xjb250ZW50bG9ja2luZ25ldHdvcmtzKS5jb20vZ0xvYWRlci5waHAnLAogICAgICAgICAgICBBZHNjZW5kbWVkaWEgOiAnYWRzY2VuZG1lZGlhLmNvbS9nd2pzLnBocCcsCiAgICAgICAgICAgIEZ1Y2tBZEJsb2NrIDogJygvZnVja2FkYmxvY2suanN8L2Jsb2NrYWRibG9jay5qcyknLAogICAgICAgICAgICBqUXVlcnlBZEJsb2NrIDogJy9qcXVlcnkuYWRibG9jay5qcycsCiAgICAgICAgICAgIGpRdWVyeUFkYmxvY2tEZXRlY3RvciA6ICcvanF1ZXJ5LmFkYmxvY2stZGV0ZWN0b3IuanMnLAogICAgICAgICAgICBBZEJsb2NrQWR2ZXJ0aXNlbWVudCA6ICcvYWR2ZXJ0aXNlbWVudC5qcycsCiAgICAgICAgICAgIEFkQmxvY2tBZHZlcnQgOiAnL2FkdmVydC5qcycsCiAgICAgICAgICAgIEFkQmxvY2tBZHZDdXN0b20gOiAnL2FkdmVydGlzZW1lbnQoLispLmpzJywKICAgICAgICAgICAgQWRCbG9ja0FkZnJhbWUgOiAnL2FkZnJhbWUuanMnLAogICAgICAgICAgICBBbnRpQWRCdXN0ZXIgOiAnL2FudGktYWQtYnVzdGVyLmpzJywKICAgICAgICAgICAgUlRLQW50aUFkYmxvY2sgOiAnL2Jsb2NrY2FrZS5qcycsCiAgICAgICAgICAgIEFkYmxvY2tEZXRlY3RvciA6ICcvQWRibG9ja0RldGVjdG9yL2hhbmRsZXIubWluLmpzJywKICAgICAgICAgICAgalF1ZXJ5QW50aUFkc0Jsb2NrIDogJy9qcXVlcnkuYW50aWFkc2Jsb2NrLmpzJywKICAgICAgICAgICAgQWRidWRkeSA6ICcvanMvYWRidWRkeS5taW4uanMnLAogICAgICAgICAgICBBbnRpQURzQmxvY2tlciA6ICcvYWFkYi9zY3JpcHQuanMnCiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBzY3JpcHRzID0gZG9jdW1lbnQuc2NyaXB0czsKICAgICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgc2NyaXB0cy5sZW5ndGg7IHkrKykgewogICAgICAgICAgICB2YXIgc2NyaXB0ID0gc2NyaXB0c1t5XTsKICAgICAgICAgICAgaWYgKHNjcmlwdC5zcmMpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYWFicykgewogICAgICAgICAgICAgICAgaWYgKG5ldyBSZWdFeHAoYWFic1trZXldLCAnaScpLnRlc3Qoc2NyaXB0LnNyYykpIHsKICAgICAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKFtrZXksIHNjcmlwdC5zcmNdKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgIH0sCiAgICAgICAgb25JbnNlcnQgOiBmdW5jdGlvbiAoaW5zZXJ0ZWROb2RlKSB7CgogICAgICAgICAgLy8gQWxsIE5vZGVzCiAgICAgICAgICBpZiAoQWFrLm9wdHMuaW5zZXJ0ZWQpIHsKICAgICAgICAgICAgaWYgKGluc2VydGVkTm9kZS5zcmMgfHwKICAgICAgICAgICAgICBpbnNlcnRlZE5vZGUuaWQgfHwKICAgICAgICAgICAgICBpbnNlcnRlZE5vZGUuY2xhc3NOYW1lICYmCiAgICAgICAgICAgICAgIS9maXJlYnVnLy50ZXN0KGluc2VydGVkTm9kZS5pbm5lckhUTUwpKSB7CiAgICAgICAgICAgICAgLy8gTm9kZSBpbnNlcnRlZAogICAgICAgICAgICAgIEFhay5sb2coaW5zZXJ0ZWROb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIE5vLUFkYmxvY2sgLSBodHRwOi8vd3d3Lm5vLWFkYmxvY2suY29tLwogICAgICAgICAgaWYgKGluc2VydGVkTm9kZS5pZCAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUuaWQubGVuZ3RoID09IDQgJiYKICAgICAgICAgICAgL15bYS16MC05XXs0fSQvLnRlc3QoaW5zZXJ0ZWROb2RlLmlkKSAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUubm9kZU5hbWUgPT0gJ0RJVicgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLmZpcnN0Q2hpbGQgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLmZpcnN0Q2hpbGQuaWQgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLmZpcnN0Q2hpbGQuaWQgPT0gaW5zZXJ0ZWROb2RlLmlkICYmCiAgICAgICAgICAgIEFhay5jb250YWlucyhpbnNlcnRlZE5vZGUuaW5uZXJIVE1MLCAnbm8tYWRibG9jay5jb20nKSkgewogICAgICAgICAgICAvLyBSZW1vdmUKICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdOby1BZGJsb2NrJywgZmFsc2UsIGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudChpbnNlcnRlZE5vZGUpOwogICAgICAgICAgICAvL0Fhay5sb2coaW5zZXJ0ZWROb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdG9wQWRibG9jayAtIGh0dHA6Ly9zdG9wYWRibG9jay5vcmcvZG93bmxvYWRzLwogICAgICAgICAgaWYgKGluc2VydGVkTm9kZS5pZCAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUuaWQubGVuZ3RoID09IDcgJiYKICAgICAgICAgICAgL15hW2EtejAtOV17Nn0kLy50ZXN0KGluc2VydGVkTm9kZS5pZCkgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5vZGVOYW1lID09ICdESVYnICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5wYXJlbnROb2RlICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5wYXJlbnROb2RlLmlkICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5wYXJlbnROb2RlLmlkID09IGluc2VydGVkTm9kZS5pZCArICcyJyAmJgogICAgICAgICAgICBBYWsuY29udGFpbnMoaW5zZXJ0ZWROb2RlLmlubmVySFRNTCwgJ3N0b3BhZGJsb2NrLm9yZycpKSB7CiAgICAgICAgICAgIC8vIFJlbW92ZQogICAgICAgICAgICBBYWsuZGV0ZWN0ZWQoJ1N0b3BBZEJsb2NrJywgZmFsc2UsIGxvY2F0aW9uLmhyZWYpOwogICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudChpbnNlcnRlZE5vZGUpOwogICAgICAgICAgICAvL0Fhay5sb2coaW5zZXJ0ZWROb2RlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBbnRpQWRibG9jayAoUGFja2VyKQogICAgICAgICAgdmFyIHJlSWZyYW1lSWQgPSAvXih6ZHx3ZCkkLzsKICAgICAgICAgIHZhciByZUltZ0lkID0gL14oeGR8Z2QpJC87CiAgICAgICAgICB2YXIgcmVJbWdTcmMgPSAvXC9hZHNcL2Jhbm5lci5qcGcvOwogICAgICAgICAgdmFyIHJlSWZyYW1lU3JjID0gLyhcL2FkaGFuZGxlclwvfFwvYWRpbWFnZXNcL3xhZC5odG1sKS87CgogICAgICAgICAgLy8gQ29tbXVucwogICAgICAgICAgaWYgKGluc2VydGVkTm9kZS5pZCAmJgogICAgICAgICAgICByZUltZ0lkLnRlc3QoaW5zZXJ0ZWROb2RlLmlkKSAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUubm9kZU5hbWUgPT0gJ0lNRycgJiYKICAgICAgICAgICAgcmVJbWdTcmMudGVzdChpbnNlcnRlZE5vZGUuc3JjKSB8fAogICAgICAgICAgICBpbnNlcnRlZE5vZGUuaWQgJiYKICAgICAgICAgICAgcmVJZnJhbWVJZC50ZXN0KGluc2VydGVkTm9kZS5pZCkgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5vZGVOYW1lID09ICdJRlJBTUUnICYmCiAgICAgICAgICAgIHJlSWZyYW1lU3JjLnRlc3QoaW5zZXJ0ZWROb2RlLnNyYykpIHsKCiAgICAgICAgICAgIC8vIFZhcmlhbnQgMQogICAgICAgICAgICBpZiAoaW5zZXJ0ZWROb2RlLmlkID09ICd4ZCcpIHsKICAgICAgICAgICAgICBBYWsuZGV0ZWN0ZWQoJ0FudGlBZGJsb2NrUGFja2VyWmR4ZCcsIGZhbHNlLCBsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgfSAvLyBWYXJpYW50IDIKICAgICAgICAgICAgZWxzZSBpZiAoaW5zZXJ0ZWROb2RlLmlkID09ICdnZCcpIHsKICAgICAgICAgICAgICBBYWsuZGV0ZWN0ZWQoJ0FudGlBZGJsb2NrUGFja2VyV2RnZCcsIGZhbHNlLCBsb2NhdGlvbi5ocmVmKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBSZW1vdmUKICAgICAgICAgICAgLy9BYWsubG9nKGluc2VydGVkTm9kZSk7CiAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KGluc2VydGVkTm9kZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gQWR1bmJsb2NrIC0gaHR0cDovL2FkdW5ibG9jay5jb20vCiAgICAgICAgICB2YXIgcmVJZCA9IC9eW2Etel17OH0kLzsKICAgICAgICAgIHZhciByZUNsYXNzID0gL15bYS16XXs4fSBbYS16XXs4fS87CiAgICAgICAgICB2YXIgcmVCZyA9IC9eW2Etel17OH0tYmckLzsKICAgICAgICAgIHZhciByZU1lc3NhZ2UgPSAvSWwgc2VtYmxlcmFpdCBxdWUgdm91cyB1dGlsaXNpZXogdW4gYmxvcXVldXIgZGUgcHVibGljaXTDqSAhLzsKCiAgICAgICAgICAvLyBDb21tdW5zCiAgICAgICAgICBpZiAodHlwZW9mIEFhay51dy52dGZhYiAhPSAndW5kZWZpbmVkJyAmJgogICAgICAgICAgICB0eXBlb2YgQWFrLnV3LmFkYmxvY2tfYW50aWIgIT0gJ3VuZGVmaW5lZCcgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLnBhcmVudE5vZGUgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLnBhcmVudE5vZGUubm9kZU5hbWUgPT0gJ0JPRFknICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5pZCAmJgogICAgICAgICAgICByZUlkLnRlc3QoaW5zZXJ0ZWROb2RlLmlkKSAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUubm9kZU5hbWUgPT0gJ0RJVicgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5uZXh0U2libGluZy5jbGFzc05hbWUgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nLm5vZGVOYW1lID09ICdESVYnKSB7CgogICAgICAgICAgICAvLyBGdWxsIFNjcmVlbiBNZXNzYWdlIChQcmVtaXVtKQogICAgICAgICAgICAvLyA8ZGl2IGlkPSJsZnloc3ZkcSIgY2xhc3M9InR2d25vcWRmIHN2b25leHJrIiBzdHlsZT0idG9wOiAxMDBweDsgb3BhY2l0eTogMTsgdmlzaWJpbGl0eTogdmlzaWJsZTsiPgogICAgICAgICAgICAvLyA8ZGl2IGNsYXNzPSJ0dndub3FkZi1iZyIgc3R5bGU9ImRpc3BsYXk6IGJsb2NrOyI+PC9kaXY+CiAgICAgICAgICAgIGlmIChpbnNlcnRlZE5vZGUuY2xhc3NOYW1lICYmCiAgICAgICAgICAgICAgcmVDbGFzcy50ZXN0KGluc2VydGVkTm9kZS5jbGFzc05hbWUpICYmCiAgICAgICAgICAgICAgcmVCZy50ZXN0KGluc2VydGVkTm9kZS5uZXh0U2libGluZy5jbGFzc05hbWUpICYmCiAgICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nLnN0eWxlICYmCiAgICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nLnN0eWxlLmRpc3BsYXkgIT0gJ25vbmUnKSB7CgogICAgICAgICAgICAgIC8vIFJlbW92ZSBNZXNzYWdlCiAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKCJBZFVuQmxvY2tQcmVtaXVtIik7CiAgICAgICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nKTsgLy8gb3ZlcmxheQogICAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KGluc2VydGVkTm9kZSk7IC8vIGJveAogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFRvcCBiYXIgTWVzc2FnZSAoRnJlZSkKICAgICAgICAgICAgLy8gPGRpdiBpZD0idml4bWdybHkiPgogICAgICAgICAgICAvLyA8ZGl2IGlkPSJtZm5oYWl5eCIgY2xhc3M9Imxrcm52Ynl0Ij4KICAgICAgICAgICAgZWxzZSBpZiAoaW5zZXJ0ZWROb2RlLm5leHRTaWJsaW5nLmlkICYmCiAgICAgICAgICAgICAgcmVJZC50ZXN0KGluc2VydGVkTm9kZS5uZXh0U2libGluZy5pZCkgJiYKICAgICAgICAgICAgICByZU1lc3NhZ2UudGVzdChpbnNlcnRlZE5vZGUuaW5uZXJIVE1MKSkgewoKICAgICAgICAgICAgICAvLyBSZW1vdmUgTWVzc2FnZQogICAgICAgICAgICAgIEFhay5kZXRlY3RlZCgiQWRVbkJsb2NrRnJlZSIpOwogICAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KGluc2VydGVkTm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBBbnRpYmxvY2sgLSBodHRwOi8vYW50aWJsb2NrLm9yZy8KICAgICAgICAgIHZhciByZU1zZ0lkID0gL15bYS16MC05XXs0LDEwfSQvaTsKICAgICAgICAgIHZhciByZVRhZzEgPSAvXihkaXZ8c3BhbnxifGl8Zm9udHxzdHJvbmd8Y2VudGVyKSQvaTsKICAgICAgICAgIHZhciByZVRhZzIgPSAvXihhfGJ8aXxzfHV8cXxwfHN0cm9uZ3xjZW50ZXIpJC9pOwogICAgICAgICAgdmFyIHJlV29yZHMxID0gL2FkIGJsb2NrZXJ8YWQgYmxvY2t8YWQtYmxvY2t8YWRibG9ja2VyfGFkLWJsb2NrZXJ8YWRibG9ja3xibG9xdWV1cnxibG9xdWVhZG9yfFdlcmJlYmxvY2tlcnxhZGJsb2NrZXJ0fCYjMTU3MDsmIzE1ODM7JiMxNTc2OyYjMTYwNDsmIzE2MDg7JiMxNjAzOyAmIzE1NzY7JiMxNjA0OyYjMTU4Nzt80LHQu9C+0LrQuNGA0L7QstGJ0LjQutC+0LwvaTsKICAgICAgICAgIHZhciByZVdvcmRzMiA9IC9rYXBhdHxkaXNhYmxlfGTDqXNhY3RpdmV6fGTDqXNhY3RpdmVyfGRlc2FjdGl2ZXp8ZGVzYWN0aXZlcnxkZXNhdGl2ZXxkZXNhY3RpdmFyfGRlc2FjdGl2ZXxkZXNhY3RpdmF8ZGVha3RpdmllcmV8ZGlzYWJpbGl0YXJlfCYjOTQ1OyYjOTYwOyYjOTQ5OyYjOTU3OyYjOTQ5OyYjOTYxOyYjOTQ3OyYjOTU5OyYjOTYwOyYjOTU5OyYjOTQzOyYjOTUxOyYjOTYzOyYjOTUxO3wmIzEwNzk7JiMxMDcyOyYjMTA4NzsmIzEwODg7JiMxMDc3OyYjMTA5NzsmIzEwNzI7JiMxMDkwOyYjMTEwMDt8w6FsbMOtdHNkIGxlfHB1YmxpY2l0w6lzfNGA0LXQutC70LDQvNC1fHZlcmhpbmRlcnR8YWR2ZXJ0fGthcGF0xLFuxLF6L2k7CgogICAgICAgICAgLy8gQW50aWJsb2NrLm9yZyAoYWxsIHZlcnNpb24pCiAgICAgICAgICBpZiAoaW5zZXJ0ZWROb2RlLnBhcmVudE5vZGUgJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLmlkICYmCiAgICAgICAgICAgIGluc2VydGVkTm9kZS5zdHlsZSAmJgogICAgICAgICAgICBpbnNlcnRlZE5vZGUuY2hpbGROb2Rlcy5sZW5ndGggJiYKICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLmZpcnN0Q2hpbGQgJiYKICAgICAgICAgICAgIWluc2VydGVkTm9kZS5maXJzdENoaWxkLmlkICYmCiAgICAgICAgICAgICFpbnNlcnRlZE5vZGUuZmlyc3RDaGlsZC5jbGFzc05hbWUgJiYKICAgICAgICAgICAgcmVNc2dJZC50ZXN0KGluc2VydGVkTm9kZS5pZCkgJiYKICAgICAgICAgICAgcmVUYWcxLnRlc3QoaW5zZXJ0ZWROb2RlLm5vZGVOYW1lKSAmJgogICAgICAgICAgICByZVRhZzIudGVzdChpbnNlcnRlZE5vZGUuZmlyc3RDaGlsZC5ub2RlTmFtZSkpIHsKICAgICAgICAgICAgLy9BYWsubG9nKGluc2VydGVkTm9kZSk7CgogICAgICAgICAgICAvLyBLaWxsIGF1ZGlvIG1lc3NhZ2UKICAgICAgICAgICAgdmFyIGF1ZGlvID0gaW5zZXJ0ZWROb2RlLnF1ZXJ5U2VsZWN0b3IoImF1ZGlvW2xvb3BdIik7CiAgICAgICAgICAgIGlmIChhdWRpbykgewogICAgICAgICAgICAgIGF1ZGlvLnBhdXNlKCk7CiAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdBbnRpYmxvY2t7YXVkaW99Jyk7CiAgICAgICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoYXVkaW8pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIEFudGlibG9jay5vcmcgdjIKICAgICAgICAgICAgLy8gZGVtbzogaHR0cDovL3Rpbnl1cmwuY29tL2gzbXd0YTQKICAgICAgICAgICAgZWxzZSBpZiAoKEFhay5hYWJzLmFibzIgJiYgaW5zZXJ0ZWROb2RlLmlkID09IEFhay5hYWJzLmFibzIpIHx8CiAgICAgICAgICAgICAgKGluc2VydGVkTm9kZS5maXJzdENoaWxkLmhhc0NoaWxkTm9kZXMoKSAmJiByZVdvcmRzMS50ZXN0KGluc2VydGVkTm9kZS5maXJzdENoaWxkLmlubmVySFRNTCkgJiYgcmVXb3JkczIudGVzdChpbnNlcnRlZE5vZGUuZmlyc3RDaGlsZC5pbm5lckhUTUwpKSkgewogICAgICAgICAgICAgIEFhay5kZXRlY3RlZCgnQW50aWJsb2NrMntpbnNlcnR9Jyk7CiAgICAgICAgICAgICAgQWFrLnJlbW92ZUVsZW1lbnQoaW5zZXJ0ZWROb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBBbnRpYmxvY2sub3JnIHYzCiAgICAgICAgICAgIC8vIGRlbW86IGh0dHA6Ly90aW55dXJsLmNvbS9xZWNmYTd3CiAgICAgICAgICAgIC8vIGNhc2U6IGh0dHA6Ly90aW55dXJsLmNvbS96YnJscjNhIC8qIGZvcmsgKi8KICAgICAgICAgICAgZWxzZSBpZiAoKEFhay5hYWJzLmFibzMgJiYgaW5zZXJ0ZWROb2RlLmlkID09IEFhay5hYWJzLmFibzMpIHx8CiAgICAgICAgICAgICAgKGluc2VydGVkTm9kZS5maXJzdENoaWxkLmhhc0NoaWxkTm9kZXMoKSAmJiBpbnNlcnRlZE5vZGUuZmlyc3RDaGlsZC5maXJzdENoaWxkLm5vZGVOYW1lID09ICdJTUcnICYmIC9eZGF0YTppbWFnZVwvcG5nO2Jhc2U2NC8udGVzdChpbnNlcnRlZE5vZGUuZmlyc3RDaGlsZC5maXJzdENoaWxkLnNyYykpKSB7CiAgICAgICAgICAgICAgQWFrLnV3W0Fhay5hYWJzLmFibzNdID0gbnVsbDsKICAgICAgICAgICAgICBBYWsuZGV0ZWN0ZWQoJ0FudGlibG9jazN7aW5zZXJ0fScpOwogICAgICAgICAgICAgIEFhay5yZW1vdmVFbGVtZW50KGluc2VydGVkTm9kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQmV0dGVyU3RvcEFkYmxvY2sKICAgICAgICAgICAgLy8gZGVtbzogaHR0cDovL3Rpbnl1cmwuY29tL2pzOXphdDQKICAgICAgICAgICAgLy8gc291cmNlOiBodHRwOi8vcGFzdGViaW4uY29tL1lpbWtydEtCCiAgICAgICAgICAgIC8vIGlzc3VlOiBodHRwOi8vdGlueXVybC5jb20vemV0Z2J0eAogICAgICAgICAgICBlbHNlIGlmIChBYWsuYWFicy5ic2EgJiYgaW5zZXJ0ZWROb2RlLmlkID09IEFhay5hYWJzLmJzYSkgewogICAgICAgICAgICAgIEFhay51d1tBYWsuYWFicy5ic2FdID0gbnVsbDsKICAgICAgICAgICAgICBBYWsuZGV0ZWN0ZWQoJ0JldHRlclN0b3BBZGJsb2Nre2luc2VydH0nKTsKICAgICAgICAgICAgICBBYWsucmVtb3ZlRWxlbWVudChpbnNlcnRlZE5vZGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICBNYW55IGZhbHNlIHBvc2l0aXZlCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vQWFrLnJlbW92ZUVsZW1lbnQoaW5zZXJ0ZWROb2RlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGJsb2NrRGV0ZWN0IDogZnVuY3Rpb24gKCkgewoKICAgICAgLy8gRXhjbHVkZSBkb21haW5zCiAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xNDY2CiAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy8xMjYzCiAgICAgIC8vIGlzc3VlOiBodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL2ZvcnVtL2Rpc2N1c3Npb24vODQyMi8KICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzk4NgogICAgICAvLyBpc3N1ZTogaHR0cHM6Ly9naXRodWIuY29tL3JlZWsvYW50aS1hZGJsb2NrLWtpbGxlci9pc3N1ZXMvODU3CiAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy82MTcKICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ3JlYXN5Zm9yay5vcmcvZnIvZm9ydW0vZGlzY3Vzc2lvbi81NDI2CiAgICAgIC8vIGlzc3VlOiBodHRwczovL2dpdGh1Yi5jb20vcmVlay9hbnRpLWFkYmxvY2sta2lsbGVyL2lzc3Vlcy80MTkKICAgICAgLy8gaXNzdWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9yZWVrL2FudGktYWRibG9jay1raWxsZXIvaXNzdWVzLzM3NwogICAgICB2YXIgZXhjbHVkZXMgPSBbIjM2MC5jbiIsICJhbWF6b24uIiwgImFwcGxlLmNvbSIsICJhc2suY29tIiwgImJhaWR1LmNvbSIsICJiaW5nLmNvbSIsICJidWZmZXJhcHAuY29tIiwgImNoYXRhbmdvLmNvbSIsICJjaHJvbWVhY3Rpb25zLmNvbSIsICJlYXN5aW5wbGF5Lm5ldCIsICJlYmF5LmNvbSIsICJmYWNlYm9vay5jb20iLCAiZmxhdHRyLmNvbSIsICJmbGlja3IuY29tIiwgImdoYWNrcy5uZXQiLCAiZ29vZ2xlLiIsICJpbWRiLmNvbSIsICJpbWdib3guY29tIiwgImltZ3VyLmNvbSIsICJpbnN0YWdyYW0uY29tIiwgImpzYmluLmNvbSIsICJqc2ZpZGRsZS5uZXQiLCAibGlua2VkaW4uY29tIiwgImxpdmUuY29tIiwgIm1haWwucnUiLCAibWljcm9zb2Z0LmNvbSIsICJtc24uY29tIiwgInBheXBhbC5jb20iLCAicGludGVyZXN0LmNvbSIsICJwcmVsb2FkZXJzLm5ldCIsICJxcS5jb20iLCAicmVkZGl0LmNvbSIsICJzdGFja292ZXJmbG93LmNvbSIsICJ0YW1wZXJtb25rZXkubmV0IiwgInR3aXR0ZXIuY29tIiwgInZpbWVvLmNvbSIsICJ3aWtpcGVkaWEub3JnIiwgInczc2Nob29scy5jb20iLCAieWFob28uIiwgInlhbmRleC5ydSIsICJ5b3V0dS5iZSIsICJ5b3V0dWJlLmNvbSIsICJ4ZW12dHYubmV0IiwgInZvZC5wbCIsICJhZ2FyLmlvIiwgInBhbmRvb24uaW5mbyIsICJmc2Yub3JnIiwgImFkYmxvY2twbHVzLm9yZyIsICJwbG5rci5jbyIsICJleGFjdHRhcmdldC5jb20iLCAiZG9sbGRpdmluZS5jb20iLCAicG9wbWVjaC5ydSIsICJjYWxtLmNvbSJdOwogICAgICB2YXIgaG9zdCA9IGxvY2F0aW9uLmhvc3Q7CiAgICAgIHZhciBleGNsdWRlZCA9IGZhbHNlOwogICAgICBleGNsdWRlcy5mb3JFYWNoKGZ1bmN0aW9uIChleGNsdWRlKSB7CiAgICAgICAgaWYgKG5ldyBSZWdFeHAoZXhjbHVkZSkudGVzdChob3N0KSkgewogICAgICAgICAgZXhjbHVkZWQgPSB0cnVlOwogICAgICAgICAgaWYgKEFhay5vcHRzLmxvZ0V4Y2x1ZGVkKSB7CiAgICAgICAgICAgIEFhay53YXJuKCdFeGNsdWRlZCcpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyBJbmNsdWRlIGRvbWFpbnMKICAgICAgLy8gSXNFdmVudHVwcG9ydGVkOiBodHRwOi8vdGlueXVybC5jb20vb2VlejhjNwogICAgICBpZiAoIWV4Y2x1ZGVkKSB7CgogICAgICAgIHZhciBoYW5kbGVyRXZlbnRzID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgdmFyIHJ1bGUgPSBBYWsucnVsZXNbbmFtZV07CgogICAgICAgICAgcnVsZS5ob3N0LmZvckVhY2goZnVuY3Rpb24gKGhvc3QpIHsKICAgICAgICAgICAgLy8gQ2hlY2sgaG9zdAogICAgICAgICAgICBpZiAobmV3IFJlZ0V4cChob3N0KS50ZXN0KGxvY2F0aW9uLmhvc3QpKSB7CgogICAgICAgICAgICAgIC8vIE5hdGl2ZSBtb2RlCiAgICAgICAgICAgICAgaWYgKCFBYWsudXNlR00gJiYgQWFrLmlzVG9wZnJhbWUpIHsKICAgICAgICAgICAgICAgIEFhay53YXJuKCdSdW4gbmF0aXZlbHkuJyk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAvLyBMb2cgcnVsZSB1c2VkCiAgICAgICAgICAgICAgaWYgKHJ1bGUuaG9zdFswXSAhPSAnLio/JykgewogICAgICAgICAgICAgICAgQWFrLmRldGVjdGVkKCdydWxlJywgcnVsZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIAogICAgICAgICAgICAgIC8vIEJlZm9yZSBET00gbG9hZAogICAgICAgICAgICAgIGlmIChydWxlLm9uU3RhcnQpIHsKICAgICAgICAgICAgICAgIHJ1bGUub25TdGFydCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyBPbiBhbGwgc3RhdGVtZW50cwogICAgICAgICAgICAgIGlmIChydWxlLm9uQWx3YXlzKSB7CiAgICAgICAgICAgICAgICBydWxlLm9uQWx3YXlzKCk7IC8vIHN0YXJ0CiAgICAgICAgICAgICAgICBBYWsub25FdmVudCh3aW5kb3csICdET01Db250ZW50TG9hZGVkJywgcnVsZS5vbkFsd2F5cyk7IC8vIGlkbGUKICAgICAgICAgICAgICAgIEFhay5vbkV2ZW50KHdpbmRvdywgJ2xvYWQnLCBydWxlLm9uQWx3YXlzKTsgLy8gZW5kCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIEJlZm9yZSBTY3JpcHQgRXhlY3V0ZWQKICAgICAgICAgICAgICBpZiAocnVsZS5vbkJlZm9yZVNjcmlwdCkgewoKICAgICAgICAgICAgICAgIC8vIG9wdGlvbnM6IGNvbnRhaW5zLCBzZWFyY2gsIHJlcGxhY2UsIG92ZXJyaWRlLCByZW1vdmUsIGV4dGVybmFsCiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uc0JlZm9yZVNjcmlwdCA9IHJ1bGUub25CZWZvcmVTY3JpcHQoKTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9uc0JlZm9yZVNjcmlwdCA9PSAib2JqZWN0IikgewoKICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZXJCZWZvcmVTY3JpcHQgPSBmdW5jdGlvbiAoZSwgb3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0V2ZW50ID0gZSBpbnN0YW5jZW9mIHdpbmRvdy5FdmVudDsKICAgICAgICAgICAgICAgICAgICB2YXIgdGhpc1NjcmlwdCA9IChlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQpIHx8IGU7CgogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobykgeyAvLyBoYXNBdHRyaWJ1dGUKICAgICAgICAgICAgICAgICAgICAgIHZhciBzcmMgPSBvLmV4dGVybmFsID8gJ3NyYycgOiAnaW5uZXJIVE1MJzsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWFyY2ggPSBuZXcgUmVnRXhwKG8uY29udGFpbnMsIG8uZmxhZ3MgfHwgJycpOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzU2NyaXB0W3NyY10gJiYgdGhpc1NjcmlwdFtzcmNdLmxlbmd0aCAmJiBzZWFyY2gudGVzdCh0aGlzU2NyaXB0W3NyY10pKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIHNjcmlwdCBleGVjdXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIG5ldyBzY3JpcHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXNTY3JpcHQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1NjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBhIHBhcnQgb2YgdGhlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5yZXBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0W3NyY10gPSB0aGlzU2NyaXB0W3NyY10ucmVwbGFjZShzZWFyY2gsIG8ucmVwbGFjZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJlcGxhY2VDaGlsZChuZXdTY3JpcHQsIHRoaXNTY3JpcHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9IC8vIE92ZXJyaWRlIHNjcmlwdAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChvLm92ZXJyaWRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NyaXB0W3NyY10gPSBvLm92ZXJyaWRlOwogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5yZXBsYWNlQ2hpbGQobmV3U2NyaXB0LCB0aGlzU2NyaXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSAvLyBSZW1vdmUgc2NyaXB0CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG8ucmVtb3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXNTY3JpcHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAoby5kZXRlY3RlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIEFhay5kZXRlY3RlZChvLmRldGVjdGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQkJCQkJCQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFhay5vcHRzLmxvZ0ludGVyY2VwdGVkU2NyaXB0cykgewogICAgICAgICAgICAgICAgICAgICAgICAgIEFhay5sb2coc3JjLCBvLCB0aGlzU2NyaXB0LCBuZXdTY3JpcHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICAvLyBCcm93c2VyIHN1cHBvcnRpbmcgZXZlbnQgYmVmb3Jlc2NyaXB0ZXhlY3V0ZQogICAgICAgICAgICAgICAgICBpZiAoJ29uYmVmb3Jlc2NyaXB0ZXhlY3V0ZScgaW4gZG9jdW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICBBYWsub25FdmVudCh3aW5kb3csICdiZWZvcmVzY3JpcHRleGVjdXRlJywgZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXJCZWZvcmVTY3JpcHQoZSwgb3B0aW9uc0JlZm9yZVNjcmlwdCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIEJyb3dzZXIgbm90IHN1cHBvdGluZyBiZWZvcmVzY3JpcHRleGVjdXRlCgogICAgICAgICAgICAgICAgICAgIHZhciBsb2FkRG9jdW1lbnQgPSBmdW5jdGlvbiAob3B0aW9uc0JlZm9yZVNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgICAgLy9pZiAoZG9jdW1lbnQucmVmZXJyZXIgPT09ICcnKQogICAgICAgICAgICAgICAgICAgICAgLy9yZXR1cm47CgogICAgICAgICAgICAgICAgICAgICAgQWFrLndhcm4oJ29uYmVmb3Jlc2NyaXB0LWNvbXBhdGlibGUnKTsKCiAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9wIGxvYWRpbmcKICAgICAgICAgICAgICAgICAgICAgIEFhay5hZGRTY3JpcHQoJ3dpbmRvdy5zdG9wKCk7Jyk7IC8vIGNocm9tZS9vcGVyYQogICAgICAgICAgICAgICAgICAgICAgLy9BYWsuYWRkU2NyaXB0KCdkb2N1bWVudC5vcGVuKCk7Jyk7IC8vIGZpcmVmb3gKCiAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY29udGVudAogICAgICAgICAgICAgICAgICAgICAgQWFrLnJlcXVlc3QoewogICAgICAgICAgICAgICAgICAgICAgICB1cmwgOiBsb2NhdGlvbi5ocmVmLAogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzIDogewogICAgICAgICAgICAgICAgICAgICAgICAgICJSZWZlcmVyIiA6IGRvY3VtZW50LnJlZmVycmVyCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIG9ubG9hZCA6IGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IHJlc3VsdC5yZXNwb25zZVRleHQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnNlciA9IG5ldyB3aW5kb3cuRE9NUGFyc2VyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoaHRtbCwgInRleHQvaHRtbCIpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JpcHRzID0gZG9jLnNjcmlwdHM7CgogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRoaXNTY3JpcHQgPSBzY3JpcHRzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxlckJlZm9yZVNjcmlwdCh0aGlzU2NyaXB0LCBvcHRpb25zQmVmb3JlU2NyaXB0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbCA9IGRvYy5kb2N1bWVudEVsZW1lbnQub3V0ZXJIVE1MOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXcml0ZSBuZXcgY29udGVudCB0byBIVE1MIGRvY3VtZW50OgogICAgICAgICAgICAgICAgICAgICAgICAgIEFhay5hZGRTY3JpcHQoJ2RvY3VtZW50Lm9wZW4oKTsgZG9jdW1lbnQud3JpdGUodW5lc2NhcGUoIicgKyB3aW5kb3cuZXNjYXBlKGh0bWwpICsgJyIpKTsgZG9jdW1lbnQuY2xvc2UoKTsnKTsgLy8gY2hyb21lL29wZXJhCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BYWsuYWRkU2NyaXB0KCdkb2N1bWVudC53cml0ZSh1bmVzY2FwZSgiJyArIGVzY2FwZShodG1sKSArICciKSk7IGRvY3VtZW50LmNsb3NlKCk7Jyk7IC8vIGZpcmVmb3gKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICBsb2FkRG9jdW1lbnQob3B0aW9uc0JlZm9yZVNjcmlwdCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IC8vIEFmdGVyIFNjcmlwdCBFeGVjdXRlZAogICAgICAgICAgICAgIGlmIChydWxlLm9uQWZ0ZXJTY3JpcHQpIHsKICAgICAgICAgICAgICAgIGlmICgnb25hZnRlcnNjcmlwdGV4ZWN1dGUnIGluIGRvY3VtZW50KSB7IC8vIE1vemlsbGEgRmlyZWZveAogICAgICAgICAgICAgICAgICBBYWsub25FdmVudCh3aW5kb3csICdhZnRlcnNjcmlwdGV4ZWN1dGUnLCBydWxlLm9uQWZ0ZXJTY3JpcHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyBXaGVuIERPTSBMb2FkCiAgICAgICAgICAgICAgaWYgKHJ1bGUub25JZGxlKSB7CiAgICAgICAgICAgICAgICBpZiAoIUFhay51c2VHTSkgeyAvLyBOYXRpdmUgbW9kZQogICAgICAgICAgICAgICAgICBydWxlLm9uSWRsZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy9BYWsub25FdmVudCh3aW5kb3csICdET01Db250ZW50TG9hZGVkJywgcnVsZS5vbklkbGUpOwogICAgICAgICAgICAgICAgICBBYWsub25FdmVudCh3aW5kb3csICdET01Db250ZW50TG9hZGVkJywgcnVsZS5vbklkbGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyBXaGVuIFdpbmRvdyBMb2FkCiAgICAgICAgICAgICAgaWYgKHJ1bGUub25FbmQpIHsKICAgICAgICAgICAgICAgIGlmICghQWFrLnVzZUdNKSB7IC8vIE5hdGl2ZSBtb2RlCiAgICAgICAgICAgICAgICAgIHJ1bGUub25FbmQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIEFhay5vbkV2ZW50KHdpbmRvdywgJ2xvYWQnLCBydWxlLm9uRW5kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gV2hlbiBET00gQXR0ck1vZGlmaWVkCiAgICAgICAgICAgICAgaWYgKHJ1bGUub25BdHRyTW9kaWZpZWQpIHsKICAgICAgICAgICAgICAgIEFhay5vbkV2ZW50KHdpbmRvdywgJ0RPTUF0dHJNb2RpZmllZCcsIHJ1bGUub25BdHRyTW9kaWZpZWQsIGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gV2hlbiBET00gU3VidHJlZU1vZGlmaWVkCiAgICAgICAgICAgICAgaWYgKHJ1bGUub25TdWJ0cmVlTW9kaWZpZWQpIHsKICAgICAgICAgICAgICAgIEFhay5vbkV2ZW50KHdpbmRvdywgJ0RPTVN1YnRyZWVNb2RpZmllZCcsIHJ1bGUub25TdWJ0cmVlTW9kaWZpZWQsIGZhbHNlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gV2hlbiBET00gRWxlbWVudHMgYXJlIEluc2VydGVkIGluIERvY3VtZW50CiAgICAgICAgICAgICAgaWYgKHJ1bGUub25JbnNlcnQpIHsKCiAgICAgICAgICAgICAgICAvLyBNdXRhdGlvbiBPYnNlcnZlcgogICAgICAgICAgICAgICAgLy8gZG9jOiBodHRwOi8vdGlueXVybC5jb20vbXh4emVlNAogICAgICAgICAgICAgICAgLy8gc3VwcG9ydDogaHR0cDovL3Rpbnl1cmwuY29tL25lcG43dnkKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgIT0gJ3VuZGVmaW5lZCcgfHwKICAgICAgICAgICAgICAgICAgdHlwZW9mIFdlYktpdE11dGF0aW9uT2JzZXJ2ZXIgIT0gJ3VuZGVmaW5lZCcpIHsKCiAgICAgICAgICAgICAgICAgIC8vIE11dGF0aW9uIE9ic2VydmVyCiAgICAgICAgICAgICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyMSA9IHdpbmRvdy5NdXRhdGlvbk9ic2VydmVyIHx8IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwoKICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlCiAgICAgICAgICAgICAgICAgIHZhciBvYnMxID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIxKGZ1bmN0aW9uIChtdXRhdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgIC8vIFdlIGNhbiBzYWZlbHkgdXNlIGBmb3JFYWNoYCBiZWNhdXNlIHdlIGFscmVhZHkgdXNlIG11dGF0aW9uCiAgICAgICAgICAgICAgICAgICAgICAvLyBvYnNlcnZlcnMgdGhhdCBhcmUgbW9yZSByZWNlbnQgdGhhbiBgZm9yRWFjaGAuIChzb3VyY2U6IE1ETikKICAgICAgICAgICAgICAgICAgICAgIG11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChtdXRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSB3YW50IG9ubHkgYWRkZWQgbm9kZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChtdXRhdGlvbi5hZGRlZE5vZGVzLCBmdW5jdGlvbiAoYWRkZWROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQWFrLm9wdHMubG9nSW5zZXJ0ZWROb2RlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBYWsubG9nKGFkZGVkTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydWxlLm9uSW5zZXJ0KGFkZGVkTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAvLyBPYnNlcnZlcgogICAgICAgICAgICAgICAgICBvYnMxLm9ic2VydmUoZG9jdW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZExpc3QgOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIHN1YnRyZWUgOiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gTXV0YXRpb24gRXZlbnRzIChBbHRlcm5hdGl2ZSBTb2x1dGlvbikKICAgICAgICAgICAgICAgIC8vIGRvYzogaHR0cDovL3Rpbnl1cmwuY29tL29wOTVyZnkKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBBYWsub25FdmVudCh3aW5kb3csICJET01Ob2RlSW5zZXJ0ZWQiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChBYWsub3B0cy5sb2dJbnNlcnRlZE5vZGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICBBYWsubG9nKGUudGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcnVsZS5vbkluc2VydChlLnRhcmdldCk7CiAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gV2hlbiBET00gRWxlbWVudHMgYXJlIFJlbW92ZWQgaW4gRG9jdW1lbnQKICAgICAgICAgICAgICBpZiAocnVsZS5vblJlbW92ZSkgewoKICAgICAgICAgICAgICAgIC8vIE11dGF0aW9uIE9ic2VydmVyCiAgICAgICAgICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9teHh6ZWU0CiAgICAgICAgICAgICAgICAvLyBzdXBwb3J0OiBodHRwOi8vdGlueXVybC5jb20vbmVwbjd2eQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciAhPSAndW5kZWZpbmVkJyB8fAogICAgICAgICAgICAgICAgICB0eXBlb2YgV2ViS2l0TXV0YXRpb25PYnNlcnZlciAhPSAndW5kZWZpbmVkJykgewoKICAgICAgICAgICAgICAgICAgLy8gTXV0YXRpb24gT2JzZXJ2ZXIKICAgICAgICAgICAgICAgICAgdmFyIE11dGF0aW9uT2JzZXJ2ZXIyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CgogICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYW4gb2JzZXJ2ZXIgaW5zdGFuY2UKICAgICAgICAgICAgICAgICAgdmFyIG9iczIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcjIoZnVuY3Rpb24gKG11dGF0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgLy8gV2UgY2FuIHNhZmVseSB1c2UgYGZvckVhY2hgIGJlY2F1c2Ugd2UgYWxyZWFkeSB1c2UgbXV0YXRpb24KICAgICAgICAgICAgICAgICAgICAgIC8vIG9ic2VydmVycyB0aGF0IGFyZSBtb3JlIHJlY2VudCB0aGFuIGBmb3JFYWNoYC4gKHNvdXJjZTogTUROKQogICAgICAgICAgICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHdhbnQgb25seSByZW1vdmVkIG5vZGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtdXRhdGlvbi5yZW1vdmVkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChtdXRhdGlvbi5yZW1vdmVkTm9kZXMsIGZ1bmN0aW9uIChyZW1vdmVkTm9kZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFhay5vcHRzLmxvZ1JlbW92ZWROb2RlcykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBYWsubG9nKHJlbW92ZWROb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJ1bGUub25SZW1vdmUocmVtb3ZlZE5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZXIKICAgICAgICAgICAgICAgICAgb2JzMi5vYnNlcnZlKGRvY3VtZW50LCB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBzdWJ0cmVlIDogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIE11dGF0aW9uIEV2ZW50cyAoQWx0ZXJuYXRpdmUgU29sdXRpb24pCiAgICAgICAgICAgICAgICAvLyBkb2M6IGh0dHA6Ly90aW55dXJsLmNvbS9vcDk1cmZ5CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgQWFrLm9uRXZlbnQod2luZG93LCAiRE9NTm9kZVJlbW92ZWQiLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChBYWsub3B0cy5sb2dSZW1vdmVkTm9kZXMpIHsKICAgICAgICAgICAgICAgICAgICAgIEFhay5sb2coZS50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBydWxlLm9uUmVtb3ZlKGUudGFyZ2V0KTsKICAgICAgICAgICAgICAgICAgfSwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAKICAgICAgICAgICAgICAvLyBBYWsgRXZlbnRzCiAgICAgICAgICAgICAgQWFrLm9uRXZlbnQod2luZG93LCAnZGV0ZWN0ZWQnLCBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgQWFrLmluZm8oWydBbnRpQWRiS2lsbGVyJywgQWFrLmlzVG9wZnJhbWUgPyAndG9wZnJhbWUnIDogJ3N1YmZyYW1lJywgbG9jYXRpb24uaG9zdCwgZS5kZXRhaWxdKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgLy8gQXBwbHkgcnVsZXMKICAgICAgICBmb3IgKHZhciBuYW1lIGluIEFhay5ydWxlcykgewogICAgICAgICAgaWYgKEFhay5ydWxlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICAgICAgICBoYW5kbGVyRXZlbnRzKEFhaywgbmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgQWFrLmluaXRpYWxpemUoKTsKCn0pKHdpbmRvdyk7"},{"name":"YouTube +","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":["*://www.youtube.com/tv*","*://www.youtube.com/embed/*","*://www.youtube.com/live_chat*"],"orig_includes":[],"orig_matches":["*://www.youtube.com/*"],"orig_noframes":true,"orig_run_at":"document-start","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"data":{"particleSettings":"s{\"GEN_BTTR_NTF\":true,\"GEN_SUB_LIST\":true,\"GEN_INF_SCRL\":true,\"GEN_BLUE_GLOW\":true,\"GEN_PPOT_ON\":true,\"VID_END_SHRE\":true,\"VID_DFLT_QLTY\":\"hd1080\",\"VID_PLST_ATPL\":true,\"VID_PLST_RVRS\":true,\"VID_PLR_ATPL\":true,\"VID_PLR_ALVIS\":true,\"VID_PLR_SIZE_MEM\":true,\"VID_PLR_VOL_LDN\":true,\"VID_POST_TIME\":true,\"VID_VID_CNT\":true,\"VID_DESC_SHRT\":true,\"VID_PPOT_SZ\":false,\"VID_PLR_HTML5\":true,\"BLK_ON\":true,\"floaterX\":2000,\"floaterY\":2000,\"firstTime\":false,\"volLev\":50,\"advOpts\":true,\"blacklist\":{},\"extLang\":{\"zh_CN\":{\"YTSETS\":\"YouTube+ 设置\",\"ADV_OPTS\":\"高级选项\",\"SUB_PLST\":\"播放最新上传的内容\",\"BLCK_ADD\":\"添加到黑名单\",\"BLCK_EDIT\":\"编辑\",\"BLCK_SAVE\":\"保存\",\"BLCK_CLSE\":\"关闭\",\"CNSL_AP\":\"自动播放\",\"CNSL_RPT\":\"再次播放视频\",\"CNSL_SVTH\":\"打开缩略图\",\"CNSL_SS\":\"屏幕截图\",\"CNSL_SS_CLS\":\"关闭\",\"CNSL_FLBR\":\"网页全屏模式\",\"CNSL_CINM_MD\":\"影院模式\",\"CNSL_FRME\":\"逐帧\",\"PLST_AP\":\"自动播放\",\"PLST_RVRS\":\"倒序排列\",\"SHOW_CMTS\":\"显示评论\",\"HIDE_CMTS\":\"隐藏评论\",\"GLB_IMPR\":\"导入/导出设置\",\"GLB_LOCL_LANG\":\"点击以设置 YT+ 语言\",\"GLB_LOCL_LANG_CSTM\":\"本地化\",\"GLB_IMPR_SAVE\":\"保存和加载\",\"GLB_RSET\":\"重置\",\"GLB_SVE\":\"保存\",\"GLB_SVE_SETS\":\"设置已保存\",\"FTR_DESC\":\"这是什么\",\"GEN\":\"一般\",\"VID\":\"视频\",\"CHN\":\"频道\",\"BLK\":\"黑名单\",\"ABT\":\"关于\",\"HLP\":\"帮助\",\"DNT\":\"捐赠\",\"GEN_TTL\":\"通用设置\",\"GEN_GEN\":\"常规\",\"GEN_LYT\":\"布局\",\"GEN_LOCL_LANG\":\"使用更改过的 YT+ 语言\",\"GEN_DSBL_ADS\":\"禁止视频页面以外的广告\",\"GEN_INF_SCRL\":\"在信息源列表启用无限滚动\",\"GEN_YT_LOGO_LINK\":\"将YouTube标志重定向到订阅\",\"GEN_SUB_LIST\":\"启用播放列表订阅\",\"GEN_REM_APUN\":\"删除自动播放下一个\",\"GEN_SPF_OFF\":\"禁用SPF\",\"GEN_HIDE_FTR\":\"隐藏页脚\",\"GEN_BLUE_GLOW\":\"删除点击过的按钮周围的蓝色光圈\",\"GEN_HDE_RECM_SDBR\":\"隐藏推荐频道侧边栏\",\"GEN_HDE_SRCH_SDBR\":\"隐藏搜索结果侧边栏\",\"GEN_HDE_CHN_SDBR\":\"隐藏频道侧边栏\",\"GEN_CMPT_TTLS\":\"在信息源中使用紧凑型标题\",\"GEN_DSB_HVRC\":\"禁用悬停卡片\",\"GEN_BTTR_NTF\":\"改进的蓝色通知框\",\"GEN_GRID_SUBS\":\"在订阅中使用网格布局\",\"GEN_GRID_SRCH\":\"在搜索结果中使用网格布局\",\"VID_TTL\":\"视频设置\",\"VID_PLR\":\"播放器设置\",\"VID_PLR_LYT\":\"播放器布局\",\"VID_DFLT_QLTY\":\"默认视频质量：\",\"VID_DFLT_QLTY_AUTO\":\"自动\",\"VID_DFLT_QLTY_TNY\":\"144p\",\"VID_DFLT_QLTY_SML\":\"240p\",\"VID_DFLT_QLTY_MDM\":\"360p\",\"VID_DFLT_QLTY_LRG\":\"480p\",\"VID_DFLT_QLTY_720\":\"720p\",\"VID_DFLT_QLTY_1080\":\"1080p\",\"VID_DFLT_QLTY_1440\":\"1440p\",\"VID_DFLT_QLTY_2160\":\"2160p (4k)\",\"VID_DFLT_QLTY_2880\":\"2880p (5k)\",\"VID_DFLT_QLTY_ORIG\":\"4320p (8k)\",\"VID_PLR_ALVIS\":\"阅读评论时保持播放器可见\",\"VID_PLR_ALVIS_RST\":\"重设位置\",\"VID_PLR_ALVIS_SCRL_TOP\":\"返回顶部\",\"VID_PLR_ATPL\":\"自动播放视频\",\"VID_LAYT\":\"布局\",\"VID_VID_CNT\":\"显示指向已上传视频数的链\",\"VID_POST_TIME\":\"显示视频已发布时间\",\"VID_HIDE_DETLS\":\"隐藏视频详细信息\",\"VID_HIDE_COMS\":\"评论区\",\"VID_HIDE_COMS_SHOW\":\"显示\",\"VID_HIDE_COMS_HIDE\":\"隐藏\",\"VID_HIDE_COMS_REM\":\"删除\",\"VID_END_SHRE\":\"视频结束时禁用分享面板\",\"VID_PLST\":\"播放列表\",\"VID_PLST_ATPL\":\"启用播放列表自动播放按钮\",\"VID_PLST_RVRS\":\"启用播放列表倒序排列按钮\",\"VID_PLR_SIZE_MEM\":\"记住播放模式\",\"VID_VOL_WHEEL\":\"使用鼠标滚轮改变音量\",\"VID_PLR_VOL_MEM\":\"记住音量\",\"VID_PLR_ADS\":\"在视频页面禁用广告\",\"VID_PLR_ALACT\":\"播放器快捷方式始终处于活动状态\",\"VID_SUB_ADS\":\"仅在订阅频道的视频中启用广告\",\"VID_PLR_ANTS\":\"禁用注释\",\"VID_PLR_DASH\":\"禁用回放\",\"VID_PLR_HFR\":\"禁用HFR (60fps)\",\"VID_PLR_HTML5\":\"在可能时使用HTML 5播放器\",\"VID_PLR_CC\":\"禁用字幕和CC\",\"VID_PLR_INFO\":\"启用稍后观看按钮\",\"VID_PLR_FIT\":\"适应页面为剧场模式\",\"VID_PLR_FIT_WDTH\":\"适应页面为最大宽度:\",\"VID_PLR_DYN_SIZE\":\"在默认视图禁用播放器动态尺寸调节\",\"VID_DESC_SHRT\":\"短视频描述按钮\",\"VID_TTL_CMPT\":\"在视频描述页折叠标题\",\"VID_LAYT_AUTO_PNL\":\"自动展开视频描述\",\"GEN_CHN_DFLT_PAGE\":\"默认的频道页面:\",\"GEN_CHN_DFLT_PAGE_DFLT\":\"默认\",\"GEN_CHN_DFLT_PAGE_VID\":\"视频\",\"GEN_CHN_DFLT_PAGE_PL\":\"播放列表\",\"GEN_CHN_DFLT_PAGE_CHN\":\"频道\",\"GEN_CHN_DFLT_PAGE_DISC\":\"讨论\",\"GEN_CHN_DFLT_PAGE_ABT\":\"关于\",\"BLK_TTL\":\"黑名单设置\",\"BLK_BLK\":\"黑名单\",\"BLK_ON\":\"启用黑名单\",\"ABT_TTL\":\"信息和有用的链接\",\"ABT_THKS\":\"鸣谢:\",\"ABT_THKS_YEPPHA\":\"，他们的工作给此项目带来了灵感，没有他们今天这些都不会存在。\",\"ABT_THKS_USERSCRIPT\":\" 使开发和发行第三方软件的任务无比简单。\",\"ABT_THKS_STACKOV\":\" 无价的信息对软件开发做出了巨大贡献。\",\"ABT_INFO\":\"官方页面\",\"ABT_LNK_GHB\":\"GitHub\",\"ABT_LNK_GRFK\":\"Greasy Fork\",\"ABT_LNK_OPNU\":\"OpenUserJS\",\"WLCM\":\"感谢您安装YouTube+\",\"WLCMSTRT\":\"您可以通过点击上面的按钮来自定义您的设置\",\"LOCALE\":\"中文 (简体)\",\"lastMod\":1475001746000},\"nextCheck\":1475832777552},\"GEN_HDE_CHN_SDBR\":false,\"GEN_HDE_SRCH_SDBR\":false,\"GEN_HDE_RECM_SDBR\":false,\"GEN_HIDE_FTR\":false,\"GEN_CMPT_TTLS\":false,\"GEN_DSB_HVRC\":false,\"GEN_GRID_SRCH\":false,\"GEN_GRID_SUBS\":false,\"GEN_CHN_DFLT_PAGE\":\"default\",\"GEN_SPF_OFF\":false,\"GEN_REM_APUN\":false,\"GEN_YT_LOGO_LINK\":false,\"GEN_DSBL_ADS\":false,\"GEN_LOCL_LANG\":false,\"VID_LAYT_AUTO_PNL\":false,\"VID_HIDE_DETLS\":false,\"VID_TTL_CMPT\":false,\"VID_HIDE_COMS\":\"0\",\"VID_PLR_FIT_WDTH\":false,\"VID_PLR_FIT\":false,\"VID_PLR_DYN_SIZE\":false,\"VID_PLR_INFO\":false,\"VID_PLR_HFR\":false,\"VID_VOL_WHEEL\":true,\"VID_PLR_ALACT\":false,\"VID_PLR_VOL_MEM\":false,\"VID_PLR_ANTS\":false,\"VID_PLR_CC\":false,\"VID_PLR_ALVIS_WDTH\":false,\"VID_SUB_ADS\":false,\"VID_PLR_ADS\":true,\"lightsOut\":false,\"theaterMode\":false}"},"ts":1475235445659},"enabled":true,"position":7,"file_url":"https://greasyfork.org/scripts/9932-youtube/code/YouTube%20+.user.js","uuid":"f036c817-e556-4bb9-9941-5081c51a16da","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQHZlcnNpb24gICAgICAgICAxLjUuNgovLyBAbmFtZSAgICAgICAgICAgIFlvdVR1YmUgKwovLyBAbmFtZXNwYWNlICAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUKLy8gQGRlc2NyaXB0aW9uICAgICBZb3VUdWJlIHdpdGggbW9yZSBmcmVlZG9tCi8vIEBpY29uICAgICAgICAgICAgaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS9naC1wYWdlcy9pbWFnZXMvWVQlMkJpY29uLnBuZwovLyBAbWF0Y2ggICAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vKgovLyBAZXhjbHVkZSAgICAgICAgICo6Ly93d3cueW91dHViZS5jb20vdHYqCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8qCi8vIEBleGNsdWRlICAgICAgICAgKjovL3d3dy55b3V0dWJlLmNvbS9saXZlX2NoYXQqCi8vIEBydW4tYXQgICAgICAgICAgZG9jdW1lbnQtc3RhcnQKLy8gQGhvbWVwYWdlVVJMICAgICBodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlCi8vIEBzdXBwb3J0VVJMICAgICAgaHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpCi8vIEBjb250cmlidXRpb25VUkwgaHR0cHM6Ly93d3cucGF5cGFsLmNvbS9jZ2ktYmluL3dlYnNjcj9jbWQ9X3MteGNsaWNrJmhvc3RlZF9idXR0b25faWQ9VU1WUUpKRkc0QkZIVwovLyBAZ3JhbnQgICAgICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICAgICAgR01fc2V0VmFsdWUKLy8gQG5vZnJhbWVzCi8vID09L1VzZXJTY3JpcHQ9PQooZnVuY3Rpb24gKCkgewogICAgInVzZSBzdHJpY3QiOwogICAgdmFyIHBhcnRpY2xlID0gewogICAgICAgIGluamVjdDogZnVuY3Rpb24oaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICBmdW5jdGlvbiBzZXRMb2NhbGUoY29udGVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHl0cGxhYmVsOwogICAgICAgICAgICAgICAgeXRwbGFiZWwgPSBjb250ZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIltkYXRhLXBdIik7CiAgICAgICAgICAgICAgICBpID0geXRwbGFiZWwubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QgPSB5dHBsYWJlbFtpXS5kYXRhc2V0LnAuc3BsaXQoIiYiKTsKICAgICAgICAgICAgICAgICAgICBqID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGotLSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbGlzdFtqXS5zcGxpdCgifCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFswXSA9PT0gInRuZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0cGxhYmVsW2ldLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhbmcodGVtcFsxXSkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0ZW1wWzBdID09PSAidHRsIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uc2V0QXR0cmlidXRlKCJ0aXRsZSIsIGxhbmcodGVtcFsxXSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeXRwbGFiZWxbaV0uZGF0YXNldC50b29sdGlwVGV4dCA9IGxhbmcodGVtcFsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29udGVudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMb2NhbGUoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgZGF0YSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZTsKICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhICYmIEpTT04ucGFyc2UoZGF0YSk7CiAgICAgICAgICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXS5sYXN0TW9kID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgNjA0OEU1OwogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYW5nLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRMYW5ndWFnZShkYXRhKSB7CiAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgICBpZiAoZGF0YS50YXJnZXQucmVhZHlTdGF0ZSA9PT0gNCAmJiBkYXRhLnRhcmdldC5zdGF0dXMgPT09IDIwMCkgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gPSBKU09OLnBhcnNlKGRhdGEudGFyZ2V0LnJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QgPSBuZXcgRGF0ZShkYXRhLnRhcmdldC5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpKS5nZXRUaW1lKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrID0gbmV3IERhdGUoKS5nZXRUaW1lKCkgKyA2MDQ4RTU7CiAgICAgICAgICAgICAgICBzZXQoImV4dExhbmciLCB1c2VyX3NldHRpbmdzLmV4dExhbmcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrTW9kaWZpZWQoZGF0YSkgewogICAgICAgICAgICAgICAgbGFuZy5mZXRjaGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0LnJlYWR5U3RhdGUgPT09IDQgJiYgZGF0YS50YXJnZXQuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbGFuZyhsYWJlbCkgewogICAgICAgICAgICAgICAgbGFuZy55dGxhbmcgPSB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgd2luZG93Lnl0LmNvbmZpZ18uR0FQSV9MT0NBTEU7CiAgICAgICAgICAgICAgICBsYW5nLnVybEJhc2UgPSAiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy9QYXJ0aWNsZUNvcmUvUGFydGljbGUvY29udGVudHMvTG9jYWxlLyI7CiAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZykgewogICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHt9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHVzZXJfc2V0dGluZ3MuZXh0TGFuZykgIT09ICJ7fSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJleHRMYW5nIiwge30pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlcl9zZXR0aW5ncy5sb2NhbExhbmdbbGFiZWxdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgbGFuZy55dGxhbmcgJiYgbGFuZy55dGxhbmcgIT09ICJlbl9VUyIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5leHRMYW5nW2xhbmcueXRsYW5nXSAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddW2xhYmVsXSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxhbmcuZmV0Y2hpbmcgJiYgdXNlcl9zZXR0aW5ncy5leHRMYW5nLm5leHRDaGVjayAmJiB1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIDw9IG5ldyBEYXRlKCkuZ2V0VGltZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYW5nLmZldGNoaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuZGF0YXNldC5nZXRsb2NhbGUgPSBsYW5nLnl0bGFuZzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkhFQUQiLCBjaGVja01vZGlmaWVkLCBsYW5nLnVybEJhc2UgKyBsYW5nLnl0bGFuZyArICIuanNvbiIsIFsiSWYtTW9kaWZpZWQtU2luY2UiLCBuZXcgRGF0ZSh1c2VyX3NldHRpbmdzLmV4dExhbmdbbGFuZy55dGxhbmddLmxhc3RNb2QpLnRvVVRDU3RyaW5nKCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDYwNDhFNTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgiZXh0TGFuZyIsIHVzZXJfc2V0dGluZ3MuZXh0TGFuZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ11bbGFiZWxdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MuZXh0TGFuZ1tsYW5nLnl0bGFuZ10gJiYgIWxhbmcuZmV0Y2hpbmcgJiYgKCF1c2VyX3NldHRpbmdzLmV4dExhbmcubmV4dENoZWNrIHx8IHVzZXJfc2V0dGluZ3MuZXh0TGFuZy5uZXh0Q2hlY2sgPD0gbmV3IERhdGUoKS5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcuZmV0Y2hpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmcub2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihnZXRMb2NhbGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZy5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlRmlsdGVyOiBbImRhdGEtc2V0bG9jYWxlIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQuZ2V0bG9jYWxlID0gbGFuZy55dGxhbmc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgZ2V0TGFuZ3VhZ2UsIGxhbmcudXJsQmFzZSArIGxhbmcueXRsYW5nICsgIi5qc29uIiwgWyJBY2NlcHQiLCAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5yYXciXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZ3VhZ2VbbGFiZWxdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEJ1dHRvbihvYmopIHsKICAgICAgICAgICAgICAgIHZhciBsbmssIGtleXMsIHRlbXA7CiAgICAgICAgICAgICAgICBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAiPGRpdiBjbGFzcz0nYmxhY2tsaXN0Jz48YnV0dG9uIGNsYXNzPSdjbG9zZSB5dHBsdXNfc3ByaXRlJz48L2J1dHRvbj48YSB0YXJnZXQ9J19ibGFuayc+PC9hPjwvZGl2PiI7CiAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5jb250ZW50LmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICBsbmsgPSB0ZW1wLnF1ZXJ5U2VsZWN0b3IoImEiKTsKICAgICAgICAgICAgICAgIGxuay5ocmVmID0gIi9jaGFubmVsLyIgKyBrZXlzWzBdOwogICAgICAgICAgICAgICAgbG5rLnNldEF0dHJpYnV0ZSgidGl0bGUiLCBvYmpba2V5c1swXV0pOwogICAgICAgICAgICAgICAgbG5rLnRleHRDb250ZW50ID0gb2JqW2tleXNbMF1dOwogICAgICAgICAgICAgICAgZ2V0QmxhY2tsaXN0LmJsaXN0LmFwcGVuZENoaWxkKHRlbXApOwogICAgICAgICAgICAgICAgZ2V0QmxhY2tsaXN0LmJsaXN0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJcbiIpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzb3J0TGlzdChwcmV2aW91cywgbmV4dCl7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJldmlvdXNbT2JqZWN0LmtleXMocHJldmlvdXMpWzBdXS5sb2NhbGVDb21wYXJlKG5leHRbT2JqZWN0LmtleXMobmV4dClbMF1dKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBidWlsZExpc3QoeXRpZCkgewogICAgICAgICAgICAgICAgdmFyIG9iaiA9IHt9OwogICAgICAgICAgICAgICAgb2JqW3l0aWRdID0gZ2V0QmxhY2tsaXN0Lmxpc3RbeXRpZF07CiAgICAgICAgICAgICAgICBnZXRCbGFja2xpc3Quc29ydEFscGhhLnB1c2gob2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRCbGFja2xpc3QoYmxpc3QpIHsKICAgICAgICAgICAgICAgIGdldEJsYWNrbGlzdC5ibGlzdCA9IGJsaXN0OwogICAgICAgICAgICAgICAgZ2V0QmxhY2tsaXN0Lmxpc3QgPSB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdDsKICAgICAgICAgICAgICAgIGdldEJsYWNrbGlzdC5zb3J0QWxwaGEgPSBbXTsKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGdldEJsYWNrbGlzdC5saXN0KS5mb3JFYWNoKGJ1aWxkTGlzdCk7CiAgICAgICAgICAgICAgICBnZXRCbGFja2xpc3Quc29ydEFscGhhLnNvcnQoc29ydExpc3QpLmZvckVhY2goc2V0QnV0dG9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRWYWx1ZXMobWVudSkgewogICAgICAgICAgICAgICAgdmFyIGksIHl0cCwgbGlzdDsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdCA9IG1lbnUucXVlcnlTZWxlY3RvcigiI2JsYWNrbGlzdCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGdldEJsYWNrbGlzdChsaXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeXRwID0gbWVudS5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtpZF0iKTsKICAgICAgICAgICAgICAgICAgICBpID0geXRwLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dHBbaV0udHlwZSA9PT0gImNoZWNrYm94IiAmJiB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0gPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0cFtpXS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCAidHJ1ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dHBbaV0udHlwZSA9PT0gInRleHQiICYmIHR5cGVvZiB1c2VyX3NldHRpbmdzW3l0cFtpXS5pZF0gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIHVzZXJfc2V0dGluZ3NbeXRwW2ldLmlkXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgeXRwID0gbWVudS5xdWVyeVNlbGVjdG9yQWxsKCJvcHRpb24iKTsKICAgICAgICAgICAgICAgICAgICBpID0geXRwLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzW3l0cFtpXS5wYXJlbnROb2RlLmlkXSA9PT0geXRwW2ldLnZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dHBbaV0uc2V0QXR0cmlidXRlKCJzZWxlY3RlZCIsICJ0cnVlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbWVudTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRNZW51KHNlY3Rpb24pIHsKICAgICAgICAgICAgICAgIHZhciB0ZW1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgIGlmIChzZWN0aW9uID09PSAiTUVOIikgewogICAgICAgICAgICAgICAgICAgIHRlbXAuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1Atc2V0dGluZ3MnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nUC1jb250YWluZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J1Atc2lkZWJhcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBpZD0nUC1zaWRlYmFyLWxpc3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdHRU4nIGNsYXNzPSdzZWxlY3RlZCcgZGF0YS1wPSd0bmR8R0VOJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdWSUQnIGRhdGEtcD0ndG5kfFZJRCc+PC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0nQkxLJyBkYXRhLXA9J3RuZHxCTEsnPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0FCVCcgZGF0YS1wPSd0bmR8QUJUJz48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSdITFAnPjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2knIGRhdGEtcD0ndG5kfEhMUCc+PC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9J0ROVCc+PGEgdGl0bGU9J1BheVBhbCcgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vd3d3LnBheXBhbC5jb20vY2dpLWJpbi93ZWJzY3I/Y21kPV9zLXhjbGljayZob3N0ZWRfYnV0dG9uX2lkPVVNVlFKSkZHNEJGSFcnIGRhdGEtcD0ndG5kfEROVCc+PC9hPjwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbiA9PT0gIkdFTiIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdQLWNvbnRlbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1oZWFkZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1Atc2F2ZScgZGF0YS1wPSd0bmR8R0xCX1NWRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1yZXNldCcgZGF0YS1wPSd0bmR8R0xCX1JTRVQnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtaW1wZXhwIHl0cGx1c19zcHJpdGUnIGRhdGEtcD0ndHRsfEdMQl9JTVBSJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGxhbmcnIGRhdGEtcD0ndHRsfEdMQl9MT0NMX0xBTkcmdG5kfExPQ0FMRSc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIGRhdGEtcD0ndG5kfEdFTl9UVEwnPjwvaDI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxociBjbGFzcz0nUC1ob3J6Jz48L2hyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEdFTl9HRU4nPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0xPQ0xfTEFORycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0xPQ0xfTEFORycgZGF0YS1wPSd0bmR8R0VOX0xPQ0xfTEFORyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNjdXN0b21fbGFuZycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0RTQkxfQURTJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fRFNCTF9BRFMnIGRhdGEtcD0ndG5kfEdFTl9EU0JMX0FEUyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNvdXRzaWRlX2FkcycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1lUX0xPR09fTElOSycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX1lUX0xPR09fTElOSycgZGF0YS1wPSd0bmR8R0VOX1lUX0xPR09fTElOSyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNsb2dvX3JlZGlyZWN0JyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fU1VCX0xJU1QnIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J0dFTl9TVUJfTElTVCcgZGF0YS1wPSd0bmR8R0VOX1NVQl9MSVNUJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1Yl9wbGF5bGlzdCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0lORl9TQ1JMJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fSU5GX1NDUkwnIGRhdGEtcD0ndG5kfEdFTl9JTkZfU0NSTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNpbmZpbml0ZV9zY3JvbGwnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9QUE9UX09OJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fUFBPVF9PTicgZGF0YS1wPSd0bmR8R0VOX1BQT1RfT04nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcG9wb3V0X29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fUkVNX0FQVU4nIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J0dFTl9SRU1fQVBVTicgZGF0YS1wPSd0bmR8R0VOX1JFTV9BUFVOJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbW92ZV9hdXRvcGxheScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX1NQRl9PRkYnIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J0dFTl9TUEZfT0ZGJyBkYXRhLXA9J3RuZHxHRU5fU1BGX09GRic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzcGZfb2ZmJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxhYmVsIGZvcj0nR0VOX0NITl9ERkxUX1BBR0UnIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFJz48L2xhYmVsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1Atc2VsZWN0Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBpZD0nR0VOX0NITl9ERkxUX1BBR0UnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nZGVmYXVsdCcgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfREZMVCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSd2aWRlb3MnIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX1ZJRCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdwbGF5bGlzdHMnIGRhdGEtcD0ndG5kfEdFTl9DSE5fREZMVF9QQUdFX1BMJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2NoYW5uZWxzJyBkYXRhLXA9J3RuZHxHRU5fQ0hOX0RGTFRfUEFHRV9DSE4nPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nZGlzY3Vzc2lvbicgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfRElTQyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdhYm91dCcgZGF0YS1wPSd0bmR8R0VOX0NITl9ERkxUX1BBR0VfQUJUJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjY2hhbm5lbF9wYWdlJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfEdFTl9MWVQnPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0dSSURfU1VCUycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0dSSURfU1VCUycgZGF0YS1wPSd0bmR8R0VOX0dSSURfU1VCUyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzdWJfZ3JpZCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0dSSURfU1JDSCcgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0dSSURfU1JDSCcgZGF0YS1wPSd0bmR8R0VOX0dSSURfU1JDSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzZWFyY2hfZ3JpZCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JUVFJfTlRGJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fQlRUUl9OVEYnIGRhdGEtcD0ndG5kfEdFTl9CVFRSX05URic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNibHVlX2JveCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0RTQl9IVlJDJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fRFNCX0hWUkMnIGRhdGEtcD0ndG5kfEdFTl9EU0JfSFZSQyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNob3ZlcmNhcmRzX29mZicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0NNUFRfVFRMUycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0NNUFRfVFRMUycgZGF0YS1wPSd0bmR8R0VOX0NNUFRfVFRMUyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmZWVkX3RpdGxlcycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nR0VOX0JMVUVfR0xPVycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0JMVUVfR0xPVycgZGF0YS1wPSd0bmR8R0VOX0JMVUVfR0xPVyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNibHVlX2dsb3cnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9ISURFX0ZUUicgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0hJREVfRlRSJyBkYXRhLXA9J3RuZHxHRU5fSElERV9GVFInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9mb290ZXInIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9IREVfUkVDTV9TREJSJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdHRU5fSERFX1JFQ01fU0RCUicgZGF0YS1wPSd0bmR8R0VOX0hERV9SRUNNX1NEQlInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9yZWNvbV9zaWRlYmFyJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdHRU5fSERFX1NSQ0hfU0RCUicgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nR0VOX0hERV9TUkNIX1NEQlInIGRhdGEtcD0ndG5kfEdFTl9IREVfU1JDSF9TREJSJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfc2VhcmNoX3NpZGViYXInIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0dFTl9IREVfQ0hOX1NEQlInIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J0dFTl9IREVfQ0hOX1NEQlInIGRhdGEtcD0ndG5kfEdFTl9IREVfQ0hOX1NEQlInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGlkZV9jaGFubmVsX3NpZGViYXInIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoIi5QLWltcGxhbmciKS5kYXRhc2V0LnAgPSAiR0xCX0xPQ0xfTEFOR19DU1RNIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJWSUQiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXNhdmUnIGRhdGEtcD0ndG5kfEdMQl9TVkUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtcmVzZXQnIGRhdGEtcD0ndG5kfEdMQl9SU0VUJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGV4cCB5dHBsdXNfc3ByaXRlJyBkYXRhLXA9J3R0bHxHTEJfSU1QUic+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBsYW5nJyBkYXRhLXA9J3R0bHxHTEJfTE9DTF9MQU5HJnRuZHxMT0NBTEUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxWSURfVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeic+PC9ocj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExSJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfQURTJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0FEUycgZGF0YS1wPSd0bmR8VklEX1BMUl9BRFMnPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjdmlkZW9fYWRzJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfU1VCX0FEUycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1NVQl9BRFMnIGRhdGEtcD0ndG5kfFZJRF9TVUJfQURTJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3N1YnNfYWRzX29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FMVklTJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0FMVklTJyBkYXRhLXA9J3RuZHxWSURfUExSX0FMVklTJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Zsb2F0aW5nX3BsYXllcicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTFZJU19XRFRIJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nMzUwJyBzaXplPSc2Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QTFJfQUxWSVNfV0RUSCcgZGF0YS1wPSd0bmR8VklEX1BMUl9BTFZJU19XRFRIJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Zsb2F0aW5nX3BsYXllcl93aWR0aCcgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BVFBMJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0FUUEwnIGRhdGEtcD0ndG5kfFZJRF9QTFJfQVRQTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN2aWRlb19hdXRvcGxheScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9DQycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1BMUl9DQycgZGF0YS1wPSd0bmR8VklEX1BMUl9DQyc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzdWJ0aXRsZXNfb2ZmJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0FOVFMnIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QTFJfQU5UUycgZGF0YS1wPSd0bmR8VklEX1BMUl9BTlRTJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Fubm90YXRpb25zX29mZicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX0VORF9TSFJFJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfRU5EX1NIUkUnIGRhdGEtcD0ndG5kfFZJRF9FTkRfU0hSRSc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzaGFyZV9wYW5lbF9vZmYnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfVk9MX01FTScgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1BMUl9WT0xfTUVNJyBkYXRhLXA9J3RuZHxWSURfUExSX1ZPTF9NRU0nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVtZW1iZXJfdm9sdW1lJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX1ZPTF9MRE4nIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QTFJfVk9MX0xETicgZGF0YS1wPSd0bmR8VklEX1BMUl9WT0xfTEROJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2Rpc2FibGVfbm9ybWFsaXNhdGlvbicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9BTEFDVCcgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1BMUl9BTEFDVCcgZGF0YS1wPSd0bmR8VklEX1BMUl9BTEFDVCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNzaG9ydGN1dHNfb24nIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfU0laRV9NRU0nIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QTFJfU0laRV9NRU0nIGRhdGEtcD0ndG5kfFZJRF9QTFJfU0laRV9NRU0nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjcmVtZW1iZXJfbW9kZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1ZPTF9XSEVFTCcgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1ZPTF9XSEVFTCcgZGF0YS1wPSd0bmR8VklEX1ZPTF9XSEVFTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyN3aGVlbF92b2x1bWUnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfSEZSJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0hGUicgZGF0YS1wPSd0bmR8VklEX1BMUl9IRlInPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjaGZyX29mZicgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX1BMUl9IVE1MNScgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1BMUl9IVE1MNScgZGF0YS1wPSd0bmR8VklEX1BMUl9IVE1MNSc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmb3JjZV9odG1sNScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J1ZJRF9ERkxUX1FMVFknIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFknPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1zZWxlY3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSdWSURfREZMVF9RTFRZJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2F1dG8nIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfQVVUTyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdoaWdocmVzJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX09SSUcnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQyODgwJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzI4ODAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQyMTYwJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzIxNjAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQxNDQwJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzE0NDAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQxMDgwJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZXzEwODAnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0naGQ3MjAnIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfNzIwJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J2xhcmdlJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX0xSRyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSdtZWRpdW0nIGRhdGEtcD0ndG5kfFZJRF9ERkxUX1FMVFlfTURNJz48L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9J3NtYWxsJyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX1NNTCc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPSd0aW55JyBkYXRhLXA9J3RuZHxWSURfREZMVF9RTFRZX1ROWSc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2RlZmF1bHRfcXVhbGl0eScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExSX0xZVCc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0lORk8nIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QTFJfSU5GTycgZGF0YS1wPSd0bmR8VklEX1BMUl9JTkZPJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2luZm9fYmFyJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExSX0RZTl9TSVpFJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0RZTl9TSVpFJyBkYXRhLXA9J3RuZHxWSURfUExSX0RZTl9TSVpFJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2R5bmFtaWNfc2l6ZV9vZmYnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfRklUJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExSX0ZJVCcgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVQnPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjZml0X3RvX3BhZ2UnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QTFJfRklUX1dEVEgnIHR5cGU9J3RleHQnIHBsYWNlaG9sZGVyPScxMjgwcHgnIHNpemU9JzYnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1BMUl9GSVRfV0RUSCcgZGF0YS1wPSd0bmR8VklEX1BMUl9GSVRfV0RUSCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNmaXRfbWF4X3dpZHRoJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxWSURfUExTVCc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExTVF9BVFBMJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExTVF9BVFBMJyBkYXRhLXA9J3RuZHxWSURfUExTVF9BVFBMJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3BsYXlsaXN0X2F1dG9wbGF5JyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUExTVF9SVlJTJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUExTVF9SVlJTJyBkYXRhLXA9J3RuZHxWSURfUExTVF9SVlJTJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3BsYXlsaXN0X3JldmVyc2UnIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIGRhdGEtcD0ndG5kfFZJRF9MQVlUJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J1ZJRF9QUE9UX1NaJyB0eXBlPSd0ZXh0JyBwbGFjZWhvbGRlcj0nNTMzJyBzaXplPSc2Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9QUE9UX1NaJyBkYXRhLXA9J3RuZHxWSURfUFBPVF9TWic+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNwb3BvdXRfc2l6ZScgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9J1ZJRF9ISURFX0NPTVMnIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVMnPjwvbGFiZWw+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1zZWxlY3QnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c2VsZWN0IGlkPSdWSURfSElERV9DT01TJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gdmFsdWU9JzAnIGRhdGEtcD0ndG5kfFZJRF9ISURFX0NPTVNfU0hPVyc+PC9vcHRpb24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPScxJyBkYXRhLXA9J3RuZHxWSURfSElERV9DT01TX0hJREUnPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0nMicgZGF0YS1wPSd0bmR8VklEX0hJREVfQ09NU19SRU0nPjwvb3B0aW9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNjb21tZW50cycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVFRMX0NNUFQnIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9UVExfQ01QVCcgZGF0YS1wPSd0bmR8VklEX1RUTF9DTVBUJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3ZpZGVvX3RpdGxlJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfREVTQ19TSFJUJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfREVTQ19TSFJUJyBkYXRhLXA9J3RuZHxWSURfREVTQ19TSFJUJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2xhYmVsbGVzc19idXR0b25zJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfVklEX0NOVCcgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX1ZJRF9DTlQnIGRhdGEtcD0ndG5kfFZJRF9WSURfQ05UJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3VwbG9hZF9jb3VudGVyJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfUE9TVF9USU1FJyB0eXBlPSdjaGVja2JveCc+PC9pbnB1dD48bGFiZWwgZm9yPSdWSURfUE9TVF9USU1FJyBkYXRhLXA9J3RuZHxWSURfUE9TVF9USU1FJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI3JlbGF0aXZlX3VwbG9hZF90aW1lJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGlucHV0IGlkPSdWSURfSElERV9ERVRMUycgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nVklEX0hJREVfREVUTFMnIGRhdGEtcD0ndG5kfFZJRF9ISURFX0RFVExTJz48L2xhYmVsPlxuPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL0ZlYXR1cmVzI2hpZGVfdmlkZW9fZGV0YWlscycgZGF0YS1wPSd0dGx8RlRSX0RFU0MnIHRhcmdldD0nZmVhdHVyZXMnPj88L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxpbnB1dCBpZD0nVklEX0xBWVRfQVVUT19QTkwnIHR5cGU9J2NoZWNrYm94Jz48L2lucHV0PjxsYWJlbCBmb3I9J1ZJRF9MQVlUX0FVVE9fUE5MJyBkYXRhLXA9J3RuZHxWSURfTEFZVF9BVVRPX1BOTCc+PC9sYWJlbD5cbjxhIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcyNleHBhbmRfZGVzY3JpcHRpb24nIGRhdGEtcD0ndHRsfEZUUl9ERVNDJyB0YXJnZXQ9J2ZlYXR1cmVzJz4/PC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9MT0NMX0xBTkcgJiYgdXNlcl9zZXR0aW5ncy5sb2NhbExhbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoIi5QLWltcGxhbmciKS5kYXRhc2V0LnAgPSAiR0xCX0xPQ0xfTEFOR19DU1RNIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlY3Rpb24gPT09ICJCTEsiKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1jb250ZW50Jz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J1AtaGVhZGVyJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLXNhdmUnIGRhdGEtcD0ndG5kfEdMQl9TVkUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9J1AtcmVzZXQnIGRhdGEtcD0ndG5kfEdMQl9SU0VUJz48L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSdQLWltcGV4cCB5dHBsdXNfc3ByaXRlJyBkYXRhLXA9J3R0bHxHTEJfSU1QUic+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0nUC1pbXBsYW5nJyBkYXRhLXA9J3R0bHxHTEJfTE9DTF9MQU5HJnRuZHxMT0NBTEUnPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxCTEtfVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeic+PC9ocj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxCTEtfQkxLJz48L2gzPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48aW5wdXQgaWQ9J0JMS19PTicgdHlwZT0nY2hlY2tib3gnPjwvaW5wdXQ+PGxhYmVsIGZvcj0nQkxLX09OJyBkYXRhLXA9J3RuZHxCTEtfT04nPjwvbGFiZWw+XG48YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvRmVhdHVyZXMjYmxhY2tsaXN0X29uJyBkYXRhLXA9J3R0bHxGVFJfREVTQycgdGFyZ2V0PSdmZWF0dXJlcyc+PzwvYT48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2JsYWNrbGlzdCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYmxhY2tsaXN0LWNvbnRyb2xzJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nYmxhY2tsaXN0LWVkaXQnIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1zZXNzaW9ubGluayB5dC11aXgtYnV0dG9uLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQnPjxzcGFuIGNsYXNzPSd5dC11aXgtYnV0dG9uLWNvbnRlbnQnIGRhdGEtcD0ndG5kfEJMQ0tfRURJVCc+PC9zcGFuPjwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdibGFja2xpc3Qtc2F2ZScgY2xhc3M9J3l0LXVpeC1idXR0b24geXQtdWl4LXNlc3Npb25saW5rIHl0LXVpeC1idXR0b24tZGVmYXVsdCB5dC11aXgtYnV0dG9uLXNpemUtZGVmYXVsdCc+PHNwYW4gY2xhc3M9J3l0LXVpeC1idXR0b24tY29udGVudCcgZGF0YS1wPSd0bmR8QkxDS19TQVZFJz48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9J2JsYWNrbGlzdC1jbG9zZScgY2xhc3M9J3l0LXVpeC1idXR0b24geXQtdWl4LXNlc3Npb25saW5rIHl0LXVpeC1idXR0b24tZGVmYXVsdCB5dC11aXgtYnV0dG9uLXNpemUtZGVmYXVsdCc+PHNwYW4gY2xhc3M9J3l0LXVpeC1idXR0b24tY29udGVudCcgZGF0YS1wPSd0bmR8QkxDS19DTFNFJz48L3NwYW4+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRleHRhcmVhIGlkPSdibGFja2xpc3QtZWRpdC1saXN0Jz48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+PC9icj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fTE9DTF9MQU5HICYmIHVzZXJfc2V0dGluZ3MubG9jYWxMYW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAuY29udGVudC5xdWVyeVNlbGVjdG9yKCIuUC1pbXBsYW5nIikuZGF0YXNldC5wID0gInR0bHxHTEJfTE9DTF9MQU5HJnRuZHxHTEJfTE9DTF9MQU5HX0NTVE0iOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VjdGlvbiA9PT0gIkFCVCIpIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdQLWNvbnRlbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nUC1oZWFkZXInPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMiBkYXRhLXA9J3RuZHxBQlRfVFRMJz48L2gyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgY2xhc3M9J1AtaG9yeic+PC9ocj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBkYXRhLXA9J3RuZHxBQlRfVEhLUyc+PC9oMz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+PGEgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9ZZVBwSGEnPkplcHBlIFJ1bmUgTW9ydGVuc2VuPC9hPjxzcGFuIGRhdGEtcD0ndG5kfEFCVF9USEtTX1lFUFBIQSc+PC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cDovL3d3dy5ncmVhc2VzcG90Lm5ldC8nPkdyZWFzZW1vbmtleTwvYT4gKyA8YSBocmVmPSdodHRwOi8vdGFtcGVybW9ua2V5Lm5ldC8nPlRhbXBlcm1vbmtleTwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19VU0VSU0NSSVBUJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vJz5TdGFjayBPdmVyZmxvdzwvYT48c3BhbiBkYXRhLXA9J3RuZHxBQlRfVEhLU19TVEFDS09WJz48L3NwYW4+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgZGF0YS1wPSd0bmR8QUJUX0lORk8nPjwvaDM+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlLyc+R2l0SHViPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj48YSB0YXJnZXQ9J19ibGFuaycgaHJlZj0naHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy9lbi91c2Vycy84MjIzLXBhcnRpY2xlY29yZSc+R3JlYXN5IEZvcms8L2E+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PjxhIHRhcmdldD0nX2JsYW5rJyBocmVmPSdodHRwOi8vb3BlbnVzZXJqcy5vcmcvc2NyaXB0cy9QYXJ0aWNsZUNvcmUvJz5PcGVuVXNlckpTPC9hPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHNldExvY2FsZShnZXRWYWx1ZXModGVtcC5jb250ZW50KSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZXhwb3J0U2V0dGluZ3ModGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgZXhwQ29udDsKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoIlAtaW1wbGFuZyIpKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJleHAtY29udCIpOwogICAgICAgICAgICAgICAgICAgIGlmIChleHBDb250KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgZXhwQ29udC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nZXhwLWNvbnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSdpbXBsYW5nLXNhdmUnIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1zZXNzaW9ubGluayB5dC11aXgtYnV0dG9uLWRlZmF1bHQgeXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSd5dC11aXgtYnV0dG9uLWNvbnRlbnQnIGRhdGEtcD0ndG5kfEdMQl9JTVBSX1NBVkUnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICA8dGV4dGFyZWEgaWQ9J2ltcGV4cC1saXN0Jz48L3RleHRhcmVhPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cENvbnQuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjaW1wbGFuZy1zYXZlIikuaWQgPSAiaW1wZXhwLXNhdmUiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBleHBDb250ID0gc2V0TG9jYWxlKGV4cENvbnQuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1jb250ZW50IikuYXBwZW5kQ2hpbGQoZXhwQ29udCk7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUgPSBKU09OLnN0cmluZ2lmeSgodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1pbXBleHAiKSAmJiB1c2VyX3NldHRpbmdzKSB8fCB1c2VyX3NldHRpbmdzLmxvY2FsTGFuZyB8fCBsYW5ndWFnZSwgdW5kZWZpbmVkLCAyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmlkID09PSAiaW1wZXhwLXNhdmUiIHx8IHRhcmdldC5pZCA9PT0gImltcGxhbmctc2F2ZSIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiaW1wbGFuZy1zYXZlIikgewogICAgICAgICAgICAgICAgICAgICAgICBzZXQoImxvY2FsTGFuZyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIEpTT04ucGFyc2UoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImltcGV4cC1saXN0IikudmFsdWUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudS5zZXR0aW5nc0J1dHRvbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCbGFja0xpc3QodGFyZ2V0KSB7CiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LWVkaXQiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJsYWNrbGlzdCIpLmNsYXNzTGlzdC5hZGQoImVkaXQiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkodXNlcl9zZXR0aW5ncy5ibGFja2xpc3QsIHVuZGVmaW5lZCwgMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1zYXZlIikgewogICAgICAgICAgICAgICAgICAgIHNldCgiYmxhY2tsaXN0IiwgSlNPTi5wYXJzZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmxhY2tsaXN0LWVkaXQtbGlzdCIpLnZhbHVlKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1jbG9zZSIpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQkxLIikuY2xpY2soKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWxCbGFja0xpc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdLZXkgPSB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdDsKICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdLZXlbZXZlbnQudGFyZ2V0Lm5leHRTaWJsaW5nLmhyZWYuc3BsaXQoIi9jaGFubmVsLyIpWzFdXTsKICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCBuZXdLZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGRlbE5vdGlmaWNhdGlvbigpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKHNhbHQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB2YWx1ZSwgbm90aWZpY2F0aW9uLCBuYXZJZCwgdXNlclNldHMsIHNhdmVkU2V0czsKICAgICAgICAgICAgICAgIG5hdklkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnNlbGVjdGVkIikuaWQ7CiAgICAgICAgICAgICAgICB1c2VyU2V0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLWNvbnRlbnQiKS5xdWVyeVNlbGVjdG9yQWxsKCJbaWRePSciICsgbmF2SWQgKyAiJ10iKTsKICAgICAgICAgICAgICAgIHNhdmVkU2V0cyA9IHVzZXJfc2V0dGluZ3M7CiAgICAgICAgICAgICAgICBpID0gdXNlclNldHMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHVzZXJTZXRzW2ldLmNoZWNrZWQgJiYgKHVzZXJTZXRzW2ldLnZhbHVlID09PSAib24iIHx8IHVzZXJTZXRzW2ldLnZhbHVlKSkgfHwgKHVzZXJTZXRzW2ldLmxlbmd0aCAmJiB1c2VyU2V0c1tpXS52YWx1ZSkgfHwgKHVzZXJTZXRzW2ldLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAidGV4dCIgJiYgdXNlclNldHNbaV0udmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFNldHNbdXNlclNldHNbaV0ubmFtZSB8fCB1c2VyU2V0c1tpXS5pZF0gPSB2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF2YWx1ZSAmJiB1c2VyU2V0c1tpXS50eXBlICE9PSAicmFkaW8iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkU2V0c1t1c2VyU2V0c1tpXS5pZF0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzZXQoInVzZXJfc2V0dGluZ3MiLCBzYXZlZFNldHMpOwogICAgICAgICAgICAgICAgY3VzdG9tU3R5bGVzKCk7CiAgICAgICAgICAgICAgICBpZiAoIXNhbHQpIHsKICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24uY2hpbGROb2Rlcy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nYXBwYmFyLW1haW4tZ3VpZGUtbm90aWZpY2F0aW9uLWNvbnRhaW5lcic+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbicgcm9sZT0nYWxlcnQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi1jb250ZW50LXdyYXBwZXIgeXQtdmFsaWduJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSdhcHBiYXItZ3VpZGUtbm90aWZpY2F0aW9uLWljb24geXQtc3ByaXRlJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0nYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQnPjwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0gc2V0TG9jYWxlKG5vdGlmaWNhdGlvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXQtbWFzdGhlYWQtbG9nby1jb250YWluZXIiKS5hcHBlbmRDaGlsZChub3RpZmljYXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXBwYmFyLWd1aWRlLW5vdGlmaWNhdGlvbi10ZXh0LWNvbnRlbnQiKS50ZXh0Q29udGVudCA9IGxhbmcoIkdMQl9TVkVfU0VUUyIpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgic2hvdy1ndWlkZS1idXR0b24tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZGVsTm90aWZpY2F0aW9uLCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBuYXZpZ2F0ZVNldHRpbmdzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1zYXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygiUC1yZXNldCIpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJ1c2VyX3NldHRpbmdzIiwgZGVmYXVsdF9zZXR0aW5ncyk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uLmNsaWNrKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoImNsb3NlIikpIHsKICAgICAgICAgICAgICAgICAgICBkZWxCbGFja0xpc3QoZXZlbnQpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGV4cCIpIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImltcGV4cC1zYXZlIiB8fCBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJQLWltcGxhbmciKSB8fCBldmVudC50YXJnZXQuaWQgPT09ICJpbXBsYW5nLXNhdmUiKSB7CiAgICAgICAgICAgICAgICAgICAgZXhwb3J0U2V0dGluZ3MoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiYmxhY2tsaXN0LWVkaXQiIHx8IGV2ZW50LnRhcmdldC5pZCA9PT0gImJsYWNrbGlzdC1zYXZlIiB8fCBldmVudC50YXJnZXQuaWQgPT09ICJibGFja2xpc3QtY2xvc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0QmxhY2tMaXN0KGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtY29udGFpbmVyIiB8fCBldmVudC50YXJnZXQuaWQgPT09ICJQLXNldHRpbmdzIikgewogICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gKGV2ZW50LnRhcmdldC5pZCA9PT0gIlAtc2V0dGluZ3MiKSA/IGV2ZW50LnRhcmdldCA6IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgIGV2ZW50Lm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50Wyh3aW5kb3cuY2hyb21lICYmICJib2R5IikgfHwgImRvY3VtZW50RWxlbWVudCJdLnNjcm9sbFRvcCA9IDA7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnRhcmdldC5pZCAhPT0gIkROVCIgJiYgZXZlbnQudGFyZ2V0LnRhZ05hbWUgIT09ICJBIiAmJiBldmVudC50YXJnZXQucGFyZW50Tm9kZS5pZCA9PT0gIlAtc2lkZWJhci1saXN0IikgewogICAgICAgICAgICAgICAgICAgIHNhdmVTZXR0aW5ncygibm8tbm90aWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtY29udGVudCIpLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJQLWNvbnRhaW5lciIpLmFwcGVuZENoaWxkKGdldE1lbnUoZXZlbnQudGFyZ2V0LmlkKSk7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcigiLnNlbGVjdGVkIikucmVtb3ZlQXR0cmlidXRlKCJjbGFzcyIpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc05hbWUgPSAic2VsZWN0ZWQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldHRpbmdzVGVtcGxhdGUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwV3JhcHBlcjsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuaWQgPT09ICJQIiAmJiBldmVudC50YXJnZXQudGFnTmFtZSAhPT0gIklOUFVUIikgewogICAgICAgICAgICAgICAgICAgIHBXcmFwcGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2V0dGluZ3MiKTsKICAgICAgICAgICAgICAgICAgICBpZiAocFdyYXBwZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKS5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIgPSBnZXRNZW51KCJNRU4iKTsKICAgICAgICAgICAgICAgICAgICAgICAgcFdyYXBwZXIucXVlcnlTZWxlY3RvcigiI1AtY29udGFpbmVyIikuYXBwZW5kQ2hpbGQoZ2V0TWVudSgiR0VOIikpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYm9keS1jb250YWluZXIiKS5pbnNlcnRCZWZvcmUocFdyYXBwZXIsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYWdlLWNvbnRhaW5lciIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBuYXZpZ2F0ZVNldHRpbmdzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBmaXJzdFRpbWUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUgJiYgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NOYW1lID09PSAicGFyX2Nsb3Nld2xjbSIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoImZpcnN0VGltZSIsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGZpcnN0VGltZSk7CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXR0aW5nc01lbnUoKSB7CiAgICAgICAgICAgICAgICB2YXIgbm90aWZfYnV0dG9uLCBzZXR0aW5nc19idXR0b24sIHdlbGNvbWVfbWVzc2FnZTsKICAgICAgICAgICAgICAgIGlmIChzZXR0aW5nc01lbnUuc2V0dGluZ3NCdXR0b24pIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBub3RpZl9idXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubm90aWZpY2F0aW9ucy1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX2J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN5dC1tYXN0aGVhZC11c2VyLCAjeXQtbWFzdGhlYWQtc2lnbmluIik7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3NfYnV0dG9uKSB7CiAgICAgICAgICAgICAgICAgICAgd2VsY29tZV9tZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lX21lc3NhZ2UuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxkaXYgaWQ9J1BzZXR0aW5ncycgc3R5bGU9J2Rpc3BsYXk6aW5saW5lLWJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlJz4KICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nUCcgY2xhc3M9J3l0cGx1c19zcHJpdGUnIGRhdGEtcD0ndHRsfFlUU0VUUyc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J3BhcnRfd2VsY29tZScgc3R5bGU9J2Rpc3BsYXk6bm9uZTttYXJnaW4tbGVmdDotMjIwcHg7dG9wOjM4cHg7cmlnaHQ6MCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLXA9J3RuZHxXTENNJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+PC9icj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGRhdGEtcD0ndG5kfFdMQ01TVFJUJz48L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnI+PC9icj48YnI+PC9icj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGRhdGEtcD0ndG5kfFdMQ01GVFJTJyBzdHlsZT0nY29sb3I6I0ZGRjsnIGhyZWY9J2h0dHBzOi8vZ2l0aHViLmNvbS9QYXJ0aWNsZUNvcmUvUGFydGljbGUvd2lraS9GZWF0dXJlcycgdGFyZ2V0PSdfYmxhbmsnPjwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9J3Bhcl9jbG9zZXdsY20nPjxzcGFuPsOXPC9zcGFuPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICB3ZWxjb21lX21lc3NhZ2UgPSBzZXRMb2NhbGUod2VsY29tZV9tZXNzYWdlLmNvbnRlbnQpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgc2V0dGluZ3NUZW1wbGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vdGlmX2J1dHRvbikgewogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc19idXR0b24uaW5zZXJ0QmVmb3JlKHdlbGNvbWVfbWVzc2FnZSwgbm90aWZfYnV0dG9uKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc19idXR0b24uYXBwZW5kQ2hpbGQod2VsY29tZV9tZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LnNldHRpbmdzQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAiKTsKICAgICAgICAgICAgICAgICAgICBzZXR0aW5nc01lbnUud2VsY29tZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYXJ0X3dlbGNvbWUiKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5maXJzdFRpbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3NNZW51LndlbGNvbWUuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZmlyc3RUaW1lKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQ29tbWVudChvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbW1lbnRzLCBpc19saXZlOwogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWRpc2N1c3Npb24iKTsKICAgICAgICAgICAgICAgICAgICBpc19saXZlID0gd2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy5saXZlc3RyZWFtOwogICAgICAgICAgICAgICAgICAgIGlmIChhLnNwbGl0KCJjb21tZW50cyIpLmxlbmd0aCA+IDEgJiYgIWlzX2xpdmUgJiYgY29tbWVudHMgJiYgIWNvbW1lbnRzLmxhenlsb2FkICYmIHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiICYmICFjb21tZW50cy5jbGFzc0xpc3QuY29udGFpbnMoInNob3ciKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5sYXp5bG9hZCA9IGFyZ3VtZW50czsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIG1vZFNldENvbmZpZyhvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIlNIQVJFX09OX1ZJREVPX0VORCIgaW4gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5TSEFSRV9PTl9WSURFT19FTkQgPSAhdXNlcl9zZXR0aW5ncy5WSURfRU5EX1NIUkU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCJVTklWRVJTQUxfSE9WRVJDQVJEUyIgaW4gYSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYS5VTklWRVJTQUxfSE9WRVJDQVJEUyA9ICF1c2VyX3NldHRpbmdzLkdFTl9EU0JfSFZSQzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RFbWJlZChvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXAsIHBsYXllcjsKICAgICAgICAgICAgICAgICAgICBiID0gbW9kQXJncyhiKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIuc2V0UGxheWJhY2tRdWFsaXR5KHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBdXRvcGxheShvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFiIHx8IHVzZXJfc2V0dGluZ3MucGxBcGwgfHwgKCF1c2VyX3NldHRpbmdzLnBsQXBsICYmIGIuZmVhdHVyZSAmJiBiLmZlYXR1cmUgIT09ICJhdXRvcGxheSIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBdXRvcGxheUZ1bGxzY3JlZW4ob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGhhc19lbmRlZCwgbmV4dF9idXR0b24sIG5leHRfY2xpY2tlZDsKICAgICAgICAgICAgICAgICAgICBoYXNfZW5kZWQgPSBhcGkgJiYgYXBpLmdldEN1cnJlbnRUaW1lICYmIE1hdGgucm91bmQoYXBpLmdldEN1cnJlbnRUaW1lKCkpID49IE1hdGguZmxvb3IoYXBpLmdldER1cmF0aW9uKCkpOwogICAgICAgICAgICAgICAgICAgIG5leHRfY2xpY2tlZCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtYnV0dG9uLW5leHQiKSB8fCBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygieXRwLW5leHQtYnV0dG9uIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLnBsQXBsICYmICFuZXh0X2NsaWNrZWQgJiYgaGFzX2VuZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1uZXh0LWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dF9idXR0b24gJiYgbmV4dF9idXR0b24uZ2V0QXR0cmlidXRlKCJhcmlhLWRpc2FibGVkIikgPT09ICJ0cnVlIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9idXR0b24ub25jbGljayA9IGFwaS5uZXh0VmlkZW87CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGFwaS5uZXh0VmlkZW8pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dF9idXR0b24uc2V0QXR0cmlidXRlKCJhcmlhLWRpc2FibGVkIiwgImZhbHNlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5wbEFwbCB8fCBuZXh0X2NsaWNrZWQgfHwgIWhhc19lbmRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV4dF9jbGlja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIikuZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGl0ZXJhdGVLZXlzKGtleXMpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGxheWVyX2luc3RhbmNlW2tleXNdID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJfaW5zdGFuY2Vba2V5c10gJiYgcGxheWVyX2luc3RhbmNlW2tleXNdLmhhc05leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2luc3RhbmNlW2tleXNdLmhhc05leHQgPSBtb2RBdXRvcGxheUZ1bGxzY3JlZW4ocGxheWVyX2luc3RhbmNlW2tleXNdLmhhc05leHQpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kUGxheWVyQ3JlYXRlKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcGxheWVyOwogICAgICAgICAgICAgICAgICAgIGIgPSBtb2RBcmdzKGIpOwogICAgICAgICAgICAgICAgICAgIGlmIChhLmlkID09PSAidXBzZWxsLXZpZGVvIikgewogICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGEgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pbnN0YW5jZSA9IG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKHBsYXllcl9pbnN0YW5jZSkuc29tZShpdGVyYXRlS2V5cyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCAmJiBwbGF5ZXIgJiYgKCF3aW5kb3cub3BlbmVyIHx8IHdpbmRvdy5sb2NhdGlvbi5oYXNoID09PSAiIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MuZHZtYXAgJiYgIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BRFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3Mudm1hcCA9IHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy5kdm1hcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5zdG9wVmlkZW8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kU2Vla1RvKG9yaWdpbmFsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odGltZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuY2FsbCh0aGlzLCB0aW1lLCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHNldE1vZHMoa2V5cykgewogICAgICAgICAgICAgICAgdmFyIHN0cjsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93Ll95dF93d3dba2V5c10gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICAgICAgICBzdHIgPSBTdHJpbmcod2luZG93Ll95dF93d3dba2V5c10pOwogICAgICAgICAgICAgICAgICAgIGlmIChzdHIuc3BsaXQoInBsYXllci1hZGRlZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Ll95dF93d3dba2V5c10gPSBtb2RFbWJlZCh3aW5kb3cuX3l0X3d3d1trZXlzXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdHIuc3BsaXQoIndpbmRvdy5zcGYubmF2aWdhdGUiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5feXRfd3d3W2tleXNdID0gbW9kQXV0b3BsYXkod2luZG93Ll95dF93d3dba2V5c10pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RyLnNwbGl0KCIuc2V0KFwiXCIrYSxiLGMsXCIvXCIsZCIpLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cHNldHdpZGUgPSB3aW5kb3cuX3l0X3d3d1trZXlzXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2NyaXB0RXhpdChldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGV2ZW50LnRhcmdldCkgewogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJ3d3cvYmFzZSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0LnNldENvbmZpZyA9IG1vZFNldENvbmZpZyh3aW5kb3cueXQuc2V0Q29uZmlnKTsKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMod2luZG93Ll95dF93d3cpLmZvckVhY2goc2V0TW9kcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJ3d3cvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC53d3cud2F0Y2gucGxheWVyLnNlZWtUbyA9IG1vZFNlZWtUbyh3aW5kb3cueXQud3d3LndhdGNoLnBsYXllci5zZWVrVG8pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgibmFtZSIpID09PSAic3BmL3NwZiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5sb2FkID0gbW9kQ29tbWVudCh3aW5kb3cuc3BmLmxvYWQpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLnByZWZldGNoID0gZnVuY3Rpb24oKXtyZXR1cm47fTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5uYXZpZ2F0ZSA9IGZ1bmN0aW9uKCl7cmV0dXJuO307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoKGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKCJuYW1lIikgPT09ICJwbGF5ZXIvYmFzZSIpIHx8ICghd2luZG93Lmh0bWw1UGF0Y2hlZCAmJiB3aW5kb3cueXQgJiYgd2luZG93Lnl0LnBsYXllciAmJiB3aW5kb3cueXQucGxheWVyLkFwcGxpY2F0aW9uICYmIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlKSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5odG1sNVBhdGNoZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlID0gbW9kUGxheWVyQ3JlYXRlKHdpbmRvdy55dC5wbGF5ZXIuQXBwbGljYXRpb24uY3JlYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja0JvdW5kcyhlbG0sIFgsIFkpIHsKICAgICAgICAgICAgICAgIHZhciBzbmFwWCwgc25hcFk7CiAgICAgICAgICAgICAgICBpZiAoWCA+IC0xICYmIFggKyBlbG0ub2Zmc2V0V2lkdGggPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICBzbmFwWCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChYIDwgMSkgewogICAgICAgICAgICAgICAgICAgIFggPSAwOwogICAgICAgICAgICAgICAgICAgIHNuYXBYID0gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGggLSBlbG0ub2Zmc2V0V2lkdGg7CiAgICAgICAgICAgICAgICAgICAgc25hcFggPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKFkgPiA1MCAmJiBZICsgZWxtLm9mZnNldEhlaWdodCA8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBzbmFwWSA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChZIDwgNTEpIHsKICAgICAgICAgICAgICAgICAgICBZID0gNTA7CiAgICAgICAgICAgICAgICAgICAgc25hcFkgPSAtMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgWSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQgLSBlbG0ub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIHNuYXBZID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB7WDogWCArICJweCIsIFk6IFkgKyAicHgiLCBzbmFwWDogc25hcFgsIHNuYXBZOiBzbmFwWX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlUG9zKCkgewogICAgICAgICAgICAgICAgdmFyIHgsIHksIGhlaWdodCwgcGxheWVyLCBib3VuZHM7CiAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoImZsb2F0ZXIiKSkgewogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCB1cGRhdGVQb3MpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGhlaWdodCA9IHBhcnNlSW50KHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BTFZJU19XRFRIKSB8fCAzNTA7CiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICBib3VuZHMgPSBjaGVja0JvdW5kcyhwbGF5ZXIsIHVzZXJfc2V0dGluZ3MuZmxvYXRlclgsIHVzZXJfc2V0dGluZ3MuZmxvYXRlclkpOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gKGhlaWdodCA8IDM1MCA/IDM1MCA6IGhlaWdodCkgLyAoMTYgLyA5KTsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWCA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB4ID0gIjBweCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuZmxvYXRlclNuYXBYID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRXaWR0aCAtIHBsYXllci5vZmZzZXRXaWR0aCArICJweCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHggPSBib3VuZHMuWDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICB5ID0gIjUwcHgiOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIHkgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gcGxheWVyLm9mZnNldEhlaWdodCArICJweCI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHkgPSBib3VuZHMuWTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHBsYXllci5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIndpZHRoOiIgKyAoaGVpZ2h0ICogKDE2IC8gOSkpICsgInB4O2hlaWdodDoiICsgaGVpZ2h0ICsgInB4O2xlZnQ6IiArIHggKyAiO3RvcDoiICsgeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ0Zsb2F0ZXIoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBleGNsdWRlZCwgaXNGU2NyZWVuLCBpc0Zsb2F0ZXIsIGJvdW5kcywgcGxheWVyOwogICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICBpc0Zsb2F0ZXIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgIWlzRlNjcmVlbiAmJiBpc0Zsb2F0ZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gImNsaWNrIiAmJiBldmVudC50YXJnZXQuaWQgPT09ICJwYXJ0X2Zsb2F0ZXJ1aV9zY3JvbGx0b3AiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudFsod2luZG93LmNocm9tZSAmJiAiYm9keSIpIHx8ICJkb2N1bWVudEVsZW1lbnQiXS5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtb3ZpZV9wbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbnMgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1jaHJvbWUtYm90dG9tIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIgJiYgcGxheWVyLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgKCFleGNsdWRlZCB8fCAhZXhjbHVkZWQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGRyYWdGbG9hdGVyLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5vbGRQb3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFg6IHBhcnNlSW50KHBsYXllci5zdHlsZS5sZWZ0KSAtIGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFk6IHBhcnNlSW50KHBsYXllci5zdHlsZS50b3ApIC0gZXZlbnQuY2xpZW50WSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWDogZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LnR5cGUgPT09ICJtb3VzZW1vdmUiICYmIChkcmFnRmxvYXRlci5oYXNNb3ZlZCB8fCBNYXRoLmFicyhldmVudC5jbGllbnRYIC0gZHJhZ0Zsb2F0ZXIub2xkUG9zLm9yZ1gpID4gMTAgfHwgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIGRyYWdGbG9hdGVyLm9sZFBvcy5vcmdZKSA+IDEwKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kcyA9IGNoZWNrQm91bmRzKHBsYXllciwgZXZlbnQuY2xpZW50WCArIGRyYWdGbG9hdGVyLm9sZFBvcy5YLCBldmVudC5jbGllbnRZICsgZHJhZ0Zsb2F0ZXIub2xkUG9zLlkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllci5zdHlsZS5sZWZ0ID0gYm91bmRzLlg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnN0eWxlLnRvcCA9IGJvdW5kcy5ZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLmhhc01vdmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5zbmFwWCA9IGJvdW5kcy5zbmFwWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnRmxvYXRlci5zbmFwWSA9IGJvdW5kcy5zbmFwWTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyAhPT0gMSB8fCBldmVudC50eXBlID09PSAiY2xpY2siKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZHJhZ0Zsb2F0ZXIuaGFzTW92ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLm9sZFBvcyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRyYWdGbG9hdGVyLmhhc01vdmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5mbG9hdGVyWCA9IHBhcnNlSW50KHBsYXllci5zdHlsZS5sZWZ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJZID0gcGFyc2VJbnQocGxheWVyLnN0eWxlLnRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5mbG9hdGVyU25hcFggPSBkcmFnRmxvYXRlci5zbmFwWDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX3NldHRpbmdzLmZsb2F0ZXJTbmFwWSA9IGRyYWdGbG9hdGVyLnNuYXBZOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldCgidXNlcl9zZXR0aW5ncyIsIHVzZXJfc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vtb3ZlIiwgZHJhZ0Zsb2F0ZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnRmxvYXRlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaW5pRmxvYXRlcigpIHsKICAgICAgICAgICAgICAgIHZhciBwbGF5ZXIsIHBsckFwaSwgb3V0X29mX3NpZ2h0LCBpc0Zsb2F0ZXIsIGlzRlNjcmVlbiwgZmxvYXRlclVJLCBzZXR0aW5nc19vcGVuOwogICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgcGxyQXBpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXllci1hcGkiKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzX29wZW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiUC1zZXR0aW5ncyIpOwogICAgICAgICAgICAgICAgaWYgKHBsYXllcikgewogICAgICAgICAgICAgICAgICAgIG91dF9vZl9zaWdodCA9IHBsckFwaS5ib3R0b20gPCAoKHBsckFwaS5oZWlnaHQgLyAyKSArIDUwKTsKICAgICAgICAgICAgICAgICAgICBpc0Zsb2F0ZXIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICAgICAgZmxvYXRlclVJID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBhcnRfZmxvYXRlcnVpIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmbG9hdGVyVUkgJiYgIWlzRlNjcmVlbikgewogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkuaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGlkPSdwYXJ0X2Zsb2F0ZXJ1aSc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0ncGFydF9mbG9hdGVydWlfc2Nyb2xsdG9wJyBjbGFzcz0neXRwbHVzX3Nwcml0ZScgZGF0YS1wPSd0dGx8VklEX1BMUl9BTFZJU19TQ1JMX1RPUCc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgICAgICBmbG9hdGVyVUkgPSBzZXRMb2NhbGUoZmxvYXRlclVJLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGRyYWdGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLmFwcGVuZENoaWxkKGZsb2F0ZXJVSSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChvdXRfb2Zfc2lnaHQgJiYgIWlzRmxvYXRlciAmJiAhc2V0dGluZ3Nfb3BlbikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgiZmxvYXRlciIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdXBkYXRlUG9zKTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlUG9zKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoKCFvdXRfb2Zfc2lnaHQgfHwgc2V0dGluZ3Nfb3BlbikgJiYgaXNGbG9hdGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJmbG9hdGVyIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJyZXNpemUiLCB1cGRhdGVQb3MpOwogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoInJlc2l6ZSIpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzVmlzaWJsZSgpIHsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQUxWSVMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgaW5pRmxvYXRlcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJzY3JvbGwiLCBpbmlGbG9hdGVyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gYWx3YXlzQWN0aXZlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgaSwgbGlzdCwgY2xlYXIsIGxlbmd0aCwgZXZlbnRDbG9uZTsKICAgICAgICAgICAgICAgIGNsZWFyID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09ICIvd2F0Y2giICYmIGFwaSAmJiBhcGkgIT09IGV2ZW50LnRhcmdldCAmJiAhYXBpLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgJiYgIWV2ZW50LmN0cmxLZXkgJiYgIWV2ZW50LnNoaWZ0S2V5ICYmICFldmVudC5hbHRLZXkgJiYgIWV2ZW50Lm1ldGFLZXkgJiYgIWV2ZW50LnRhcmdldC5pc0NvbnRlbnRFZGl0YWJsZTsKICAgICAgICAgICAgICAgIGlmIChjbGVhciAmJiAoKGV2ZW50LndoaWNoID4gNDcgJiYgZXZlbnQud2hpY2ggPCA1OCkgfHwgKGV2ZW50LndoaWNoID4gOTUgJiYgZXZlbnQud2hpY2ggPCAxMDYpIHx8IFsyNywgMzIsIDM1LCAzNiwgMzcsIDM4LCAzOSwgNDAsIDY2LCA2NywgNzksIDg3LCAxODcsIDE4OV0uaW5kZXhPZihldmVudC53aGljaCkgPiAtMSkgJiYgWyJFTUJFRCIsICJJTlBVVCIsICJPQkpFQ1QiLCAiVEVYVEFSRUEiLCAiSUZSQU1FIl0uaW5kZXhPZihkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUpIDwgMCkgewogICAgICAgICAgICAgICAgICAgIGV2ZW50Q2xvbmUgPSBuZXcgRXZlbnQoImtleWRvd24iKTsKICAgICAgICAgICAgICAgICAgICBsaXN0ID0gT2JqZWN0LmtleXMoT2JqZWN0LmdldFByb3RvdHlwZU9mKGV2ZW50KSk7CiAgICAgICAgICAgICAgICAgICAgbGVuZ3RoID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50Q2xvbmVbbGlzdFtpXV0gPSBldmVudFtsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICBhcGkuZGlzcGF0Y2hFdmVudChldmVudENsb25lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5ZXJTdGF0ZShldmVudCkgewogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuZnVsbEJycyB8fCB1c2VyX3NldHRpbmdzLmxpZ2h0c091dCkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKGV2ZW50IDwgNSAmJiBldmVudCA+IDAgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgodXNlcl9zZXR0aW5ncy5mdWxsQnJzICYmICJwYXJ0X2Z1bGxicm93c2VyIikgfHwgIjAiLCAodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgInBhcnRfY2luZW1hX21vZGUiKSB8fCAiMCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCJyZXNpemUiKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ3VzdG9tcyhldmVudCkgewogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBldmVudCA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgICBzZXQoInZvbExldiIsIGV2ZW50LnZvbHVtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHNldCgidGhlYXRlck1vZGUiLCBldmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcGxheWVyUmVhZHkoKSB7CiAgICAgICAgICAgICAgICBhcGkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibW92aWVfcGxheWVyIik7CiAgICAgICAgICAgICAgICBpZiAoYXBpICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYzQtcGxheWVyIikpIHsKICAgICAgICAgICAgICAgICAgICBhcGkuYWRkRXZlbnRMaXN0ZW5lcigib25TdGF0ZUNoYW5nZSIsIHBsYXllclN0YXRlKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1ZPTF9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmFkZEV2ZW50TGlzdGVuZXIoIm9uVm9sdW1lQ2hhbmdlIiwgaGFuZGxlQ3VzdG9tcyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfU0laRV9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLmFkZEV2ZW50TGlzdGVuZXIoIlNJWkVfQ0xJQ0tFRCIsIGhhbmRsZUN1c3RvbXMpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX1ZPTF9NRU0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgYXBpLnNldFZvbHVtZSh1c2VyX3NldHRpbmdzLnZvbExldik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmxvb3BWaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKS5sb29wID0gdXNlcl9zZXR0aW5ncy5sb29wVmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0FMQUNUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBhbHdheXNBY3RpdmUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRUaHVtYigpIHsKICAgICAgICAgICAgICAgIHZhciBhcmdzLCBiYXNlLCB0aHVtYl91cmw7CiAgICAgICAgICAgICAgICBhcmdzID0gd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzOwogICAgICAgICAgICAgICAgYmFzZSA9IChhcmdzLml1cmxfd2VicCAmJiAiX3dlYnAiKSB8fCAiIjsKICAgICAgICAgICAgICAgIHRodW1iX3VybCA9IGFyZ3NbIml1cmxtYXhyZXMiICsgYmFzZV0gfHwgYXJnc1siaXVybHNkIiArIGJhc2VdIHx8IGFyZ3NbIml1cmwiICsgYmFzZV07CiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih0aHVtYl91cmwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhpZGVTY3JlZW5zaG90KGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiY2xvc2Utc2NyZWVuc2hvdCIpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC50YXJnZXQucGFyZW50Tm9kZS5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGhpZGVTY3JlZW5zaG90KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRTY3JlZW5zaG90KCkgewogICAgICAgICAgICAgICAgdmFyIHdpZHRoLCBoZWlnaHQsIGFzcGVjdFJhdGlvLCB2aWRlbywgY29udGFpbmVyLCBjYW52YXMsIGNsb3NlLCBjb250ZXh0OwogICAgICAgICAgICAgICAgdmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNjcmVlbnNob3QtcmVzdWx0IikgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgICAgICBjYW52YXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcigiY2FudmFzIikgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY2FudmFzIik7CiAgICAgICAgICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgICAgICAgICAgICBhc3BlY3RSYXRpbyA9IHZpZGVvLnZpZGVvV2lkdGggLyB2aWRlby52aWRlb0hlaWdodDsKICAgICAgICAgICAgICAgIHdpZHRoID0gdmlkZW8udmlkZW9XaWR0aDsKICAgICAgICAgICAgICAgIGhlaWdodCA9IHBhcnNlSW50KHdpZHRoIC8gYXNwZWN0UmF0aW8sIDEwKTsKICAgICAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKHZpZGVvLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGlmICghY29udGFpbmVyLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmlkID0gInNjcmVlbnNob3QtcmVzdWx0IjsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2FudmFzKTsKICAgICAgICAgICAgICAgICAgICBjbG9zZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIGNsb3NlLmlkID0gImNsb3NlLXNjcmVlbnNob3QiOwogICAgICAgICAgICAgICAgICAgIGNsb3NlLnRleHRDb250ZW50ID0gbGFuZygiQ05TTF9TU19DTFMiKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGhpZGVTY3JlZW5zaG90KTsKICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2xvc2UpOwogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBleGl0RnVsbEJyb3dzZXIoa2V5KSB7CiAgICAgICAgICAgICAgICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygicGFydF9mdWxsYnJvd3NlciIpICYmIChrZXkua2V5Q29kZSA9PT0gMjcgfHwga2V5LmtleSA9PT0gIkVzY2FwZSIgfHwgKGtleS50YXJnZXQuY2xhc3NOYW1lICYmIGtleS50YXJnZXQuY2xhc3NOYW1lLnNwbGl0KCJ5dHAtc2l6ZSIpLmxlbmd0aCA+IDEpKSkgewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50eXBlID09PSAibW91c2Vkb3duIikgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgICAgICAgICAga2V5LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZ1bGxCcm93c2VyKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgcGxyU3RhdGUgPSBhcGkgJiYgYXBpLmdldFBsYXllclN0YXRlICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpOwogICAgICAgICAgICAgICAgcGxyU3RhdGUgPSBwbHJTdGF0ZSA8IDUgJiYgcGxyU3RhdGUgPiAwOwogICAgICAgICAgICAgICAgZG9jdW1lbnRbKHdpbmRvdy5jaHJvbWUgJiYgImJvZHkiKSB8fCAiZG9jdW1lbnRFbGVtZW50Il0uc2Nyb2xsVG9wID0gMDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCBleGl0RnVsbEJyb3dzZXIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigibW91c2Vkb3duIiwgZXhpdEZ1bGxCcm93c2VyKTsKICAgICAgICAgICAgICAgIHNldCgiZnVsbEJycyIsIGV2ZW50ID8gIXVzZXJfc2V0dGluZ3MuZnVsbEJycyA6IHRydWUpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZ1bGxfYnJvd3Nlci5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnVsbEJycyAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAocGxyU3RhdGUgfHwgZXZlbnQua2V5Q29kZSA9PT0gMjcgfHwgZXZlbnQua2V5ID09PSAiRXNjYXBlIikpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0Wyh1c2VyX3NldHRpbmdzLmZ1bGxCcnMgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgicGFydF9mdWxsYnJvd3NlciIpOwogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgicmVzaXplIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUZyYW1lcyhldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGksIHBpLCBmcHMsIHRlbXA7CiAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmcmFtZXN0ZXAtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgWyJFTUJFRCIsICJJTlBVVCIsICJPQkpFQ1QiLCAiVEVYVEFSRUEiXS5pbmRleE9mKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZSkgPCAwICYmIGV2ZW50LnRhcmdldC50YWdOYW1lICE9PSAiSUZSQU1FIiAmJiAhZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZSgiY29udGVudGVkaXRhYmxlIikpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGV2ZW50LmtleUNvZGUgPT09IDM3IHx8IGV2ZW50LmtleUNvZGUgPT09IDM5KSAmJiBldmVudC5zaGlmdEtleSkgewogICAgICAgICAgICAgICAgICAgICAgICBwaSA9IGFwaS5nZXRWaWRlb1N0YXRzKCkuZm10OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy5hZGFwdGl2ZV9mbXRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLmFkYXB0aXZlX2ZtdHMuc3BsaXQoIiwiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFtpXS5pbmRleE9mKCJpdGFnPSIgKyBwaSkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mcHMgPSBwYXJzZUludCh0ZW1wW2ldLm1hdGNoKC9mcHM9KFtcZF0rKS8pWzFdKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYWR2YW5jZWRPcHRpb25zLmZwcyB8fCBhZHZhbmNlZE9wdGlvbnMuZnBzID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnBzID0gMzA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZnBzID0gKChldmVudC5rZXlDb2RlIDwgMzkgJiYgLTEpIHx8IDEpICogKChhZHZhbmNlZE9wdGlvbnMuZnBzIDwgMiAmJiAzMCkgfHwgYWR2YW5jZWRPcHRpb25zLmZwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmcHMgJiYgYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIikucGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBpLnBhdXNlVmlkZW8oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zZWVrQnkoMSAvIGZwcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAiY2xpY2siICYmIGV2ZW50LnRhcmdldC5pZCA9PT0gImZyYW1lc3RlcC1idXR0b24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldCgiZnJhbWVfc3RlcCIsICF1c2VyX3NldHRpbmdzLmZyYW1lX3N0ZXApOwogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuZnJhbWVfc3RlcCAmJiAiYWRkIikgfHwgInJlbW92ZSJdKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAgJiYgYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAuY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCB0b2dnbGVGcmFtZXMsIHRydWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICghYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAgfHwgIWFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgdG9nZ2xlRnJhbWVzLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVDb25zb2xlKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiY29uc29sZS1idXR0b24iKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoInBsYXllci1jb25zb2xlIik7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdFtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJwbGF5ZXItY29uc29sZSIpID8gImFkZCIgOiAicmVtb3ZlIl0oImNsb3NlIik7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJhZHZPcHRzIiwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygicGxheWVyLWNvbnNvbGUiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlUGxheSgpIHsKICAgICAgICAgICAgICAgIHNldCgiVklEX1BMUl9BVFBMIiwgIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9BVFBMICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oInBhcnRfYXV0b3BsYXlvbiIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImF1dG9wbGF5LWJ1dHRvbiIpLmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgiYWN0aXZlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlTG9vcChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIHZpZGVvUGxheWVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIGlmICh2aWRlb1BsYXllcikgewogICAgICAgICAgICAgICAgICAgIHZpZGVvUGxheWVyLmxvb3AgPSBldmVudCA/ICF1c2VyX3NldHRpbmdzLmxvb3BWaWQgOiB1c2VyX3NldHRpbmdzLmxvb3BWaWQ7CiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3RbKCF1c2VyX3NldHRpbmdzLmxvb3BWaWQgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc2V0KCJsb29wVmlkIiwgYWR2YW5jZWRPcHRpb25zLmxvb3BfYnV0dG9uLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZUNpbmVtYU1vZGUoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwbHJTdGF0ZSA9IGFwaSAmJiBhcGkuZ2V0UGxheWVyU3RhdGUgJiYgYXBpLmdldFBsYXllclN0YXRlKCkgPCA1ICYmIGFwaS5nZXRQbGF5ZXJTdGF0ZSgpID4gMDsKICAgICAgICAgICAgICAgIHNldCgibGlnaHRzT3V0IiwgZXZlbnQgPyAhdXNlcl9zZXR0aW5ncy5saWdodHNPdXQgOiB0cnVlKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZS5jbGFzc0xpc3RbKHVzZXJfc2V0dGluZ3MubGlnaHRzT3V0ICYmICJhZGQiKSB8fCAicmVtb3ZlIl0oImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIHBsclN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdFsodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgImFkZCIpIHx8ICJyZW1vdmUiXSgicGFydF9jaW5lbWFfbW9kZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVRvZ2dsZXMoZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC50YXJnZXQuZGF0YXNldCAmJiBldmVudC50YXJnZXQuZGF0YXNldC5hY3Rpb24gJiYgYWR2YW5jZWRPcHRpb25zLmFjdGlvbnNbZXZlbnQudGFyZ2V0LmRhdGFzZXQuYWN0aW9uXSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5hY3Rpb25zW2V2ZW50LnRhcmdldC5kYXRhc2V0LmFjdGlvbl0oZXZlbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGhvb2tCdXR0b25zKCkgewogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLnBvcFBsYXllciA9IHBvcFBsYXllcjsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5mdWxsX2Jyb3dzZXIgPSBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMucXVlcnlTZWxlY3RvcigiI2Z1bGxicm93c2VyLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNpbmVtYV9tb2RlID0gYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLnF1ZXJ5U2VsZWN0b3IoIiNjaW5lbWFtb2RlLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmxvb3BfYnV0dG9uID0gYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLnF1ZXJ5U2VsZWN0b3IoIiNsb29wLWJ1dHRvbiIpOwogICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmZyYW1lX3N0ZXAgPSBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMucXVlcnlTZWxlY3RvcigiI2ZyYW1lc3RlcC1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5hY3Rpb25zID0gewogICAgICAgICAgICAgICAgICAgIHRvZ2dsZVBsYXk6IHRvZ2dsZVBsYXksCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlTG9vcDogdG9nZ2xlTG9vcCwKICAgICAgICAgICAgICAgICAgICBnZXRUaHVtYjogZ2V0VGh1bWIsCiAgICAgICAgICAgICAgICAgICAgZ2V0U2NyZWVuc2hvdDogZ2V0U2NyZWVuc2hvdCwKICAgICAgICAgICAgICAgICAgICBwb3BQbGF5ZXI6IHBvcFBsYXllciwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVGdWxsQnJvd3NlcjogdG9nZ2xlRnVsbEJyb3dzZXIsCiAgICAgICAgICAgICAgICAgICAgdG9nZ2xlQ2luZW1hTW9kZTogdG9nZ2xlQ2luZW1hTW9kZSwKICAgICAgICAgICAgICAgICAgICB0b2dnbGVGcmFtZXM6IHRvZ2dsZUZyYW1lcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgaGFuZGxlVG9nZ2xlcyk7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5sb29wVmlkICYmICFhZHZhbmNlZE9wdGlvbnMubG9vcF9idXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKCJhY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5sb29wX2J1dHRvbi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVMb29wKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5mdWxsQnJzICYmICFhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnVsbF9icm93c2VyLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUZ1bGxCcm93c2VyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5saWdodHNPdXQgJiYgIWFkdmFuY2VkT3B0aW9ucy5jaW5lbWFfbW9kZS5jbGFzc0xpc3QuY29udGFpbnMoImFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNpbmVtYV9tb2RlLmNsYXNzTGlzdC5hZGQoImFjdGl2ZSIpOwogICAgICAgICAgICAgICAgICAgIHRvZ2dsZUNpbmVtYU1vZGUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLmZyYW1lX3N0ZXAgJiYgIWFkdmFuY2VkT3B0aW9ucy5mcmFtZV9zdGVwLmNsYXNzTGlzdC5jb250YWlucygiYWN0aXZlIikpIHsKICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuZnJhbWVfc3RlcC5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICB0b2dnbGVGcmFtZXMoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBhZHZhbmNlZE9wdGlvbnMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyLCBjbnNsQnRuLCBjbnNsQ29udDsKICAgICAgICAgICAgICAgIGhlYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1oZWFkZXIiKTsKICAgICAgICAgICAgICAgIGNuc2xCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uc29sZS1idXR0b24iKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItY29uc29sZSIpOwogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgaGVhZGVyICYmICFjbnNsQnRuKSB7CiAgICAgICAgICAgICAgICAgICAgY25zbEJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgY25zbEJ0bi5pbm5lckhUTUwgPSAiPGJ1dHRvbiBpZD0nY29uc29sZS1idXR0b24nIGNsYXNzPSd5dHBsdXNfc3ByaXRlJyBkYXRhLXA9J3R0bHxBRFZfT1BUUyc+PC9idXR0b24+IjsKICAgICAgICAgICAgICAgICAgICBjbnNsQnRuID0gc2V0TG9jYWxlKGNuc2xCdG4uY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRvZ2dsZUNvbnNvbGUpOwogICAgICAgICAgICAgICAgICAgIGNuc2xDb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5pbm5lckhUTUwgPSAiPGRpdiBpZD0nYWR2YW5jZWQtb3B0aW9ucyc+PC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udCA9IGNuc2xDb250LmNvbnRlbnQuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5hcHBlbmRDaGlsZChjbnNsQnRuKTsKICAgICAgICAgICAgICAgICAgICBoZWFkZXIuYXBwZW5kQ2hpbGQoY25zbENvbnQpOwogICAgICAgICAgICAgICAgICAgIGlmIChhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWR2YW5jZWRPcHRpb25zLmNvbnRyb2xzLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scy5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0ncGxheWVyLWNvbnNvbGUnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nYXV0b3BsYXktYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfQVAnIGRhdGEtYWN0aW9uPSd0b2dnbGVQbGF5Jz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2xvb3AtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfUlBUJyBkYXRhLWFjdGlvbj0ndG9nZ2xlTG9vcCc+PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSdzYXZlLXRodW1ibmFpbC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9TVlRIJyBkYXRhLWFjdGlvbj0nZ2V0VGh1bWInPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nc2NyZWVuc2hvdC1idXR0b24nIGNsYXNzPSd5dC11aXgtdG9vbHRpcCcgZGF0YS1wPSd0dHB8Q05TTF9TUycgZGF0YS1hY3Rpb249J2dldFNjcmVlbnNob3QnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0ncG9wb3V0LWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX1BQT1QnIGRhdGEtYWN0aW9uPSdwb3BQbGF5ZXInPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nZnVsbGJyb3dzZXItYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfRkxCUicgZGF0YS1hY3Rpb249J3RvZ2dsZUZ1bGxCcm93c2VyJz48L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9J2NpbmVtYW1vZGUtYnV0dG9uJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAnIGRhdGEtcD0ndHRwfENOU0xfQ0lOTV9NRCcgZGF0YS1hY3Rpb249J3RvZ2dsZUNpbmVtYU1vZGUnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0nZnJhbWVzdGVwLWJ1dHRvbicgY2xhc3M9J3l0LXVpeC10b29sdGlwJyBkYXRhLXA9J3R0cHxDTlNMX0ZSTUUnIGRhdGEtYWN0aW9uPSd0b2dnbGVGcmFtZXMnPjwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5gOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudC5xdWVyeVNlbGVjdG9yKCIjYXV0b3BsYXktYnV0dG9uIikuY2xhc3NMaXN0LmFkZCgiYWN0aXZlIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucy5jb250cm9scyA9IHNldExvY2FsZShhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMuY29udGVudCkuZmlyc3RDaGlsZDsKICAgICAgICAgICAgICAgICAgICBjbnNsQ29udC5hcHBlbmRDaGlsZChhZHZhbmNlZE9wdGlvbnMuY29udHJvbHMpOwogICAgICAgICAgICAgICAgICAgIGhvb2tCdXR0b25zKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuYWR2T3B0cykgewogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0LmFkZCgicGxheWVyLWNvbnNvbGUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgY25zbEJ0bi5jbGFzc0xpc3QuYWRkKCJjbG9zZSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpbmlBY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBvYnNlcnZlciwgbG9hZF9tb3JlLCBjbGlja190aXRsZTsKICAgICAgICAgICAgICAgIGxvYWRfbW9yZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN3YXRjaC1tb3JlLXJlbGF0ZWQsIC5sb2FkLW1vcmUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgd2hpbGUgKGNsaWNrX3RpdGxlKSB7CiAgICAgICAgICAgICAgICAgICAgY2xpY2tfdGl0bGUuY2xhc3NMaXN0LnJlbW92ZSgieXQtdWl4LXRpbGUiKTsKICAgICAgICAgICAgICAgICAgICBjbGlja190aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtdGlsZSIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGxvYWRfbW9yZSAmJiAhbG9hZF9tb3JlLmNsYXNzTGlzdC5jb250YWlucygibW9kVGh1bWJzIikpIHsKICAgICAgICAgICAgICAgICAgICBsb2FkX21vcmUuY2xhc3NMaXN0LmFkZCgibW9kVGh1bWJzIik7CiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2RUaHVtYnMpOwogICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUobG9hZF9tb3JlLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlT2xkVmFsdWU6IHRydWUKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiAvcG9wb3V0bW9kZXxibGFja2xpc3QvLnRlc3QoZXZlbnQudGFyZ2V0LmNsYXNzTmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIGV2ZW50ID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5jbGFzc0xpc3QuY29udGFpbnMoInBvcG91dG1vZGUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwb3BQbGF5ZXIoZXZlbnQuZGF0YXNldC5saW5rKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmRhdGFzZXQueXRpZCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncy5ibGFja2xpc3RbZXZlbnQuZGF0YXNldC55dGlkXSA9IGV2ZW50LmRhdGFzZXQudXNlcjsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0KCJibGFja2xpc3QiLCB1c2VyX3NldHRpbmdzLmJsYWNrbGlzdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vZFRodW1icygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRCdXR0b25zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIGxpc3QsIHRlbXAsIHRodW1iLCBidXR0b247CiAgICAgICAgICAgICAgICBsaXN0ID0gT2JqZWN0LmtleXMobW9kVGh1bWJzLnRodW1icyk7CiAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcCA9IG1vZFRodW1icy50aHVtYnNbbGlzdFtpXV07CiAgICAgICAgICAgICAgICAgICAgaiA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChqLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSB0ZW1wW2pdLnF1ZXJ5U2VsZWN0b3IoIi55dC1sb2NrdXAtdGh1bWJuYWlsLCAudGh1bWItd3JhcHBlciIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGh1bWIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9QUE9UX09OICYmICF0aHVtYi5xdWVyeVNlbGVjdG9yKCIucG9wb3V0bW9kZSIpICYmICEvY2hhbm5lbC8udGVzdCh0ZW1wW2pdLmZpcnN0Q2hpbGQuY2xhc3NOYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmlubmVySFRNTCA9ICI8ZGl2IGRhdGEtcD0ndHRsfFBQT1RfT1BFTiZ0dHB8UFBPVF9PUEVOJyBjbGFzcz0neXQtdWl4LXRvb2x0aXAgcG9wb3V0bW9kZSB5dHBsdXNfc3ByaXRlJz48L2Rpdj4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuZGF0YXNldC5saW5rID0gdGVtcFtqXS5xdWVyeVNlbGVjdG9yKCJhW2hyZWYqPScvd2F0Y2g/diddIikuaHJlZjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYi5hcHBlbmRDaGlsZChzZXRMb2NhbGUoYnV0dG9uLmNvbnRlbnQpLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuQkxLX09OICYmICF0aHVtYi5xdWVyeVNlbGVjdG9yKCIuYmxhY2tsaXN0IikgJiYgd2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FICE9PSAiY2hhbm5lbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAiPGRpdiBkYXRhLXA9J3R0bHxCTENLX0FERCZ0dHB8QkxDS19BREQnIGNsYXNzPSd5dC11aXgtdG9vbHRpcCBibGFja2xpc3QgeXRwbHVzX3Nwcml0ZSc+PC9kaXY+IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmRhdGFzZXQudXNlciA9IHRlbXBbal0udXNlcm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQuZmlyc3RDaGlsZC5kYXRhc2V0Lnl0aWQgPSBsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iLmFwcGVuZENoaWxkKHNldExvY2FsZShidXR0b24uY29udGVudCkuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZGVsVmlkZW9zKCkgewogICAgICAgICAgICAgICAgdmFyIGksIGosIHRlbXAsIHBhcmVudCwgYmxhY2tsaXN0LCBoYXNfdXBuZXh0OwogICAgICAgICAgICAgICAgaGFzX3VwbmV4dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hdXRvcGxheS1iYXIiKTsKICAgICAgICAgICAgICAgIGJsYWNrbGlzdCA9IE9iamVjdC5rZXlzKHVzZXJfc2V0dGluZ3MuYmxhY2tsaXN0KTsKICAgICAgICAgICAgICAgIGkgPSBibGFja2xpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBtb2RUaHVtYnMudGh1bWJzW2JsYWNrbGlzdFtpXV07CiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaiA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoai0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzX3VwbmV4dCAmJiBoYXNfdXBuZXh0LmNvbnRhaW5zKHRlbXBbal0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzX3VwbmV4dC5wYXJlbnROb2RlLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc191cG5leHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIud2F0Y2gtc2lkZWJhci1zZXBhcmF0aW9uLWxpbmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzX3VwbmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfdXBuZXh0Lm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXNfdXBuZXh0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IHRlbXBbal0ucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wW2pdLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5jaGlsZEVsZW1lbnRDb3VudCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LmZpcnN0Q2hpbGQub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0ZW1wLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG1vZFRodW1icy50aHVtYnNbYmxhY2tsaXN0W2ldXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGVtcCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImZlZWQtaXRlbS1jb250YWluZXIiKTsKICAgICAgICAgICAgICAgIGkgPSB0ZW1wLmxlbmd0aDsKICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGVtcFtpXS5xdWVyeVNlbGVjdG9yQWxsKCJ1bCIpLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGVtcFtpXS5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wW2ldLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAocGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmNoaWxkRWxlbWVudENvdW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudC5maXJzdENoaWxkLm91dGVySFRNTCA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFZpZGVvcygpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBsaXN0LCB0ZW1wLCBjaGFubmVsX2lkOwogICAgICAgICAgICAgICAgbW9kVGh1bWJzLnRodW1icyA9IHt9OwogICAgICAgICAgICAgICAgbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYAogICAgICAgICAgICAgICAgICAgIC55dC1sb2NrdXAtYnlsaW5lID4gYSwKICAgICAgICAgICAgICAgICAgICAueXQtbG9ja3VwLWNvbnRlbnQgLmctaG92ZXJjYXJkLAogICAgICAgICAgICAgICAgICAgIC52aWRlby1saXN0LWl0ZW0gLmctaG92ZXJjYXJkLAogICAgICAgICAgICAgICAgICAgIC5jaGFubmVscy1jb250ZW50LWl0ZW0gLnl0LWxvY2t1cC10aXRsZSA+IGEKICAgICAgICAgICAgICAgIGApOwogICAgICAgICAgICAgICAgaSA9IGxpc3QubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSBsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgIGNoYW5uZWxfaWQgPSB0ZW1wLmRhdGFzZXQueXRpZDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGVtcCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGVtcC50YWdOYW1lICYmIHRlbXAudGFnTmFtZSA9PT0gIkxJIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcC51c2VybmFtZSA9IGxpc3RbaV0udGV4dENvbnRlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZFRodW1icy50aHVtYnNbY2hhbm5lbF9pZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RUaHVtYnMudGh1bWJzW2NoYW5uZWxfaWRdID0gW3RlbXBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RUaHVtYnMudGh1bWJzW2NoYW5uZWxfaWRdLmluZGV4T2YodGVtcCkgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kVGh1bWJzLnRodW1ic1tjaGFubmVsX2lkXS5wdXNoKHRlbXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdGVtcCA9IHRlbXAucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kVGh1bWJzKCkgewogICAgICAgICAgICAgICAgaWYgKCh1c2VyX3NldHRpbmdzLkJMS19PTiB8fCB1c2VyX3NldHRpbmdzLkdFTl9QUE9UX09OKSAmJiAhd2luZG93Lm9wZW5lciAmJiB3aW5kb3cueXQgJiYgd2luZG93Lnl0LmNvbmZpZ18gJiYgL3dhdGNofGluZGV4fGZlZWR8Y2hhbm5lbHxyZXN1bHRzLy50ZXN0KHdpbmRvdy55dC5jb25maWdfLlBBR0VfTkFNRSkpIHsKICAgICAgICAgICAgICAgICAgICBnZXRWaWRlb3MoKTsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5CTEtfT04gJiYgd2luZG93Lnl0LmNvbmZpZ18uUEFHRV9OQU1FICE9PSAiY2hhbm5lbCIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsVmlkZW9zKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNldEJ1dHRvbnMoKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGluaUFjdGlvbik7CiAgICAgICAgICAgICAgICAgICAgaW5pQWN0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0VmlkZW9Db3VudCgpIHsKICAgICAgICAgICAgICAgIHZhciBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpOwogICAgICAgICAgICAgICAgc3Bhbi50ZXh0Q29udGVudCA9ICIgwrcgIjsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VybmFtZS5hcHBlbmRDaGlsZChzcGFuKTsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rLmhyZWYgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICsgIi9jaGFubmVsLyIgKyBlbmhhbmNlZERldGFpbHMudXNlci5kYXRhc2V0Lnl0aWQgKyAiL3ZpZGVvcyI7CiAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlcm5hbWUuYXBwZW5kQ2hpbGQoZW5oYW5jZWREZXRhaWxzLmxpbmspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZGVvQ291bnQoZGV0YWlscykgewogICAgICAgICAgICAgICAgZGV0YWlscyA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3IoIi5wbC1oZWFkZXItZGV0YWlscyBsaTpudGgtY2hpbGQoMikiKTsKICAgICAgICAgICAgICAgIGlmIChkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLmxpbmsuY2xhc3NOYW1lID0gInNwZi1saW5rIjsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMubGluay50ZXh0Q29udGVudCA9IGNpZFtlbmhhbmNlZERldGFpbHMudXNlci5kYXRhc2V0Lnl0aWRdID0gZGV0YWlscy50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICBzZXRWaWRlb0NvdW50KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VmlkZW9Db3VudCgpIHsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy51c2VybmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11c2VyLWluZm8iKTsKICAgICAgICAgICAgICAgIGlmICghZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInVwbG9hZGVkLXZpZGVvcyIpICYmIGVuaGFuY2VkRGV0YWlscy51c2VybmFtZSkgewogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpOwogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rLmlkID0gInVwbG9hZGVkLXZpZGVvcyI7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLnVzZXJuYW1lLmFwcGVuZENoaWxkKGVuaGFuY2VkRGV0YWlscy5saW5rKTsKICAgICAgICAgICAgICAgICAgICBlbmhhbmNlZERldGFpbHMudXNlciA9IGVuaGFuY2VkRGV0YWlscy51c2VybmFtZS5xdWVyeVNlbGVjdG9yKCJhIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNpZFtlbmhhbmNlZERldGFpbHMudXNlci5kYXRhc2V0Lnl0aWRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy5saW5rLnRleHRDb250ZW50ID0gY2lkW2VuaGFuY2VkRGV0YWlscy51c2VyLmRhdGFzZXQueXRpZF07CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFZpZGVvQ291bnQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFhIUigiR0VUIiwgdXBkYXRlVmlkZW9Db3VudCwgIi9wbGF5bGlzdD9saXN0PSIgKyBlbmhhbmNlZERldGFpbHMudXNlci5kYXRhc2V0Lnl0aWQucmVwbGFjZSgiVUMiLCAiVVUiKSwgImRvYyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRDaGFubmVsSW5mbyhkZXRhaWxzKSB7CiAgICAgICAgICAgICAgICB2YXIgcmV0cnksIGlzTGl2ZTsKICAgICAgICAgICAgICAgIGlzTGl2ZSA9IGRldGFpbHMudGFyZ2V0LnJlc3BvbnNlLnF1ZXJ5U2VsZWN0b3IoIi55dC1iYWRnZS1saXZlIik7CiAgICAgICAgICAgICAgICBpZiAoIWlzTGl2ZSkgewogICAgICAgICAgICAgICAgICAgIHJldHJ5ID0gZGV0YWlscy50YXJnZXQucmVzcG9uc2VVUkwuc3BsaXQoIi92aWRlb3MiKS5sZW5ndGggPCAyOwogICAgICAgICAgICAgICAgICAgIGRldGFpbHMgPSBkZXRhaWxzLnRhcmdldC5yZXNwb25zZS5xdWVyeVNlbGVjdG9yQWxsKCJbZGF0YS1jb250ZXh0LWl0ZW0taWQ9JyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudmlkZW9faWQgKyAiJ10gLnl0LWxvY2t1cC1tZXRhLWluZm8gbGkiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZGV0YWlscyAmJiBkZXRhaWxzLmxlbmd0aCA+IDAgJiYgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS50ZXh0Q29udGVudC5zcGxpdCgiwrciKS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscy53YXRjaFRpbWUudGV4dENvbnRlbnQgKz0gIiDCtyAiICsgZGV0YWlsc1tyZXRyeSA/IDAgOiAxXS50ZXh0Q29udGVudDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJldHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsWEhSKCJHRVQiLCBnZXRDaGFubmVsSW5mbywgIi9jaGFubmVsLyIgKyB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MudWNpZCArICIvdmlkZW9zIiwgImRvYyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBnZXRQdWJsaXNoZWRUaW1lKCkgewogICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi53YXRjaC10aW1lLXRleHQiKTsKICAgICAgICAgICAgICAgIGlmIChlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lICYmICFlbmhhbmNlZERldGFpbHMud2F0Y2hUaW1lLmZldGNoaW5nICYmIHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnKSB7CiAgICAgICAgICAgICAgICAgICAgZW5oYW5jZWREZXRhaWxzLndhdGNoVGltZS5mZXRjaGluZyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgbG9jYWxYSFIoIkdFVCIsIGdldENoYW5uZWxJbmZvLCAiL2NoYW5uZWwvIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy51Y2lkICsgIi9zZWFyY2g/cXVlcnk9JTIyIiArIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncy52aWRlb19pZCArICIlMjIiLCAiZG9jIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZW5oYW5jZWREZXRhaWxzKCkgewogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfVklEX0NOVCkgewogICAgICAgICAgICAgICAgICAgICAgICBnZXRWaWRlb0NvdW50KCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QT1NUX1RJTUUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UHVibGlzaGVkVGltZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXZlcnNlQ29udHJvbCgpIHsKICAgICAgICAgICAgICAgIHZhciBpLCB0ZW1wLCBwcmV2LCBuZXh0LCBsaXN0LCB2aWRlb3M7CiAgICAgICAgICAgICAgICBwcmV2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnByZXYtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBuZXh0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLm5leHQtcGxheWxpc3QtbGlzdC1pdGVtIik7CiAgICAgICAgICAgICAgICBsaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsYXlsaXN0LWF1dG9zY3JvbGwtbGlzdCIpOwogICAgICAgICAgICAgICAgdmlkZW9zID0gbGlzdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgibGkiKTsKICAgICAgICAgICAgICAgIGkgPSB2aWRlb3MubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kQ2hpbGQodmlkZW9zW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRlbXAgPSBwcmV2LmhyZWY7CiAgICAgICAgICAgICAgICBwcmV2LmhyZWYgPSBuZXh0LmhyZWY7CiAgICAgICAgICAgICAgICBuZXh0LmhyZWYgPSB0ZW1wOwogICAgICAgICAgICAgICAgbGlzdC5zY3JvbGxUb3AgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY3VycmVudGx5LXBsYXlpbmciKS5vZmZzZXRUb3A7CiAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgYXBpLnVwZGF0ZVBsYXlsaXN0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcmV2ZXJzZUJ1dHRvbihldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC5pZCA9PT0gInJldmVyc2UiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldCgicGxSZXYiLCAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygieXQtdWl4LWJ1dHRvbi10b2dnbGVkIikpID8gd2luZG93Lnl0LmNvbmZpZ18uTElTVF9JRCA6IGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICByZXZlcnNlQ29udHJvbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGF1dG9wbGF5QnV0dG9uKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmlkID09PSAiYXV0b3BsYXkiKSB7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoInl0LXVpeC1idXR0b24tdG9nZ2xlZCIpOwogICAgICAgICAgICAgICAgICAgIHNldCgicGxBcGwiLCBldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dC11aXgtYnV0dG9uLXRvZ2dsZWQiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnV0dG9uKHR5cGUsIGxhYmVsLCBib29sLCBjYWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgIGJ1dHRvbi5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgIGA8YnV0dG9uIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1idXR0b24tcGxheWVyLWNvbnRyb2xzIHl0LXVpeC1idXR0b24tb3BhY2l0eSB5dC11aXgtdG9vbHRpcCcgdHlwZT0nYnV0dG9uJz4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9J3l0LXVpeC1idXR0b24taWNvbic+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPmA7CiAgICAgICAgICAgICAgICBpZiAoYm9vbCA9PT0gdHJ1ZSB8fCB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdChib29sKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmNvbnRlbnQucXVlcnlTZWxlY3RvcigiYnV0dG9uIikuY2xhc3NMaXN0LmFkZCgieXQtdWl4LWJ1dHRvbi10b2dnbGVkIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmlkID0gdHlwZTsKICAgICAgICAgICAgICAgIGJ1dHRvbi5jb250ZW50LmZpcnN0Q2hpbGQuZGF0YXNldC5wID0gInR0cHwiICsgbGFiZWwgKyAiJnR0bHwiICsgbGFiZWw7CiAgICAgICAgICAgICAgICBidXR0b24uY29udGVudC5maXJzdENoaWxkLmNsYXNzTGlzdC5hZGQoInl0LXVpeC1idXR0b24taWNvbi13YXRjaC1hcHBiYXItIiArIHR5cGUgKyAiLXZpZGVvLWxpc3QiLCAieXRwbHVzX3Nwcml0ZSIpOwogICAgICAgICAgICAgICAgYnV0dG9uID0gc2V0TG9jYWxlKGJ1dHRvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgcGxheWxpc3RDb250cm9scy5wbEJhci5jbGFzc05hbWUgPSBwbGF5bGlzdENvbnRyb2xzLnBsQmFyLmNsYXNzTmFtZS5yZXBsYWNlKCJyYWRpby1wbGF5bGlzdCIsICIiKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgY2FsbCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtbmF2LWNvbnRyb2xzIikuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwbGF5bGlzdENvbnRyb2xzKCkgewogICAgICAgICAgICAgICAgcGxheWxpc3RDb250cm9scy5wbEJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3YXRjaC1hcHBiYXItcGxheWxpc3QiKTsKICAgICAgICAgICAgICAgIGlmIChwbGF5bGlzdENvbnRyb2xzLnBsQmFyKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICJjb21wbGV0ZSIgJiYgdXNlcl9zZXR0aW5ncy5wbFJldiAmJiB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCh1c2VyX3NldHRpbmdzLnBsUmV2KS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmVyc2VDb250cm9sKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFNUX1JWUlMgJiYgIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyZXZlcnNlIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlQnV0dG9uKCJyZXZlcnNlIiwgIlBMU1RfUlZSUyIsIHVzZXJfc2V0dGluZ3MucGxSZXYsIHJldmVyc2VCdXR0b24pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExTVF9BVFBMICYmICFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXV0b3BsYXkiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVCdXR0b24oImF1dG9wbGF5IiwgIlBMU1RfQVAiLCB1c2VyX3NldHRpbmdzLnBsQXBsLCBhdXRvcGxheUJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHhoclBhdGNoKGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdGVtcCwgcGxheWVyOwogICAgICAgICAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCkgewogICAgICAgICAgICAgICAgICAgIHRlbXAgPSB7YXJnczogSlNPTi5wYXJzZSgKICAgICAgICAgICAgICAgICAgICAgICAgIntcIiIgKwogICAgICAgICAgICAgICAgICAgICAgICBkZWNvZGVVUklDb21wb25lbnQodGhpcy5yZXNwb25zZVRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lNUMvZywgIiU1QyU1QyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIyL2csICIlNUMlMjIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyYvZywgIlwiLFwiIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9cPS9nLCAiXCI6XCIiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1wrL2csICIlMjAiKQogICAgICAgICAgICAgICAgICAgICAgICApICsKICAgICAgICAgICAgICAgICAgICAgICAgIlwifSIKICAgICAgICAgICAgICAgICAgICApfTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gbW9kQXJncyh0ZW1wKTsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KHRlbXAuYXJncykuc3BsaXQoL1x7IihbXHdcV10qPykiXH0vKVsxXSkKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyU1Qy9nLCAiJTVDIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyU1QyUyMi9nLCAiJTIyIikKICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyMiUyQyUyMi9nLCAiJiIpCiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8lMjIlM0ElMjIvZywgIj0iKQogICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvJTIwL2csICIrIik7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJyZXNwb25zZVRleHQiLCB7d3JpdGFibGU6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3BvbnNlVGV4dCA9IHRlbXA7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLnNldFBsYXliYWNrUXVhbGl0eSh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBjaGVja1hIUihvcmlnaW5hbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1ldGhvZCwgdXJsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHVybC5tYXRjaCgiZ2V0X3ZpZGVvX2luZm8iKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoInJlYWR5c3RhdGVjaGFuZ2UiLCB4aHJQYXRjaCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBoaWRlVm9sdW1lKCkgewogICAgICAgICAgICAgICAgaWYgKHZvbHVtZVdoZWVsLmNCb3R0b20gJiYgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuY29udGFpbnMoInl0cC12b2x1bWUtc2xpZGVyLWFjdGl2ZSIpKSB7CiAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QucmVtb3ZlKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGUgdm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiB2b2x1bWVXaGVlbChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGZzUGwsIHBTZXRzLCBpdkNhcmQsIHBsYXllciwgY2FuU2Nyb2xsLCBkaXJlY3Rpb247CiAgICAgICAgICAgICAgICBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJ2aWRlbyIpOwogICAgICAgICAgICAgICAgZnNQbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtcGxheWxpc3QtbWVudSIpOwogICAgICAgICAgICAgICAgcFNldHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLXNldHRpbmdzLW1lbnUiKTsKICAgICAgICAgICAgICAgIGl2Q2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5pdi1kcmF3ZXIiKTsKICAgICAgICAgICAgICAgIGNhblNjcm9sbCA9IGV2ZW50ICYmICghZnNQbCB8fCAoZnNQbCAmJiAhZnNQbC5jb250YWlucyhldmVudC50YXJnZXQpKSkgJiYgKCFpdkNhcmQgfHwgKGl2Q2FyZCAmJiAhaXZDYXJkLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpKSAmJiAoIXBTZXRzIHx8IChwU2V0cyAmJiAhcFNldHMuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpOwogICAgICAgICAgICAgICAgaWYgKGV2ZW50ICYmIGFwaSAmJiBwbGF5ZXIgJiYgY2FuU2Nyb2xsICYmIChldmVudC50YXJnZXQuaWQgPT09IGFwaSB8fCBhcGkuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIHZvbHVtZVdoZWVsLmNCb3R0b20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIueXRwLWNocm9tZS1ib3R0b20iKTsKICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXZvbHVtZVdoZWVsLmNCb3R0b20uY2xhc3NMaXN0LmNvbnRhaW5zKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwuY0JvdHRvbS5jbGFzc0xpc3QuYWRkKCJ5dHAtdm9sdW1lLXNsaWRlci1hY3RpdmUiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAodm9sdW1lV2hlZWwuY0JvdHRvbS50aW1lcikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcGkuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoIm1vdXNlbW92ZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2b2x1bWVXaGVlbC5jQm90dG9tLnRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoaGlkZVZvbHVtZSwgNDAwMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbiA9IGV2ZW50ICYmIChldmVudC5kZWx0YVkgfHwgZXZlbnQud2hlZWxEZWx0YVkpOwogICAgICAgICAgICAgICAgICAgIGFwaS5zZXRWb2x1bWUocGxheWVyLnZvbHVtZSAqIDEwMCAtIChNYXRoLnNpZ24oZGlyZWN0aW9uKSAqIDUpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50ICYmIHVzZXJfc2V0dGluZ3MuVklEX1ZPTF9XSEVFTCkgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIndoZWVsIiwgdm9sdW1lV2hlZWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09ICIvd2F0Y2giKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigid2hlZWwiLCB2b2x1bWVXaGVlbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gZHJhZ1BvcE91dChldmVudCkgewogICAgICAgICAgICAgICAgdmFyIGV4Y2x1ZGVkLCBpc0ZTY3JlZW47CiAgICAgICAgICAgICAgICBleGNsdWRlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dHAtY2hyb21lLWJvdHRvbSIpOwogICAgICAgICAgICAgICAgaXNGU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLnl0cC1mdWxsc2NyZWVuIik7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgIWlzRlNjcmVlbiAmJiAoIWV4Y2x1ZGVkIHx8IChldmVudC50YXJnZXQgIT09IGV4Y2x1ZGVkICYmICFleGNsdWRlZC5jb250YWlucyhldmVudC50YXJnZXQpKSkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9ucyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQudHlwZSA9PT0gIm1vdXNlZG93biIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBkcmFnUG9wT3V0LCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbGRQb3MgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWDogZXZlbnQuY2xpZW50WCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBZOiBldmVudC5jbGllbnRZLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ1g6IGV2ZW50LmNsaWVudFgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnWTogZXZlbnQuY2xpZW50WQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC50eXBlID09PSAibW91c2Vtb3ZlIiAmJiAod2luZG93Lmhhc01vdmVkIHx8IE1hdGguYWJzKGV2ZW50LmNsaWVudFggLSB3aW5kb3cub2xkUG9zLm9yZ1gpID4gMTAgfHwgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIHdpbmRvdy5vbGRQb3Mub3JnWSkgPiAxMCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tb3ZlQnkoZXZlbnQuY2xpZW50WCAtIHdpbmRvdy5vbGRQb3MuWCwgZXZlbnQuY2xpZW50WSAtIHdpbmRvdy5vbGRQb3MuWSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuaGFzTW92ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5idXR0b25zICE9PSAxIHx8IGV2ZW50LnR5cGUgPT09ICJjbGljayIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5oYXNNb3ZlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHdpbmRvdy5vbGRQb3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgd2luZG93Lmhhc01vdmVkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIGRyYWdQb3BPdXQsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50ICYmIHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGRyYWdQb3BPdXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc3VtZVBsYXliYWNrKCkgewogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSB0aGlzLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInZpZGVvIik7CiAgICAgICAgICAgICAgICBpZiAodGVtcCAmJiAhaXNOYU4odGVtcC5kdXJhdGlvbikgJiYgdGVtcC5jdXJyZW50VGltZSA8IHRlbXAuZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICB0ZW1wID0gdGVtcC5jdXJyZW50VGltZTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSAidD0iICsgdGVtcDsKICAgICAgICAgICAgICAgICAgICB9LCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwb3BQbGF5ZXIodXJsKSB7CiAgICAgICAgICAgICAgICB2YXIgcG9wT3V0LCB3aWR0aCwgaGVpZ2h0LCBwb3BfdXJsLCB2aWRlbzsKICAgICAgICAgICAgICAgIHdpZHRoID0gcGFyc2VJbnQodXNlcl9zZXR0aW5ncy5WSURfUFBPVF9TWikgfHwgNTMzOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCh3aWR0aCAvICgxNiAvIDkpKTsKICAgICAgICAgICAgICAgIHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigidmlkZW8iKTsKICAgICAgICAgICAgICAgIHBvcF91cmwgPSAoIXVybC50YXJnZXQgJiYgdXJsKSB8fCB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgvJnQ9WzAtOV0rfCN0PVswLTldK3wmdGltZT1bMC05XSsvKS5qb2luKCIiKTsKICAgICAgICAgICAgICAgIGlmICh1cmwudGFyZ2V0ICYmIHZpZGVvICYmIHZpZGVvLmN1cnJlbnRUaW1lICYmIHZpZGVvLmN1cnJlbnRUaW1lIDwgdmlkZW8uZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwb3BfdXJsICs9ICIjdD0iICsgdmlkZW8uY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzLnN0YXJ0ID0gdmlkZW8uY3VycmVudFRpbWU7CiAgICAgICAgICAgICAgICAgICAgYXBpLmN1ZVZpZGVvQnlQbGF5ZXJWYXJzKHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwb3BPdXQgPSB3aW5kb3cub3Blbihwb3BfdXJsLCAicG9wT3V0IiwgIndpZHRoPSIgKyB3aWR0aCArICIsaGVpZ2h0PSIgKyBoZWlnaHQpOwogICAgICAgICAgICAgICAgaWYgKHVybC50YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICBwb3BPdXQuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgcmVzdW1lUGxheWJhY2spOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcG9wT3V0LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2V0U3ViUGxheWxpc3QoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBsaXN0LCBidXR0b247CiAgICAgICAgICAgICAgICBsaXN0ID0gW107CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLmlkID09PSAic3Vic2NyaXB0aW9uLXBsYXlsaXN0IikgewogICAgICAgICAgICAgICAgICAgIGkgPSBzdWJQbGF5bGlzdC52aWRlb19saXN0Lmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QucHVzaChzdWJQbGF5bGlzdC52aWRlb19saXN0W2ldLmRhdGFzZXQudmlkZW9JZHMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpc3QgPSBsaXN0LnJldmVyc2UoKS5zcGxpY2UoMCwgMjApLmpvaW4oIiUyQyIpOwogICAgICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgPSBzdWJQbGF5bGlzdC5saXN0X3RpdGxlICYmIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUucXVlcnlTZWxlY3RvcigiLmVwaWMtbmF2LWl0ZW0taGVhZGluZyIpLnRleHRDb250ZW50LnRyaW0oKTsKICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3Vic2NyaXB0aW9uLXBsYXlsaXN0Iik7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uLmhyZWYgPSAiL3dhdGNoX3ZpZGVvcz90aXRsZT0iICsgc3ViUGxheWxpc3QubGlzdF90aXRsZSArICImdmlkZW9faWRzPSIgKyBsaXN0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIHN1YlBsYXlsaXN0KCkgewogICAgICAgICAgICAgICAgdmFyIGJ1dHRvbiwgbmF2X21lbnU7CiAgICAgICAgICAgICAgICBuYXZfbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hcHBiYXItbmF2LW1lbnUiKTsKICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdWJzY3JpcHRpb24tcGxheWxpc3QiKTsKICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0Lmxpc3RfdGl0bGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuYXBwYmFyLW5hdi1tZW51Iik7CiAgICAgICAgICAgICAgICBzdWJQbGF5bGlzdC52aWRlb19saXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiYWRkdG8td2F0Y2gtbGF0ZXItYnV0dG9uIik7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fU1VCX0xJU1QgJiYgbmF2X21lbnUgJiYgd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIi9mZWVkL3N1YnNjcmlwdGlvbnMiKS5sZW5ndGggPiAxICYmICFidXR0b24gJiYgc3ViUGxheWxpc3QubGlzdF90aXRsZSAmJiBzdWJQbGF5bGlzdC52aWRlb19saXN0KSB7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGVtcGxhdGUiKTsKICAgICAgICAgICAgICAgICAgICBidXR0b24uaW5uZXJIVE1MID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYDxsaSBpZD0nc3Vic2NyaXB0aW9uLXBsYXlsaXN0LWljb24nPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaWQ9J3N1YnNjcmlwdGlvbi1wbGF5bGlzdCcgZGF0YS1wPSd0dGx8U1VCX1BMU1QnIGNsYXNzPSd5dC11aXgtYnV0dG9uIHNwZi1saW5rIHl0LXVpeC1zZXNzaW9ubGluayB5dC11aXgtYnV0dG9uLWVwaWMtbmF2LWl0ZW0geXQtdWl4LWJ1dHRvbi1zaXplLWRlZmF1bHQnPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSd5dC11aXgtYnV0dG9uLWNvbnRlbnQgeXRwbHVzX3Nwcml0ZSc+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9hPgogICAgICAgICAgICAgICAgICAgICAgICA8L2xpPmA7CiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gc2V0TG9jYWxlKGJ1dHRvbi5jb250ZW50KS5maXJzdENoaWxkOwogICAgICAgICAgICAgICAgICAgIG5hdl9tZW51LmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBzZXRTdWJQbGF5bGlzdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbG9hZENvbW1lbnRzKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlICYmIGV2ZW50LnRhcmdldC5wYXJlbnROb2RlLmlkID09PSAiUC1zaG93LWNvbW1lbnRzIikgewogICAgICAgICAgICAgICAgICAgIGlmIChtb2RDb21tZW50cy5jb21tZW50cy5sYXp5bG9hZCkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc3BmLmxvYWQuYXBwbHkobWFpbiwgbW9kQ29tbWVudHMuY29tbWVudHMubGF6eWxvYWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtb2RDb21tZW50cy5jb21tZW50cy5jbGFzc0xpc3QudG9nZ2xlKCJzaG93Iik7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlci5xdWVyeVNlbGVjdG9yKCJidXR0b24iKS50ZXh0Q29udGVudCA9IGxhbmcoKG1vZENvbW1lbnRzLmNvbW1lbnRzLmNsYXNzTGlzdC5jb250YWlucygic2hvdyIpICYmICJISURFX0NNVFMiKSB8fCAiU0hPV19DTVRTIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbW9kQ29tbWVudHMoKSB7CiAgICAgICAgICAgICAgICB2YXIgaXNfbGl2ZSA9IHdpbmRvdy55dHBsYXllciAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnICYmIHdpbmRvdy55dHBsYXllci5jb25maWcuYXJncyAmJiB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmFyZ3MubGl2ZXN0cmVhbTsKICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWRpc2N1c3Npb24iKTsKICAgICAgICAgICAgICAgIGlmICghaXNfbGl2ZSAmJiBtb2RDb21tZW50cy5jb21tZW50cyAmJiAhZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIlAtc2hvdy1jb21tZW50cyIpICYmIHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRlbXBsYXRlIik7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlci5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBpZD0nUC1zaG93LWNvbW1lbnRzJyBjbGFzcz0neXQtY2FyZCc+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSd5dC11aXgtYnV0dG9uIHl0LXVpeC1idXR0b24tZXhwYW5kZXInIGRhdGEtcD0ndG5kfFNIT1dfQ01UUyc+PC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7CiAgICAgICAgICAgICAgICAgICAgbW9kQ29tbWVudHMud3JhcHBlciA9IHNldExvY2FsZShtb2RDb21tZW50cy53cmFwcGVyLmNvbnRlbnQpLmZpcnN0Q2hpbGQ7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBsb2FkQ29tbWVudHMpOwogICAgICAgICAgICAgICAgICAgIG1vZENvbW1lbnRzLmNvbW1lbnRzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG1vZENvbW1lbnRzLndyYXBwZXIsIG1vZENvbW1lbnRzLmNvbW1lbnRzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXRDdXN0b21TdHlsZXMoY2xzcykgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdFt1c2VyX3NldHRpbmdzW2Nsc3NdID8gImFkZCIgOiAicmVtb3ZlIl0oY3VzdG9tU3R5bGVzLmN1c3RvbV9zdHlsZXNbY2xzc10pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGN1c3RvbVN0eWxlcygpIHsKICAgICAgICAgICAgICAgIHZhciBjaGlsZCwgcGFyZW50LCBwbHJfYXBpLCBjb21tZW50cywgc2lkZWJhciwgeXRHcmlkLCBhZHZlcnRzLCBhZHNfbGlzdDsKICAgICAgICAgICAgICAgIGNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhdGNoLWRpc2N1c3Npb24iKTsKICAgICAgICAgICAgICAgIHl0R3JpZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi55dC11aXgtbWVudS10b3AtbGV2ZWwtZmxvdy1idXR0b246bGFzdC1jaGlsZCBhIik7CiAgICAgICAgICAgICAgICBjdXN0b21TdHlsZXMuY3VzdG9tX3N0eWxlcyA9IHsKICAgICAgICAgICAgICAgICAgICBHRU5fRFNCTF9BRFMgICAgOiAicGFydF9ub19hZHMiLAogICAgICAgICAgICAgICAgICAgIEdFTl9CTFVFX0dMT1cgICA6ICJwYXJ0X2RzYmxfZ2xvdyIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0hJREVfRlRSICAgIDogInBhcnRfaGlkZV9mb290ZXIiLAogICAgICAgICAgICAgICAgICAgIEdFTl9CVFRSX05URiAgICA6ICJwYXJ0X25vdGlmX2J1dHRvbiIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0dSSURfU1VCUyAgIDogInBhcnRfZ3JpZF9zdWJzIiwKICAgICAgICAgICAgICAgICAgICBHRU5fR1JJRF9TUkNIICAgOiAicGFydF9ncmlkX3NlYXJjaCIsCiAgICAgICAgICAgICAgICAgICAgR0VOX0NNUFRfVFRMUyAgIDogInBhcnRfY29tcGFjdF90aXRsZXMiLAogICAgICAgICAgICAgICAgICAgIFZJRF9QTFJfQVRQTCAgICA6ICJwYXJ0X2F1dG9wbGF5b24iLAogICAgICAgICAgICAgICAgICAgIFZJRF9QTFJfRklUICAgICA6ICJwYXJ0X2ZpdF90aGVhdGVyIiwKICAgICAgICAgICAgICAgICAgICBWSURfUExSX0RZTl9TSVpFOiAicGFydF9zdGF0aWNfc2l6ZSIsCiAgICAgICAgICAgICAgICAgICAgVklEX0hJREVfREVUTFMgIDogInBhcnRfaGlkZV9kZXRhaWxzIiwKICAgICAgICAgICAgICAgICAgICBWSURfVFRMX0NNUFQgICAgOiAicGFydF9jb21wYWN0X3RpdGxlIiwKICAgICAgICAgICAgICAgICAgICBWSURfREVTQ19TSFJUICAgOiAicGFydF9sYWJlbGxlc3NfYnV0dG9ucyIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0ICYmIHdpbmRvdy55dC5jb25maWdfICYmIHdpbmRvdy55dC5jb25maWdfLlBBR0VfTkFNRSA9PT0gInNoYXJlZF9jb252ZXJzYXRpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnN0b3AoKTsKICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJbcmVsPSdzaG9ydGxpbmsnXSIpLmhyZWY7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwYXJ0X3BvcG91dCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHl0R3JpZCAmJiB1c2VyX3NldHRpbmdzLkdFTl9HUklEX1NVQlMpIHsKICAgICAgICAgICAgICAgICAgICB5dEdyaWQuY2xpY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcGxyX2FwaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXItYXBpIik7CiAgICAgICAgICAgICAgICAgICAgc2lkZWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5icmFuZGVkLXBhZ2UtdjItc2Vjb25kYXJ5LWNvbCIpOwogICAgICAgICAgICAgICAgICAgIGFkc19saXN0ID0gLy8KICAgICAgICAgICAgICAgICAgICAgICAgYCNtYXN0aGVhZF9jaGlsZCwKICAgICAgICAgICAgICAgICAgICAgICAgI2ZlZWQtcHl2LWNvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgI3dhdGNoNy1zaWRlYmFyLWFkcywKICAgICAgICAgICAgICAgICAgICAgICAgI3dhdGNoNy1zaWRlYmFyLW9mZmVyLAogICAgICAgICAgICAgICAgICAgICAgICAuYWQtZGl2LAogICAgICAgICAgICAgICAgICAgICAgICAucHl2LWFmYy1hZHMtY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgICAgICAudmlkZW8tbGlzdC1pdGVtOm5vdCgucmVsYXRlZC1saXN0LWl0ZW0pOm5vdCguZGFzaGJvYXJkLXdpZGdldC1pdGVtKWA7CiAgICAgICAgICAgICAgICAgICAgYWR2ZXJ0cyA9IHVzZXJfc2V0dGluZ3MuR0VOX0RTQkxfQURTICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWRzX2xpc3QpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChhZHZlcnRzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gYWR2ZXJ0czsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGNoaWxkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnQgPSBjaGlsZC5wYXJlbnROb2RlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudC5jaGlsZEVsZW1lbnRDb3VudCA+IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkID0gcGFyZW50OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFkdmVydHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGFkc19saXN0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09ICIvcmVzdWx0cyIgJiYgc2lkZWJhciAmJiBzaWRlYmFyLnF1ZXJ5U2VsZWN0b3JBbGwoIioiKS5sZW5ndGggPCAxMCkgfHwgKHNpZGViYXIgJiYgKCh1c2VyX3NldHRpbmdzLkdFTl9IREVfUkVDTV9TREJSICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCIvZmVlZC9zdWJzY3JpcHRpb25zIikubGVuZ3RoID4gMSkgfHwgKHVzZXJfc2V0dGluZ3MuR0VOX0hERV9TUkNIX1NEQlIgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3Jlc3VsdHMiKSB8fCAodXNlcl9zZXR0aW5ncy5HRU5fSERFX0NITl9TREJSICYmIHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KC9cLyhjaGFubmVsfHVzZXJ8YylcLy8pLmxlbmd0aCA+IDEpKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2lkZWJhci5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgdXNlcl9zZXR0aW5ncy5WSURfSElERV9DT01TID4gMSAmJiBjb21tZW50cykgewogICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50cy5vdXRlckhUTUwgPSAiIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyA9PT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0hJREVfQ09NUyAhPT0gIjEiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJwYXJ0X2hpZGVfY29tbWVudHMiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVQgJiYgcGxyX2FwaSAmJiAoISFwbHJfYXBpLnN0eWxlLm1heFdpZHRoIHx8IHBscl9hcGkuc3R5bGUubWF4V2lkdGggIT09IHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVRfV0RUSCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGxyX2FwaS5zdHlsZS5tYXhXaWR0aCA9IHVzZXJfc2V0dGluZ3MuVklEX1BMUl9GSVRfV0RUSCB8fCAiMTI4MHB4IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY3VzdG9tU3R5bGVzLmN1c3RvbV9zdHlsZXMpLmZvckVhY2goc2V0Q3VzdG9tU3R5bGVzKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoIi9mZWVkL3N1YnNjcmlwdGlvbnMiKS5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCJwYXJ0X2dyaWRfc3VicyIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBkZWZhdWx0Q2hhbm5lbFBhZ2UoZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJlbnROb2RlOwogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX0NITl9ERkxUX1BBR0UgIT09ICJkZWZhdWx0IikgewogICAgICAgICAgICAgICAgICAgIGlmIChldmVudCAmJiBldmVudC50YXJnZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZSA9IGV2ZW50LnRhcmdldDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LnRhcmdldC50YWdOYW1lICE9PSAiQSIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChwYXJlbnROb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLnRhZ05hbWUgPT09ICJBIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudE5vZGUgJiYgcGFyZW50Tm9kZS5ocmVmICYmIHBhcmVudE5vZGUuaHJlZi5zcGxpdCh1c2VyX3NldHRpbmdzLkdFTl9DSE5fREZMVF9QQUdFKS5sZW5ndGggPCAyICYmIChwYXJlbnROb2RlLmhyZWYuc3BsaXQoIi9jaGFubmVsLyIpLmxlbmd0aCA+IDEgfHwgcGFyZW50Tm9kZS5ocmVmLnNwbGl0KCIvdXNlci8iKS5sZW5ndGggPiAxKSAmJiBwYXJlbnROb2RlLmhyZWYuc3BsaXQoL1thLXowLTldXC9bYS16MC05XS9pKS5sZW5ndGggPCA0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnROb2RlLmhyZWYgKz0gIi8iICsgdXNlcl9zZXR0aW5ncy5HRU5fQ0hOX0RGTFRfUEFHRTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNldXAiLCBkZWZhdWx0Q2hhbm5lbFBhZ2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtb2RBcmdzKGNvbmZpZykgewogICAgICAgICAgICAgICAgdmFyIGksIHRlbXAsIGxpc3QsIGxlbmd0aCwgdmlkZW9zLCBuZXdfbGlzdCwgY2FuX3NoYXJlOwogICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLnZpZGVvX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy5uYW1lID09PSAicG9wT3V0IikgewogICAgICAgICAgICAgICAgICAgICAgICBjYW5fc2hhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIucGxheWxpc3QtaGVhZGVyLWNvbnRlbnQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbl9zaGFyZSAmJiBjYW5fc2hhcmUuZGF0YXNldC5zaGFyZWFibGUgPT09ICJGYWxzZSIgJiYgIWNvbmZpZy5hcmdzLnZpZGVvKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy52aWRlbyA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgibGlbZGF0YS12aWRlby1pZF0iKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCA9IHZpZGVvcy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy52aWRlb1tpXSA9IHsiZW5jcnlwdGVkX2lkIjogdmlkZW9zW2ldLmdldEF0dHJpYnV0ZSgiZGF0YS12aWRlby1pZCIpfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGNvbmZpZy5hcmdzLnRpdGxlOwogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5lbCA9ICJlbWJlZGRlZCI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLnZxID0gdXNlcl9zZXR0aW5ncy5WSURfREZMVF9RTFRZOwogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9ERkxUX1FMVFkgIT09ICJhdXRvIikgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZVsieXQtcGxheWVyLXF1YWxpdHkiXSA9IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGF0YSI6IHVzZXJfc2V0dGluZ3MuVklEX0RGTFRfUUxUWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXhwaXJhdGlvbiI6IG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgODY0RTUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImNyZWF0aW9uIjogbmV3IERhdGUoKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChpZ25vcmUpIHt9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChjb25maWcuYXJncy5jYXB0aW9uX2F1ZGlvX3RyYWNrcyAmJiB1c2VyX3NldHRpbmdzLlZJRF9QTFJfQ0MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuY2FwdGlvbl9hdWRpb190cmFja3MgPSBjb25maWcuYXJncy5jYXB0aW9uX2F1ZGlvX3RyYWNrcy5zcGxpdCgvJmQ9WzAtOV18ZD1bMC05XSYvKS5qb2luKCIiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9WT0xfTEROKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuYXJncy5sb3VkbmVzczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9IVE1MNSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuaHRtbDUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5WSURfUExSX0lORk8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3Muc2hvd2luZm8gPSAiMSI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cub3BlbmVyICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoICE9PSAiIikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5hdXRvcGxheSA9ICIxIjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF1c2VyX3NldHRpbmdzLlZJRF9QTFJfQVRQTCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5hdXRvcGxheSA9ICIwIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX1BMUl9TSVpFX01FTSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXJncy5wbGF5ZXJfd2lkZSA9ICh1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlICYmICIxIikgfHwgIjAiOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cHNldHdpZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBzZXR3aWRlKCJ3aWRlIiwgY29uZmlnLmFyZ3MucGxheWVyX3dpZGUsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3MuaXZfbG9hZF9wb2xpY3kgJiYgdXNlcl9zZXR0aW5ncy5WSURfUExSX0FOVFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuaXZfbG9hZF9wb2xpY3kgPSAiMyI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfQURTICYmICghdXNlcl9zZXR0aW5ncy5WSURfU1VCX0FEUyB8fCAodXNlcl9zZXR0aW5ncy5WSURfU1VCX0FEUyAmJiAhY29uZmlnLmFyZ3Muc3Vic2NyaWJlZCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuYXJncy5hZDNfbW9kdWxlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoY29uZmlnLmFyZ3Mudm1hcCAmJiAhdXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwgJiYgIXVzZXJfc2V0dGluZ3MuVklEX1BMUl9BRFMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmFyZ3MuZHZtYXAgPSBjb25maWcuYXJncy52bWFwOwogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmFyZ3Mudm1hcDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbmZpZy5hcmdzLmFkYXB0aXZlX2ZtdHMgJiYgdXNlcl9zZXR0aW5ncy5WSURfUExSX0hGUikgewogICAgICAgICAgICAgICAgICAgICAgICBuZXdfbGlzdCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ID0gY29uZmlnLmFyZ3MuYWRhcHRpdmVfZm10cy5zcGxpdCgiLCIpOwogICAgICAgICAgICAgICAgICAgICAgICBpID0gbGlzdC5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBsaXN0W2ldLnNwbGl0KC9mcHNcPShbMC05XXsyfSkvKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGVtcCB8fCB0ZW1wIDwgMzEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdfbGlzdC5wdXNoKGxpc3RbaV0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hcmdzLmFkYXB0aXZlX2ZtdHMgPSBuZXdfbGlzdC5qb2luKCIsIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cueXRwbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHdpbmRvdy55dHBsYXllci5jb25maWcgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy55dHBsYXllci5jb25maWcgPSBjb25maWc7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAod2luZG93Lnl0cGxheWVyLmNvbmZpZykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5hcmdzID0gY29uZmlnLmFyZ3M7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYWxDaGFuZ2VzKCkgewogICAgICAgICAgICAgICAgdmFyIGxvZ28sIGNoZWNrYm94LCBhdXRvcGxheWJhciwgZGVzY3JpcHRpb247CiAgICAgICAgICAgICAgICBhdXRvcGxheWJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hdXRvcGxheS1iYXIiKTsKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFjdGlvbi1wYW5lbC1kZXRhaWxzIik7CiAgICAgICAgICAgICAgICBpZiAodXNlcl9zZXR0aW5ncy5HRU5fWVRfTE9HT19MSU5LICYmIHdpbmRvdy55dCAmJiB3aW5kb3cueXQuY29uZmlnXyAmJiB3aW5kb3cueXQuY29uZmlnXy5MT0dHRURfSU4pIHsKICAgICAgICAgICAgICAgICAgICBsb2dvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigibWFwW25hbWU9J2Rvb2RsZSddID4gYXJlYSwgYSNsb2dvLWNvbnRhaW5lciIpOwogICAgICAgICAgICAgICAgICAgIGlmIChsb2dvICYmIGxvZ28uaHJlZiA9PT0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiArICIvIikgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dvLmhyZWYgPSAiL2ZlZWQvc3Vic2NyaXB0aW9ucyI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuR0VOX1JFTV9BUFVOICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gIi93YXRjaCIgJiYgYXV0b3BsYXliYXIpIHsKICAgICAgICAgICAgICAgICAgICBjaGVja2JveCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGVja2JveC1vbi1vZmYiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tib3gpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3gub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHVzZXJfc2V0dGluZ3MuVklEX0xBWVRfQVVUT19QTkwgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIiAmJiBkZXNjcmlwdGlvbikgewogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLmNsYXNzTGlzdC5yZW1vdmUoInl0LXVpeC1leHBhbmRlci1jb2xsYXBzZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLkdFTl9TUEZfT0ZGICYmIHdpbmRvdy5zcGYgJiYgd2luZG93LnNwZi5kaXNwb3NlKSB7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNwZi5kaXNwb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbG9jYWxYSFIobWV0aG9kLCBjYWxsLCB1cmwsIGhlYWQpIHsKICAgICAgICAgICAgICAgIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoImxvYWQiLCBjYWxsKTsKICAgICAgICAgICAgICAgIHJlcXVlc3Qub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBpZiAoaGVhZCAmJiBoZWFkICE9PSAiZG9jIikgewogICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcihoZWFkWzBdLCBoZWFkWzFdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5yZXNwb25zZVR5cGUgPSAiZG9jdW1lbnQiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVxdWVzdC5zZW5kKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gcGxheWVyTW9kZSgpIHsKICAgICAgICAgICAgICAgIHZhciBwYWdlRWxlbWVudCwgcGxheWVyRWxlbWVudDsKICAgICAgICAgICAgICAgIGlmICh1c2VyX3NldHRpbmdzLlZJRF9QTFJfU0laRV9NRU0pIHsKICAgICAgICAgICAgICAgICAgICBwYWdlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwYWdlIik7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwbGF5ZXIiKTsKICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cHNldHdpZGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lnl0cHNldHdpZGUoIndpZGUiLCAodXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/ICIxIiA6ICIwIiksIC0xKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllckVsZW1lbnQgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lID09PSAiL3dhdGNoIikgewogICAgICAgICAgICAgICAgICAgICAgICBwYWdlRWxlbWVudC5jbGFzc0xpc3RbdXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/ICJhZGQiIDogInJlbW92ZSJdKCJ3YXRjaC13aWRlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VFbGVtZW50LmNsYXNzTmFtZSA9IHBhZ2VFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKHVzZXJfc2V0dGluZ3MudGhlYXRlck1vZGUgPyAibm9uLSIgOiAid2F0Y2gtc3RhZ2UiLCB1c2VyX3NldHRpbmdzLnRoZWF0ZXJNb2RlID8gIiIgOiAid2F0Y2gtbm9uLXN0YWdlIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckVsZW1lbnQuY2xhc3NOYW1lID0gdXNlcl9zZXR0aW5ncy50aGVhdGVyTW9kZSA/IHBsYXllckVsZW1lbnQuY2xhc3NOYW1lLnJlcGxhY2UoInNtYWxsIiwgImxhcmdlIikgOiBwbGF5ZXJFbGVtZW50LmNsYXNzTmFtZS5yZXBsYWNlKCJsYXJnZSIsICJzbWFsbCIpLnJlcGxhY2UoIm1lZGl1bSIsICJzbWFsbCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpbmZpbml0ZVNjcm9sbCgpIHsKICAgICAgICAgICAgICAgIHZhciBvYnNlcnZlciwgbG9hZE1vcmU7CiAgICAgICAgICAgICAgICBsb2FkTW9yZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5sb2FkLW1vcmUtYnV0dG9uIik7CiAgICAgICAgICAgICAgICBpZiAobG9hZE1vcmUgJiYgdXNlcl9zZXR0aW5ncy5HRU5fSU5GX1NDUkwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxvYWRNb3JlLmNsYXNzTGlzdC5jb250YWlucygiaW5maW5pdGVTY3JvbGwiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTW9yZS5jbGFzc0xpc3QuYWRkKCJpbmZpbml0ZVNjcm9sbCIpOwogICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGluZmluaXRlU2Nyb2xsKTsKICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShsb2FkTW9yZSwge2F0dHJpYnV0ZXM6IHRydWV9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFsb2FkTW9yZS5jbGFzc0xpc3QuY29udGFpbnMoInNjcm9sbGRldGVjdCIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRNb3JlLmNsYXNzTGlzdC5hZGQoInNjcm9sbGRldGVjdCIpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2FkTW9yZS5kYXRhc2V0LnNjcm9sbGRldGVjdENhbGxiYWNrID0gImxvYWQtbW9yZS1hdXRvIjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tOZXdGZWF0dXJlcygpIHsKICAgICAgICAgICAgICAgIHZhciBpLCBrZXlzOwogICAgICAgICAgICAgICAga2V5cyA9IE9iamVjdC5rZXlzKGRlZmF1bHRfc2V0dGluZ3MpOwogICAgICAgICAgICAgICAgaSA9IGtleXMubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGkpIHsKICAgICAgICAgICAgICAgICAgICBpIC09IDE7CiAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyX3NldHRpbmdzLmhhc093blByb3BlcnR5KGtleXNbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldChrZXlzW2ldLCBkZWZhdWx0X3NldHRpbmdzW2tleXNbaV1dKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gc2hhcmVBcGkob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgcGxheWVyUmVhZHkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ2luYWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiByZXF1ZXN0KGV2ZW50KSB7CiAgICAgICAgICAgICAgICB2YXIgdmlkZW9fcGxheWVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1vdmllX3BsYXllciIpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoImZsb2F0ZXIiKTsKICAgICAgICAgICAgICAgIGlmICh2aWRlb19wbGF5ZXIpIHsKICAgICAgICAgICAgICAgICAgICB2aWRlb19wbGF5ZXIucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghdXNlcl9zZXR0aW5ncy5WSURfUExSX0FUUEwgfHwgZXZlbnQuZGV0YWlsLnVybC5zcGxpdCgiL3dhdGNoIikubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2luZG93Lnl0cGxheWVyICYmIHdpbmRvdy55dHBsYXllci5jb25maWcgJiYgd2luZG93Lnl0cGxheWVyLmNvbmZpZy5sb2FkZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB3aW5kb3cueXRwbGF5ZXIuY29uZmlnLmxvYWRlZDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBhcGkuZGVzdHJveSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBwYWdlU2NyaXB0TWVzc2FnZXMoKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5LCBnYXRlLCBzZXRzLCBvYnNlcnZlcjsKICAgICAgICAgICAgICAgIGtleSA9ICJwYXJyZWNlaXZlIjsKICAgICAgICAgICAgICAgIGdhdGUgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgICAgICAgICAgICBzZXRzID0gSlNPTi5wYXJzZShnYXRlLmRhdGFzZXRba2V5XSB8fCBudWxsKTsKICAgICAgICAgICAgICAgIGlmICghZ2F0ZS5wYWdlc2NyaXB0KSB7CiAgICAgICAgICAgICAgICAgICAgZ2F0ZS5wYWdlc2NyaXB0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHBhZ2VTY3JpcHRNZXNzYWdlcyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLm9ic2VydmUoZ2F0ZSwgewogICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOnRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZUZpbHRlcjogWyJkYXRhLSIgKyBrZXldCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2V0cykgewogICAgICAgICAgICAgICAgICAgIHVzZXJfc2V0dGluZ3MgPSBzZXRzOwogICAgICAgICAgICAgICAgICAgIGdhdGUuZGF0YXNldFtrZXldID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBjdXN0b21TdHlsZXMoKTsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCJkYXRhLXBhcnJlY2VpdmUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBzZXQoc2V0dGluZywgbmV3X3ZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAoc2V0dGluZyAhPT0gInVzZXJfc2V0dGluZ3MiKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5nc1tzZXR0aW5nXSA9IG5ld192YWx1ZTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IG5ld192YWx1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnBhcnNlbmQgPSBKU09OLnN0cmluZ2lmeSh1c2VyX3NldHRpbmdzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBtYWluKCkgewogICAgICAgICAgICAgICAgcGFnZVNjcmlwdE1lc3NhZ2VzKCk7CiAgICAgICAgICAgICAgICBjdXN0b21TdHlsZXMoKTsKICAgICAgICAgICAgICAgIHNldHRpbmdzTWVudSgpOwogICAgICAgICAgICAgICAgaW5maW5pdGVTY3JvbGwoKTsKICAgICAgICAgICAgICAgIHBsYXlsaXN0Q29udHJvbHMoKTsKICAgICAgICAgICAgICAgIHBsYXllck1vZGUoKTsKICAgICAgICAgICAgICAgIGFkdmFuY2VkT3B0aW9ucygpOwogICAgICAgICAgICAgICAgdm9sdW1lV2hlZWwoKTsKICAgICAgICAgICAgICAgIHN1YlBsYXlsaXN0KCk7CiAgICAgICAgICAgICAgICBhbHdheXNWaXNpYmxlKCk7CiAgICAgICAgICAgICAgICBtb2RUaHVtYnMoKTsKICAgICAgICAgICAgICAgIGVuaGFuY2VkRGV0YWlscygpOwogICAgICAgICAgICAgICAgbW9kQ29tbWVudHMoKTsKICAgICAgICAgICAgICAgIGRlZmF1bHRDaGFubmVsUGFnZSgpOwogICAgICAgICAgICAgICAgZ2VuZXJhbENoYW5nZXMoKTsKICAgICAgICAgICAgICAgIGRyYWdQb3BPdXQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdW5jdGlvbiBpc01hdGVyaWFsKCkgewogICAgICAgICAgICAgICAgdmFyIGksIHRlbXA7CiAgICAgICAgICAgICAgICB0ZW1wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgibGluayIpOwogICAgICAgICAgICAgICAgaSA9IHRlbXAubGVuZ3RoOwogICAgICAgICAgICAgICAgd2hpbGUgKGktLSkgewogICAgICAgICAgICAgICAgICAgIGlmICh0ZW1wW2ldLmhyZWYubWF0Y2goIm9seW1lciIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wLmlubmVySFRNTCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBzdHlsZT0nYm9yZGVyLXJhZGl1czoycHg7Y29sb3I6I0ZGRjtwYWRkaW5nOjEwcHg7YmFja2dyb3VuZC1jb2xvcjojMDlGO2JveC1zaGFkb3c6MCAwIDNweCByZ2JhKDAsMCwwLC41KTtmb250LXNpemU6MTJweDtwb3NpdGlvbjpmaXhlZDtib3R0b206MjBweDtyaWdodDoyMHB4O3otaW5kZXg6OTk5OTknPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgWW91VHViZSBQbHVzIGlzIG5vdCB5ZXQgY29tcGF0aWJsZSB3aXRoIHRoZSBZb3VUdWJlIGJldGEgTWF0ZXJpYWwgTGF5b3V0PGJyPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0naHR0cHM6Ly9naXRodWIuY29tL1BhcnRpY2xlQ29yZS9QYXJ0aWNsZS93aWtpL1Jlc3RvcmUtY2xhc3NpYy1Zb3VUdWJlJyB0YXJnZXQ9J19ibGFuaycgc3R5bGU9J2NvbG9yOiNGRkY7Zm9udC13ZWlnaHQ6Ym9sZDsnPkNsaWNrIGhlcmU8L2E+IGZvciBpbnN0cnVjdGlvbnMgdG8gcmVzdG9yZSBjbGFzc2ljIFlvdVR1YmUgYW5kIGNvbnRpbnVlIHVzaW5nIFlUKzxicj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvIGtlZXAgdXNpbmcgdGhlIGN1cnJlbnQgbGF5b3V0IHdpdGhvdXQgdGhpcyBtZXNzYWdlIHBsZWFzZSBkaXNhYmxlIFlUKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKHRlbXAuY29udGVudC5maXJzdENoaWxkKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmN0aW9uIGNsb3NlTWlncmF0aW9uSW5zdHJ1Y3Rpb25zKGV2ZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5pZCA9PT0gImNsb3NlX21pZ3JhdGlvbl9pbnN0cnVjdGlvbnMiKSB7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBjbG9zZU1pZ3JhdGlvbkluc3RydWN0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LnBhcmVudE5vZGUub3V0ZXJIVE1MID0gIiI7CiAgICAgICAgICAgICAgICAgICAgc2V0KCJtaWdyYXRpb25faW5zdHJ1Y3Rpb25zIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZnVuY3Rpb24gbWlncmF0aW9uSW5zdHJ1Y3Rpb25zKCkgewogICAgICAgICAgICAgICAgdmFyIHRlbXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZW1wbGF0ZSIpOwogICAgICAgICAgICAgICAgdGVtcC5pbm5lckhUTUwgPSAvLwogICAgICAgICAgICAgICAgICAgIGA8ZGl2IHN0eWxlPSdib3JkZXItcmFkaXVzOiAycHg7IGNvbG9yOiAjRkZGOyBmb250OiAxMnB4IFJvYm90byxhcmlhbCxzYW5zLXNlcmlmOyBwYWRkaW5nOiAxMHB4OyBiYWNrZ3JvdW5kLWNvbG9yOiByZ2IoMCwgMTUzLCAyNTUpOyBib3gtc2hhZG93OiAwcHggMHB4IDNweCByZ2JhKDAsIDAsIDAsIDAuNSk7IHBvc2l0aW9uOiBmaXhlZDsgei1pbmRleDogOTk5OTk7IHRvcDogNTAlOyBsZWZ0OiA1MCU7IHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOyc+CiAgICAgICAgICAgICAgICAgICAgWW91VHViZSBQbHVzIGhhcyBiZWVuIHVwZGF0ZWQgYW5kIGlzIG5vdyBhIFdlYmV4dGVuc2lvbi4gVW5mb3J0dW5hdGVseSB0aGlzIG1lYW5zIHRoYXQgeW91ciBwcmV2aW91cyBzZXR0aW5ncyBuZWVkIHRvIGJlIGltcG9ydGVkIG1hbnVhbGx5Ljxicj4KICAgICAgICAgICAgICAgICAgICA8YSBocmVmPSdodHRwczovL2dpdGh1Yi5jb20vUGFydGljbGVDb3JlL1BhcnRpY2xlL3dpa2kvUmVzdG9yZS1zZXR0aW5ncycgdGFyZ2V0PSdfYmxhbmsnIHN0eWxlPSdjb2xvcjojRkZGO2ZvbnQtd2VpZ2h0OmJvbGQ7Jz5DbGljayBoZXJlPC9hPiBpZiB5b3Ugd2lzaCB0byBpbXBvcnQgdGhlIHByZXZpb3VzIHNldHRpbmdzIG9yIGtub3cgbW9yZSBhYm91dCB0aGlzIGNoYW5nZS48YnI+CiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0nY2xvc2VfbWlncmF0aW9uX2luc3RydWN0aW9ucycgc3R5bGU9J2JhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKTsgY29sb3I6ICNGRkY7IGN1cnNvcjogcG9pbnRlcjsgbWFyZ2luLXRvcDogMTBweDsgYm9yZGVyLXJhZGl1czogMnB4OyBwYWRkaW5nOiA0cHg7IGZsb2F0OiByaWdodDsnPkNMT1NFPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZCh0ZW1wLmNvbnRlbnQuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGNsb3NlTWlncmF0aW9uSW5zdHJ1Y3Rpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgYXBpLCBjaWQsIGV2ZW50cywgbGFuZ3VhZ2UsIHVzZXJfc2V0dGluZ3MsIHBsYXllcl9pbnN0YW5jZSwgZGVmYXVsdF9zZXR0aW5nczsKICAgICAgICAgICAgaWYgKGlzTWF0ZXJpYWwoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNpZCA9IHt9OwogICAgICAgICAgICBldmVudHMgPSB7fTsKICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IEpTT04ucGFyc2UoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQudXNlcl9zZXR0aW5ncyB8fCBudWxsKTsKICAgICAgICAgICAgaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnVzZXJfc2V0dGluZ3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtdXNlcl9zZXR0aW5ncyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRlZmF1bHRfc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICAgICBHRU5fQlRUUl9OVEYgICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX1NVQl9MSVNUICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIEdFTl9JTkZfU0NSTCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBHRU5fQkxVRV9HTE9XICAgOiB0cnVlLAogICAgICAgICAgICAgICAgR0VOX1BQT1RfT04gICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9FTkRfU0hSRSAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZICAgOiAiYXV0byIsCiAgICAgICAgICAgICAgICBWSURfUExTVF9BVFBMICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMU1RfUlZSUyAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQVRQTCAgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1BMUl9TSVpFX01FTTogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX0xETiA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUE9TVF9USU1FICAgOiB0cnVlLAogICAgICAgICAgICAgICAgVklEX1ZJRF9DTlQgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIFZJRF9ERVNDX1NIUlQgICA6IHRydWUsCiAgICAgICAgICAgICAgICBWSURfUFBPVF9TWiAgICAgOiA1MzMsCiAgICAgICAgICAgICAgICBWSURfUExSX0hUTUw1ICAgOiB0cnVlLAogICAgICAgICAgICAgICAgQkxLX09OICAgICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGZsb2F0ZXJYICAgICAgICA6IDIwMDAsCiAgICAgICAgICAgICAgICBmbG9hdGVyWSAgICAgICAgOiAyMDAwLAogICAgICAgICAgICAgICAgZmlyc3RUaW1lICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIHZvbExldiAgICAgICAgICA6IDUwLAogICAgICAgICAgICAgICAgYWR2T3B0cyAgICAgICAgIDogdHJ1ZSwKICAgICAgICAgICAgICAgIGJsYWNrbGlzdCAgICAgICA6IHt9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxhbmd1YWdlID0gewogICAgICAgICAgICAgICAgWVRTRVRTICAgICAgICAgICAgICAgIDogIllvdVR1YmUrIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIEFEVl9PUFRTICAgICAgICAgICAgICA6ICJBZHZhbmNlZCBvcHRpb25zIiwKICAgICAgICAgICAgICAgIFNVQl9QTFNUICAgICAgICAgICAgICA6ICJQbGF5IHJlY2VudCB1cGxvYWRzIiwKICAgICAgICAgICAgICAgIFBQT1RfT1BFTiAgICAgICAgICAgICA6ICJPcGVuIGluIHBvcC1vdXQiLAogICAgICAgICAgICAgICAgQkxDS19BREQgICAgICAgICAgICAgIDogIkFkZCB0byBibGFja2xpc3QiLAogICAgICAgICAgICAgICAgQkxDS19FRElUICAgICAgICAgICAgIDogIkVkaXQiLAogICAgICAgICAgICAgICAgQkxDS19TQVZFICAgICAgICAgICAgIDogIlNhdmUiLAogICAgICAgICAgICAgICAgQkxDS19DTFNFICAgICAgICAgICAgIDogIkNsb3NlIiwKICAgICAgICAgICAgICAgIENOU0xfQVAgICAgICAgICAgICAgICA6ICJBdXRvcGxheSIsCiAgICAgICAgICAgICAgICBDTlNMX1JQVCAgICAgICAgICAgICAgOiAiUmVwZWF0IHZpZGVvIiwKICAgICAgICAgICAgICAgIENOU0xfU1ZUSCAgICAgICAgICAgICA6ICJPcGVuIHRodW1ibmFpbCIsCiAgICAgICAgICAgICAgICBDTlNMX1NTICAgICAgICAgICAgICAgOiAiVGFrZSBzY3JlZW5zaG90IiwKICAgICAgICAgICAgICAgIENOU0xfU1NfQ0xTICAgICAgICAgICA6ICJDTE9TRSIsCiAgICAgICAgICAgICAgICBDTlNMX1BQT1QgICAgICAgICAgICAgOiAiUG9wLW91dCB2aWRlbyIsCiAgICAgICAgICAgICAgICBDTlNMX0ZMQlIgICAgICAgICAgICAgOiAiRnVsbGJyb3dzZXIgbW9kZSIsCiAgICAgICAgICAgICAgICBDTlNMX0NJTk1fTUQgICAgICAgICAgOiAiQ2luZW1hIG1vZGUiLAogICAgICAgICAgICAgICAgQ05TTF9GUk1FICAgICAgICAgICAgIDogIkZyYW1lIGJ5IGZyYW1lIChTaGlmdCArIOKGkCBvciDihpIpIiwKICAgICAgICAgICAgICAgIFBMU1RfQVAgICAgICAgICAgICAgICA6ICJBdXRvcGxheSIsCiAgICAgICAgICAgICAgICBQTFNUX1JWUlMgICAgICAgICAgICAgOiAiUmV2ZXJzZSIsCiAgICAgICAgICAgICAgICBTSE9XX0NNVFMgICAgICAgICAgICAgOiAiU2hvdyBjb21tZW50cyIsCiAgICAgICAgICAgICAgICBISURFX0NNVFMgICAgICAgICAgICAgOiAiSGlkZSBjb21tZW50cyIsCiAgICAgICAgICAgICAgICBHTEJfSU1QUiAgICAgICAgICAgICAgOiAiSW1wb3J0L2V4cG9ydCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBHTEJfTE9DTF9MQU5HICAgICAgICAgOiAiQ2xpY2sgdG8gZWRpdCBZVCsgbGFuZ3VhZ2UiLAogICAgICAgICAgICAgICAgR0xCX0xPQ0xfTEFOR19DU1RNICAgIDogIkxvY2FsIiwKICAgICAgICAgICAgICAgIEdMQl9JTVBSX1NBVkUgICAgICAgICA6ICJTYXZlIGFuZCBsb2FkIiwKICAgICAgICAgICAgICAgIEdMQl9SU0VUICAgICAgICAgICAgICA6ICJSZXNldCIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFICAgICAgICAgICAgICAgOiAiU2F2ZSIsCiAgICAgICAgICAgICAgICBHTEJfU1ZFX1NFVFMgICAgICAgICAgOiAiU2V0dGluZ3Mgc2F2ZWQiLAogICAgICAgICAgICAgICAgRlRSX0RFU0MgICAgICAgICAgICAgIDogIkZpbmQgb3V0IHdoYXQgdGhpcyBkb2VzIiwKICAgICAgICAgICAgICAgIEdFTiAgICAgICAgICAgICAgICAgICA6ICJHZW5lcmFsIiwKICAgICAgICAgICAgICAgIFZJRCAgICAgICAgICAgICAgICAgICA6ICJWaWRlbyIsCiAgICAgICAgICAgICAgICBDSE4gICAgICAgICAgICAgICAgICAgOiAiQ2hhbm5lbHMiLAogICAgICAgICAgICAgICAgQkxLICAgICAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCIsCiAgICAgICAgICAgICAgICBBQlQgICAgICAgICAgICAgICAgICAgOiAiQWJvdXQiLAogICAgICAgICAgICAgICAgSExQICAgICAgICAgICAgICAgICAgIDogIkhlbHAiLAogICAgICAgICAgICAgICAgRE5UICAgICAgICAgICAgICAgICAgIDogIkRvbmF0ZSIsCiAgICAgICAgICAgICAgICBHRU5fVFRMICAgICAgICAgICAgICAgOiAiR2VuZXJhbCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBHRU5fR0VOICAgICAgICAgICAgICAgOiAiR2VuZXJhbCIsCiAgICAgICAgICAgICAgICBHRU5fTFlUICAgICAgICAgICAgICAgOiAiTGF5b3V0IiwKICAgICAgICAgICAgICAgIEdFTl9MT0NMX0xBTkcgICAgICAgICA6ICJVc2UgbW9kaWZpZWQgWVQrIGxhbmd1YWdlIiwKICAgICAgICAgICAgICAgIEdFTl9QUE9UX09OICAgICAgICAgICA6ICJFbmFibGUgcG9wLW91dCBtb2RlIiwKICAgICAgICAgICAgICAgIEdFTl9EU0JMX0FEUyAgICAgICAgICA6ICJEaXNhYmxlIGFkdmVydGlzZW1lbnRzIG91dHNpZGUgdGhlIHZpZGVvIHBhZ2UiLAogICAgICAgICAgICAgICAgR0VOX0lORl9TQ1JMICAgICAgICAgIDogIkVuYWJsZSBpbmZpbml0ZSBzY3JvbGwgaW4gZmVlZHMiLAogICAgICAgICAgICAgICAgR0VOX1lUX0xPR09fTElOSyAgICAgIDogIllvdVR1YmUgbG9nbyByZWRpcmVjdHMgdG8gc3Vic2NyaXB0aW9ucyIsCiAgICAgICAgICAgICAgICBHRU5fU1VCX0xJU1QgICAgICAgICAgOiAiRW5hYmxlIHN1YnNjcmlwdGlvbiBwbGF5bGlzdCIsCiAgICAgICAgICAgICAgICBHRU5fUkVNX0FQVU4gICAgICAgICAgOiAiUmVtb3ZlIGF1dG9wbGF5IHVwIG5leHQiLAogICAgICAgICAgICAgICAgR0VOX1NQRl9PRkYgICAgICAgICAgIDogIkRpc2FibGUgU1BGIiwKICAgICAgICAgICAgICAgIEdFTl9ISURFX0ZUUiAgICAgICAgICA6ICJIaWRlIGZvb3RlciIsCiAgICAgICAgICAgICAgICBHRU5fQkxVRV9HTE9XICAgICAgICAgOiAiUmVtb3ZlIGJsdWUgZ2xvdyBhcm91bmQgY2xpY2tlZCBidXR0b25zIiwKICAgICAgICAgICAgICAgIEdFTl9IREVfUkVDTV9TREJSICAgICA6ICJIaWRlIHJlY29tbWVuZGVkIGNoYW5uZWxzIHNpZGViYXIiLAogICAgICAgICAgICAgICAgR0VOX0hERV9TUkNIX1NEQlIgICAgIDogIkhpZGUgc2VhcmNoIHJlc3VsdHMgc2lkZWJhciIsCiAgICAgICAgICAgICAgICBHRU5fSERFX0NITl9TREJSICAgICAgOiAiSGlkZSBjaGFubmVsIHNpZGViYXIiLAogICAgICAgICAgICAgICAgR0VOX0NNUFRfVFRMUyAgICAgICAgIDogIkNvbXBhY3QgdGl0bGVzIGluIGZlZWRzIiwKICAgICAgICAgICAgICAgIEdFTl9EU0JfSFZSQyAgICAgICAgICA6ICJEaXNhYmxlIGhvdmVyY2FyZHMiLAogICAgICAgICAgICAgICAgR0VOX0JUVFJfTlRGICAgICAgICAgIDogIkltcHJvdmVkIGJsdWUgbm90aWZpY2F0aW9uIGJveCIsCiAgICAgICAgICAgICAgICBHRU5fR1JJRF9TVUJTICAgICAgICAgOiAiR3JpZCBsYXlvdXQgaW4gc3Vic2NyaXB0aW9ucyIsCiAgICAgICAgICAgICAgICBHRU5fR1JJRF9TUkNIICAgICAgICAgOiAiR3JpZCBsYXlvdXQgaW4gc2VhcmNoIHJlc3VsdHMiLAogICAgICAgICAgICAgICAgVklEX1RUTCAgICAgICAgICAgICAgIDogIlZpZGVvIHNldHRpbmdzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFIgICAgICAgICAgICAgICA6ICJQbGF5ZXIgc2V0dGluZ3MiLAogICAgICAgICAgICAgICAgVklEX1BMUl9MWVQgICAgICAgICAgIDogIlBsYXllciBsYXlvdXQiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWSAgICAgICAgIDogIkRlZmF1bHQgdmlkZW8gcXVhbGl0eToiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9BVVRPICAgIDogIkF1dG8iLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9UTlkgICAgIDogIjE0NHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9TTUwgICAgIDogIjI0MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9NRE0gICAgIDogIjM2MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV9MUkcgICAgIDogIjQ4MHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV83MjAgICAgIDogIjcyMHAiLAogICAgICAgICAgICAgICAgVklEX0RGTFRfUUxUWV8xMDgwICAgIDogIjEwODBwIiwKICAgICAgICAgICAgICAgIFZJRF9ERkxUX1FMVFlfMTQ0MCAgICA6ICIxNDQwcCIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzIxNjAgICAgOiAiMjE2MHAgKDRrKSIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZXzI4ODAgICAgOiAiMjg4MHAgKDVrKSIsCiAgICAgICAgICAgICAgICBWSURfREZMVF9RTFRZX09SSUcgICAgOiAiNDMyMHAgKDhrKSIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTICAgICAgICAgOiAiUGxheWVyIGFsd2F5cyB2aXNpYmxlIHdoZW4gcmVhZGluZyBjb21tZW50cyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0FMVklTX1dEVEggICAgOiAiRmxvYXRpbmcgcGxheWVyIHdpZHRoIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxWSVNfU0NSTF9UT1A6ICJHbyB0byB0b3AiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BVFBMICAgICAgICAgIDogIkF1dG9wbGF5IHZpZGVvcyIsCiAgICAgICAgICAgICAgICBWSURfTEFZVCAgICAgICAgICAgICAgOiAiTGF5b3V0IiwKICAgICAgICAgICAgICAgIFZJRF9WSURfQ05UICAgICAgICAgICA6ICJTaG93IGxpbmsgd2l0aCBudW1iZXIgb2YgdXBsb2FkZWQgdmlkZW9zIiwKICAgICAgICAgICAgICAgIFZJRF9QT1NUX1RJTUUgICAgICAgICA6ICJTaG93IGhvdyBsb25nIHRoZSB2aWRlbyBoYXMgYmVlbiBwdWJsaXNoZWQiLAogICAgICAgICAgICAgICAgVklEX0hJREVfREVUTFMgICAgICAgIDogIkhpZGUgdmlkZW8gZGV0YWlscyIsCiAgICAgICAgICAgICAgICBWSURfSElERV9DT01TICAgICAgICAgOiAiQ29tbWVudCBzZWN0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfU0hPVyAgICA6ICJTaG93IiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfSElERSAgICA6ICJIaWRlIiwKICAgICAgICAgICAgICAgIFZJRF9ISURFX0NPTVNfUkVNICAgICA6ICJSZW1vdmUiLAogICAgICAgICAgICAgICAgVklEX0VORF9TSFJFICAgICAgICAgIDogIkRpc2FibGUgc2hhcmUgcGFuZWwgd2hlbiB2aWRlbyBlbmRzIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUICAgICAgICAgICAgICA6ICJQbGF5bGlzdHMiLAogICAgICAgICAgICAgICAgVklEX1BMU1RfQVRQTCAgICAgICAgIDogIkVuYWJsZSBwbGF5bGlzdCBhdXRvcGxheSBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFNUX1JWUlMgICAgICAgICA6ICJFbmFibGUgcmV2ZXJzZSBwbGF5bGlzdCBjb250cm9sIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfU0laRV9NRU0gICAgICA6ICJNZW1vcml6ZSBwbGF5ZXIgbW9kZSIsCiAgICAgICAgICAgICAgICBWSURfVk9MX1dIRUVMICAgICAgICAgOiAiQ2hhbmdlIHZvbHVtZSB3aXRoIG1vdXNlIHdoZWVsIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfVk9MX01FTSAgICAgICA6ICJNZW1vcml6ZSBhdWRpbyB2b2x1bWUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9WT0xfTEROICAgICAgIDogIkRpc2FibGUgWW91VHViZSBsb3VkbmVzcyBub3JtYWxpc2F0aW9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQURTICAgICAgICAgICA6ICJEaXNhYmxlIGFkdmVydGlzZW1lbnRzIGluIHRoZSB2aWRlbyBwYWdlIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfQUxBQ1QgICAgICAgICA6ICJQbGF5ZXIgc2hvcnRjdXRzIGFsd2F5cyBhY3RpdmUiLAogICAgICAgICAgICAgICAgVklEX1NVQl9BRFMgICAgICAgICAgIDogIkVuYWJsZSBhZHZlcnRpc2VtZW50cyBvbmx5IGluIHZpZGVvcyBmcm9tIHN1YnNjcmliZWQgY2hhbm5lbHMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9BTlRTICAgICAgICAgIDogIkRpc2FibGUgYW5ub3RhdGlvbnMiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IRlIgICAgICAgICAgIDogIkRpc2FibGUgSEZSICg2MGZwcykiLAogICAgICAgICAgICAgICAgVklEX1BMUl9IVE1MNSAgICAgICAgIDogIlVzZSB0aGUgSFRNTDUgcGxheWVyIHdoZW4gcG9zc2libGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9DQyAgICAgICAgICAgIDogIkRpc2FibGUgc3VidGl0bGVzIGFuZCBDQyIsCiAgICAgICAgICAgICAgICBWSURfUExSX0lORk8gICAgICAgICAgOiAiRW5hYmxlIGluZm8gYmFyIHdpdGggd2F0Y2ggbGF0ZXIgYnV0dG9uIiwKICAgICAgICAgICAgICAgIFZJRF9QTFJfRklUICAgICAgICAgICA6ICJGaXQgdG8gcGFnZSBpbiB0aGVhdGVyIG1vZGUiLAogICAgICAgICAgICAgICAgVklEX1BMUl9GSVRfV0RUSCAgICAgIDogIkZpdCB0byBwYWdlIG1heCB3aWR0aDoiLAogICAgICAgICAgICAgICAgVklEX1BMUl9EWU5fU0laRSAgICAgIDogIkRpc2FibGUgZHluYW1pYyBwbGF5ZXIgc2l6ZSBpbiBkZWZhdWx0IHZpZXciLAogICAgICAgICAgICAgICAgVklEX0RFU0NfU0hSVCAgICAgICAgIDogIlNob3J0IHZpZGVvIGRlc2NyaXB0aW9uIGJ1dHRvbnMiLAogICAgICAgICAgICAgICAgVklEX1RUTF9DTVBUICAgICAgICAgIDogIkNvbXBhY3QgdGl0bGUgaW4gdmlkZW8gZGVzY3JpcHRpb24iLAogICAgICAgICAgICAgICAgVklEX1BQT1RfU1ogICAgICAgICAgIDogIlBvcC1vdXQgcGxheWVyIHNpemUiLAogICAgICAgICAgICAgICAgVklEX0xBWVRfQVVUT19QTkwgICAgIDogIkF1dG8gZXhwYW5kIHZpZGVvIGRlc2NyaXB0aW9uIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFICAgICA6ICJEZWZhdWx0IGNoYW5uZWwgcGFnZToiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfREZMVDogIkRlZmF1bHQiLAogICAgICAgICAgICAgICAgR0VOX0NITl9ERkxUX1BBR0VfVklEIDogIlZpZGVvcyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9QTCAgOiAiUGxheWxpc3RzIiwKICAgICAgICAgICAgICAgIEdFTl9DSE5fREZMVF9QQUdFX0NITiA6ICJDaGFubmVscyIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9ESVNDOiAiRGlzY3Vzc2lvbiIsCiAgICAgICAgICAgICAgICBHRU5fQ0hOX0RGTFRfUEFHRV9BQlQgOiAiQWJvdXQiLAogICAgICAgICAgICAgICAgQkxLX1RUTCAgICAgICAgICAgICAgIDogIkJsYWNrbGlzdCBzZXR0aW5ncyIsCiAgICAgICAgICAgICAgICBCTEtfQkxLICAgICAgICAgICAgICAgOiAiQmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEJMS19PTiAgICAgICAgICAgICAgICA6ICJFbmFibGUgYmxhY2tsaXN0IiwKICAgICAgICAgICAgICAgIEFCVF9UVEwgICAgICAgICAgICAgICA6ICJJbmZvcm1hdGlvbiBhbmQgdXNlZnVsIGxpbmtzIiwKICAgICAgICAgICAgICAgIEFCVF9USEtTICAgICAgICAgICAgICA6ICJUaGFua3MgdG86IiwKICAgICAgICAgICAgICAgIEFCVF9USEtTX1lFUFBIQSAgICAgICA6ICIsIHdobydzIHdvcmsgaW5zcGlyZWQgdGhlIGNyZWF0aW9uIG9mIHRoaXMgcHJvamVjdCwgd2l0aG91dCB3aG9tIG5vbmUgb2YgdGhpcyB3b3VsZCBleGlzdCB0b2RheS4iLAogICAgICAgICAgICAgICAgQUJUX1RIS1NfVVNFUlNDUklQVCAgIDogIiBmb3IgbWFraW5nIHRoZSB0YXNrIG9mIGRldmVsb3BpbmcgYW5kIHNoaXBwaW5nIHRoaXJkIHBhcnR5IHNvZnR3YXJlIGluY3JlZGlibHkgZWFzaWVyLiIsCiAgICAgICAgICAgICAgICBBQlRfVEhLU19TVEFDS09WICAgICAgOiAiIGZvciBhbGwgb2YgaXRzIHByaWNlbGVzcyBpbmZvcm1hdGlvbiB3aGljaCBncmVhdGx5IGNvbnRyaWJ1dGVzIGZvciBzb2Z0d2FyZSBkZXZlbG9wbWVudC4iLAogICAgICAgICAgICAgICAgQUJUX0lORk8gICAgICAgICAgICAgIDogIk9mZmljaWFsIHBhZ2VzIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfR0hCICAgICAgICAgICA6ICJHaXRIdWIiLAogICAgICAgICAgICAgICAgQUJUX0xOS19HUkZLICAgICAgICAgIDogIkdyZWFzeSBGb3JrIiwKICAgICAgICAgICAgICAgIEFCVF9MTktfT1BOVSAgICAgICAgICA6ICJPcGVuVXNlckpTIiwKICAgICAgICAgICAgICAgIFdMQ00gICAgICAgICAgICAgICAgICA6ICJUaGFuayB5b3UgZm9yIGluc3RhbGxpbmcgWW91VHViZSsiLAogICAgICAgICAgICAgICAgV0xDTVNUUlQgICAgICAgICAgICAgIDogIllvdSBjYW4gY3VzdG9taXplIHlvdXIgc2V0dGluZ3MgYnkgY2xpY2tpbmcgdGhlIGJ1dHRvbiBhYm92ZSIsCiAgICAgICAgICAgICAgICBXTENNRlRSUyAgICAgICAgICAgICAgOiAiQ2xpY2sgaGVyZSB0byBzZWUgYWxsIHRoZSBmZWF0dXJlcyIsCiAgICAgICAgICAgICAgICBMT0NBTEUgICAgICAgICAgICAgICAgOiAiRW5nbGlzaCAoVVMpIgogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoIXVzZXJfc2V0dGluZ3MgfHwgT2JqZWN0LmtleXModXNlcl9zZXR0aW5ncykubGVuZ3RoIDwgMSkgewogICAgICAgICAgICAgICAgdXNlcl9zZXR0aW5ncyA9IGRlZmF1bHRfc2V0dGluZ3M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaGVja05ld0ZlYXR1cmVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHdpbmRvdy5jaHJvbWUpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCJsb2FkIiwgc2NyaXB0RXhpdCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJhZnRlcnNjcmlwdGV4ZWN1dGUiLCBzY3JpcHRFeGl0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWlzX3VzZXJzY3JpcHQgJiYgIXdpbmRvdy5jaHJvbWUgJiYgIXVzZXJfc2V0dGluZ3MubWlncmF0aW9uX2luc3RydWN0aW9ucykgewogICAgICAgICAgICAgICAgbWlncmF0aW9uSW5zdHJ1Y3Rpb25zKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigic3BmZG9uZSIsIG1haW4pOwogICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJzcGZyZXF1ZXN0IiwgcmVxdWVzdCk7CiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInJlYWR5c3RhdGVjaGFuZ2UiLCBtYWluLCB0cnVlKTsKICAgICAgICAgICAgWE1MSHR0cFJlcXVlc3QucHJvdG90eXBlLm9wZW4gPSBjaGVja1hIUihYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUub3Blbik7CiAgICAgICAgICAgIHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSA9IHNoYXJlQXBpKHdpbmRvdy5vbllvdVR1YmVQbGF5ZXJSZWFkeSk7CiAgICAgICAgICAgIHdpbmRvdy5tYXRjaE1lZGlhID0gZmFsc2U7CiAgICAgICAgICAgIG1haW4oKTsKICAgICAgICB9LAogICAgICAgIGNvbnRlbnRTY3JpcHRNZXNzYWdlczogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHZhciBrZXkxLCBrZXkyLCBnYXRlLCBzZXRzLCBsb2NzLCBvYnNlcnZlcjsKICAgICAgICAgICAga2V5MSA9ICJwYXJzZW5kIjsKICAgICAgICAgICAga2V5MiA9ICJnZXRsb2NhbGUiOwogICAgICAgICAgICBnYXRlID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgICBzZXRzID0gSlNPTi5wYXJzZShnYXRlLmRhdGFzZXRba2V5MV0gfHwgbnVsbCk7CiAgICAgICAgICAgIGxvY3MgPSBnYXRlLmRhdGFzZXRba2V5Ml0gfHwgbnVsbDsKICAgICAgICAgICAgaWYgKCFnYXRlLmNvbnRlbnRzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGdhdGUuY29udGVudHNjcmlwdCA9IHRydWU7CiAgICAgICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKHBhcnRpY2xlLmNvbnRlbnRTY3JpcHRNZXNzYWdlcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2ZXIub2JzZXJ2ZShnYXRlLCB7CiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczogdHJ1ZSwKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVGaWx0ZXI6IFsiZGF0YS0iICsga2V5MSwgImRhdGEtIiArIGtleTJdCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2V0cykgewogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5HTV9zZXRWYWx1ZShwYXJ0aWNsZS5pZCwgSlNPTi5zdHJpbmdpZnkoc2V0cykpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoe3BhcnRpY2xlU2V0dGluZ3M6IHNldHN9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoImRhdGEtcGFyc2VuZCIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxvY3MpIHsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5kYXRhc2V0LnNldGxvY2FsZSA9IGNocm9tZS5pMThuLmdldE1lc3NhZ2UobG9jcyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGZpbHRlckNocm9tZUtleXM6IGZ1bmN0aW9uKGtleXMpIHsKICAgICAgICAgICAgaWYgKGtleXNbcGFydGljbGUuaWRdICYmIGtleXNbcGFydGljbGUuaWRdLm5ld192YWx1ZSkgewogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQucGFycmVjZWl2ZSA9IEpTT04uc3RyaW5naWZ5KAogICAgICAgICAgICAgICAgICAgIChrZXlzW3BhcnRpY2xlLmlkXS5uZXdfdmFsdWUgJiYga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlW3BhcnRpY2xlLmlkXSkgfHwga2V5c1twYXJ0aWNsZS5pZF0ubmV3X3ZhbHVlIHx8IHt9CiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBtYWluOiBmdW5jdGlvbihldmVudCkgewogICAgICAgICAgICB2YXIgaG9sZGVyOwogICAgICAgICAgICBpZiAoIWV2ZW50ICYmIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgIGV2ZW50ID0gSlNPTi5wYXJzZShwYXJ0aWNsZS5HTV9nZXRWYWx1ZShwYXJ0aWNsZS5pZCwgInt9IikpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICAgICAgZXZlbnQgPSBKU09OLnN0cmluZ2lmeShldmVudFtwYXJ0aWNsZS5pZF0gfHwgZXZlbnQpOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmRhdGFzZXQudXNlcl9zZXR0aW5ncyA9IGV2ZW50OwogICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaW5rIik7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLnJlbCA9ICJzdHlsZXNoZWV0IjsKICAgICAgICAgICAgICAgICAgICBob2xkZXIudHlwZSA9ICJ0ZXh0L2NzcyI7CiAgICAgICAgICAgICAgICAgICAgaG9sZGVyLmhyZWYgPSAiaHR0cHM6Ly9wYXJ0aWNsZWNvcmUuZ2l0aHViLmlvL1BhcnRpY2xlL3N0eWxlc2hlZXRzL1lvdVR1YmVQbHVzLmNzcyI7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5jaHJvbWUpIHsKICAgICAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgICAgICAgICAgICAgICAgIGhvbGRlci50ZXh0Q29udGVudCA9IC8vCiAgICAgICAgICAgICAgICAgICAgICAgIGAueXRwbHVzX3Nwcml0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgI0ROVDpob3ZlcjphZnRlciwKICAgICAgICAgICAgICAgICAgICAgICAgI3BsYXllci1jb25zb2xlID4gZGl2LAogICAgICAgICAgICAgICAgICAgICAgICAjUC1jb250ZW50IGlucHV0W3R5cGU9J3JhZGlvJ106Y2hlY2tlZCArIGxhYmVsOmJlZm9yZSwKICAgICAgICAgICAgICAgICAgICAgICAgI1AtY29udGVudCBpbnB1dFt0eXBlPSdjaGVja2JveCddOmNoZWNrZWQgKyBsYWJlbDpiZWZvcmV7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoY2hyb21lLWV4dGVuc2lvbjovL2AgKyB3aW5kb3cuY2hyb21lLnJ1bnRpbWUuaWQgKyBgL2ltYWdlcy9zcHJpdGUucG5nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfWA7CiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBob2xkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICAgICAgICAgICAgICAgIGhvbGRlci50ZXh0Q29udGVudCA9ICIoIiArIHBhcnRpY2xlLmluamVjdCArICIoIiArIHBhcnRpY2xlLmlzX3VzZXJzY3JpcHQgKyAiKSkiOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFwcGVuZENoaWxkKGhvbGRlcik7CiAgICAgICAgICAgICAgICBpZiAoIXBhcnRpY2xlLmlzX3VzZXJzY3JpcHQpIHsKICAgICAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5vbkNoYW5nZWQuYWRkTGlzdGVuZXIocGFydGljbGUuZmlsdGVyQ2hyb21lS2V5cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGluaTogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHBhcnRpY2xlLmlkID0gInBhcnRpY2xlU2V0dGluZ3MiOwogICAgICAgICAgICBwYXJ0aWNsZS5pc191c2Vyc2NyaXB0ID0gdHlwZW9mIEdNX2luZm8gPT09ICJvYmplY3QiID8gdHJ1ZSA6IGZhbHNlOwogICAgICAgICAgICBpZiAocGFydGljbGUuaXNfdXNlcnNjcmlwdCkgewogICAgICAgICAgICAgICAgcGFydGljbGUuR01fZ2V0VmFsdWUgPSBHTV9nZXRWYWx1ZTsKICAgICAgICAgICAgICAgIHBhcnRpY2xlLkdNX3NldFZhbHVlID0gR01fc2V0VmFsdWU7CiAgICAgICAgICAgICAgICBwYXJ0aWNsZS5tYWluKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQocGFydGljbGUuaWQsIHBhcnRpY2xlLm1haW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBhcnRpY2xlLmNvbnRlbnRTY3JpcHRNZXNzYWdlcygpOwogICAgICAgIH0KICAgIH07CiAgICBwYXJ0aWNsZS5pbmkoKTsKfSgpKTs="},{"name":"iZhihu","options":{"awareOfChrome":false,"comment":null,"compat_arrayleft":false,"compat_foreach":false,"compat_forvarin":false,"compat_metadata":false,"compat_uW_gmonkey":false,"compat_wrappedjsobject":false,"compatopts_for_requires":true,"noframes":null,"override":{"merge_connects":true,"merge_excludes":true,"merge_includes":true,"merge_matches":true,"orig_connects":[],"orig_excludes":[],"orig_includes":["http://www.zhihu.com/*","https://www.zhihu.com/*"],"orig_matches":["http://www.zhihu.com/*","https://www.zhihu.com/*"],"orig_noframes":null,"orig_run_at":"document-idle","use_blockers":[],"use_connects":[],"use_excludes":[],"use_includes":[],"use_matches":[]},"run_at":null},"storage":{"ts":1475240734352,"data":{}},"enabled":true,"position":8,"file_url":"https://greasyfork.org/scripts/350-izhihu/code/iZhihu.user.js","uuid":"a3402b39-10fd-40e9-9ee5-c72302d817c7","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBpWmhpaHUKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2dpdGh1Yi5jb20vdW5vZ3ovaXpoaWh1Ci8vIEB2ZXJzaW9uICAgICAgMi4xMy4zCi8vIEBkZXNjcmlwdGlvbiAg55+l5LmO5o+S5Lu2Ci8vIEBtYXRjaCAgICAgICAgaHR0cDovL3d3dy56aGlodS5jb20vKgovLyBAaW5jbHVkZSAgICAgIGh0dHA6Ly93d3cuemhpaHUuY29tLyoKLy8gQG1hdGNoICAgICAgICBodHRwczovL3d3dy56aGlodS5jb20vKgovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vd3d3LnpoaWh1LmNvbS8qCi8vIEByZXF1aXJlICAgICAgaHR0cDovL2Nkbi5zdGF0aWNmaWxlLm9yZy9qcXVlcnkvMS44LjIvanF1ZXJ5Lm1pbi5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvaUNoZWNrLzEuMC4xL2ljaGVjay5taW4uanMKLy8gQHJlc291cmNlICAgICBqcVVJX0NTUyBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZS5jc3MKLy8gQHJlc291cmNlICAgICB1aS1iZ19pY2hlY2stc2tpbl9zcXVhcmVfYmx1ZSBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZS5wbmcKLy8gQHJlc291cmNlICAgICB1aS1iZ19pY2hlY2stc2tpbl9zcXVhcmVfYmx1ZTJ4IGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvaUNoZWNrLzEuMC4xL3NraW5zL3NxdWFyZS9ibHVlQDJ4LnBuZwovLyBAcmVxdWlyZSAgICAgIGh0dHA6Ly9jZG4uc3RhdGljZmlsZS5vcmcvanF1ZXJ5dWkvMS4xMC40L2pxdWVyeS11aS5taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL3B1cmwvMi4zLjEvcHVybC5taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL3VuZGVyc2NvcmUuanMvMS42LjAvdW5kZXJzY29yZS1taW4uanMKLy8gQGdyYW50ICAgICAgICBHTV94bWxIdHRwUmVxdWVzdAovLyBAZ3JhbnQgICAgICAgIEdNX2FkZFN0eWxlCi8vIEBncmFudCAgICAgICAgR01fZ2V0UmVzb3VyY2VUZXh0Ci8vIEBncmFudCAgICAgICAgR01fZ2V0UmVzb3VyY2VVUkwKLy8gQGljb24gICAgICAgICBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vdW5vZ3ovaXpoaWh1L2RldmVsb3AvbWlzYy94cGktY29uZmlnL2ljb242NC5wbmcKLy8gQGNvcHlyaWdodCAgICAyMDE1KywgQOmSouebhemDreWtkCBA5YiY5YuHIEDloqjno4oKLy8gPT0vVXNlclNjcmlwdD09Cgp2YXIganFVSV9Dc3NTcmMgPSBHTV9nZXRSZXNvdXJjZVRleHQoImpxVUlfQ1NTIikKR01fYWRkU3R5bGUgKGpxVUlfQ3NzU3JjLnJlcGxhY2UoJ3VybChibHVlJywgJ3VybChodHRwOi8vY2RuLnN0YXRpY2ZpbGUub3JnL2lDaGVjay8xLjAuMS9za2lucy9zcXVhcmUvYmx1ZScpKTsKCnZhciB2ZXJzaW9uPScyLjEzLjMnOwp2YXIgdXBkYXRlRGF0ZT0nMjAxNi00LTI1JzsKCmlmICggdHlwZW9mIHVuc2FmZVdpbmRvdyA9PT0gInVuZGVmaW5lZCIpIHsKICAgIHVuc2FmZVdpbmRvdyAgICA9ICggZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBkdW1teUVsZW0gICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgICAgICBkdW1teUVsZW0ub25jbGljaz1mdW5jdGlvbigpe3JldHVybiB3aW5kb3c7fTsKICAgICAgICByZXR1cm4gZHVtbXlFbGVtLm9uY2xpY2sgKCk7CiAgICB9ICkgKCk7Cn0KCi8v5Li75YWl5Y+jCi8vJChmdW5jdGlvbiBtYWluKCl7CgoKLyoqCiAqIEBjbGFzcyBVdGlscyDovoXliqnnsbsKICovCmZ1bmN0aW9uIHV0aWxzKCl7Cn07Cgp2YXIgY2ZnRGVmYXVsdCA9IHsKICAgICdjb21tZW50X3NpZGViYXInOiB0cnVlCiAgLCAnYW5zd2VyX29yZGVyQnlUaW1lJzogZmFsc2UKICAsICdBdXRob3JMaXN0JzpmYWxzZQogICwgJ1Nob3dDb21tZW50Jzp0cnVlCiAgLCAnSG9tZUxheW91dCc6ZmFsc2UKICAsICdRdWlja0Zhdm8nOnRydWUKICAsICdRdWlja0Zhdm9QaW5uZWQnOnt9CiAgLCAnQXV0aG9yUmVhcic6ZmFsc2UKICAsICdIb21lTm90aSc6ZmFsc2UKICAsICdRdWlja0Jsb2NrJzpmYWxzZQogICwgJ05vdGk3Jzp0cnVlCiAgLCAnSG9tZUZlZWRzQ29sdW1ucyc6ZmFsc2UKICAsICdSaWdodENvbW1lbnRfQXV0b1Njcm9sbFBhZ2VXaGVuQ2xvc2luZyc6dHJ1ZQogICwgJ1RvcE5hdkF1dG9Gb2xkJzpmYWxzZQp9OwogIAovKioKICog6K+75Y+W6YWN572uCiAqLwp1dGlscy5nZXRDZmcgPSBmdW5jdGlvbihrZXkpewogIGlmKCFrZXkpcmV0dXJuIGZhbHNlOwogIHZhciBjZmcgPSAkLmV4dGVuZChjZmdEZWZhdWx0LCB0aGlzLmdldFZhbHVlKCdpemhpaHUnLGNmZ0RlZmF1bHQpKTsKICByZXR1cm4ga2V5ID8gY2ZnW2tleV0gOiBjZmc7Cn07Cgp1dGlscy5zZXRDZmcgPSBmdW5jdGlvbihrZXksdmFsdWUpewogIGlmKCFrZXkpcmV0dXJuOwogIHZhciBjZmcgPSAkLmV4dGVuZChjZmdEZWZhdWx0LCB0aGlzLmdldFZhbHVlKCdpemhpaHUnLGNmZ0RlZmF1bHQpKTsKICBjZmdba2V5XT12YWx1ZTsKICB0aGlzLnNldFZhbHVlKCdpemhpaHUnLGNmZyk7Cn07CgovKioKICog6K+75Y+W5a2Y5YKoCiAqLwp1dGlscy5nZXRWYWx1ZSA9IGZ1bmN0aW9uKGtleSwgZGVmYXVsdFZhbHVlKXsKICAgIHZhciB2PXVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XTsKICAgIGlmKHYpCiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2Uodik7CiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfTsKCi8qKgogKiDlhpnlhaXlrZjlgqgKICovCnV0aWxzLnNldFZhbHVlID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSl7CiAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOwp9OwoKLyoqCiAqIOWIoOmZpOWtmOWCqAogKi8KdXRpbHMuZGVsZXRlVmFsdWUgPSBmdW5jdGlvbihrZXkpewogIHJldHVybiBkZWxldGUgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVtrZXldOwp9OwoKdXRpbHMudHJhbnNmZXJPbGRDZmc9ZnVuY3Rpb24oKXsKICAgIHZhciBvbGRIb21lTGF5b3V0ID0gdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZVsnaXpoX0hvbWVMYXlvdXQnXQogICAgICAsIG9sZEF1dGhvckxpc3QgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfQXV0aG9yTGlzdCddCiAgICAgICwgb2xkU2hvd0NvbW1lbnQgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfU2hvd0NvbW1lbnQnXQogICAgICAsIG9sZFF1aWNrRmF2byA9IHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2l6aF9RdWlja0Zhdm8nXQogICAgICAsIG9sZEF1dGhvclJlYXIgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfQXV0aG9yUmVhciddCiAgICAgICwgb2xkSG9tZU5vdGkgPSB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlWydpemhfSG9tZU5vdGknXQogICAgOwogICAgaWYob2xkSG9tZUxheW91dCl7CiAgICAgICAgaXpoSG9tZUxheW91dD1vbGRIb21lTGF5b3V0OwogICAgICAgIHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnaXpoX0hvbWVMYXlvdXQnKTsKICAgICAgICB0aGlzLnNldENmZygnSG9tZUxheW91dCcsaXpoSG9tZUxheW91dCk7CiAgICB9CiAgICBpZihvbGRBdXRob3JMaXN0KXsKICAgICAgICBpemhBdXRob3JMaXN0PW9sZEF1dGhvckxpc3Q7CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfQXV0aG9yTGlzdCcpOwogICAgICAgIHRoaXMuc2V0Q2ZnKCdBdXRob3JMaXN0JyxpemhBdXRob3JMaXN0KTsKICAgIH0KICAgIGlmKG9sZFNob3dDb21tZW50KXsKICAgICAgICBpemhSaWdodENvbW1lbnQ9b2xkU2hvd0NvbW1lbnQ7CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfU2hvd0NvbW1lbnQnKTsKICAgICAgICB0aGlzLnNldENmZygnU2hvd0NvbW1lbnQnLGl6aFJpZ2h0Q29tbWVudCk7CiAgICB9CiAgICBpZihvbGRRdWlja0Zhdm8pewogICAgICAgIGl6aFF1aWNrRmF2bz1vbGRRdWlja0Zhdm87CiAgICAgICAgdW5zYWZlV2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdpemhfUXVpY2tGYXZvJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ1F1aWNrRmF2bycsaXpoUXVpY2tGYXZvKTsKICAgIH0KICAgIGlmKG9sZEF1dGhvclJlYXIpewogICAgICAgIGl6aEF1dGhvclJlYXI9b2xkQXV0aG9yUmVhcjsKICAgICAgICB1bnNhZmVXaW5kb3cubG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2l6aF9BdXRob3JSZWFyJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ0F1dGhvclJlYXInLGl6aEF1dGhvclJlYXIpOwogICAgfQogICAgaWYob2xkSG9tZU5vdGkpewogICAgICAgIGl6aEhvbWVOb3RpPW9sZEhvbWVOb3RpOwogICAgICAgIHVuc2FmZVdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnaXpoX0hvbWVOb3RpJyk7CiAgICAgICAgdGhpcy5zZXRDZmcoJ0hvbWVOb3RpJyxpemhIb21lTm90aSk7CiAgICB9Cgp9OwoKCi8qKgogKiBAbWV0aG9kIGZvcm1hdFN0cgogKgogKiDmoLzlvI/ljJblrZfnrKbkuLLmqKHniYgs5pSv5oyBMuenjeagvOW8jzoKICoKICogICAgIGZvcm1hdFN0cigiaSBjYW4gc3BlYWsge2xhbmd1YWdlfSBzaW5jZSBpIHdhcyB7YWdlfSIse2xhbmd1YWdlOidqYXZhc2NyaXB0JyxhZ2U6MTB9KTsKICogICAgIGZvcm1hdFN0cigiaSBjYW4gc3BlYWsgezB9IHNpbmNlIGkgd2FzIHsxfSIsJ2phdmFzY3JpcHQnLDEwKTsKICoKICog5aaC5p6c5LiN5biM5pyb6KKr6L2s5LmJLOWImeeUqOS4pOS4quaLrOWPtyzlpoI6IGBmb3JtYXRTdHIoImkgY2FuIHNwZWFrIHswfSBzaW5jZSBpIHdhcyB7ezF9IiwnamF2YXNjcmlwdCcsMTApO2AKICoKICovCnV0aWxzLmZvcm1hdFN0ciA9IGZ1bmN0aW9uKHRwbCxvYmopewogIG9iaiA9IHR5cGVvZiBvYmogPT09ICdvYmplY3QnID8gb2JqIDogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICByZXR1cm4gdHBsLnJlcGxhY2UoL1x7XHt8XH1cfXxceyhcdyspXH0vZywgZnVuY3Rpb24gKG0sIG4pewogICAgaWYgKG0gPT0gInt7IikgeyByZXR1cm4gInsiOyB9CiAgICBpZiAobSA9PSAifX0iKSB7IHJldHVybiAifSI7IH0KICAgIHJldHVybiBvYmpbbl07CiAgfSk7Cn07Cgp1dGlscy5nZXRQYXJhbUluUXVlcnk9ZnVuY3Rpb24ocXVlcnlTdHIscGFyYW1OYW1lKXsKICAgIHZhciBwYXJhbT1wYXJhbU5hbWUrJz0nCiAgICAgICwgc3RhcnQ9cXVlcnlTdHIuaW5kZXhPZihwYXJhbSkrcGFyYW0ubGVuZ3RoCiAgICAgICwgZW5kPXF1ZXJ5U3RyLmluZGV4T2YoJyYnLHN0YXJ0KTsKICAgIHJldHVybiBlbmQ8c3RhcnQ/cXVlcnlTdHIuc3Vic3RyaW5nKHN0YXJ0KTpxdWVyeVN0ci5zdWJzdHJpbmcoc3RhcnQsZW5kKTsKfTsKCnV0aWxzLm9ic2VydmVET01BdHRyTW9kaWZpZWQgPSAoZnVuY3Rpb24oKXsKICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsCiAgICAgICAgZXZlbnRMaXN0ZW5lclN1cHBvcnRlZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwoKICAgIHJldHVybiBmdW5jdGlvbihvYmosIGNhbGxiYWNrKXsKICAgICAgICBpZiggTXV0YXRpb25PYnNlcnZlciApewogICAgICAgICAgICAvLyBkZWZpbmUgYSBuZXcgb2JzZXJ2ZXIKICAgICAgICAgICAgdmFyIG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpewogICAgICAgICAgICAgICAgaWYoIG11dGF0aW9uc1swXS50eXBlID09ICdhdHRyaWJ1dGVzJyApCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobXV0YXRpb25zWzBdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9icy5vYnNlcnZlKCBvYmosIHsgYXR0cmlidXRlczp0cnVlIH0pOwogICAgICAgIH1lbHNlIGlmKCBldmVudExpc3RlbmVyU3VwcG9ydGVkICl7CiAgICAgICAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKCdET01BdHRyTW9kaWZpZWQnLCBjYWxsYmFjaywgZmFsc2UpOwogICAgICAgIH0KICAgIH0KfSkoKTsKCnV0aWxzLm9ic2VydmVET01Ob2RlQWRkZWQgPSAoZnVuY3Rpb24oKXsKICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsCiAgICAgICAgZXZlbnRMaXN0ZW5lclN1cHBvcnRlZCA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyOwoKICAgIHJldHVybiBmdW5jdGlvbihvYmosIGNhbGxiYWNrKXsKICAgICAgICBpZiggTXV0YXRpb25PYnNlcnZlciApewogICAgICAgICAgICAvLyBkZWZpbmUgYSBuZXcgb2JzZXJ2ZXIKICAgICAgICAgICAgdmFyIG9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucywgb2JzZXJ2ZXIpewogICAgICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24obXV0YXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhtdXRhdGlvbik7CiAgICAgICAgICAgICAgICAgIH0pOyAgICAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG9icy5vYnNlcnZlKCBvYmosIHsgY2hpbGRMaXN0OnRydWUgfSk7CiAgICAgICAgfWVsc2UgaWYoIGV2ZW50TGlzdGVuZXJTdXBwb3J0ZWQgKXsKICAgICAgICAgICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTU5vZGVJbnNlcnRlZCcsIGNhbGxiYWNrLCBmYWxzZSk7CiAgICAgICAgfQogICAgfQp9KSgpOwoKdXRpbHMuUmVnZXhTcmNQaWMgPSAvc3JjPSJbXHNcU10rPy5qcGciL2cKCi8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7Cgp2YXIgJCA9IHdpbmRvdy4kOwp2YXIgXyA9IHRoaXMuXzsKdmFyIHB1cmwgPSB3aW5kb3cucHVybHx8JC51cmw7CgovL+S9v+eUqENhc3BlckpT55qE5qih5ouf55So5oi35pON5L2c77yaIGh0dHA6Ly9jYXNwZXJqcy5vcmcvYXBpLmh0bWwjY2xpZW50LXV0aWxzCi8vdmFyIGNsaWVudCA9IHdpbmRvdy5jcmVhdGUoKTsKCnZhciB1cmwgPSBwdXJsKCk7CnZhciBwYWdlID0gdXJsLnNlZ21lbnQoMSk7Cgp2YXIgcGFnZUlzPXt9CiAgLCAkd2luPSQod2luZG93KQogICwgX2RvYz13aW5kb3cuZG9jdW1lbnQKICAsICRib2R5PSQoX2RvYy5ib2R5KQogICwgX3BhdGg9d2luZG93LmZyYW1lRWxlbWVudD93aW5kb3cuZnJhbWVFbGVtZW50LnNyYy5yZXBsYWNlKC9odHRwcz86XC9cL3d3dy56aGlodS5jb20vLCcnKTp1cmwuZGF0YS5hdHRyWydwYXRoJ10KICAsIGNzcz0nJwogICwgJGg9JCgnaGVhZCcpCiAgLCAkcz0kKCc8c3R5bGU+JywgeyAndHlwZSc6ICd0ZXh0L2NzcycgfSkKICAsIGlQYXRoQW5zd2Vycz1fcGF0aC5pbmRleE9mKCcvYW5zd2VycycpCiAgLCBpUGF0aENvbGxlY3Rpb249X3BhdGguaW5kZXhPZignL2NvbGxlY3Rpb24nKQo7CnBhZ2VJcy5Ib21lPScvJz09X3BhdGg7CnBhZ2VJcy5BbnN3ZXI9MDxfcGF0aC5pbmRleE9mKCcvYW5zd2VyLycpOwpwYWdlSXMuUXVlc3Rpb249IXBhZ2VJcy5BbnN3ZXImJjA9PV9wYXRoLmluZGV4T2YoJy9xdWVzdGlvbi8nKTsKcGFnZUlzLkFuc3dlcnM9MDxpUGF0aEFuc3dlcnMmJl9wYXRoLnN1YnN0cihpUGF0aEFuc3dlcnMpPT0nL2Fuc3dlcnMnOwpwYWdlSXMuQ29sbGVjdGlvbj0wPT1pUGF0aENvbGxlY3Rpb247CnBhZ2VJcy5EZWJ1dHM9MD09X3BhdGguaW5kZXhPZignL2RlYnV0cy8nKTsKcGFnZUlzLk15Q29sbGVjdGlvbj0wPT1fcGF0aC5pbmRleE9mKCcvY29sbGVjdGlvbnMvbWluZScpOwpwYWdlSXMuU2V0dGluZ3NGaWx0ZXI9MD09X3BhdGguaW5kZXhPZignL3NldHRpbmdzL2ZpbHRlcicpCgp2YXIgaT0wCiAgLCAkdXNlcj0kKCcuenUtdG9wLW5hdi11c2VyaW5mbycpLy91c2VyX2F2YXRlcgogICwgej0kdXNlci5sZW5ndGg/JHVzZXIuYXR0cignaHJlZicpOicnCiAgLCAkYmFubmVyPSQoZG9jdW1lbnQuYm9keSkuY2hpbGRyZW4oKS5maXJzdCgpCiAgLCAkbWFpbj0kKCdbcm9sZT1tYWluXScpLy9tYWluCiAgLCBjc3NfQXV0aG9yTGlzdEl0ZW1BPSdwYWRkaW5nOjAgMTBweCAwIDA7JwogICwgY3NzX0F1dGhvckxpc3RJdGVtQV9uYW1lPSdwYWRkaW5nOjAgNXB4OycKOwoKd2luZG93LmlaaGlodSA9IHsKICAgICR3aW46JHdpbgogICwgJGJvZHk6JGJvZHkKICAsICRtYWluOiRtYWluCiAgLCBjb25maWc6JC5leHRlbmQoY2ZnRGVmYXVsdCwgdXRpbHMuZ2V0VmFsdWUoJ2l6aGlodScsY2ZnRGVmYXVsdCkpCn07Cgp2YXIgaXpoSG9tZUxheW91dCA9IHdpbmRvdy5pWmhpaHUuY29uZmlnWydIb21lTGF5b3V0J10KICAsIGl6aEF1dGhvckxpc3QgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snQXV0aG9yTGlzdCddCiAgLCBpemhSaWdodENvbW1lbnQgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snU2hvd0NvbW1lbnQnXQogICwgaXpoUXVpY2tGYXZvID0gd2luZG93LmlaaGlodS5jb25maWdbJ1F1aWNrRmF2byddCiAgLCBpemhBdXRob3JSZWFyID0gd2luZG93LmlaaGlodS5jb25maWdbJ0F1dGhvclJlYXInXQogICwgaXpoSG9tZU5vdGkgPSB3aW5kb3cuaVpoaWh1LmNvbmZpZ1snSG9tZU5vdGknXQogICwgaXpoUXVpY2tCbG9jayA9IHdpbmRvdy5pWmhpaHUuY29uZmlnWydRdWlja0Jsb2NrJ10KICAsIGl6aFRvcE5hdkF1dG9Gb2xkID0gd2luZG93LmlaaGlodS5jb25maWdbJ1RvcE5hdkF1dG9Gb2xkJ10KOwoKdXRpbHMudHJhbnNmZXJPbGRDZmcoKTsKCiRib2R5LmF0dHIoewogICAgJ2l6aEhvbWVMYXlvdXQnIDogaXpoSG9tZUxheW91dD8nMSc6JycKICAsICdpemhBdXRob3JMaXN0JyA6IGl6aEF1dGhvckxpc3Q/JzEnOicnCiAgLCAnaXpoUmlnaHRDb21tZW50JyA6IGl6aFJpZ2h0Q29tbWVudD8nMSc6JycKICAsICdpemhRdWlja0Zhdm8nIDogaXpoUXVpY2tGYXZvPycxJzonJwogICwgJ2l6aEF1dGhvclJlYXInIDogaXpoQXV0aG9yUmVhcj8nMSc6JycKICAsICdpemhIb21lTm90aScgOiBpemhIb21lTm90aT8nMSc6JycKICAsICdpemhRdWlja0Jsb2NrJyA6IGl6aFF1aWNrQmxvY2s/JzEnOicnCiAgLCAnaXpoVG9wTmF2QXV0b0ZvbGQnIDogaXpoVG9wTmF2QXV0b0ZvbGQ/JzEnOicnCn0pOwoKdmFyIF9RdWlja0Jsb2NrID0gbmV3IFF1aWNrQmxvY2sod2luZG93LmlaaGlodSkKICAsIF9RdWlja0Zhdm8gPSBuZXcgUXVpY2tGYXZvKHdpbmRvdy5pWmhpaHUpCiAgLCBfQ29tbWVudCA9IG5ldyBDb21tZW50KHdpbmRvdy5pWmhpaHUpCiAgLCBfTm90aTcgPSBuZXcgTm90aTcod2luZG93LmlaaGlodSkKICAsIF9BbnN3ZXIgPSBuZXcgQW5zd2VyKHdpbmRvdy5pWmhpaHUpCiAgLCBfU2VhcmNoaW5nTGlzdCA9IG5ldyBTZWFyY2hpbmdMaXN0KHdpbmRvdy5pWmhpaHUpCiAgLCBfVG9wTmF2ID0gbmV3IFRvcE5hdih3aW5kb3cuaVpoaWh1KQo7Cgpjc3MrPVsnLnRfc2hvd2ZyYW1le3BhZGRpbmc6MTBweCAxMHB4IDEwcHggMTBweDtiYWNrZ3JvdW5kOiNmMGYwZjA7Ym9yZGVyOjFweCBzb2xpZCAjZmZmO2JveC1zaGFkb3c6MnB4IDVweCAxNXB4ICMzMzM7Ym9yZGVyLXJhZGl1czoxMHB4Oy1tb3otYm94LXNoYWRvdzoycHggNXB4IDE1cHggIzMzMzstbW96LWJvcmRlci1yYWRpdXM6MTBweDstd2Via2l0LWJveC1zaGFkb3c6MnB4IDVweCAxNXB4ICMzMzM7LXdlYmtpdC1ib3JkZXItcmFkaXVzOjEwcHh9I2laaGlodV9ydGpkZGl2e3dpZHRoOjY1MHB4O2hlaWdodDo0MzdweH0jaVpoaWh1X3NldGRpdnt3aWR0aDo2MDBweDtoZWlnaHQyOjI5NXB4fS50X3NldGRpdntwYWRkaW5nLWJvdHRvbToxMHB4O2JhY2tncm91bmQ6I2ZjZmNmYzt3aWR0aDoxMDAlO2hlaWdodDoxMDAlfS50X3NldF90Yntmb250LWZhbWlseToiTHVjaWRhIFNhbnMgVW5pY29kZSIsIkx1Y2lkYSBHcmFuZGUiLFNhbnMtU2VyaWYgIWltcG9ydGFudDtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O3RleHQtc2hhZG93Om5vbmUgIWltcG9ydGFudDtib3JkZXItY29sbGFwc2U6Y29sbGFwc2UgIWltcG9ydGFudDttYXJnaW46MCAhaW1wb3J0YW50O2xpbmUtaGVpZ2h0OjEyMCV9LnRfc2V0X3RiIHRoZWFkIHRke2JhY2tncm91bmQ6IzAwODBjMDtjb2xvcjojZmZmO2JvcmRlcjpub25lICFpbXBvcnRhbnQ7cGFkZGluZzo0cHggOHB4IDRweCAhaW1wb3J0YW50O2JvcmRlci1yYWRpdXMtdG9wbGVmdDoxMHB4O2JvcmRlci1yYWRpdXMtdG9wcmlnaHQ6MTBweDstbW96LWJvcmRlci1yYWRpdXMtdG9wbGVmdDoxMHB4Oy1tb3otYm9yZGVyLXJhZGl1cy10b3ByaWdodDoxMHB4Oy13ZWJraXQtYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czoxMHB4Oy13ZWJraXQtYm9yZGVyLXRvcC1yaWdodC1yYWRpdXM6MTBweH0udF9zZXRfdGIgdGgsLnRfc2V0X3RiIHRke3BhZGRpbmc6OHB4O2JhY2tncm91bmQ6I2U4ZWRmZjtib3JkZXI6bm9uZSAhaW1wb3J0YW50O2JvcmRlci10b3A6MnB4IHNvbGlkICNmY2ZjZmMgIWltcG9ydGFudDtjb2xvcjojNjY5O2xpbmUtaGVpZ2h0OjEuMWVtICFpbXBvcnRhbnR9LnRfc2V0X3RiIHRkIGlucHV0LC50X3NldF90YiB0ZCB0ZXh0YXJlYXtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O3BhZGRpbmc6MCAhaW1wb3J0YW50fS50X3NldF90YiB0Ym9keSB0cjpob3ZlciB0aCwudF9zZXRfdGIgdGJvZHkgdHI6aG92ZXIgdGR7YmFja2dyb3VuZDojZDBkYWZkfS50X3NldF90YiB0Zm9vdCB0ZHtib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6MTBweDtib3JkZXItcmFkaXVzLWJvdHRvbXJpZ2h0OjEwcHg7LW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbWxlZnQ6MTBweDstbW96LWJvcmRlci1yYWRpdXMtYm90dG9tcmlnaHQ6MTBweDstd2Via2l0LWJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6MTBweDstd2Via2l0LWJvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjEwcHh9LnRfc2V0X2Z0e2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWYs54C577+977+9ICFpbXBvcnRhbnQ7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDtmb250LXdlaWdodDpib2xkICFpbXBvcnRhbnQ7dGV4dC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50O21hcmdpbi10b3A6MTVweCAhaW1wb3J0YW50fS50X3NldF9mdCBhe3RleHQtZGVjb3JhdGlvbjpub25lO2NvbG9yOiMwMDB9LnRfc2V0YnRue2JvcmRlcjoxcHggc29saWQgYmxhY2s7cGFkZGluZzoycHg7Y3Vyc29yOnBvaW50ZXI7YmFja2dyb3VuZDojZmZmO2NvbG9yOiMwMDgwYzB9LnRfc2V0ZnRidG4gc3BhbntwYWRkaW5nOjJweCAxMHB4IDJweCAxMHB4ICFpbXBvcnRhbnR9LnRfcnRqZGJ0bntiYWNrZ3JvdW5kOiMwMDgwYzAgIWltcG9ydGFudDtjb2xvcjojZmZmICFpbXBvcnRhbnR9LnRfcnRqZHR4dHBvc3twYWRkaW5nLXRvcDo1cHh9I2laaGlodV9ydGhpbnR7Zm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZizngLnvv73vv70gIWltcG9ydGFudDtmb250LXNpemU6MTZweCAhaW1wb3J0YW50O2ZvbnQtd2VpZ2h0OmJvbGQ7cGFkZGluZzo1cHggMTBweCA1cHggMTBweDtwb3NpdGlvbjpmaXhlZDt0b3A6MjBweDtib3JkZXItcmFkaXVzOjVweDstbW96LWJvcmRlci1yYWRpdXM6NXB4Oy13ZWJraXQtYm9yZGVyLXJhZGl1czo1cHg7ZGlzcGxheTppbmxpbmUtYmxvY2s7b3BhY2l0eTowLjd9LnRfcnRoaW50X257Y29sb3I6I2ZmZiAhaW1wb3J0YW50O2JhY2tncm91bmQ6IzAwMCAhaW1wb3J0YW50fS50X3J0aGludF9me2JhY2tncm91bmQ6Izg4MDAwMCAhaW1wb3J0YW50O2NvbG9yOiNmZmZmZGQgIWltcG9ydGFudH0udF91cGJ0bntiYWNrZ3JvdW5kOiMwMDgwYzAgIWltcG9ydGFudDtjb2xvcjojZmZmICFpbXBvcnRhbnR9LnRfdXBpbmZve2hlaWdodDoxMjBweCAhaW1wb3J0YW50O3ZlcnRpY2FsLWFsaWduOnRleHQtdG9wICFpbXBvcnRhbnR9I2l6aF91cGRhdGVkaXYgdGh7Ym9yZGVyLXJpZ2h0OjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnR9I2l6aF91cGRhdGVkaXYgdGZvb3QgdGR7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtib3JkZXItdG9wOjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnQ7Zm9udC1mYW1pbHk6QXJpYWwsc2Fucy1zZXJpZizngLnvv73vv70gIWltcG9ydGFudDtmb250LXNpemU6MTJweCAhaW1wb3J0YW50O2ZvbnQtc3R5bGU6bm9ybWFsICFpbXBvcnRhbnQ7dGV4dC1zaGFkb3c6bm9uZSAhaW1wb3J0YW50fS50X3R4dHNob3d7dGV4dC1hbGlnbjpjZW50ZXI7YmFja2dyb3VuZDojMDA4MGMwO2NvbG9yOiNmMGYwZjA7dXNlci1zZWxlY3Q6bm9uZTstbW96LXVzZXItc2VsZWN0Om5vbmV9LnRfZnJzaG93e2ZvbnQtc2l6ZToxLjJlbTtwb3NpdGlvbjpmaXhlZDt6LWluZGV4Ojk5OTk5O3RvcDo0NXB4O3dpZHRoOjIwMHB4O29wYWNpdHk6MC45O2N1cnNvcjpwb2ludGVyfS50X3Rib3h7cGFkZGluZzoxMHB4O3Bvc2l0aW9uOnJlbGF0aXZlO2JvcmRlcjoxcHggc29saWQgI2YwZjBmMDtsaW5lLWhlaWdodDoyMHB4OypoZWlnaHQ6MSU7d2lkdGg6MjAwcHg7LW1vei1ib3gtc2hhZG93OjJweCA1cHggMTVweCAjMzMzOy1tb3otYm9yZGVyLXJhZGl1czo3cHg7LXdlYmtpdC1ib3gtc2hhZG93OjJweCA1cHggMTVweCAjMzMzOy13ZWJraXQtYm9yZGVyLXJhZGl1czo3cHh9LnRfdGJveCBze3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMjBweDtsZWZ0OjE2MHB4O2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjA7d2lkdGg6MDtmb250LXNpemU6MDtsaW5lLWhlaWdodDowO2JvcmRlci1jb2xvcjp0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjZjBmMGYwIHRyYW5zcGFyZW50O2JvcmRlci1zdHlsZTpkYXNoZWQgZGFzaGVkIHNvbGlkIGRhc2hlZDtib3JkZXItd2lkdGg6MTBweH0udF90Ym94IGl7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05cHg7bGVmdDotMTBweDtkaXNwbGF5OmJsb2NrO2hlaWdodDowO3dpZHRoOjA7Zm9udC1zaXplOjA7bGluZS1oZWlnaHQ6MDtib3JkZXItY29sb3I6dHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgIzAwODBjMCB0cmFuc3BhcmVudDtib3JkZXItc3R5bGU6ZGFzaGVkIGRhc2hlZCBzb2xpZCBkYXNoZWQ7Ym9yZGVyLXdpZHRoOjEwcHh9QG1lZGlhIHNjcmVlbiBhbmQgKC13ZWJraXQtbWluLWRldmljZS1waXhlbC1yYXRpbzowKXsjaVpoaWh1X3J0amRkaXZ7aGVpZ2h0OjQxN3B4fSNpWmhpaHVfc2V0ZGl2e2hlaWdodDI6Mjk1cHh9I2l6aF91cGRhdGVkaXZ7aGVpZ2h0OjMxNXB4fX0nCiAgICAgLCcnXS5qb2luKCdcbicpOwppZihwYWdlSXMuUXVlc3Rpb24mJml6aEF1dGhvckxpc3QpewogICAgY3NzKz1bJ2Rpdi51bm97cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItcmlnaHQtd2lkdGg6MDtib3JkZXItdG9wLXJpZ2h0LXJhZGl1czo2cHh9JwogICAgICAgICAsJ2Rpdi51bm8gLmZyYW1le292ZXJmbG93LXg6aGlkZGVuO292ZXJmbG93LXk6YXV0bztkaXJlY3Rpb246cnRsfScKICAgICAgICAgLCdkaXYudW5vIHNwYW4ubWVULGRpdi51bm8gc3Bhbi5tZUIsZGl2LnVubyB1bC5wcCBsaSBzcGFuLm1le3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjA7ZGlzcGxheTpibG9jaztoZWlnaHQ6MXB4O3dpZHRoOjFweDtsaW5lLWhlaWdodDoxcHg7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtib3JkZXItc3R5bGU6c29saWQ7Ym9yZGVyLWNvbG9yOnRyYW5zcGFyZW50O30nCiAgICAgICAgICwnZGl2LnVubyBzcGFuLm1lVHtib3JkZXItd2lkdGg6NnB4IDRweDtib3JkZXItdG9wLXdpZHRoOjBweDtib3JkZXItYm90dG9tLWNvbG9yOiNmZmY7fScKICAgICAgICAgLCdkaXYudW5vIHNwYW4ubWVCe2JvcmRlci13aWR0aDo2cHggNHB4O2JvcmRlci1ib3R0b20td2lkdGg6MHB4O2JvcmRlci10b3AtY29sb3I6I2ZmZjttYXJnaW4tdG9wOi03cHg7fScKICAgICAgICAgLCdkaXYudW5vIHVse2JhY2tncm91bmQtY29sb3I6IzA3NzFDMTtwYWRkaW5nOjA7bWFyZ2luOjA7ZGlyZWN0aW9uOmx0cn0nCiAgICAgICAgICwnZGl2LnVubyB1bCBsaXtkaXNwbGF5OmJsb2NrO2xpc3Qtc3R5bGUtdHlwZTpub25lO21hcmdpbjowO3BhZGRpbmc6MDt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAgICAgLCdkaXYudW5vIHVsIGxpIGF7ZGlzcGxheTpibG9jazt9ZGl2LnVubyBsaSBhLnNlbHt0ZXh0LWRlY29yYXRpb246bm9uZTt9JwogICAgICAgICAsJ2Rpdi51bm8gdWwgbGkgYXsnK2Nzc19BdXRob3JMaXN0SXRlbUErJ30nCiAgICAgICAgICwnZGl2LnVubyB1bC5wcCBsaSBzcGFuLm1le3Bvc2l0aW9uOnN0YXRpYzttYXJnaW46NnB4IC04cHg7Ym9yZGVyLXdpZHRoOjRweCA2cHg7Ym9yZGVyLXJpZ2h0LWNvbG9yOiNmZmY7ZmxvYXQ6cmlnaHQ7fScKICAgICAgICAgLCdkaXYudW5vIGxpIGEgc3Bhbi5uYW1le3RleHQtYWxpZ246cmlnaHQ7ZGlzcGxheTpibG9jazsnK2Nzc19BdXRob3JMaXN0SXRlbUFfbmFtZSsnYmFja2dyb3VuZC1jb2xvcjojZmZmO31kaXYudW5vIGxpIGEuc2VsIHNwYW4ubmFtZXtjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzA3NzFDMTt9JwogICAgICAgICAsJ2Rpdi51bm8gbGkgYSBzcGFuLm5hbWUubm9uYW1le2NvbG9yOiMwMDA7fScKICAgICAgICAgLCdkaXYudW5vIGxpIGEgc3Bhbi5uYW1lLmNvbGxhcHNlZHtjb2xvcjojOTk5OTk5O30nCiAgICAgICAgICwnZGl2LnVubyBsaSBhIHNwYW4ubmFtZS5mcmllbmR7Zm9udC1zdHlsZTppdGFsaWM7fScKICAgICAgICAgLCdkaXYudW5vIGxpIHNwYW4uaHB7YmFja2dyb3VuZC1jb2xvcjojOTk5OTk5O3Bvc2l0aW9uOnJlbGF0aXZlO2Zsb2F0OnJpZ2h0O21hcmdpbi10b3A6LTJweDtsaW5lLWhlaWdodDoycHg7aGVpZ2h0OjJweDt9JwogICAgICAgICAsJ2Rpdi51bm8gdGFibGUucGx1c3tmbG9hdDpyaWdodDttYXJnaW46N3B4IC05cHg7aGVpZ2h0OjdweDtib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7Ym9yZGVyLXN0eWxlOmhpZGRlbjt9ZGl2LnVubyB0YWJsZS5wbHVzIHRke2JvcmRlcjoxcHggc29saWQgI2ZmZjt3aWR0aDoxcHg7aGVpZ2h0OjFweDt9JwogICAgICAgICAsJ2Rpdi51bm8gYS5zZWwgdGFibGUucGx1c3t9ZGl2LnVubyBhLnNlbCB0YWJsZS5wbHVzIHRke30nCiAgICAgICAgICwnZGl2LnVubyBsaSBhIHNwYW4uZnVuY3t0ZXh0LWFsaWduOmNlbnRlcjt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXd7cG9zaXRpb246Zml4ZWQ7bWFyZ2luLXRvcDoxcHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItdG9wLXdpZHRoOjIycHg7Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6NnB4O2JveC1zaGFkb3c6NXB4IDVweCA1cHggIzc3Nzt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgLnptLWVkaXRhYmxlLWNvbnRlbnR7dG9wOjA7Ym90dG9tOjA7bGVmdDowO3JpZ2h0OjA7b3ZlcmZsb3cteTphdXRvO3BhZGRpbmc6MTBweDt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgaW1nLnptLWxpc3QtYXZhdGFye3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjEwcHg7dG9wOi0zNXB4O2JvcmRlcjoxcHggc29saWQgIzA3NzFDMTtib3JkZXItcmFkaXVzOjZweDt9JwogICAgICAgICAsJ2Rpdi5pemgtYW5zd2VyLXByZXZpZXcgc3Bhbi5jb21tZW50e3Bvc2l0aW9uOmFic29sdXRlO3RvcDotMThweDtsaW5lLWhlaWdodDoxOHB4O2JvcmRlci10b3AtcmlnaHQtcmFkaXVzOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7cGFkZGluZzowIDVweDt9JwogICAgICAgICAsJyddLmpvaW4oJ1xuJyk7Cn0KY3NzKz1bJy56LWljb24taXpoLWZvbGR7YmFja2dyb3VuZC1wb3NpdGlvbjotMTczcHggLTEwN3B4O3dpZHRoOjE1cHg7aGVpZ2h0OjE1cHg7fScKICAgICAsJyddLmpvaW4oJ1xuJyk7CmNzcys9WycudF9zZXRfdGJ7Zm9udC1mYW1pbHk6Ikx1Y2lkYSBTYW5zIFVuaWNvZGUiLCJMdWNpZGEgR3JhbmRlIixTYW5zLVNlcmlmICFpbXBvcnRhbnQ7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDt0ZXh0LXNoYWRvdzpub25lICFpbXBvcnRhbnQ7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlICFpbXBvcnRhbnQ7bWFyZ2luOjAgIWltcG9ydGFudDtsaW5lLWhlaWdodDoxMjAlfScKICAgICAsJy50X3NldF90YiB0aGVhZCB0ZHtiYWNrZ3JvdW5kOiMwMDgwYzA7Y29sb3I6I2ZmZjtib3JkZXI6bm9uZSAhaW1wb3J0YW50O3BhZGRpbmc6NHB4IDhweCA0cHggIWltcG9ydGFudDtib3JkZXItdG9wLWxlZnQtcmFkaXVzOjZweDtib3JkZXItdG9wLXJpZ2h0LXJhZGl1czo2cHh9JwogICAgICwnLnRfc2V0X3RiIHRoLC50X3NldF90YiB0ZHtwYWRkaW5nOjhweDtiYWNrZ3JvdW5kOiNlN2YzZjk7Ym9yZGVyOm5vbmUgIWltcG9ydGFudDtib3JkZXItdG9wOjJweCBzb2xpZCAjZmNmY2ZjICFpbXBvcnRhbnQ7Y29sb3I6IzY2OTtsaW5lLWhlaWdodDoxLjFlbSAhaW1wb3J0YW50fScKICAgICAsJy50X3NldF90YiB0ZCBpbnB1dCwudF9zZXRfdGIgdGQgdGV4dGFyZWF7Zm9udC1zaXplOjEycHggIWltcG9ydGFudDtwYWRkaW5nOjAgIWltcG9ydGFudH0nCiAgICAgLCcudF9zZXRfdGIgdGJvZHkgdHI6aG92ZXIgdGgsLnRfc2V0X3RiIHRib2R5IHRyOmhvdmVyIHRke2JhY2tncm91bmQ6I2QwZGFmZH0nCiAgICAgLCcudF9zZXRfdGIgdGZvb3QgdGR7Ym9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OjEwcHg7Ym9yZGVyLXJhZGl1cy1ib3R0b21yaWdodDoxMHB4Oy1tb3otYm9yZGVyLXJhZGl1cy1ib3R0b21sZWZ0OjEwcHg7LW1vei1ib3JkZXItcmFkaXVzLWJvdHRvbXJpZ2h0OjEwcHg7LXdlYmtpdC1ib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOjEwcHg7LXdlYmtpdC1ib3JkZXItYm90dG9tLXJpZ2h0LXJhZGl1czoxMHB4fScKICAgICAsJy50X3NldF90YiB0ZHt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAsJy50X3NldF90YiB0ZCAuaWNvbi1oZWxwe2Zsb2F0OnJpZ2h0O30nCiAgICAgLCcnXS5qb2luKCdcbicpOwpjc3MrPVsnLml6aF9ib3hTaGFkb3d7Ym94LXNoYWRvdzogNXB4IDVweCAzcHggMHB4ICM5OTkgIWltcG9ydGFudDt9JwogICAgICwnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcC5pemhfbm9Cb3JkZXJ7Ym9yZGVyLWJvdHRvbS1jb2xvcjp0cmFuc3BhcmVudCAhaW1wb3J0YW50O30nCiAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAuaXpoX25vQm9yZGVye2JvcmRlci10b3AtY29sb3I6dHJhbnNwYXJlbnQgIWltcG9ydGFudDt9JwogICAgICwnYS5pemgtYnV0dG9uLm9ue2NvbG9yOiMyMjU1OTk7dGV4dC1zaGFkb3c6MCAwIDFweCAjMjI1NTk5O30nCiAgICAgLCdhLml6aC1idXR0b24gLnpnLWljb257b3BhY2l0eTowLjU7fScKICAgICAsJ2EuaXpoLWJ1dHRvbi5vbiAuemctaWNvbntvcGFjaXR5OjE7fScKICAgICAsJ2EuaXpoLWJ1dHRvbi5vZmZ7Y29sb3I6I2VlZTt9JwogICAgICwnYS5pemgtYnV0dG9uLm9mZiAuemctaWNvbntvcGFjaXR5OjAuMjt9JwogICAgICwnLml6aC1mZWVkcy1maWx0ZXJ7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbntvcGFjaXR5OjAuNTtjb2xvcjojOTk5OTk5O3BhZGRpbmctbGVmdDo1cHg7dGV4dC1kZWNvcmF0aW9uOm5vbmU7Y3Vyc29yOnBvaW50ZXI7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbiBpe2JhY2tncm91bmQtcG9zaXRpb246LTE4M3B4IC00cHg7fScKICAgICAsJy5pemgtZmVlZHMtZmlsdGVyIC5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbi5vbntvcGFjaXR5OjE7Y29sb3I6IzIyNTU5OTt9JwogICAgICwnLml6aC1mZWVkcy1maWx0ZXIgLml6aC1mZWVkcy1maWx0ZXItb3B0aW9uLm9uIGl7YmFja2dyb3VuZC1wb3NpdGlvbjotMTgzcHggLTI0cHg7fScKICAgICAsJyddLmpvaW4oJ1xuJyk7CmlmKGl6aEhvbWVMYXlvdXQpewogICAgY3NzICs9ICBbJyN6aC1xdWVzdGlvbi1saXN0IHsgcGFkZGluZy1sZWZ0OjMwcHghaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnI3poLW1haW4tZmVlZC1mcmVzaC1idXR0b24geyBtYXJnaW4tbGVmdDotMzBweCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcuZmVlZC1pdGVtIHsnCiAgICAgICAgICAgICwnICAgIGJvcmRlci1ib3R0b206MXB4IHNvbGlkICNFRUUhaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLXRvcDotMXB4IWltcG9ydGFudCcKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW0gLmF2YXRhciB7IGRpc3BsYXk6bm9uZSFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnLmZlZWQtbWFpbiwuZmVlZC1pdGVtLmNvbWJpbmUgeyBtYXJnaW4tbGVmdDowIWltcG9ydGFudCB9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW0tcSB7IG1hcmdpbi1sZWZ0Oi0zMHB4IWltcG9ydGFudDtwYWRkaW5nLWxlZnQ6MCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICx3aW5kb3cuaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50ID8gJycgOiAnLmZlZWQtaXRlbS1hIC56bS1jb21tZW50LWJveCB7IG1heC13aWR0aDo2MDJweCFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLHdpbmRvdy5pWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQgPyAnJyA6ICcuZmVlZC1pdGVtLXEgLnptLWNvbW1lbnQtYm94IHsgbWF4LXdpZHRoOjYzMnB4IWltcG9ydGFudDsgd2lkdGg6NjMycHghaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJy56bS10YWctZWRpdG9yLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tdGl0bGUsJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1kZXRhaWwsJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAsJwogICAgICAgICAgICAsJy56aC1hbnN3ZXJzLXRpdGxlLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWxlZnQ6LTMycHghaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1sb2ctcGFnZS13cmFwIC56bS10YWctZWRpdG9yLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tbG9nLXBhZ2Utd3JhcCAjemgtcXVlc3Rpb24tdGl0bGUgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWxlZnQ6MCAhaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJy56aC1hbnN3ZXJzLXRpdGxlLCcKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tZmlsdGVyLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQ7JwogICAgICAgICAgICAsJyAgICB6LWluZGV4OjEwMDAhaW1wb3J0YW50JwogICAgICAgICAgICAsJ30nCiAgICAgICAgICAgICwnJwogICAgICAgICAgICAsJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAgeycKICAgICAgICAgICAgLCcgICAgbWFyZ2luLWJvdHRvbTowIWltcG9ydGFudDsnCiAgICAgICAgICAgICwnICAgIHBhZGRpbmctYm90dG9tOjEwcHghaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQnCiAgICAgICAgICAgICwnfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwIHsgbWFyZ2luLXRvcDotMXB4IWltcG9ydGFudCB9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLXdyYXAsI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwIHsgYm9yZGVyOm5vbmUhaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnLnp1LXF1ZXN0aW9uLWNvbGxhcC10aXRsZSB7IGJvcmRlci10b3A6MXB4IHNvbGlkICNFRUUhaW1wb3J0YW50IH0nCiAgICAgICAgICAgICwnI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwPmRpdjpsYXN0LWNoaWxkLC56bS1pdGVtLWFuc3dlcjpsYXN0LWNoaWxkIHsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI0VFRSFpbXBvcnRhbnQgfScKICAgICAgICAgICAgLCcnCiAgICAgICAgICAgICwnLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0tY29tbWVudC1vcC1saW5rLCcKICAgICAgICAgICAgLCcuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy51bnBpbiB7JwogICAgICAgICAgICAsJyAgICB2aXNpYmlsaXR5OnZpc2libGUhaW1wb3J0YW50OycKICAgICAgICAgICAgLCcgICAgb3BhY2l0eTowOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy5mZWVkLWl0ZW06aG92ZXIgLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0taXRlbS1hbnN3ZXIgLnp1LWF1dG9oaWRlLCcKICAgICAgICAgICAgLCcuem0taXRlbS1jb21tZW50OmhvdmVyIC56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLXJvdzpob3ZlciAuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy56bS1zaWRlLW5hdi1saTpob3ZlciAudW5waW4geycKICAgICAgICAgICAgLCcgICAgb3BhY2l0eToxOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJy56bS1pdGVtLXZvdGUtY291bnQ6aG92ZXIsLnptLXZvdGViYXIgYnV0dG9uOmhvdmVyeycKICAgICAgICAgICAgLCcgICAgYmFja2dyb3VuZDojYTZjZTU2IWltcG9ydGFudDsnCiAgICAgICAgICAgICwnICAgIGNvbG9yOiMzRTVFMDAgIWltcG9ydGFudCcKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCdhLGE6aG92ZXIsJwogICAgICAgICAgICAsJ2ksJwogICAgICAgICAgICAsJy56dS1hdXRvaGlkZSwnCiAgICAgICAgICAgICwnLnptLXZvdGViYXIgYnV0dG9uLCcKICAgICAgICAgICAgLCcuem0taXRlbS1jb21tZW50OmhvdmVyIC56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1jb21tZW50LW9wLWxpbmssJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLXJvdzpob3ZlciAuem0tc2lkZS10cmVuZC1kZWwsJwogICAgICAgICAgICAsJy56bS1zaWRlLXRyZW5kLWRlbCwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpLCcKICAgICAgICAgICAgLCcuenUtbWFpbi1mZWVkLWZyZXNoLWJ1dHRvbiwnCiAgICAgICAgICAgICwnLnpnLWljb24sJwogICAgICAgICAgICAsJy56bS1zaWRlLW5hdi1saTpob3ZlciAuemctaWNvbiwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpOmhvdmVyIGksJwogICAgICAgICAgICAsJy51bnBpbiwnCiAgICAgICAgICAgICwnLnptLXNpZGUtbmF2LWxpOmhvdmVyIC51bnBpbiB7JwogICAgICAgICAgICAsJyAgICAtbW96LXRyYW5zaXRpb246Y29sb3IgLjJzIGxpbmVhcixvcGFjaXR5IC4xNXMgbGluZWFyLGJhY2tncm91bmQtY29sb3IgLjJzIGxpbmVhcixiYWNrZ3JvdW5kLXBvc2l0aW9uIC4ycyBsaW5lYXIgLjFzOycKICAgICAgICAgICAgLCcgICAgLXdlYmtpdC10cmFuc2l0aW9uOmNvbG9yIC4ycyBsaW5lYXIsb3BhY2l0eSAuMTVzIGxpbmVhcixiYWNrZ3JvdW5kLWNvbG9yIC4ycyBsaW5lYXIsYmFja2dyb3VuZC1wb3NpdGlvbiAuMnMgbGluZWFyIC4xczsnCiAgICAgICAgICAgICwnICAgIHRyYW5zaXRpb246Y29sb3IgLjJzIGxpbmVhcixvcGFjaXR5IC4xNXMgbGluZWFyLGJhY2tncm91bmQtY29sb3IgLjJzIGxpbmVhcixiYWNrZ3JvdW5kLXBvc2l0aW9uIC4ycyBsaW5lYXIgLjFzOycKICAgICAgICAgICAgLCd9JwogICAgICAgICAgICAsJycKICAgICAgICAgICAgLCdoM3sgbGluZS1oZWlnaHQ6MjVweCB9JwogICAgICAgICAgICAsJy56dS1mb290ZXItaW5uZXIge3BhZGRpbmc6MTVweCAwIWltcG9ydGFudH0nCiAgICAgICAgICAgICwnLnptLXNpZGUtcGlubmVkLXRvcGljcyAuem0tc2lkZS1uYXYtbGl7ZmxvYXQ6bGVmdDtwYWRkaW5nLXJpZ2h0OjMwcHghaW1wb3J0YW50fScKICAgICAgICAgICAgLCcuem0tc2lkZS1saXN0LWNvbnRlbnR7Y2xlYXI6Ym90aH0nCiAgICAgICAgICAgICwnLnVucGlueyBkaXNwbGF5OmlubGluZS1ibG9jayFpbXBvcnRhbnQgfScKICAgICAgICAgICAsJyddLmpvaW4oJ1xuJyk7Cn0KCnZhciBjc3NfY29tbWVudD0nJzsKaWYocGFnZUlzLkhvbWV8fHBhZ2VJcy5RdWVzdGlvbnx8cGFnZUlzLkFuc3dlcil7CiAgICBjc3NfY29tbWVudCA9IHdpbmRvdy5pWmhpaHUuQ29tbWVudC5jc3M7Cn0KCmNzcyArPSB3aW5kb3cuaVpoaWh1LkFuc3dlci5jc3M7CgppZih3aW5kb3cuaVpoaWh1LlF1aWNrRmF2byl7CiAgICBjc3MgKz0gd2luZG93LmlaaGlodS5RdWlja0Zhdm8uY3NzOwp9CmlmKHdpbmRvdy5pWmhpaHUuUXVpY2tCbG9jayl7CiAgICBjc3MgKz0gd2luZG93LmlaaGlodS5RdWlja0Jsb2NrLmNzczsKfQppZih3aW5kb3cuaVpoaWh1Lk5vdGk3KXsKICAgIGNzcyArPSB3aW5kb3cuaVpoaWh1Lk5vdGk3LmNzczsKICAgIHdpbmRvdy5pWmhpaHUuTm90aTcuZW5oYW5jZSgpOwp9CnZhciBoZWFkcyA9IF9kb2MuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImhlYWQiKTsKaWYgKGhlYWRzLmxlbmd0aCA+IDApIHsKICAgIHZhciBub2RlID0gX2RvYy5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgbm9kZS50eXBlID0gInRleHQvY3NzIjsKICAgIG5vZGUuaWQgPSAiaXpoQ1NTX21haW4iOwogICAgbm9kZS5hcHBlbmRDaGlsZChfZG9jLmNyZWF0ZVRleHROb2RlKGNzcykpOwogICAgaGVhZHNbMF0uYXBwZW5kQ2hpbGQobm9kZSk7IAogICAgaWYoY3NzX2NvbW1lbnQhPScnKXsKICAgICAgICBub2RlID0gX2RvYy5jcmVhdGVFbGVtZW50KCJzdHlsZSIpCiAgICAgICAgbm9kZS50eXBlID0gInRleHQvY3NzIjsKICAgICAgICBub2RlLmlkID0gIml6aENTU19jb21tZW50IjsKICAgICAgICBub2RlLmFwcGVuZENoaWxkKF9kb2MuY3JlYXRlVGV4dE5vZGUoY3NzX2NvbW1lbnQpKTsKICAgICAgICBoZWFkc1swXS5hcHBlbmRDaGlsZChub2RlKTsKICAgIH0KfQoKaWYoISQoJy5tb2RhbC1kaWFsb2ctYmcnKS5sZW5ndGgpewogICAgJGJvZHkuYXBwZW5kKAogICAgICAgICQoJzxkaXYnLCB7IGlkOiAnaXpoLWRsZy1iZycsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctYmcnIH0pLmNzcyh7CiAgICAgICAgICAgICd6LWluZGV4JzogOTUKICAgICAgICAgICwgJ29wYWNpdHknOiAwLjUKICAgICAgICAgICwgJ3Bvc2l0aW9uJzogJ2ZpeGVkJwogICAgICAgICAgLCAndG9wJzogMAogICAgICAgICAgLCAnYm90dG9tJzogMAogICAgICAgICAgLCAnbGVmdCc6IDAKICAgICAgICAgICwgJ3JpZ2h0JzogMAogICAgICAgICAgLCAnZGlzcGxheSc6ICdub25lJwogICAgICAgIH0pCiAgICApOwp9Cgp3aW5kb3cuaVpoaWh1LmdldEl0ZW09ZnVuY3Rpb24oJGMpewogICAgdmFyICRpdGVtPSQobnVsbCk7CiAgICBpZigkYyAmJiAkYy5sZW5ndGgpeyAKICAgICAgICB2YXIgJGl0ZW1NZXRhPSRjLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKTsKICAgICAgICBpZiAoJGl0ZW1NZXRhLmlzKCcuZmVlZC1tZXRhJykgfHwgJGl0ZW1NZXRhLnBhcmVudCgpLmlzKCcuZmVlZC1tZXRhJykpewogICAgICAgICAgICAkaXRlbT0kYy5jbG9zZXN0KCcuZmVlZC1pdGVtJyk7CiAgICAgICAgICAgICRpdGVtLmF0dHIoJ2RhdGEtYWlkJywgJGl0ZW0uY2hpbGRyZW4oJ21ldGFbaXRlbXByb3A9YW5zd2VyLWlkXScpLmF0dHIoJ2NvbnRlbnQnKSkKICAgICAgICB9ZWxzZSBpZigkaXRlbU1ldGEuaXMoJy5hbnN3ZXItYWN0aW9ucycpKXsKICAgICAgICAgICAgJGl0ZW09JGMuY2xvc2VzdCgnLnptLWl0ZW0tYW5zd2VyLC5mZWVkLWl0ZW0nKTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGl0ZW09JGl0ZW1NZXRhLnByZXYoKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJGl0ZW07Cn07Cgp1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKGRvY3VtZW50LmJvZHksZnVuY3Rpb24oZXZlbnQpewoJaWYoaXpoVG9wTmF2QXV0b0ZvbGQpewoJCXdpbmRvdy5pWmhpaHUuVG9wTmF2Lm9uTm9kZUFkZGVkKGV2ZW50KQoJfQp9KQovKioKICogQGNsYXNzIEFuc3dlcgogKi8KZnVuY3Rpb24gQW5zd2VyKGlaaGlodSkgewogICAgaWYgKCB0eXBlb2YgaVpoaWh1ID09PSAndW5kZWZpbmVkJyB8fCAhaVpoaWh1KSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpWmhpaHUuQW5zd2VyID0gdGhpczsKCiAgICB0aGlzLl9lPW51bGw7CiAgICB0aGlzLnBwV2lkdGg9MDsKICAgIHRoaXMucHBIZWlnaHQ9NDAwOwoKICAgIHRoaXMuY3NzID0gCiAgICAgICAgWycuem0tdm90ZWJhciAuaXpoLWJ1dHRvbi5mb2xke21hcmdpbjo1cHggMHB4IDBweDtkaXNwbGF5OmJsb2NrO2NvbG9yOiM2OThFQkY7aGVpZ2h0OjI0cHg7bGluZS1oZWlnaHQ6MjRweDt3aWR0aDozOHB4O2JvcmRlci1yYWRpdXM6M3B4O2JvcmRlcjowcHggbm9uZTtjdXJzb3I6cG9pbnRlcjtiYWNrZ3JvdW5kOm5vbmUgcmVwZWF0IHNjcm9sbCAwJSAwJSAjRUZGNkZBO2ZvbnQtd2VpZ2h0OmZvbnQtd2VpZ2h0O3Bvc2l0aW9uOnJlbGF0aXZlO30nCiAgICAgICAgLCcnXS5qb2luKCdcbicpOwoKICAJdGhpcy5wcm9jZXNzQW5zd2VyPWZ1bmN0aW9uKCRhLCRwcCxiQXV0aG9yUmVhcixiQXV0aG9yTGlzdCl7CiAgICAgICAgaWYoISRhfHwhJGEubGVuZ3RoKXJldHVybjsKICAgICAgICBpZigkYS5hdHRyKCdpemhfcHJvY2Vzc2VkJyk9PScxJylyZXR1cm47CiAgICAgICAgdmFyIHNlbENvbGxhcHNlPScubWV0YS1pdGVtW25hbWU9Y29sbGFwc2VdJwogICAgICAgICAgLCAkbWV0YT0kYS5maW5kKCcuem0taXRlbS1tZXRhJykKICAgICAgICAgICwgJGF1dGhvcj0kYS5maW5kKCcuem0taXRlbS1hbnN3ZXItYXV0aG9yLWluZm8nKQogICAgICAgICAgLCAkZmF2bz0kYS5maW5kKCcubWV0YS1pdGVtW25hbWU9ZmF2b10nKQogICAgICAgICAgLCAkdm90ZT0kYS5maW5kKCcuem0tdm90ZWJhcicpCiAgICAgICAgOwogICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgLy8gUmVnaW9uOiDlv6vpgJ/lsY/olL0KICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkUXVpY2tCbG9jaygkYSkKCiAgICAgICAgICAgIC8vIFJlZ2lvbiBlbmQKICAgICAgICB9CiAgICAgICAgaWYoJGF1dGhvci5sZW5ndGgpey8vcmVsb2NhdGVQZXJzb25JbmZvCiAgICAgICAgICAgIGlmKGJBdXRob3JSZWFyKXsKICAgICAgICAgICAgICAgICRhdXRob3IuY3NzKHsKICAgICAgICAgICAgICAgICAgICAndGV4dEFsaWduJzoncmlnaHQnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGlmKCRhLmlzKCcuZmVlZC1pdGVtJykpewogICAgICAgICAgICAgICAgICAgICRhLmZpbmQoJy5lbnRyeS1ib2R5IC56bS1pdGVtLWFuc3dlci1kZXRhaWwgLnptLWl0ZW0tcmljaC10ZXh0JykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkYXV0aG9yLmhpZGUoKSkuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGM9JChldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGMuaXMoJy56bS1lZGl0YWJsZS1jb250ZW50JykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJy56bS1pdGVtLWFuc3dlci1hdXRob3ItaW5mbycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5pbnNlcnRCZWZvcmUoJGMuY2hpbGRyZW4oJy5hbnN3ZXItZGF0ZS1saW5rLXdyYXAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdyaWdodCc6MAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJGF1dGhvci5pbnNlcnRCZWZvcmUoJG1ldGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRhdXRob3I9JGF1dGhvci5jaGlsZHJlbigpLmVxKDEpOwogICAgICAgICAgICBpZiAoJHBwICYmIGJBdXRob3JMaXN0KXsKICAgICAgICAgICAgICAgIC8vIFJlZ2lvbjog5Zue562U55uu5b2V6aG5CiAgICAgICAgICAgICAgICB2YXIgY29sbGFwc2VkPSRhLmF0dHIoJ2RhdGEtY29sbGFwc2VkJyk9PScxJwogICAgICAgICAgICAgICAgICAsICRwcGxhPSQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaHJlZjonI2Fuc3dlci0nKyRhLmF0dHIoJ2RhdGEtYWlkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAsIHRhcmdldDonX3NlbGYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCBzdHlsZTpjc3NfQXV0aG9yTGlzdEl0ZW1BCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICwgJHBwbD0kKCc8bGk+JykuYXBwZW5kKCRwcGxhKQogICAgICAgICAgICAgICAgICAsICR1bm89aVpoaWh1LiR1bm9BbnN3ZXJzCiAgICAgICAgICAgICAgICBpZihjb2xsYXBzZWQpewogICAgICAgICAgICAgICAgICAgICRwcGwuYXBwZW5kVG8oJHBwKQogICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgJHBwbC5pbnNlcnRCZWZvcmUoJHVuby4kZW5kT2ZMYXN0QSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKCRhLmF0dHIoJ2RhdGEtaXNvd25lcicpPT0nMScpewogICAgICAgICAgICAgICAgICAgIGlaaGlodS5BbnN3ZXIuX2U9JGEuZ2V0KDApOwogICAgICAgICAgICAgICAgICAgICRwcGxhLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICdtZScgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdmFyIG5hbWVDU1M9J25hbWUnOwogICAgICAgICAgICAgICAgaWYoJGEuYXR0cignZGF0YS1pc2ZyaWVuZCcpPT0nMScpewogICAgICAgICAgICAgICAgICAgIG5hbWVDU1MrPScgZnJpZW5kJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmKGNvbGxhcHNlZCl7CiAgICAgICAgICAgICAgICAgICAgbmFtZUNTUys9JyBjb2xsYXBzZWQnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZighJGF1dGhvci5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgIG5hbWVDU1MrPScgbm9uYW1lJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICQoJzxzcGFuPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6bmFtZUNTUwogICAgICAgICAgICAgICAgICAsIHN0eWxlOmNzc19BdXRob3JMaXN0SXRlbUFfbmFtZQogICAgICAgICAgICAgICAgfSkudGV4dCghJGF1dGhvci5sZW5ndGg/J+WMv+WQjeeUqOaItyc6JGF1dGhvci50ZXh0KCkpLmFwcGVuZFRvKCRwcGxhKTsKICAgICAgICAgICAgICAgIGlmICgkcHBsLndpZHRoKCk+aVpoaWh1LkFuc3dlci5wcFdpZHRoKQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5BbnN3ZXIucHBXaWR0aD0kcHBsLndpZHRoKCk7CiAgICAgICAgICAgICAgICAvLyBSZWdpb24gZW5kCiAgICAgICAgICAgICAgICAvLyBSZWdpb246IOWbnuetlOevh+W5heaMh+ekugogICAgICAgICAgICAgICAgdmFyIG5IUD1NYXRoLmNlaWwoJCgnLnptLWVkaXRhYmxlLWNvbnRlbnQnLCRhKS50ZXh0KCkubGVuZ3RoLzEwMCk7CiAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsKICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidocCcKICAgICAgICAgICAgICAgIH0pLmNzcyh7J3dpZHRoJzpuSFAqMTAsJ21hcmdpbi1sZWZ0JzotbkhQKjEwfSkuYXBwZW5kVG8oJHBwbGEpOwogICAgICAgICAgICAgICAgLy8gUmVnaW9uIGVuZAogICAgICAgICAgICAgICAgJHBwbGEubW91c2VvdmVyKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRmcm09JCh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKQogICAgICAgICAgICAgICAgICAgICAgLCAkdW5vPWlaaGlodS4kdW5vQW5zd2VycwogICAgICAgICAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ3NlbCcpOwogICAgICAgICAgICAgICAgICAgIGlmKGlaaGlodS5BbnN3ZXIuX2UpewogICAgICAgICAgICAgICAgICAgICAgICAkdW5vLmNoaWxkcmVuKCcubWVUJykuY3NzKCdkaXNwbGF5JywwPmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCk/Jyc6J25vbmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJHVuby5jaGlsZHJlbignLm1lQicpLmNzcygnZGlzcGxheScsJGZybS5oZWlnaHQoKTxpWmhpaHUuQW5zd2VyLl9lLm9mZnNldFRvcC0kZnJtLnNjcm9sbFRvcCgpK2laaGlodS5BbnN3ZXIuX2Uub2Zmc2V0SGVpZ2h0PycnOidub25lJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFJlZ2lvbjog5Zue562U6aKE6KeICiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbT0kKCdzcGFuLm5hbWUnLHRoaXMpOwogICAgICAgICAgICAgICAgICAgIGlmKCFuYW0ubGVuZ3RoKXJldHVybjsKICAgICAgICAgICAgICAgICAgICB2YXIgYWlkPSQodGhpcykuYXR0cignaHJlZicpLnJlcGxhY2UoJyNhbnN3ZXItJywnJykKICAgICAgICAgICAgICAgICAgICAgICwgcHJ2PSR1bm8ubmV4dCgnLml6aC1hbnN3ZXItcHJldmlldycpCiAgICAgICAgICAgICAgICAgICAgICAsIHRvcD0kKHRoaXMpLnBvc2l0aW9uKCkudG9wKyR1bm8ucG9zaXRpb24oKS50b3AKICAgICAgICAgICAgICAgICAgICAgICwgc2VsPScuem0taXRlbS1hbnN3ZXJbZGF0YS1haWQ9JythaWQrJ10gPiAuem0taXRlbS1yaWNoLXRleHQnCiAgICAgICAgICAgICAgICAgICAgICAsIGN0eD1uYW0uaXMoJy5jb2xsYXBzZWQnKT8nI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwJzonI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwJwogICAgICAgICAgICAgICAgICAgICAgLCBkaXY9JChzZWwsY3R4KQogICAgICAgICAgICAgICAgICAgICAgLCBjbXQ9JCgnLnptLWl0ZW0tbWV0YSA+IC56dS1xdWVzdGlvbi1hbnN3ZXItbWV0YS1jb21tZW50JyxkaXYucGFyZW50KCkpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIGlmKCFwcnYubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgcHJ2PSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzpkaXYuY2xhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ2l6aC1hbnN3ZXItcHJldmlldycpLndpZHRoKGRpdi53aWR0aCgpKzIyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1vdXNlb3ZlcihmdW5jdGlvbigpeyR1bm8ubW91c2VvdmVyKCk7JCgnbGkgYVtocmVmPSMnKyQodGhpcykuYXR0cignZGF0YS1haWQnKSsnXScsJHVubykuYWRkQ2xhc3MoJ3NlbCcpOyQodGhpcykuc2hvdygpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAubW91c2VvdXQoZnVuY3Rpb24oKXskdW5vLm1vdXNlb3V0KCk7JCgnbGkgYVtocmVmPSMnKyQodGhpcykuYXR0cignZGF0YS1haWQnKSsnXScsJHVubykucmVtb3ZlQ2xhc3MoJ3NlbCcpOyQodGhpcykuaGlkZSgpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2xpY2soZnVuY3Rpb24oKXskKCdsaSBhW2hyZWY9IycrJCh0aGlzKS5hdHRyKCdkYXRhLWFpZCcpKyddJywkdW5vKVswXS5jbGljaygpO30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJHVubykKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZihwcnYuYXR0cignZGF0YS1haWQnKSE9YWlkKXsKICAgICAgICAgICAgICAgICAgICAgICAgcHJ2LmF0dHIoJ2RhdGEtYWlkJyxhaWQpLmVtcHR5KCkuYXBwZW5kKGRpdi5jbG9uZSgpLmNoaWxkcmVuKCkpLmZpbmQoJ2EnKS5hdHRyKCdvbmNsaWNrJywncmV0dXJuIGZhbHNlOycpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkKCdzcGFuLm1lJyx0aGlzKS5sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcnYuZmluZCgnYS56dS1lZGl0LWJ1dHRvbicpLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighbmFtLmhhc0NsYXNzKCdub25hbWUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2ltZy56bS1saXN0LWF2YXRhcicsZGl2LnBhcmVudCgpKS5jbG9uZSgpLmFwcGVuZFRvKHBydik7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0PWNtdC50ZXh0KCksaT10LmluZGV4T2YoJ+adoeivhOiuuicpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihjbXQubGVuZ3RoJiZpPjApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsnY2xhc3MnOidjb21tZW50J30pLnRleHQodC5zdWJzdHJpbmcoMCxpKSkucHJlcGVuZChjbXQuY2hpbGRyZW4oJ2knKS5jbG9uZSgpKS5hcHBlbmRUbyhwcnYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2YXIgdGg9ZGl2LmhlaWdodCgpKzMzCiAgICAgICAgICAgICAgICAgICAgICAsIG1heFRvcD0kdW5vLnBvc2l0aW9uKCkudG9wKzEyCiAgICAgICAgICAgICAgICAgICAgICAsIGNvbnRlbnRQb3NpdGlvbj0nJzsKICAgICAgICAgICAgICAgICAgICBpZihtYXhUb3ArdGg8JHdpbi5oZWlnaHQoKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRvcCt0aDwkd2luLmhlaWdodCgpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBydi5jc3Moeyd0b3AnOnRvcD5tYXhUb3A/dG9wOm1heFRvcCwnYm90dG9tJzonJ30pOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBydi5jc3Moeyd0b3AnOicnLCdib3R0b20nOjB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICBwcnYuY3NzKHsndG9wJzptYXhUb3AsJ2JvdHRvbSc6MH0pOwogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50UG9zaXRpb249J2Fic29sdXRlJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcHJ2LmNzcyh7J2xlZnQnOiR1bm8ud2lkdGgoKX0pLnNob3coKS5jaGlsZHJlbigpLmZpcnN0KCkuY3NzKCdwb3NpdGlvbicsY29udGVudFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgICAvLyBSZWdpb24gZW5kCiAgICAgICAgICAgICAgICB9KS5tb3VzZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ3NlbCcpOwogICAgICAgICAgICAgICAgICAgIHZhciAkdW5vPSQodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlKTsKICAgICAgICAgICAgICAgICAgICAkdW5vLm5leHQoKS5oaWRlKCk7CiAgICAgICAgICAgICAgICB9KS5jbGljayhmdW5jdGlvbigpeyQodGhpcykubW91c2VvdXQoKTsKICAgICAgICAgICAgICAgIGlaaGlodS4kdW5vQW5zd2Vycy5jc3MoJ2xlZnQnLDktaVpoaWh1LiR1bm9BbnN3ZXJzLndpZHRoKCkpO30pOwogICAgICAgICAgICAgICAgaWYoaVpoaWh1LkFuc3dlci5fZT09JGEuZ2V0KDApKXsKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQW5zd2VyLl9lPSRwcGxhLmdldCgwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYoaVpoaWh1LlF1aWNrRmF2bykKICAgICAgICAgICAgaVpoaWh1LlF1aWNrRmF2by5hZGRRdWlja0Zhdm8oJGZhdm8sJGEpOwoKICAgICAgICAkbWV0YS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpWmhpaHUuQ29tbWVudC5wcm9jZXNzQ29tbWVudEJ1dHRvbigkYSk7CgogICAgICAgIHZhciAkY209JCgnLnptLWNvbW1lbnQtYm94JywkYSk7CiAgICAgICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgICAgIAl2YXIgZm9jdXNOYW1lID0gaVpoaWh1LkNvbW1lbnQuc2Nyb2xsRm9jdXNDb21tZW50T25QYWdlTG9hZCgkY20pOwogICAgCiAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGNtLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKSxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJGNtLCBmb2N1c05hbWUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgJGEuYXR0cignaXpoX3Byb2Nlc3NlZCcsJzEnKTsKICAgIH07CgogICAgcmV0dXJuIHRoaXM7Cn0KCi8qKgogKiBAY2xhc3MgQ29tbWVudAogKi8KZnVuY3Rpb24gQ29tbWVudChpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1LkNvbW1lbnQgPSB0aGlzOwoKICAgIHZhciBjc3NfY29tbWVudD17CiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzonI2ZmZicKICAgICAgICAgICwgJ291dGxpbmUnOidub25lJwogICAgICAgICAgLCAnei1pbmRleCc6Jzk5OTknCiAgICAgICAgICAsICdib3JkZXItcmFkaXVzJzonMCA2cHggMCAwJwogICAgICAgICAgLCAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICwgJ3Zpc2liaWxpdHknOidoaWRkZW4nCiAgICAgICAgICAsICd0b3AnOi03MAogICAgICAgIH0KICAgIDsKICAgIHRoaXMuUmlnaHRDb21tZW50ID0gaVpoaWh1LmNvbmZpZ1snU2hvd0NvbW1lbnQnXTsKICAgIHRoaXMuQXV0b1Njcm9sbFBhZ2VXaGVuQ2xvc2luZyA9IGlaaGlodS5jb25maWdbJ1JpZ2h0Q29tbWVudF9BdXRvU2Nyb2xsUGFnZVdoZW5DbG9zaW5nJ107CiAgICBpZiAoIXRoaXMuUmlnaHRDb21tZW50KXsKICAgICAgICB0aGlzLmNzcyA9IAogICAgICAgICAgICBbJy56bS1jb21tZW50LWJveC5lbXB0eSAuaXpoLWJ1dHRvbi1jY3tkaXNwbGF5Om5vbmU7fScKICAgICAgICAgICAgLCcnXS5qb2luKCdcbicpOwogICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNzcyA9IAogICAgICAgICAgICBbJy5tZW50aW9uLXBvcHVwe3otaW5kZXg6MTAwMDAgIWltcG9ydGFudDt9JwogICAgICAgICAgICAsJy56bS1pdGVtLW1ldGEgLm1ldGEtaXRlbS50b2dnbGUtY29tbWVudHtkaXNwbGF5OmJsb2NrO2Zsb2F0OnJpZ2h0O21hcmdpbi1sZWZ0OjdweCAhaW1wb3J0YW50O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94e3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi10b3A6MDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaWNvbi1zcGlrZXtkaXNwbGF5Om5vbmUgIWltcG9ydGFudDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCA+IC56bS1jb21tZW50LWJveC1mdHtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7cmlnaHQ6MDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveC5lbXB0eXtwYWRkaW5nLXRvcDoxMHB4ICFpbXBvcnRhbnQ7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggPiAuem0tY29tbWVudC1mb3Jte21hcmdpbjoxNXB4ICFpbXBvcnRhbnQ7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgPiAuem0tY29tbWVudC1mb3Jte2JvdHRvbToyNXB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94ID4gLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZXtwb3NpdGlvbjphYnNvbHV0ZTtib3R0b206NjBweDt0b3A6MDtsZWZ0OjA7cmlnaHQ6MDtvdmVyZmxvdzphdXRvO30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94LmVtcHR5ID4gLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZXtib3R0b206MjVweDt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCA+IC56bS1jb21tZW50LWZvcm0gLnptLWNvbW1hbmR7cG9zaXRpb246YWJzb2x1dGU7bGVmdDowO3JpZ2h0OjA7Ym90dG9tOjQwcHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgPiAuem0tY29tbWVudC1mb3JtIC56bS1jb21tYW5ke2JvdHRvbToxMHB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3Bvc2l0aW9uOmFic29sdXRlO3RvcDo3MHB4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94LmVtcHR5IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3RvcDphdXRvO2JvdHRvbTozMHB4O3otaW5kZXg6MTA7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggLml6aC1idXR0b25zLWNtLUx7bGVmdDowO30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IC5pemgtYnV0dG9ucy1jbS1MID4gYXttYXJnaW4tcmlnaHQ6N3B4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IC5pemgtYnV0dG9ucy1jbS1Se3JpZ2h0OjFlbTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaXpoLWJ1dHRvbnMtY20tUiA+IGF7bWFyZ2luLWxlZnQ6N3B4O30nCiAgICAgICAgICAgICwnLnptLWNvbW1lbnQtYm94IGEuaXpoLWJ1dHRvbi5vbntjb2xvcjojMjI1NTk5O3RleHQtc2hhZG93OjAgMCAxcHggIzIyNTU5OTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCBhLml6aC1idXR0b24gLnpnLWljb257b3BhY2l0eTowLjU7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggYS5pemgtYnV0dG9uLm9uIC56Zy1pY29ue29wYWNpdHk6MTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCBhLml6aC1idXR0b24ub2Zme2NvbG9yOiNlZWU7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggYS5pemgtYnV0dG9uLm9mZiAuemctaWNvbntvcGFjaXR5OjAuMjt9JwogICAgICAgICAgICAvLywnLnptLWNvbW1lbnQtYm94LmVtcHR5IFtjbGFzc149aXpoLWJ1dHRvbnMtY21de3RvcDphdXRvO2JvdHRvbTo3cHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3guZW1wdHkgLnptLWNvbW1lbnQtbGlzdHt2aXNpYmlsaXR5OmhpZGRlbjt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuem0tY29tbWVudC1saXN0IC56bS1pdGVtLWNvbW1lbnRbaXpoX2hpbGlnaHRde2JhY2tncm91bmQtY29sb3I6cmdiKDI1NSwyNTUsMTYwKTt9JwogICAgICAgICAgICAsJy56bS1jb21tZW50LWJveCAuaXpoLWJ1dHRvbi5vbiAuemctaWNvbi1jb21tZW50LWxpa2V7YmFja2dyb3VuZC1wb3NpdGlvbjotMjIycHggLTc5cHg7fScKICAgICAgICAgICAgLCcuem0tY29tbWVudC1ib3ggLml6aC1idXR0b24gLnotaWNvbi1mb2xke2hlaWdodDo2cHg7fScKICAgICAgICAgICAgLCcnXS5qb2luKCdcbicpOwogICAgICAgIHRoaXMub25XaW5Mb2FkPWZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciBpWmhpaHU9d2luZG93LmlaaGlodTsKICAgICAgICAgICAgaVpoaWh1LiR3aW4uc2Nyb2xsKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIGlmKGlaaGlodS5Db21tZW50Lk9wZW5pbmcmJiFpWmhpaHUuQ29tbWVudC5QYWdlTm90U2Nyb2xsKXsKICAgICAgICAgICAgICAgICAgICB2YXIgYW5pbWF0ZT10cnVlOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkKGlaaGlodS5Db21tZW50Lk9wZW5pbmcpLHRydWUsYW5pbWF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIAogICAgICAgICAgICBpWmhpaHUuJHdpbi5yZXNpemUoZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuT3BlbmluZyl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRjbT0kKGlaaGlodS5Db21tZW50Lk9wZW5pbmcpOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lk9wZW5pbmcgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmNsb3NlKG51bGwsJGNtKTsKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKG51bGwsJGNtKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmKGlaaGlodS5TY3JvbGxUb3ApewogICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3A9aVpoaWh1LlNjcm9sbFRvcDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLm9uV2luTG9hZCgpCiAgICB9CiAgICB0aGlzLnByb2Nlc3NDb21tZW50QnV0dG9uID0gZnVuY3Rpb24oJGEpewogICAgICAgIGlmKGlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgICAgIHZhciAkYmM9JGEuZmluZCgnLm1ldGEtaXRlbS50b2dnbGUtY29tbWVudCcpOwogICAgICAgICAgICAkYmMucHJlcGVuZFRvKCRiYy5wYXJlbnQoKSk7CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuc2Nyb2xsRm9jdXNDb21tZW50T25QYWdlTG9hZCA9IGZ1bmN0aW9uKCRjbSl7CiAgICAgICAgaWYoIWlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudClyZXR1cm47CiAgICAgICAgdmFyIGZvY3VzTmFtZT11cmwuZGF0YS5hdHRyLmZyYWdtZW50OwogICAgICAgIGlmKCFmb2N1c05hbWV8fGZvY3VzTmFtZT09JycpcmV0dXJuOwogICAgCWlmKHdpbmRvdy5pWmhpaHU0Q1JYKXsKICAgICAgICAgICAgdmFyICRpY20yQz0kY20uZmluZCgnLnptLWNvbW1lbnQtbGlzdCAuem0taXRlbS1jb21tZW50IGEuemctYW5jaG9yLWhpZGRlbltuYW1lPSInK2ZvY3VzTmFtZSsnIl0nKS5wYXJlbnQoKQogICAgICAgICAgICAgICwgb2Zmc2V0VG9wPSRpY20yQy5sZW5ndGg/JGljbTJDLm9mZnNldCgpLnRvcDowCiAgICAgICAgICAgIDtpZihvZmZzZXRUb3Ape2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wPW9mZnNldFRvcDt9CiAgICAJfQogICAgICAgIHJldHVybiBmb2N1c05hbWU7CiAgICB9OwogICAgCiAgICB0aGlzLm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20gPSBmdW5jdGlvbigkaXRlbU1ldGEsZnVuY0FmdGVyU2Nyb2xsLGFsd2F5cyxhbmltYXRlKXsKICAgICAgICBpZighaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50IHx8ICFpWmhpaHUuQ29tbWVudC5BdXRvU2Nyb2xsUGFnZVdoZW5DbG9zaW5nKXsKICAgICAgICAgICAgaWYoZnVuY0FmdGVyU2Nyb2xsKXtmdW5jQWZ0ZXJTY3JvbGwoKTt9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYodHlwZW9mIGFsd2F5cyA9PT0gJ3VuZGVmaW5lZCcpYWx3YXlzPXRydWU7Ly9pZiBmYWxzZSwgc2Nyb2xsaW5nIG9ubHkgd2hlbiB0aGUgLnptLWl0ZW0tbWV0YSBvdXQgb2YgdmlzaWJsZSByYW5nZQogICAgICAgIGlmKHR5cGVvZiBhbmltYXRlID09PSAndW5kZWZpbmVkJylhbmltYXRlPWZhbHNlOy8vaWYgZmFsc2UsIHNjcm9sbGluZyBpbnN0YW50bHkKICAgICAgICBpZihhbHdheXMpJGl0ZW1NZXRhLmNoaWxkcmVuKCcuem0tY29tbWVudC1ib3gnKS5jc3MoJ3Bvc2l0aW9uJywnZml4ZWQnKTsKICAgICAgICB2YXIgd2luSGVpZ2h0PWlaaGlodS4kd2luLmhlaWdodCgpCiAgICAgICAgICAsIHNjcm9sbE9iaj13aW5kb3cuaVpoaWh1NENSWD9kb2N1bWVudC5ib2R5OmRvY3VtZW50LmRvY3VtZW50RWxlbWVudAogICAgICAgICAgLCBzY3JvbGxUb3BOb3c9c2Nyb2xsT2JqLnNjcm9sbFRvcAogICAgICAgICAgLCBuYXZIZWlnaHQ9aVpoaWh1LiRib2R5LmNoaWxkcmVuKCkuZmlyc3QoKS5oZWlnaHQoKQogICAgICAgICAgLCBiYXI9JCgnLnp1LWdsb2JhbC1ub3RpZnkuenUtZ2xvYmFsLW5vdGlmeS1pbmZvOnZpc2libGUnKQogICAgICAgICAgLCBiYXJIZWlnaHQ9IWJhci5sZW5ndGg/MDpiYXIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgLCBiYXNlVG9wPSgoYmFySGVpZ2h0JiZiYXIuY3NzKCdwb3NpdGlvbicpPT0nZml4ZWQnKT9iYXJIZWlnaHQ6KHNjcm9sbFRvcE5vdz5iYXJIZWlnaHQ/MDpiYXJIZWlnaHQtc2Nyb2xsVG9wTm93KSkrbmF2SGVpZ2h0CiAgICAgICAgICAsIG1heEhlaWdodD13aW5IZWlnaHQtYmFzZVRvcAogICAgICAgICAgLCBtZXRhSGVpZ2h0PSRpdGVtTWV0YS5pbm5lckhlaWdodCgpCiAgICAgICAgICAsIG9mZnNldFRvcD0kaXRlbU1ldGEub2Zmc2V0KCkudG9wCiAgICAgICAgICAsIG9mZnNldEJvdHRvbT1vZmZzZXRUb3ArbWV0YUhlaWdodAogICAgICAgICAgLCAkaXRlbT1pWmhpaHUuZ2V0SXRlbSgkaXRlbU1ldGEpCiAgICAgICAgICAsIGl0ZW1IZWlnaHQ9JGl0ZW0uaW5uZXJIZWlnaHQoKQogICAgICAgICAgLCBvZmZzZXRUb3BBPSRpdGVtLm9mZnNldCgpLnRvcAogICAgICAgICAgLCBvZmZzZXRCb3R0b21BPW9mZnNldFRvcEEraXRlbUhlaWdodAogICAgICAgICAgLCBzY3JvbGxUb3BFbmQ9aXRlbUhlaWdodD5tYXhIZWlnaHQ/b2Zmc2V0Qm90dG9tLXdpbkhlaWdodDoob2Zmc2V0VG9wQTw9c2Nyb2xsVG9wTm93P29mZnNldFRvcEEtYmFzZVRvcDpvZmZzZXRCb3R0b20td2luSGVpZ2h0KQogICAgICAgIDsKICAgICAgICBpZighYWx3YXlzKXsKICAgICAgICAgICAgYWx3YXlzPW9mZnNldFRvcDxzY3JvbGxUb3BOb3crYmFzZVRvcHx8b2Zmc2V0Qm90dG9tPnNjcm9sbFRvcE5vdyt3aW5IZWlnaHQtYmFzZVRvcDsKICAgICAgICB9CiAgICAgICAgaWYoYWx3YXlzKXsKICAgICAgICAgICAgaVpoaWh1LlNjcm9sbFRvcD1zY3JvbGxUb3BFbmQ7CiAgICAgICAgICAgIGlmKGFuaW1hdGUpewogICAgICAgICAgICAgICAgJChzY3JvbGxPYmopLmFuaW1hdGUoeydzY3JvbGxUb3AnOnNjcm9sbFRvcEVuZH0sZnVuY0FmdGVyU2Nyb2xsKTsKICAgICAgICAJfWVsc2V7CiAgICAgICAgICAgICAgICAkKHNjcm9sbE9iaikuc2Nyb2xsVG9wKHNjcm9sbFRvcEVuZCk7CiAgICAgICAgICAgICAgICBpZihmdW5jQWZ0ZXJTY3JvbGwpe2Z1bmNBZnRlclNjcm9sbCgpO30KICAgICAgICAJfQogICAgICAgIH1lbHNlewogICAgICAgICAgICBpZihmdW5jQWZ0ZXJTY3JvbGwpe2Z1bmNBZnRlclNjcm9sbCgpO30KICAgICAgICB9CiAgICB9OwogICAgdGhpcy5ib3ggPSBmdW5jdGlvbigkY20sa2VlcFNpemUsYW5pbWF0ZSl7aWYoISRjbXx8ISRjbS5sZW5ndGgpcmV0dXJuOwogICAgICAgICRjbS5zdG9wKCk7CiAgICAgICAgaWYodHlwZW9mIGtlZXBTaXplID09PSAndW5kZWZpbmVkJylrZWVwU2l6ZT1mYWxzZTsKICAgICAgICBpZih0eXBlb2YgYW5pbWF0ZSA9PT0gJ3VuZGVmaW5lZCcpYW5pbWF0ZT1mYWxzZTsKICAgICAgICB2YXIgd2luSGVpZ2h0PWlaaGlodS4kd2luLmhlaWdodCgpCiAgICAgICAgICAsIHRoPWtlZXBTaXplP3BhcnNlSW50KCRjbS5hdHRyKCdpemhfY21IZWlnaHQnKSk6MAogICAgICAgICAgLCBzY3JvbGxUb3A9KGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wKT9kb2N1bWVudC5ib2R5LnNjcm9sbFRvcDpkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wCiAgICAgICAgICAsIG5hdkhlaWdodD1pWmhpaHUuJGJvZHkuY2hpbGRyZW4oKS5maXJzdCgpLmhlaWdodCgpCiAgICAgICAgICAsIGJhcj0kKCcuenUtZ2xvYmFsLW5vdGlmeS56dS1nbG9iYWwtbm90aWZ5LWluZm86dmlzaWJsZScpCiAgICAgICAgICAsIGJhckhlaWdodD0hYmFyLmxlbmd0aD8wOmJhci5vdXRlckhlaWdodCgpCiAgICAgICAgICAsIGJhc2VUb3A9KChiYXJIZWlnaHQmJmJhci5jc3MoJ3Bvc2l0aW9uJyk9PSdmaXhlZCcpP2JhckhlaWdodDooc2Nyb2xsVG9wPmJhckhlaWdodD8wOmJhckhlaWdodC1zY3JvbGxUb3ApKStuYXZIZWlnaHQKICAgICAgICAgICwgbWluSGVpZ2h0PTExMgogICAgICAgICAgLCBtYXhIZWlnaHQ9d2luSGVpZ2h0LWJhc2VUb3AtMzUKICAgICAgICAgICwgdG9vU21hbGw9bWF4SGVpZ2h0PG1pbkhlaWdodAogICAgICAgICAgLCAkbWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAsIG1ldGFIZWlnaHQ9MiokbWV0YS5oZWlnaHQoKS0kbWV0YS5pbm5lckhlaWdodCgpCiAgICAgICAgICAsIG9mZnNldFRvcD1zY3JvbGxUb3AtJG1ldGEub2Zmc2V0KCkudG9wCiAgICAgICAgICAsIG9mZnNldEJvdHRvbT0tb2Zmc2V0VG9wLXdpbkhlaWdodAogICAgICAgIDtpZih0b29TbWFsbCltYXhIZWlnaHQ9bWluSGVpZ2h0OwogICAgICAgIGlmKCF0aHx8aXNOYU4odGgpKXsKICAgICAgICAgICAgdmFyICR0PSRjbS5jbG9uZSgpLmNzcyh7J3Bvc2l0aW9uJzonYWJzb2x1dGUnLCd6LWluZGV4JzonLTEnfSkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkuc2hvdygpCiAgICAgICAgICAgICAgLCAkbD0kdC5jaGlsZHJlbignLnptLWNvbW1lbnQtbGlzdCcpCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoISRjbS5pcygnLmVtcHR5JykmJiRsLmNoaWxkcmVuKCkubGVuZ3RoPjApJGwuY3NzKHsncG9zaXRpb24nOidhYnNvbHV0ZScsJ2hlaWdodCc6JycsJ3RvcCc6JycsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICAgICAgdGg9JGwuaGVpZ2h0KCk7CiAgICAgICAgICAgIHRoKz10aD09MD9taW5IZWlnaHQ6MTAwOwogICAgICAgICAgICAkdC5yZW1vdmUoKTskdD1udWxsOy8vY29uc29sZS5sb2codGgpOwogICAgICAgICAgICAkY20uY3NzKCdoZWlnaHQnLHRoPD1taW5IZWlnaHQ/bWluSGVpZ2h0Oih0aDxtYXhIZWlnaHQ/dGgtMTAwOm1heEhlaWdodC04MCkpOwogICAgICAgIH0KICAgICAgICB2YXIgdGFyZ2V0PXt9LG90aGVyPXsnaGVpZ2h0JzonJ307CiAgICAgICAgJGNtLmF0dHIoJ2l6aF9jbUhlaWdodCcsdGgpLmNzcyh7J2Rpc3BsYXknOicnLCd2aXNpYmlsaXR5JzondmlzaWJsZScsJ3Bvc2l0aW9uJzonYWJzb2x1dGUnfSk7CiAgICAgICAgaWYodGg8PW1heEhlaWdodCl7CiAgICAgICAgICAgIHZhciB0b3A9LW9mZnNldFRvcC03MCxmaXhIZWlnaHQ9KHRoPD1taW5IZWlnaHQ/LTE6Nyk7CiAgICAgICAgICAgIGlmKCF0b29TbWFsbCYmdG9wK3RoPndpbkhlaWdodCl7CiAgICAgICAgICAgICAgICB0YXJnZXQ9eyd0b3AnOi1vZmZzZXRCb3R0b20tdGgtbWV0YUhlaWdodCtmaXhIZWlnaHQsJ2JvdHRvbSc6b2Zmc2V0Qm90dG9tfTsKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICBvZmZzZXRUb3ArPSgoIXRvb1NtYWxsKSYmdG9wPmJhc2VUb3A/dG9wOmJhc2VUb3ApOwogICAgICAgICAgICAgICAgdGFyZ2V0PXsndG9wJzpvZmZzZXRUb3AsJ2JvdHRvbSc6LW9mZnNldFRvcC10aC1tZXRhSGVpZ2h0K2ZpeEhlaWdodH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGNtLmZpbHRlcignLmVtcHR5JykuZmluZCgnLnptLWNvbW1lbnQtZm9ybSAuem0tY29tbWVudC1lZGl0YWJsZScpLmNzcyh7J2JvdHRvbSc6Jyd9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgdGFyZ2V0PXsndG9wJzpvZmZzZXRUb3ArYmFzZVRvcCwnYm90dG9tJzpvZmZzZXRCb3R0b219OwogICAgICAgICAgICAkY20uZmlsdGVyKCcuZW1wdHknKS5maW5kKCcuem0tY29tbWVudC1mb3JtIC56bS1jb21tZW50LWVkaXRhYmxlJykuY3NzKHsnYm90dG9tJzonMjBweCd9KTsKICAgICAgICB9CiAgICAgICAgaWYoYW5pbWF0ZSl7CiAgICAgICAgICAgICRjbS5hbmltYXRlKHRhcmdldCxmdW5jdGlvbigpeyRjbS5jc3Mob3RoZXIpO30pOwogICAgICAgIH1lbHNlewogICAgICAgICAgICAkY20uY3NzKCQuZXh0ZW5kKHRhcmdldCxvdGhlcikpOwogICAgICAgIH0KICAgICAgICAkY207CiAgICB9OwogICAgdGhpcy5vcGVuID0gZnVuY3Rpb24oJGFjLCRjbSxpY21Gb2N1cyl7Ly8gaWYgJGFjIGlzIG51bGwsIGp1c3QgcmUtc2l6aW5nIGFuZCByZS1sb2NhdGluZyBjb21tZW50LWJveAogICAgICAgIHZhciBub0NvbW1lbnRPcGVuaW5nID0gaVpoaWh1LkNvbW1lbnQuT3BlbmluZyA9PSBudWxsOwogICAgICAgIGlaaGlodS5Db21tZW50Lk9wZW5pbmcgPSAkY20uYXR0cignaXpoLW9wZW5pbmcnLCcxJykuY3NzKHsnZGlzcGxheSc6J25vbmUnfSkuZ2V0KDApOwogICAgICAgICQoJy56bS1jb21tZW50LWJveDp2aXNpYmxlOm5vdChbaXpoLW9wZW5pbmc9MV0pJykKICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICQoZSkuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJykuY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpLmZpbmQoJy50b2dnbGUtY29tbWVudCcpWzBdLmNsaWNrKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIHZhciB3aW5XaWR0aD1pWmhpaHUuJHdpbi53aWR0aCgpCiAgICAgICAgICAsIG1jTGVmdD1pWmhpaHUuJG1haW4ub2Zmc2V0KCkubGVmdAogICAgICAgICAgLCAkY3Q9JGNtLmNsb3Nlc3QoJy56dS1tYWluLWNvbnRlbnQtaW5uZXInKQogICAgICAgICAgLCBjdE1hcmdpbkw9cGFyc2VJbnQoJGN0LmNzcygnbWFyZ2luLWxlZnQnKSkKICAgICAgICAgICwgY3RXaWR0aD0kY3Qud2lkdGgoKStjdE1hcmdpbkwKICAgICAgICAgICwgY3RMZWZ0PSRjdC5vZmZzZXQoKS5sZWZ0LWN0TWFyZ2luTAogICAgICAgICAgLCAkbWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAsIG10V2lkdGg9JG1ldGEuaW5uZXJXaWR0aCgpCiAgICAgICAgICAsIG1pbldpZHRoPWlaaGlodS4kbWFpbi53aWR0aCgpLWN0V2lkdGgKICAgICAgICAgICwgY21XaWR0aD1tdFdpZHRoCiAgICAgICAgICAsIG1heFdpZHRoPXdpbldpZHRoLWN0V2lkdGgKICAgICAgICAgICwgbz1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgJGNtLmF0dHIoJ29wZW5lZCcsJzEnKTsKICAgICAgICAJCWlmKCEkYWMpewogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20pOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAJCX0KICAgICAgICAgICAgICAgIHZhciBjdXJyVG9wPV9kb2MuYm9keS5zY3JvbGxUb3AKICAgICAgICAgICAgICAgICAgLCAkbj0kYWMubmV4dCgpLCRuPSRuLmxlbmd0aD8kbjokYWMucGFyZW50KCkubmV4dCgpCiAgICAgICAgICAgICAgICAgICwgdD0kYWMub2Zmc2V0KCkudG9wLWlaaGlodS4kbWFpbi5vZmZzZXQoKS50b3AKICAgICAgICAgICAgICAgICAgLCBiPSRhYy5vZmZzZXQoKS50b3AtaVpoaWh1LiRtYWluLm9mZnNldCgpLnRvcAogICAgICAgICAgICAgICAgICAsIHc9JGFjLndpZHRoKCkKICAgICAgICAgICAgICAgICAgLCBpbkFuc3dlcj0kYWMuaXMoJy56bS1pdGVtLWFuc3dlcicpCiAgICAgICAgICAgICAgICAgICwgaW5RdWVzdGlvbj0kYWMuaXMoJyN6aC1xdWVzdGlvbi1kZXRhaWwnKQogICAgICAgICAgICAgICAgICAsICRxdWVzdGlvbk1ldGE9JCgnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcCcpLy9xdWVzdGlvbl9tZXRhCiAgICAgICAgICAgICAgICAgICwgaD1pblF1ZXN0aW9uPyRxdWVzdGlvbk1ldGEub2Zmc2V0KCkudG9wKyRxdWVzdGlvbk1ldGEuaGVpZ2h0KCkrcGFyc2VJbnQoJHF1ZXN0aW9uTWV0YS5jc3MoJ3BhZGRpbmctYm90dG9tJykpLWlaaGlodS4kbWFpbi5vZmZzZXQoKS50b3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDokYWMuaGVpZ2h0KCkrcGFyc2VJbnQoJGFjLmNzcygncGFkZGluZy1ib3R0b20nKSkrcGFyc2VJbnQoJG4uY3NzKCdwYWRkaW5nLXRvcCcpKQogICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgaWYoISRhYy5maW5kKCcuaXpoX3RhcGVfYSwuaXpoX3RhcGVfYicpLmxlbmd0aCkKICAgICAgICAgICAgICAgICAgICAkYWMKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ2l6aF90YXBlX2EnIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnaXpoX3RhcGVfYicgfSkpCiAgICAgICAgICAgICAgICBpZighJGNtKSRjbT0kYWMuZmluZCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICBpZigkY20ubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICBpZighJGNtLmF0dHIoJ3RhYmluZGV4JykpewogICAgICAgICAgICAgICAgICAgICAgICAkY20uYXR0cigndGFiaW5kZXgnLCctMScpLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmKGluUXVlc3Rpb24pewogICAgICAgICAgICAgICAgICAgICAgICAkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOmgKICAgICAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tYm90dG9tJzotaAogICAgICAgICAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRxdWVzdGlvbk1ldGEubmV4dCgnOnZpc2libGUnKS5hbmRTZWxmKCkuYWRkQ2xhc3MoJ2l6aF9ub0JvcmRlcicpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkYWMuYWRkQ2xhc3MoJ2l6aF9ib3hTaGFkb3cnKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJGFjLmZpbmQoJy5pemhfdGFwZV9hJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzonYWJzb2x1dGUnCiAgICAgICAgICAgICAgICAgICAgICAsICd3aWR0aCc6MQogICAgICAgICAgICAgICAgICAgICAgLCAnaGVpZ2h0JzpoCiAgICAgICAgICAgICAgICAgICAgICAsICd0b3AnOjAKICAgICAgICAgICAgICAgICAgICAgICwgJ21hcmdpbi1sZWZ0Jzp3LTEKICAgICAgICAgICAgICAgICAgICAgICwgJ3otaW5kZXgnOicxMDAwMCcKICAgICAgICAgICAgICAgICAgICAgICwgJ2JhY2tncm91bmQtY29sb3InOicjZmZmJwogICAgICAgICAgICAgICAgICAgIH0pLnNob3coKTsKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goCiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jc3MoeydsZWZ0JzptdFdpZHRoLTF9KS5hdHRyKCdpemhfaW5RdWVzdGlvbicsaW5RdWVzdGlvbj8nMSc6JzAnKS5yZW1vdmVBdHRyKCdpemgtb3BlbmluZycpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAkKCcubWVudGlvbi1wb3B1cCcpLmF0dHIoJ2RhdGEtYWlkJywkYWMuYXR0cignZGF0YS1haWQnKSk7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAkYWMuZmluZCgnLnp1LXF1ZXN0aW9uLWFuc3dlci1tZXRhLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGFjLmZpbmQoJy5pemhfdGFwZV9iJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnd2lkdGgnOjEKICAgICAgICAgICAgICAgICAgLCAnaGVpZ2h0JzpoCiAgICAgICAgICAgICAgICAgICwgJ3RvcCc6MAogICAgICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6dwogICAgICAgICAgICAgICAgICAsICd6LWluZGV4JzonOTk5OCcKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1jb2xvcic6JyNlZWUnCiAgICAgICAgICAgICAgICB9KS5zaG93KCk7CiAgICAgICAgICAgICAgICAvLyRhYy5jc3MoJ2JvcmRlci1jb2xvcicsJyM5OTk5OTknKTsKICAgICAgICAgICAgICAgIC8vJG4uY3NzKCdib3JkZXItY29sb3InLCcjOTk5OTk5Jyk7CiAgICAgICAgICAgICAgICAkKCcuemgtYmFja3RvdG9wJykuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICBpWmhpaHUuJGJvZHkuc2Nyb2xsVG9wKGN1cnJUb3ApOwogICAgICAgICAgICAgICAgaWYoaWNtRm9jdXMpewogICAgICAgICAgICAgICAgICAgIHZhciAkaWNtPSQoaWNtRm9jdXMpLmF0dHIoJ2l6aF9oaWxpZ2h0JywnMScpCiAgICAgICAgICAgICAgICAgICAgICAsICRsaXN0PSRpY20uY2xvc2VzdCgnLnptLWNvbW1lbnQtbGlzdCcpOwogICAgICAgICAgICAgICAgICAgICRsaXN0LnNjcm9sbFRvcChpY21Gb2N1cy5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuSGlMaWdodEl0ZW09aWNtRm9jdXM7CiAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuSGlMaWdodENvbG9yPSdyZ2IoMjU1LDI1NSwxNjApJzsKICAgICAgICAgICAgICAgICAgICAkaWNtLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpWmhpaHU9d2luZG93LmlaaGlodTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1JiZpWmhpaHUuQ29tbWVudC5IaUxpZ2h0SXRlbSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGlaaGlodS5Db21tZW50LkhpTGlnaHRJdGVtKS5yZW1vdmVBdHRyKCdpemhfaGlsaWdodCcpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgIGlmKG1heFdpZHRoPjU0OSltYXhXaWR0aD01NDk7CiAgICAgICAgaWYoY21XaWR0aD5tYXhXaWR0aCkKICAgICAgICAgICAgY21XaWR0aD1tYXhXaWR0aDsKICAgICAgICBpZihjbVdpZHRoPG1pbldpZHRoKQogICAgICAgICAgICBjbVdpZHRoPW1pbldpZHRoOwogICAgICAgICRjbS5hZGRDbGFzcygnaXpoX2JveFNoYWRvdycpLmNzcygkLmV4dGVuZChjc3NfY29tbWVudCx7J3dpZHRoJzpjbVdpZHRoLTl9KSk7CiAgICAgICAgLy9pZighJGNtLmlzKCcuZW1wdHknKSkKICAgICAgICAgICAgJGNtLmNzcyh7J3BhZGRpbmcnOicxMDBweCAwcHggMHB4IDdweCd9KTsKICAgICAgICAkKCdpLnptLWNvbW1lbnQtYnViYmxlJywkY20pLmhpZGUoKTsKICAgICAgICBpZihub0NvbW1lbnRPcGVuaW5nKXsKICAgICAgICAgICAgdmFyIGNtV2lkdGhPdmVyPWNtV2lkdGgtd2luV2lkdGgKICAgICAgICAgICAgICAsIHNoaWZ0TGVmdD1jbVdpZHRoT3ZlcitjdFdpZHRoK2N0TGVmdAogICAgICAgICAgICA7CiAgICAgICAgICAgIGlmKHNoaWZ0TGVmdD4wKXsKICAgICAgICAgICAgICAgIGlmKHNoaWZ0TGVmdD5jdExlZnQpe3NoaWZ0TGVmdD1tY0xlZnQ7fQogICAgICAgICAgICAgICAgZWxzZSBpZihjbVdpZHRoT3Zlcj4wKXtzaGlmdExlZnQtPWNtV2lkdGhPdmVyO30KICAgICAgICAgICAgfQogICAgICAgICAgICBpZihzaGlmdExlZnQ8MCl7c2hpZnRMZWZ0PTA7fQogICAgICAgICAgICBpZihzaGlmdExlZnQgJiYgJGFjKXsKICAgICAgICAgICAgICAgICRjdC5jc3Moeydwb3NpdGlvbic6J3JlbGF0aXZlJywnbGVmdCc6MH0pLmFuaW1hdGUoe2xlZnQ6LXNoaWZ0TGVmdH0sbyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGN0LmNzcyh7J3Bvc2l0aW9uJzoncmVsYXRpdmUnLCdsZWZ0Jzotc2hpZnRMZWZ0fSk7CiAgICAgICAgICAgICAgICBvKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgbygpOwogICAgICAgIH0JCiAgICB9OwogICAgdGhpcy5jbG9zZSA9IGZ1bmN0aW9uKCRhYywkY20pewogICAgICAgIGlmKCEkY20pJGNtPSRhYy5maW5kKCcuem0tY29tbWVudC1ib3gnKTsKICAgICAgICB2YXIgJGN0PSRjbS5jbG9zZXN0KCcuenUtbWFpbi1jb250ZW50LWlubmVyJyk7CiAgICAgICAgdmFyIG89ZnVuY3Rpb24oKXsKICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ3Bvc2l0aW9uJywnJyk7CiAgICAgICAgICAgIGlmKCEkYWMpcmV0dXJuOwogICAgICAgICAgICB2YXIgJG49JGFjLm5leHQoKQogICAgICAgICAgICAgICwgJG49JG4ubGVuZ3RoPyRuOiRhYy5wYXJlbnQoKS5uZXh0KCkKICAgICAgICAgICAgICAsIGluUXVlc3Rpb249JGFjLmlzKCcjemgtcXVlc3Rpb24tZGV0YWlsJyk7CiAgICAgICAgICAgIGlmKCEkYWMpe3JldHVybjt9CiAgICAgICAgICAgIGlmKGluUXVlc3Rpb24pewogICAgICAgICAgICAgICAgJCgnI2l6aF9RdWVzdGlvblNoYWRvdycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKS5uZXh0KCc6dmlzaWJsZScpLmFuZFNlbGYoKS5yZW1vdmVDbGFzcygnaXpoX25vQm9yZGVyJyk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGFjLnJlbW92ZUNsYXNzKCdpemhfYm94U2hhZG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8kYWMuY3NzKCdib3JkZXItY29sb3InLCcjREREREREJyk7CiAgICAgICAgICAgIC8vJG4uY3NzKCdib3JkZXItY29sb3InLCcjREREREREJyk7CiAgICAgICAgICAgICQoJy5pemhfdGFwZV9hOnZpc2libGUsLml6aF90YXBlX2I6dmlzaWJsZScpLmhpZGUoKTsKICAgICAgICAgICAgJCgnLnpoLWJhY2t0b3RvcCcpLmNzcygndmlzaWJpbGl0eScsJ3Zpc2libGUnKTsKICAgICAgICB9OwoKICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5PcGVuaW5nID09ICRjbS5nZXQoMCkpewogICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5PcGVuaW5nID0gbnVsbDsKICAgICAgICAgICAgJGN0LmFuaW1hdGUoe2xlZnQ6MH0sbyk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIGlmKCEkYWMpeyRjdC5jc3Moe2xlZnQ6MH0pO30KICAgICAgICAgICAgbygpOwogICAgICAgIH0KICAgICAgICAKICAgIH07CiAgICB0aGlzLnByb2Nlc3NDb21tZW50ID0gZnVuY3Rpb24oJGNtLGZvY3VzTmFtZSl7CiAgICAgICAgdmFyIGxvYWRpbmc9ZmFsc2U7CiAgICAgICAgaWYoJGNtLmlzKCcuem0tY29tbWVudC1zcGlubmVyJykpewogICAgICAgICAgICAkY209JGNtLmNsb3Nlc3QoJy56bS1jb21tZW50LWJveCcpOwogICAgICAgICAgICBsb2FkaW5nPXRydWU7CiAgICAgICAgfQogICAgICAgIGlmKCEkY20uaXMoJy56bS1jb21tZW50LWJveCcpKXJldHVybjsKICAgICAgICB2YXIgJGl0ZW09aVpoaWh1LmdldEl0ZW0oJGNtKTsKICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQmJmxvYWRpbmcpewogICAgICAgICAgICB2YXIgY21MZWZ0PSRpdGVtLndpZHRoKCktMTsKICAgICAgICAgICAgJGNtLmNzcyh7J2xlZnQnOmNtTGVmdCwnd2lkdGgnOjIxNiwnei1pbmRleCc6JzEwMDAwJ30pOwogICAgICAgIH0KICAgICAgICBpZigkY20uZmlsdGVyKCcuem0tY29tbWVudC1ib3gnKS5oYXMoJy56bS1jb21tZW50LWxpc3QnKS5sZW5ndGgpewovKiBDb2xsZWN0aW9ucyBmb3IgY29tbWVudAogICAgICAgICAgICAkY20uZmluZCgnLnptLWNvbW1lbnQtZWRpdGFibGUnKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgIHZhciAkYz0kKGV2ZW50LnRhcmdldCksJGNtPSRjLmNsb3Nlc3QoJy56bS1jb21tZW50LWJveCcpOwogICAgICAgICAgICAgICAgaWYoJGMuaXMoJ2EubWVtYmVyX21lbnRpb24nKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmNoaWxkcmVuKCcuaXpoX2NvbGxlY3Rpb25zJykubGVuZ3RoPD0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGRpdiBjbGFzcz0iaXpoX2NvbGxlY3Rpb25zIj5sb2FkaW5nLi4uPC9kaXY+JykuYmluZCgnbW91c2VvdmVyJyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmJpbmQoJ21vdXNlb3V0JyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRjbSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRjLmJpbmQoJ21vdXNlb3ZlcicsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjZT0kKHRoaXMpLmNsb3Nlc3QoJy56bS1jb21tZW50LWVkaXRhYmxlJyksJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jaGlsZHJlbignLml6aF9jb2xsZWN0aW9ucycpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYm90dG9tJzokKHRoaXMpLmhlaWdodCgpLSQodGhpcykucG9zaXRpb24oKS50b3AtMQogICAgICAgICAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOiQodGhpcykucG9zaXRpb24oKS5sZWZ0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5wb3N0KCdodHRwOi8vd3d3LnpoaWh1LmNvbScrJCh0aGlzKS5hdHRyKCdocmVmJykrJy9jb2xsZWN0aW9ucycKICAgICAgICAgICAgICAgICAgICAgICAgICAsICQucGFyYW0oe194c3JmOiQoJ2lucHV0W25hbWU9X3hzcmZdJykudmFsKCl9KQogICAgICAgICAgICAgICAgICAgICAgICAgICwgZnVuY3Rpb24ocmVzdWx0LHN0YXR1cyx4aHIpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAkYy5iaW5kKCdtb3VzZW91dCcsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjZT0kKHRoaXMpLmNsb3Nlc3QoJy56bS1jb21tZW50LWVkaXRhYmxlJyksJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbS5jaGlsZHJlbignLml6aF9jb2xsZWN0aW9ucycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiovCiAgICAgICAgICAgIGlmKGlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgICAgICAgICAkY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpLmZpbmQoJy50b2dnbGUtY29tbWVudCcpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICB2YXIgJG9wZW5lZEJ5PSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICwgJGFjPSRvcGVuZWRCeS5jbG9zZXN0KCcuem0taXRlbS1tZXRhJykKICAgICAgICAgICAgICAgICAgICAgICwgJGNtPSgkYWMucGFyZW50KCkuaXMoJy56bS1pdGVtLW1ldGEuZmVlZC1tZXRhJyk/JGFjLnBhcmVudCgpOiRhYykuZmluZCgnLnptLWNvbW1lbnQtYm94JykuY3NzKCd2aXNpYmlsaXR5JywnaGlkZGVuJykKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkaXRlbT1pWmhpaHUuZ2V0SXRlbSgkY20pOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY20uaXMoJzpoaWRkZW4nKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKCRpdGVtLCRjbSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuY2xvc2UoJGl0ZW0sJGNtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vaWYoJGNtLmlzKCcuZW1wdHknKSkgcmV0dXJuOwogICAgICAgICAgICB2YXIgJGxpc3Q9JGNtLmZpbmQoJy56bS1jb21tZW50LWxpc3QnKTsKICAgICAgICAgICAgJGxpc3QuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIC8vdXRpbHMub2JzZXJ2ZURPTU5vZGVBZGRlZCgkbGlzdFswXSxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIAkvKmlmKCFldmVudC5hZGRlZE5vZGVzKXJldHVybjsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb2RlcyAnK2V2ZW50LmFkZGVkTm9kZXMubGVuZ3RoKycgaW5zZXJ0ZWQnKTsKICAgICAgICAgICAgCWZvcih2YXIgaT0wO2k8ZXZlbnQuYWRkZWROb2Rlcy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgCQl2YXIgJGljbT0kKGV2ZW50LmFkZGVkTm9kZXNbaV0pOwogICAgICAgICAgICAgICAgfSovCiAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcuem0taXRlbS1jb21tZW50LC56bS1jb21tZW50LWZvcm0nKTsKICAgICAgICAgICAgICAgIGlmKCEkaWNtLmxlbmd0aClyZXR1cm47CiAgICAgICAgICAgICAgICB2YXIgJGxpc3Q9JCh0aGlzKQogICAgICAgICAgICAgICAgICAsICRjbT0kbGlzdC5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgaWYoJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCRpY20pOwogICAgICAgICAgICAgICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnQWRkaW5nIFF1aWNrQmxvY2snKTsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkUXVpY2tCbG9ja0luT25lQ29tbWVudCgkaWNtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgJGxpc3QuY3NzKCdoZWlnaHQnLCcxMDAlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpY20uc2hvdygpLmJpbmQoJ0RPTU5vZGVSZW1vdmVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkbGlzdD0kaWNtLmhpZGUoKS5jbG9zZXN0KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkY209JGxpc3QuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94OnZpc2libGUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1JlZnJlc2hpbmcgY29tbWVudCBsaXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGxpc3QuY2hpbGRyZW4oKS5sZW5ndGg9PTEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjbSxmYWxzZSxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAJICAgICAgICAgICAgdmFyIGNvdW50Tm93PSRsaXN0LmNoaWxkcmVuKCkubGVuZ3RoCiAgICAgICAgICAgICAgICAgICAgICAgIAkgICwgY291bnRBbGw9cGFyc2VJbnQoJGNtLmF0dHIoJ2RhdGEtY291bnQnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjb3VudFJlc3Q9Y291bnRBbGwtY291bnROb3cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBub3RBbGw9JCh0aGlzKS5oYXMoJy5sb2FkLW1vcmUnKS5sZW5ndGgKICAgICAgICAgICAgICAgICAgICAgICAgCTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCghbm90QWxsKSYmY291bnRSZXN0PjEpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgCXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ1JlZnJlc2hpbmcgY29tbWVudCBsaXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobm90QWxsfHxjb3VudFJlc3Q8MCkkbGlzdC5zY3JvbGxUb3AoJGljbS5nZXQoMCkub2Zmc2V0VG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH1lbHNlIGlmKCRpY20uaXMoJy56bS1jb21tZW50LWZvcm0nKSl7CiAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LkNvbW1lbnQuUmlnaHRDb21tZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHJjbT0kaWNtOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGljbT0kcmNtLmNsb3Nlc3QoJy56bS1pdGVtLWNvbW1lbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20uZmluZCgnYS56bS1jb21tZW50LWNsb3NlLnptLWNvbW1hbmQtY2FuY2VsJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkcmNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtZm9ybScpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkY209JHJjbS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRjbS5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goJGNtLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20ucGFyZW50KCkuZmluZCgnYS5yZXBseS56bS1jb21tZW50LW9wLWxpbmsnKS5jbGljayhmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRyY209JCh0aGlzKS5jbG9zZXN0KCcuem0tY29tbWVudC1jb250ZW50LXdyYXAnKS5jaGlsZHJlbignLnptLWNvbW1lbnQtZm9ybScpLnRvZ2dsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRpY209JCh0aGlzKS5jbG9zZXN0KCcuem0taXRlbS1jb21tZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGxpc3Q9JGljbS5jbG9zZXN0KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGNtPSRsaXN0LmNsb3Nlc3QoJy56bS1jb21tZW50LWJveDp2aXNpYmxlJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGNtLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkcmNtLmlzKCc6dmlzaWJsZScpKSRsaXN0LnNjcm9sbFRvcCgkaWNtLmdldCgwKS5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyY20udG9nZ2xlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5ib3goJGNtLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaXN0LnNjcm9sbFRvcCgkaWNtLmdldCgwKS5vZmZzZXRUb3AtJGxpc3QuZ2V0KDApLm9mZnNldFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgY21DbG9zZT1mdW5jdGlvbihldmVudCxhbHNvU2Nyb2xsVG9WaWV3Qm90dG9tKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGNtPSQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94Jyk7CiAgICAgICAgICAgICAgICAJCWlmKCQodGhpcykuaXMoJ1tuYW1lPWNsb3NlZm9ybV0nKSYmKCEkY20uaXMoJy5lbXB0eScpKSlyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdmFyICRpdGVtPWlaaGlodS5nZXRJdGVtKCRjbSkvLy5hdHRyKCd0YWJpbmRleCcsJy0xJykuZm9jdXMoKS5yZW1vdmVBdHRyKCd0YWJpbmRleCcpCiAgICAgICAgICAgICAgICAgICAgICAsICRpdGVtTWV0YT0kY20uY2xvc2VzdCgnLnptLWl0ZW0tbWV0YScpCiAgICAgICAgICAgICAgICAgICAgICAsIGFsc29TY3JvbGw9dGhpcy5nZXRBdHRyaWJ1dGUoJ2l6aC1hbHNvU2Nyb2xsVG9WaWV3Qm90dG9tJyl8fCcnCiAgICAgICAgICAgICAgICAgICAgICAsIHNjcm9sbFRvcD0oZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApP2RvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoYWxzb1Njcm9sbCE9PScxJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtTWV0YS5maW5kKCcudG9nZ2xlLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcD1zY3JvbGxUb3A7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wPXNjcm9sbFRvcDsKICAgICAgICAgICAgICAgICAgICAgICAgfSwxMDApOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGl0ZW1NZXRhLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtTWV0YS5maW5kKCcudG9nZ2xlLWNvbW1lbnQnKVswXS5jbGljaygpOwogICAgICAgICAgICAgICAgICAgIH0sZmFsc2UsdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLCAkYnRuQ0M9JCgnPGE+Jyx7CiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonenUtcXVlc3Rpb24tYW5zd2VyLW1ldGEtY29tbWVudCBpemgtYnV0dG9uLWNjJwogICAgICAgICAgICAgICAgICAsIGhyZWY6J2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICwgY2xpY2s6Y21DbG9zZQogICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkdCTmlLbotbfor4Torrrlubbot7Povazoh7PmiYDlsZ7lm57nrZQnCiAgICAgICAgICAgICAgICB9KS50ZXh0KCfmlLbotbcnKQogICAgICAgICAgICAgICwgJGJ1dHRvbnNMPSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAJJ2NsYXNzJzonaXpoLWJ1dHRvbnMtY20tTCcKICAgICAgICAgICAgICAgIH0pLnByZXBlbmRUbygkY20pCiAgICAgICAgICAgICAgLCAkYnV0dG9uc1I9JCgnPGRpdj4nLHsKICAgICAgICAgICAgICAgIAknY2xhc3MnOidpemgtYnV0dG9ucy1jbS1SJwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgOwogICAgICAgICAgICBpZihpWmhpaHUuQ29tbWVudC5SaWdodENvbW1lbnQpewogICAgICAgICAgICAgICAgJGNtLmNoaWxkcmVuKCcuem0tY29tbWVudC1mb3JtJykuZmluZCgnW25hbWU9Y2xvc2Vmb3JtXScpLmNsaWNrKGNtQ2xvc2UpOwogICAgICAgICAgICAgICAgJGJ0bkNDLmNsb25lKHRydWUpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtaW1hZ2UnOiAndXJsKCIvc3RhdGljL2ltZy9zcHJpdGVzLTEuOS4yLnBuZyIpJwogICAgICAgICAgICAgICAgICAsICdiYWNrZ3JvdW5kLXBvc2l0aW9uJzogJy0yNjFweCAtNjJweCcKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1yZXBlYXQnOiAnbm8tcmVwZWF0JwogICAgICAgICAgICAgICAgICAsICdkaXNwbGF5JzogJ2lubGluZS1ibG9jaycKICAgICAgICAgICAgICAgICAgLCAnd2lkdGgnOiAxNQogICAgICAgICAgICAgICAgICAsICdoZWlnaHQnOiAxNQogICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6IDAKICAgICAgICAgICAgICAgICAgLCAndG9wJzogMAogICAgICAgICAgICAgICAgICAsICd6LWluZGV4JzogJzEwMDAwJwogICAgICAgICAgICAgICAgfSkuYXR0cignZGF0YS10aXAnLCdzJGwk5pS26LW36K+E6K66JykudGV4dCgnJykucHJlcGVuZFRvKCRjbSkKICAgICAgICAgICAgICAgICRidXR0b25zUi5wcmVwZW5kVG8oJGNtKTsKICAgICAgICAgICAgICAgIGlmKCRsaXN0LmNoaWxkcmVuKCkubGVuZ3RoPT0wKXsKICAgICAgICAgICAgICAgICAgICAkYnV0dG9uc1IuaGlkZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJGJ0bkNDLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAgICAgLCAnbWFyZ2luLWxlZnQnOjcKICAgICAgICAgICAgICAgIH0pLmF0dHIoJ2l6aC1hbHNvU2Nyb2xsVG9WaWV3Qm90dG9tJywnMScpLnByZXBlbmQoJzxpIGNsYXNzPSJ6LWljb24taXpoLWZvbGQiLz4nKS5wcmVwZW5kVG8oJGJ1dHRvbnNMKTsKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2l6aC1idXR0b24gaXpoLWJhY2stdG9wJwogICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkbCTov5Tlm57pobbpg6gnCiAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMucGFyZW50Tm9kZSkubmV4dEFsbCgnLnptLWNvbW1lbnQtbGlzdCcpLnNjcm9sbFRvcCgwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGk+JywgeyAnY2xhc3MnOiAnemctaWNvbiB6LWljb24tZm9sZCcgfSkKICAgICAgICAgICAgICAgICkuYWRkKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidpemgtYnV0dG9uIGl6aC1zaG93LWdvb2QnCiAgICAgICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkbCTkurrmsJTlppnor4QnCiAgICAgICAgICAgICAgICAgICAgICAsIGhyZWY6J2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICAgICAsIGNsaWNrOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYz0kZS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3gnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGw9JGMuZmluZCgnLnptLWNvbW1lbnQtbGlzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkbj0kbC5maW5kKCcuem0taXRlbS1jb21tZW50JykuaGFzKCdzcGFuLmxpa2UtbnVtLm5pbCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaGFzQ2xhc3MoJ29uJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYXR0cignc2Nyb2xsVG9wX3Nob3dnb29kJywkbFswXS5zY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG4uc2hvdygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjLGZhbHNlLGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLnJlbW92ZUNsYXNzKCdvbicpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjcm9sbFRvcCA9IHBhcnNlSW50KCRlLmF0dHIoJ3Njcm9sbFRvcCcpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc05hTihzY3JvbGxUb3ApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsLnNjcm9sbFRvcChzY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLmF0dHIoJ3Njcm9sbFRvcCcsJGxbMF0uc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRuLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkYyxmYWxzZSxmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hZGRDbGFzcygnb24nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSBwYXJzZUludCgkZS5hdHRyKCdzY3JvbGxUb3Bfc2hvd2dvb2QnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighaXNOYU4oc2Nyb2xsVG9wKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbC5zY3JvbGxUb3Aoc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICAgICAkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uIHpnLWljb24tY29tbWVudC1saWtlJyB9KQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAnZmxvYXQnOidyaWdodCcKICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRidXR0b25zUik7CgogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuUGFnZU5vdFNjcm9sbCA9IHRydWU7CiAgICAgICAgICAgICAgICAkbGlzdC5zY3JvbGwoZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgLCAkYj0kZS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3gnKS5maW5kKCcuaXpoLWJhY2stdG9wJykKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJGUuaGVpZ2h0KCkgPCB0aGlzLnNjcm9sbFRvcCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRiLnJlbW92ZUNsYXNzKCdvZmYnKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgJGIuYWRkQ2xhc3MoJ29mZicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLnNjcm9sbCgpOwogICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuUGFnZU5vdFNjcm9sbCA9IGZhbHNlOwoKICAgICAgICAgICAgICAgIHZhciBpY21Gb2N1cz1udWxsOwogICAgICAgICAgICAgICAgICAgICRsaXN0LmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdoZWlnaHQnOiRjbS5pcygnLmVtcHR5Jyk/Jyc6JzEwMCUnCiAgICAgICAgICAgICAgICAgICAgICAsICdvdmVyZmxvdyc6J2F1dG8nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAkbGlzdC5jaGlsZHJlbignLnptLWl0ZW0tY29tbWVudCcpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGljbT0kKGUpOwogICAgICAgICAgICAgICAgICAgICRpY20uYmluZCgnRE9NTm9kZVJlbW92ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRpY209JChldmVudC50YXJnZXQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighJGljbS5pcygnLnptLWl0ZW0tY29tbWVudCcpKXJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjbT0kaWNtLmhpZGUoKS5jbG9zZXN0KCcuem0tY29tbWVudC1ib3g6dmlzaWJsZScpOwogICAgICAgICAgICAgICAgICAgICAgICBpZigkY20ubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQodGhpcykuY2xvc2VzdCgnLnptLWNvbW1lbnQtbGlzdCcpLmNoaWxkcmVuKCkubGVuZ3RoPT0xKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCcsJGNtKS5hZGQoJy5pemgtYnV0dG9ucy1jbS1SJywkY20pLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5Db21tZW50LmJveCgkY20sZmFsc2UsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgJGljbS5maW5kKCdzcGFuLmxpa2UtbnVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGlwPWUuZ2V0QXR0cmlidXRlKCdkYXRhLXRpcCcpLnJlcGxhY2UoJ3MkciQnLCdzJGwkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRpcCE9JycpZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGlwJyx0aXApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGlmICghaWNtRm9jdXMmJmZvY3VzTmFtZSYmZm9jdXNOYW1lIT0nJwogICAgICAgICAgICAgICAgICAgICAgICAmJiAkaWNtLmNoaWxkcmVuKCdhLnpnLWFuY2hvci1oaWRkZW5bbmFtZT0iJytmb2N1c05hbWUrJyJdJykubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWNtRm9jdXM9JGljbS5nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5vcGVuKCRpdGVtLCRjbSxpY21Gb2N1cyk7CiAgICAgICAgICAgICAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKCRjbS5jaGlsZHJlbignLnptLWNvbW1lbnQtZm9ybScpLmNoaWxkcmVuKCcuem0tY29tbWVudC1lZGl0YWJsZScpWzBdLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JChldmVudC50YXJnZXQpCiAgICAgICAgICAgICAgICAgICAgICAsICRmPSRlLmNsb3Nlc3QoJy56bS1jb21tZW50LWZvcm0nKQogICAgICAgICAgICAgICAgICAgICAgLCAkbD0kZi5wcmV2KCcuem0tY29tbWVudC1saXN0JykKICAgICAgICAgICAgICAgICAgICAgICwgJGM9JGYuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94W29wZW5lZD0xXScpCiAgICAgICAgICAgICAgICAgICAgICAsIGNoPSRjLmhlaWdodCgpCiAgICAgICAgICAgICAgICAgICAgICAsIHdpbkhlaWdodD1pWmhpaHUuJHdpbi5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBzY3JvbGxUb3A9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCtkb2N1bWVudC5ib2R5LnNjcm9sbFRvcAogICAgICAgICAgICAgICAgICAgICAgLCBuYXZIZWlnaHQ9aVpoaWh1LiRib2R5LmNoaWxkcmVuKCkuZmlyc3QoKS5oZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXI9JCgnLnp1LWdsb2JhbC1ub3RpZnkuenUtZ2xvYmFsLW5vdGlmeS1pbmZvOnZpc2libGUnKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXJIZWlnaHQ9IWJhci5sZW5ndGg/MDpiYXIub3V0ZXJIZWlnaHQoKQogICAgICAgICAgICAgICAgICAgICAgLCBiYXNlVG9wPSgoYmFySGVpZ2h0JiZiYXIuY3NzKCdwb3NpdGlvbicpPT0nZml4ZWQnKT9iYXJIZWlnaHQ6KHNjcm9sbFRvcD5iYXJIZWlnaHQ/MDpiYXJIZWlnaHQtc2Nyb2xsVG9wKSkrbmF2SGVpZ2h0CiAgICAgICAgICAgICAgICAgICAgICAsIG1pbkhlaWdodD0xMTIKICAgICAgICAgICAgICAgICAgICAgICwgbWF4SGVpZ2h0PXdpbkhlaWdodC1iYXNlVG9wLTM1CiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgIGlmKCEkYy5sZW5ndGgpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGlmKCEkYy5pcygnLmVtcHR5JykmJiRsLmNoaWxkcmVuKCkubGVuZ3RoPjApewogICAgICAgICAgICAgICAgICAgICAgICBsaD0kbC5oZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgbGg9MDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyICR0PSRlLmNsb25lKCkuYXBwZW5kVG8oZG9jdW1lbnQuYm9keSkKICAgICAgICAgICAgICAgICAgICAJICAgIC5jc3Moeydwb3NpdGlvbic6J2Fic29sdXRlJywnei1pbmRleCc6Jy0xJywnd2lkdGgnOiRlLndpZHRoKCksJ21pbi1oZWlnaHQnOjIyfSkKICAgICAgICAgICAgICAgICAgICAgICwgZWg9JHQuaGVpZ2h0KCkKICAgICAgICAgICAgICAgICAgICAgICwgaD1NYXRoLm1heChlaCxsaCkrKGxoPT0wPzkwOjEwMCkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgJHQucmVtb3ZlKCk7JHQ9bnVsbDsKICAgICAgICAgICAgICAgICAgICBpZihpc05hTihjaCl8fGNoIT1oKXsKICAgICAgICAgICAgICAgICAgICAgICAgJGMuYXR0cignaXpoX2NtSGVpZ2h0JyxoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQuYm94KCRjLHRydWUsZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZighJGYuaXMoJy5leHBhbmRlZCcpJiZldmVudC5hZGRlZE5vZGVzLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgICAgICRmLmNzcyh7J2hlaWdodCc6JycsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgZWgrPTMwOwogICAgICAgICAgICAgICAgICAgICAgICAkZi5jc3MobGg9PTB8fGVoPmNoP3snaGVpZ2h0JzonJywnYm90dG9tJzoyNX06eydoZWlnaHQnOmVoLCdib3R0b20nOicnfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGJ0bkNDLnByZXBlbmQoJzxpIGNsYXNzPSJ6LWljb24tZm9sZCIvPicpCiAgICAgICAgICAgICAgICAuY3NzKHsKICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOidhYnNvbHV0ZScKICAgICAgICAgICAgICAgICAgLCAnY3Vyc29yJzoncG9pbnRlcicKICAgICAgICAgICAgICAgICAgLCAnbWFyZ2luLWxlZnQnOi0xCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOjAKICAgICAgICAgICAgICAgICAgLCAnYmFja2dyb3VuZC1jb2xvcic6JyNmYmZiZmInCiAgICAgICAgICAgICAgICAgICwgJ3BhZGRpbmcnOicycHggNXB4JwogICAgICAgICAgICAgICAgICAsICdib3R0b20nOi0yMgogICAgICAgICAgICAgICAgICAsICdib3JkZXInOicxcHggc29saWQgI2RkZCcKICAgICAgICAgICAgICAgICAgLCAnYm9yZGVyLXJhZGl1cyc6JzRweCcKICAgICAgICAgICAgICAgIH0pLmluc2VydEJlZm9yZSgkY20uZmluZCgnLnptLWNvbW1lbnQtYm94LWZ0JykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKGlaaGlodS5RdWlja0Jsb2NrKXsKICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmFkZFF1aWNrQmxvY2tJbkNvbW1lbnRMaXN0KCRidXR0b25zTCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIE5vdGk3CiAqLwpmdW5jdGlvbiBOb3RpNyhpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSB8fCAhaVpoaWh1LmNvbmZpZ1snTm90aTcnXSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1Lk5vdGk3ID0gdGhpczsKICAgIAogICAgdGhpcy4kbm90aTcgPSAkKCcjemgtdG9wLW5hdi1saXZlLW5ldycpOwogICAgdGhpcy4kZnJhbWUgPSAkKCcuem0tbm90aTctZnJhbWUnLHRoaXMuJG5vdGk3KTsKICAgIHRoaXMuJGNvbnRlbnQgPSAkKCcuem0tbm90aTctY29udGVudC1ib2R5Jyx0aGlzLiRub3RpNyk7CiAgICB0aGlzLiRmb290ZXIgPSAkKCcuem0tbm90aTctcG9wdXAtZm9vdGVyJyx0aGlzLiRub3RpNyk7CiAgICB0aGlzLiR0YWIgPSAkKCcuem0tbm90aTctcG9wdXAtdGFiLWNvbnRhaW5lcicsJyN6aC10b3AtbmF2LWxpdmUtbmV3LWlubmVyJyk7CgogICAgdGhpcy5jc3MgPSAKICAgICAgICBbJyN6aC10b3AtbmF2LWxpdmUtbmV3IC56bS1ub3RpNy1wb3B1cC1mb290ZXIgYVt1bnJlYWRvbmx5PSIxIl17Y29sb3I6IzIyNTU5OSAhaW1wb3J0YW50O3RleHQtc2hhZG93OjAgMCAxcHggIzIyNTU5OTt9JwogICAgICAgICwnJ10uam9pbignXG4nKTsKICAgIHRoaXMuZW5oYW5jZSA9IGZ1bmN0aW9uKCl7CiAgICAgICAgaVpoaWh1Lk5vdGk3LiR0YWIuZmluZCgnLnptLW5vdGk3LXBvcHVwLXRhYi1pdGVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB1dGlscy5vYnNlcnZlRE9NQXR0ck1vZGlmaWVkKGUsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgdmFyICRlPSQoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgICAgIGlmKCRlLmlzKCcuem0tbm90aTctcG9wdXAtdGFiLWl0ZW0uY3VycmVudCcpKXsKICAgICAgICAgICAgICAgIAl2YXIgY3VycmVudENsYXNzPSRlLmF0dHIoJ2NsYXNzJykKICAgICAgICAgICAgICAgIAkgICwgJGJGaWx0ZXJSZWFkPSQoJy5pemgtZmlsdGVyLXJlYWQnLGlaaGlodS5Ob3RpNy4kZm9vdGVyKTsKICAgICAgICAgICAgICAgIAlpZihjdXJyZW50Q2xhc3MhPSRiRmlsdGVyUmVhZC5hdHRyKCdjdXJyZW50Q2xhc3MnKSl7CiAgICAgICAgICAgICAgICAJICAgICRiRmlsdGVyUmVhZC5hdHRyKHsndW5yZWFkT25seSc6JycsJ2N1cnJlbnRDbGFzcyc6Y3VycmVudENsYXNzfSk7CiAgICAgICAgICAgICAgICAJfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBpWmhpaHUuTm90aTcuJGZvb3Rlci5hcHBlbmQoCiAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgJ2NsYXNzJzonaXpoLWZpbHRlci1yZWFkJwogICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAsICd1bnJlYWRPbmx5JzonJwogICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICB2YXIgdW5yZWFkT25seT10aGlzLmdldEF0dHJpYnV0ZSgndW5yZWFkT25seScpPT0nMScKICAgICAgICAgICAgICAgICAgICAgICwgJGNvbnRlbnRWaXNpYmxlPWlaaGlodS5Ob3RpNy4kY29udGVudC5maWx0ZXIoJzp2aXNpYmxlJykKICAgICAgICAgICAgICAgICAgICAgICwgJHNjcm9sbGVyPSRjb250ZW50VmlzaWJsZS5jbG9zZXN0KCcuemgtc2Nyb2xsZXItaW5uZXInKQogICAgICAgICAgICAgICAgICAgICAgLCAkaXRlbXM9JGNvbnRlbnRWaXNpYmxlLmZpbmQoJy56bS1ub3RpNy1jb250ZW50LWl0ZW0nKQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICB1bnJlYWRPbmx5PSF1bnJlYWRPbmx5OwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCd1bnJlYWRPbmx5Jyx1bnJlYWRPbmx5PycxJzonJyk7CiAgICAgICAgICAgICAgICAgICAgaWYodW5yZWFkT25seSl7CiAgICAgICAgICAgICAgICAgICAgICAgICRzY3JvbGxlci5hdHRyKCdzY3JvbGxUb3AnLCRzY3JvbGxlclswXS5zY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgICAgICAkaXRlbXMubm90KCcudW5yZWFkJykuaGlkZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsVG9wID0gcGFyc2VJbnQoJHNjcm9sbGVyLmF0dHIoJ3Njcm9sbFRvcF91bnJlYWQnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCFpc05hTihzY3JvbGxUb3ApKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjcm9sbGVyLnNjcm9sbFRvcChzY3JvbGxUb3ApOwogICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAkc2Nyb2xsZXIuYXR0cignc2Nyb2xsVG9wX3VucmVhZCcsJHNjcm9sbGVyWzBdLnNjcm9sbFRvcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtcy5ub3QoJy51bnJlYWQnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzY3JvbGxUb3AgPSBwYXJzZUludCgkc2Nyb2xsZXIuYXR0cignc2Nyb2xsVG9wJykpOwogICAgICAgICAgICAgICAgICAgICAgICBpZighaXNOYU4oc2Nyb2xsVG9wKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY3JvbGxlci5zY3JvbGxUb3Aoc2Nyb2xsVG9wKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0pLnRleHQoJ+makOiXj+W3suivuycpCiAgICAgICAgKTsKICAgIH07CgogICAgcmV0dXJuIHRoaXM7Cn0KCi8qKgogKiBAY2xhc3MgUXVpY2tCbG9jawogKi8KZnVuY3Rpb24gUXVpY2tCbG9jayhpWmhpaHUpIHsKICAgIGlmICggdHlwZW9mIGlaaGlodSA9PT0gJ3VuZGVmaW5lZCcgfHwgIWlaaGlodSB8fCAhaVpoaWh1LmNvbmZpZ1snUXVpY2tCbG9jayddKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpWmhpaHUuUXVpY2tCbG9jayA9IHRoaXM7CiAgICAKLyoKICAgIHZhciBjc3NfUXVpY2tCbG9jayA9IHsKICAgICAgICAgICAgJ2JhY2tncm91bmQtcG9zaXRpb24nOictMTQ2cHggLTIwMnB4JwogICAgICAgICAgLCAnd2lkdGgnOjE2CiAgICAgICAgICAsICdoZWlnaHQnOjE2CiAgICAgIAl9CiAgICA7CiovCiAgICB0aGlzLlBlbmRpbmcgPSB7VXNlcnM6JywnLENvdW50OjB9OwogICAgdGhpcy5CbG9ja2luZyA9IHtVc2VyczonLCcsQ291bnQ6MH07CiAgICB0aGlzLlVuZm9sbG93ZWQgPSB7VXNlcnM6JywnLENvdW50OjB9OwogICAgdGhpcy5SZWZvbGxvd2VkID0ge1VzZXJzOicsJyxDb3VudDowfTsKICAgIHRoaXMuVXNlcnMyQiA9IFtdCiAgICB0aGlzLlVzZXJzMkJCUSA9IFtdCiAgICB0aGlzLmNzcyA9IAogICAgICAgIFsnLml6aF9ibG9ja0NhcnR7YmFja2dyb3VuZC1jb2xvcjojMDc3MUMxO3Bvc2l0aW9uOmZpeGVkO3JpZ2h0OjA7ei1pbmRleDo5O3BhZGRpbmc6MCAzMHB4IDAgNjBweDtib3JkZXI6MXB4IHNvbGlkICMwNzcxQzE7Ym9yZGVyLWxlZnQtd2lkdGg6MTBweDtib3JkZXItdG9wLWxlZnQtcmFkaXVzOjZweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmRve2NvbG9yOiNmZmY7dGV4dC1hbGlnbjpjZW50ZXI7ZGlzcGxheTpibG9jazttYXJnaW46MnB4O21pbi13aWR0aDo4MHB4O3dpZHRoOjEwMCU7aGVpZ2h0OjIwcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0LnBlbmRpbmcgLmRvOmFmdGVye3RleHQtZGVjb3JhdGlvbjpibGluaztjb2xvcjpyZWQ7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC5kbzphZnRlcntwb3NpdGlvbjpyZWxhdGl2ZTtjb250ZW50OmF0dHIoaXpoX251bTJCKTt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmRvIC5idXR0b257Y29sb3I6I2ZmZjt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmZyYW1le292ZXJmbG93LXk6YXV0bztvdmVyZmxvdy14OmhpZGRlbjtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MjVweDtib3R0b206MDtsZWZ0OjA7cmlnaHQ6MDtiYWNrZ3JvdW5kLWNvbG9yOiNmZmY7cGFkZGluZy10b3A6NXB4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAubGlzdHtkaXNwbGF5OmJsb2NrO21hcmdpbjoycHg7d2lkdGg6MTAwJTtwYWRkaW5nLXJpZ2h0OjVweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QgLnJlbHtib3JkZXItd2lkdGg6MCAycHg7Ym9yZGVyLXN0eWxlOnNvbGlkO2JvcmRlci1jb2xvcjojZmZmO3dpZHRoOjI0cHg7aGVpZ2h0OjE4cHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC5saXN0LmlfZm8gLnJlbHtib3JkZXItbGVmdC1jb2xvcjojMjU5O2JhY2tncm91bmQtcG9zaXRpb246LTEyMHB4IC0xODRweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QuZm9faSAucmVse2JvcmRlci1yaWdodC1jb2xvcjojMjU5O2JhY2tncm91bmQtcG9zaXRpb246LTEyMHB4IC0xNjRweDt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLmxpc3QuaV9mby5mb19pIC5yZWx7YmFja2dyb3VuZC1wb3NpdGlvbjotNzhweCAtMjAwcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkJ7ZGlzcGxheTpibG9jazttYXJnaW46MnB4IDA7cGFkZGluZzowIDQwcHggMCA2MHB4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAudXNlcjJCIGkuemctaWNvbntkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3JpZ2h0OjA7bWFyZ2luLXRvcDo1cHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgLm5hbWV7ZGlzcGxheTpibG9jaztjb2xvcjojZmZmO2JhY2tncm91bmQtY29sb3I6IzAwMDt3aGl0ZS1zcGFjZTpub3dyYXA7cGFkZGluZzoycHggNXB4O2JvcmRlci1yYWRpdXM6M3B4O30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAubGlzdCAudXNlcjJCLnVuZm8gLm5hbWV7YmFja2dyb3VuZC1jb2xvcjojZjAwO30nCiAgICAgICAgLCcuaXpoX2Jsb2NrQ2FydCAudXNlcjJCIC5kZWx7ZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTttYXJnaW4tbGVmdDotNC41ZW07fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgaS5zYXl7ZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTttYXJnaW4tbGVmdDotNDRweDtib3JkZXItcmFkaXVzOjZweCA2cHggMCA2cHg7Ym9yZGVyOjFweCBzb2xpZCAjOTk5O3BhZGRpbmc6MCA1cHggMCAzcHg7fScKICAgICAgICAsJy5pemhfYmxvY2tDYXJ0IC51c2VyMkIgaS5zYXlfMXtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi1sZWZ0Oi0xMHB4O2hlaWdodDo2cHg7YmFja2dyb3VuZC1jb2xvcjojZmZmO3dpZHRoOjZweDttYXJnaW4tdG9wOjE3cHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgIzk5OTt9JwogICAgICAgICwnLml6aF9ibG9ja0NhcnQgLnVzZXIyQiBpLnNheV8ye2Rpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7bWFyZ2luLWxlZnQ6LTlweDtoZWlnaHQ6NnB4O2JhY2tncm91bmQtY29sb3I6I2ZmZjt3aWR0aDo2cHg7bWFyZ2luLXRvcDoxN3B4O2JvcmRlci1yYWRpdXM6MCAwIDAgNnB4O2JvcmRlcjoxcHggc29saWQgIzk5OTtib3JkZXItd2lkdGg6MCAwIDFweCAxcHh9JwogICAgICAgICwnLml6aC1xdWljay1ibG9ja3twb3NpdGlvbjphYnNvbHV0ZTt0ZXh0LWFsaWduOmNlbnRlcjt3aWR0aDo0ZW07bWFyZ2luLXRvcDoxLjVlbTt3aGl0ZS1zcGFjZTpub3dyYXA7fScKICAgICAgICAsJy5pemgtcXVpY2stYmxvY2sgW2NsYXNzXj1pemgtcXVpY2stYmxvY2tde3Bvc2l0aW9uOmFic29sdXRlO2Rpc3BsYXk6YmxvY2s7d2hpdGUtc3BhY2U6bm93cmFwO30nCiAgICAgICAgLCcuaXpoLXF1aWNrLWJsb2NrOmFmdGVye2NvbnRlbnQ6YXR0cihpemhfbnVtMkIpO21hcmdpbi10b3A6MWVtO2Rpc3BsYXk6YmxvY2s7fScKICAgICAgICAsJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjQwcHg7fScKICAgICAgICAsJycKICAgICAgICBdLmpvaW4oJ1xuJyk7CiAgICB0aGlzLnVuYmxvY2tBbGwgPSBmdW5jdGlvbigpewogICAgICAgICQoJy5ibG9ja2VkLXVzZXJzID4gLml0ZW0tY2FyZCcpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgdmFyIHVpZD0kKGUpLmF0dHIoJ2RhdGEtaWQnKTsKICAgICAgICAgICAgJC5wb3N0KCcvc2V0dGluZ3MvdW5ibG9ja3VzZXInLCQucGFyYW0oewogICAgICAgICAgICAgICAgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgICwgdWlkOnVpZAogICAgICAgICAgICB9KSxmdW5jdGlvbihyKXsKICAgICAgICAgICAgCS8vY29uc29sZS5sb2cocik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwoJICB9OwoJICB0aGlzLmRvVW5mb2xsb3cgPSBmdW5jdGlvbigpewogICAgICAgIHZhciAkZSA9IGlaaGlodS5RdWlja0Jsb2NrLlVzZXJzMkJCUS5zaGlmdCgpCiAgICAgICAgaWYodHlwZW9mICRlID09PSAndW5kZWZpbmVkJykgcmV0dXJuCgogICAgICAgIHZhciB1aWQ9JGUuYXR0cigndWlkJyk7CiAgICAgICAgJC5wb3N0KCcvbm9kZS9NZW1iZXJGb2xsb3dCYXNlVjInCiAgICAgICAgICAsICQucGFyYW0oewogICAgICAgICAgICAgICAgbWV0aG9kOid1bmZvbGxvd19tZW1iZXInCiAgICAgICAgICAgICAgLCBwYXJhbXM6SlNPTi5zdHJpbmdpZnkoeydoYXNoX2lkJzp1aWR9KQogICAgICAgICAgICAgICwgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgIH0pCiAgICAgICAgICAsIGZ1bmN0aW9uKHIpewogICAgICAgICAgICAgICAgICB2YXIgcXVlcnk9ZGVjb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YSkKICAgICAgICAgICAgICAgICAgICAsIHBhcmFtcz11dGlscy5nZXRQYXJhbUluUXVlcnkocXVlcnksJ3BhcmFtcycpCiAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgZXZhbCgncGFyYW1zPScrcGFyYW1zKTsKICAgICAgICAgICAgICAgICAgdmFyIGJpZD0nZmItJytwYXJhbXMuaGFzaF9pZAogICAgICAgICAgICAgICAgICAgICwgd2hvPWJpZCsnLCcKICAgICAgICAgICAgICAgICAgICAsIHVuZm9sbG93ZWQ9aVpoaWh1LlF1aWNrQmxvY2suVW5mb2xsb3dlZAogICAgICAgICAgICAgICAgICAgICwgcmVmb2xsb3dlZD1pWmhpaHUuUXVpY2tCbG9jay5SZWZvbGxvd2VkCiAgICAgICAgICAgICAgICAgICAgLCAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpCiAgICAgICAgICAgICAgICAgICAgLCAkdXNlcj0kY2FydERJVi5maW5kKCcudXNlcjJCW3VpZD0nK3BhcmFtcy5oYXNoX2lkKyddJykKICAgICAgICAgICAgICAgICAgICAsICRsaXN0PSR1c2VyLmNsb3Nlc3QoJy5saXN0JykKICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAkdXNlci5wcmVwZW5kVG8oJGxpc3QubmV4dCgpLm5leHQoKSk7CiAgICAgICAgICAgICAgICAgIGlmKHVuZm9sbG93ZWQuVXNlcnMuaW5kZXhPZignLCcrd2hvKTwwKQogICAgICAgICAgICAgICAgICAgICAgdW5mb2xsb3dlZC5Vc2VycyArPSB3aG87CiAgICAgICAgICAgICAgICAgIGlmKHJlZm9sbG93ZWQuVXNlcnMuaW5kZXhPZignLCcrd2hvKT49MCkKICAgICAgICAgICAgICAgICAgICAgIHJlZm9sbG93ZWQuVXNlcnMgPSByZWZvbGxvd2VkLnJlcGxhY2UoJywnK3dobywnLCcpOwogICAgICAgICAgICB9CiAgICAgICAgKS5hbHdheXMoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpewogICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5kb1VuZm9sbG93KCkKICAgICAgICB9KTsKCSAgfTsKICAgIHRoaXMuZG9RdWlja0Jsb2NrID0gZnVuY3Rpb24oKXsKICAgICAgICB2YXIgJGUgPSBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCQlEuc2hpZnQoKQogICAgICAgIGlmKHR5cGVvZiAkZSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybgoKICAgICAgICB2YXIgYmxvY2tpbmcgPSBpWmhpaHUuUXVpY2tCbG9jay5CbG9ja2luZwogICAgICAgICAgLCBocmVmID0gJGUuYXR0cignaHJlZicpCiAgICAgICAgICAsIHdobyA9IGhyZWYuc3BsaXQoJy8nKS5wb3AoKSsnLCcKICAgICAgICA7CiAgICAgICAgaWYodHlwZW9mIGJsb2NraW5nID09PSAndW5kZWZpbmVkJyB8fCAhYmxvY2tpbmcpewogICAgICAgICAgICBibG9ja2luZyA9IGlaaGlodS5RdWlja0Jsb2NrLkJsb2NraW5nID0geyBVc2VyczonLCcsIENvdW50OjAgfTsKICAgICAgICB9ZWxzZSBpZihibG9ja2luZy5Vc2Vycy5pbmRleE9mKCcsJyt3aG8pID49IDApewogICAgICAgICAgICByZXR1cm47IC8vIEFscmVhZHkgYmxvY2tpbmcKICAgICAgICB9CiAgICAgICAgdmFyICRjYXJ0RElWPSQoJyNpemhfYmxvY2tDYXJ0Jyk7CiAgICAgICAgJGNhcnRESVYuYWRkQ2xhc3MoJ2Jsb2NraW5nJyk7CiAgICAgICAgYmxvY2tpbmcuVXNlcnMgKz0gd2hvOwogICAgICAgIGJsb2NraW5nLkNvdW50ICsrOwogICAgICAgICQucG9zdChocmVmKycvYmxvY2snLCQucGFyYW0oewogICAgICAgICAgICBhY3Rpb246J2FkZCcKICAgICAgICAgICwgX3hzcmY6JCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKSAKICAgICAgICB9KSxmdW5jdGlvbihyKXsKICAgICAgICAgICAgdmFyIGhyZWY9dGhpcy51cmwucmVwbGFjZSgnL2Jsb2NrJywnJykKICAgICAgICAgICAgICAsIHVzZXJJRD1ocmVmLnNwbGl0KCcvJykucG9wKCkKICAgICAgICAgICAgICAsIHdobz0nLCcrdXNlcklEKycsJwogICAgICAgICAgICAgICwgYmxvY2tpbmc9aVpoaWh1LlF1aWNrQmxvY2suQmxvY2tpbmcKICAgICAgICAgICAgOwoKICAgICAgICAgICAgaWYoMD09LS1ibG9ja2luZy5Db3VudCkkY2FydERJVi5yZW1vdmVDbGFzcygncGVuZGluZycpOwogICAgCiAgICAgICAgICAgIGlmKGJsb2NraW5nLlVzZXJzLmluZGV4T2Yod2hvKSA8IDApCiAgICAgICAgICAgICAgICByZXR1cm47IC8vIE5vIHRoaXMgdXNlciBpbiBwZW5kaW5nCiAgICAgICAgICAgICAgCiAgICAgICAgICAgIGJsb2NraW5nLlVzZXJzID0gYmxvY2tpbmcuVXNlcnMucmVwbGFjZSh3aG8sJywnKTsKICAgICAgICAgICAgJCgnI2l6aF9ibG9ja0NhcnQgLnVzZXIyQltocmVmPSInK2hyZWYrJyJdJykuZmluZCgnLmRlbCcpWzBdLmNsaWNrKCk7CiAgICAgICAgICAgICQoJ2FbaHJlZiQ9IicraHJlZisnIl0nKS5jc3MoJ3RleHQtZGVjb3JhdGlvbicsJ2xpbmUtdGhyb3VnaCcpOwogICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUil7CiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmRvUXVpY2tCbG9jaygpCiAgICAgICAgfSk7CiAgCX07CiAgICB0aGlzLnJlc2l6ZUJsb2NrQ2FydCA9IGZ1bmN0aW9uKCRjYXJ0RElWKXsKICAgICAgICBmdW5jdGlvbiBwYXJzZUNzc1B4KCRpdGVtLCBuYW1lKSB7CiAgICAgICAgICAgIHZhciBtID0gJGl0ZW0uY3NzKG5hbWUpOwogICAgICAgICAgICBpZiAobSAhPSAndW5kZWZpbmVkJykgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KG0ucmVwbGFjZSgncHgnLCcnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHZhciAkdXNlckRJViA9ICRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKTsKICAgICAgICB2YXIgJHRpdGxlQm94ID0gJCgnI2l6aF9ibG9ja0NhcnQgLmRvJyk7CiAgICAgICAgdmFyIGggPSBwYXJzZUNzc1B4KCRjYXJ0RElWLmZpbmQoJ2Rpdi5mcmFtZScpLCdwYWRkaW5nVG9wJykgCiAgICAgICAgICAgICAgICArICgkdXNlckRJVi5oZWlnaHQoKSArIHBhcnNlQ3NzUHgoJHVzZXJESVYsJ21hcmdpblRvcCcpKSAqICR1c2VyRElWLmxlbmd0aCAKICAgICAgICAgICAgICAgICsgJHRpdGxlQm94LmhlaWdodCgpCiAgICAgICAgICAgICAgICArIHBhcnNlQ3NzUHgoJHRpdGxlQm94LCAnbWFyZ2luVG9wJykKICAgICAgICAgICAgICAgICsgcGFyc2VDc3NQeCgkdGl0bGVCb3gsICdtYXJnaW5Cb3R0b20nKTsKICAgICAgICAKICAgICAgICBpZihoK2laaGlodS4kbWFpbi5vZmZzZXQoKS50b3A8aVpoaWh1LiR3aW4uaGVpZ2h0KCkpewogICAgICAgICAgICAkY2FydERJVi5jc3MoeydoZWlnaHQnOmgsJ2JvdHRvbSc6Jyd9KTsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGNhcnRESVYuY3NzKHsnaGVpZ2h0JzonJywnYm90dG9tJzowfSk7CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuZ2V0Q2FydERJVj1mdW5jdGlvbigpewogICAgICAgIHZhciAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpOwogICAgICAgIGlmKCEkY2FydERJVi5sZW5ndGgpewogICAgICAgICAgICAkY2FydERJVj0kKCc8ZGl2PicsIHsgaWQ6ICdpemhfYmxvY2tDYXJ0JywgJ2NsYXNzJzogJ2l6aF9ibG9ja0NhcnQnIH0pLmNzcyh7CiAgICAgICAgICAgICAgICAndG9wJzppWmhpaHUuJG1haW4ub2Zmc2V0KCkudG9wCiAgICAgICAgICAgIH0pLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonZG8nCiAgICAgICAgICAgICAgICAgICwgJ2l6aF9udW0yQic6MAogICAgICAgICAgICAgICAgICAsICd0aXRsZSc6J+S4i+S4uuOAjOWAmeWuoeOAjeWIl+ihqFxu54K55Ye75bem5LiK6KeS5Y+v5pS26LW3L+WxleW8gFxu5pWw5a2X5Li65Lq654qv5oC75pWw77yI57qi6Imy6KGo56S65LuN5pyJ5Lq654qv5q2j5b6F5YWl5YiX77yJJwogICAgICAgICAgICAgICAgfSkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOididXR0b24gZGVsQWxsJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon5riF56m644CM5YCZ5a6h44CN5YiX6KGoJwogICAgICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkY2FydERJVj0kKCcjaXpoX2Jsb2NrQ2FydCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNzcygnYm90dG9tJywnJykuZmluZCgnLmxpc3QnKS5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcy5wYXJlbnROb2RlKS5hdHRyKCdpemhfbnVtMkInLCcwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcnRESVYuY3NzKCdoZWlnaHQnLCcnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+Wkp+i1picpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzonYmxvY2snCiAgICAgICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6J2Fic29sdXRlJwogICAgICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6MjQKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGlucHV0PicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOid1bmZvJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0eXBlOidjaGVja2JveCcKICAgICAgICAgICAgICAgICAgICAgICwgdGl0bGU6J+mAieS4reWQju+8jOWwhuaIkeWFs+azqOS5i+S6uuagh+WHuu+8jOaUueS7peaUvumAkO+8iOWPlua2iOWFs+azqO+8ieiuuuWkhCcKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNhcnRESVY9JCh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJHVzZXJzPSQoJy5mcmFtZSAubGlzdC5pX2ZvIC51c2VyMkInLCRjYXJ0RElWKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYWN0aW9uPSQoJy5hY3Rpb24nLHRoaXMucGFyZW50Tm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodGhpcy5jaGVja2VkKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVzZXJzLmFkZENsYXNzKCd1bmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb24udGV4dCgn5pS+6YCQJykuY3NzKCdwYWRkaW5nJywnMCAyZW0gMCAwJykuYXR0cigndGl0bGUnLCflr7nliJfooajlhoXmiJHlhbPms6jkuYvkurrlj5bmtojlhbPms6gnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVzZXJzLnJlbW92ZUNsYXNzKCd1bmZvJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRhY3Rpb24udGV4dCgn5pS255uRJykuY3NzKCdwYWRkaW5nJywnMCAwIDAgMmVtJykuYXR0cigndGl0bGUnLCflsIbkuIvliJfkurrniq/pgJDkuIDliqDlhaXpu5HlkI3ljZUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXknOidibG9jaycKICAgICAgICAgICAgICAgICAgICAgICwgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAgICAgICAgICwgJ2hlaWdodCc6MjIKICAgICAgICAgICAgICAgICAgICAgICwgJ2xpbmUtaGVpZ2h0JzoyMgogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon6YCJ5Lit5ZCO77yM5bCG5oiR5YWz5rOo55qE5Lq65qCH5Ye677yM5YeG5aSH44CM5Y+W5raI5YWz5rOo44CNJwogICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+S7jui9uycpLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdkaXNwbGF5JzonYmxvY2snCiAgICAgICAgICAgICAgICAgICAgICAsICdmbG9hdCc6J2xlZnQnCiAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tcmlnaHQnOjIwCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOididXR0b24gYWN0aW9uJwogICAgICAgICAgICAgICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgLCB0aXRsZTon5bCG5LiL5YiX5Lq654qv6YCQ5LiA5Yqg5YWl6buR5ZCN5Y2VJwogICAgICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRjYXJ0RElWPSQodGhpcy5wYXJlbnROb2RlLnBhcmVudE5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCgnLnVuZm8nLHRoaXMucGFyZW50Tm9kZSkuaXMoJzpjaGVja2VkJykpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5saXN0LmlfZm8gLnVzZXIyQicsJGNhcnRESVYpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQkJRLnB1c2goJChlKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5kb1VuZm9sbG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubGlzdCAudXNlcjJCJywkY2FydERJVikuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCQlEucHVzaCgkKGUpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmRvUXVpY2tCbG9jaygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkudGV4dCgn5pS255uRJykuY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc3BsYXknOidibG9jaycKICAgICAgICAgICAgICAgICAgICAgICwgJ2Zsb2F0JzoncmlnaHQnCiAgICAgICAgICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6MjAKICAgICAgICAgICAgICAgICAgICAgICwgJ21hcmdpbi1yaWdodCc6LTEwCiAgICAgICAgICAgICAgICAgICAgICAsICdwYWRkaW5nJzonMCAwIDAgMmVtJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8YT4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonemctaWNvbiB6Zy1pY29uLWRvdWJsZS1hcnJvdycKICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGNhcnRESVY9JCgnI2l6aF9ibG9ja0NhcnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkY2FydERJVi5hdHRyKCdtaW5pJykhPScxJyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmZpbmQoJy5mcmFtZScpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNhcnRESVYuY3NzKHsnaGVpZ2h0JzonJywnYm90dG9tJzonJ30pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FydERJVi5hdHRyKCdtaW5pJywnMScpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY2FydERJVi5maW5kKCcuZnJhbWUnKS5zaG93KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLnJlc2l6ZUJsb2NrQ2FydCgkY2FydERJVik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmF0dHIoJ21pbmknLCcwJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6J2Fic29sdXRlJwogICAgICAgICAgICAgICAgICAgICAgLCAnbGVmdCc6MAogICAgICAgICAgICAgICAgICAgICAgLCAndG9wJzo1CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAkKCc8ZGl2PicseydjbGFzcyc6J2ZyYW1lJ30KICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2xpc3QgaV9mbyBmb19pJwogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAkKCc8ZGl2PicsewogICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidsaXN0IGlfZm8nCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICkuYXBwZW5kKAogICAgICAgICAgICAgICAgICAgICQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2xpc3QgZm9faScKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgJCgnPGRpdj4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzonbGlzdCcKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApLmFwcGVuZFRvKGlaaGlodS4kYm9keSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJGNhcnRESVYKICAgIH0KICAgIHRoaXMuaW4yQmxvY2tDYXJ0ID0gZnVuY3Rpb24odXJsLHJldHJpZWRDb3VudCl7CiAgICAgICAgdmFyICRlID0gaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQi5zaGlmdCgpIHx8IG51bGwKICAgICAgICAgICwgJGNhcnRESVYgPSBpWmhpaHUuUXVpY2tCbG9jay5nZXRDYXJ0RElWKCkKCiAgICAgICAgJGNhcnRESVYuYWRkQ2xhc3MoJ3BlbmRpbmcnKTsKICAgICAgICBpZih0eXBlb2YgcmV0cmllZENvdW50ID09ICd1bmRlZmluZWQnKQogICAgICAgICAgICByZXRyaWVkQ291bnQgPSAwCgogICAgICAgIC8vY29uc29sZS5sb2cocmV0cmllZENvdW50KQogICAgICAgIGlmICghJGUgfHwgJGUubGVuZ3RoID09PSAwKXsKICAgICAgICAgICAgaWYoKHVybHx8JycpPT0nJyl7CiAgICAgICAgICAgICAgICAkY2FydERJVi5yZW1vdmVDbGFzcygncGVuZGluZycpCiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJC5hamF4KFsnJyx1cmxdLmpvaW4oJycpLHsKICAgICAgICAgICAgICAgICAgICB0eXBlOidHRVQnCiAgICAgICAgICAgICAgICAgICwgbWF4UmV0cnlDb3VudDogMwogICAgICAgICAgICAgICAgfSkuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUil7CiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEucGF5bG9hZCxmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5hZGRVc2VyMkIoZSkKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmluMkJsb2NrQ2FydChkYXRhLnBhZ2luZy5uZXh0KQogICAgICAgICAgICAgICAgfSkuZmFpbChmdW5jdGlvbihkYXRhLHRleHRTdGF0dXMsalhIUil7CiAgICAgICAgICAgICAgICAgICAgaWYgKCsrcmV0cmllZENvdW50IDwgdGhpcy5tYXhSZXRyeUNvdW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suaW4yQmxvY2tDYXJ0KHVybCxyZXRyaWVkQ291bnQpCiAgICAgICAgICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLnJlbW92ZUNsYXNzKCdwZW5kaW5nJykKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgdmFyIGhyZWYgPSAkZS5hdHRyKCdocmVmJykKICAgICAgICAgICwgdXNlcm5hbWUgPSBocmVmLnNwbGl0KCcvJykucG9wKCkKICAgICAgICAgICwgd2hvID0gdXNlcm5hbWUrJywnCiAgICAgICAgOwoKICAgICAgICBpZigkY2FydERJVi5maW5kKCcudXNlcjJCW2hyZWY9IicraHJlZisnIl0nKS5sZW5ndGgpewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAkLmFqYXgoJy9ub2RlL01lbWJlclByb2ZpbGVDYXJkVjI/JyskLnBhcmFtKHtwYXJhbXM6SlNPTi5zdHJpbmdpZnkoeyd1cmxfdG9rZW4nOnVzZXJuYW1lfSl9KSwgewogICAgICAgICAgICB0eXBlOiAnR0VUJwogICAgICAgICAgLCB1c2VyMkI6ICRlCiAgICAgICAgICAsIG1heFJldHJ5Q291bnQ6IDMKICAgICAgICB9KS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKXsKICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suYWRkVXNlcjJCKGRhdGEpCiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmluMkJsb2NrQ2FydCh1cmwpCiAgICAgICAgfSkuZmFpbChmdW5jdGlvbihkYXRhLHRleHRTdGF0dXMsalhIUil7CiAgICAgICAgICAgIGlmICgrK3JldHJpZWRDb3VudCA8IHRoaXMubWF4UmV0cnlDb3VudCl7CiAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5Vc2VyczJCLnVuc2hpZnQodGhpcy51c2VyMkIpCiAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5pbjJCbG9ja0NhcnQodXJsLHJldHJpZWRDb3VudCkKICAgICAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIH0KICAgICAgICB9KS5hbHdheXMoZnVuY3Rpb24oZGF0YSx0ZXh0U3RhdHVzLGpYSFIpewogICAgICAgICAgICAkKCcjaXpoX2Jsb2NrQ2FydCcpLnJlbW92ZUNsYXNzKCdwZW5kaW5nJyk7CiAgICAgICAgfSk7CiAgICB9OwogICAgdGhpcy5hZGRVc2VyMkI9ZnVuY3Rpb24oZGF0YSl7CiAgICAgICAgaWYgKGRhdGEgPT09ICcnKSByZXR1cm4KICAgICAgICB2YXIgJGh0bWw9JChkYXRhLnJlcGxhY2UodXRpbHMuUmVnZXhTcmNQaWMsICcnKSkKICAgICAgICAgICwgaXNaSFBDPSRodG1sLmlzKCcuemgtcHJvZmlsZS1jYXJkJykKICAgICAgICAgICwgJGF2YXRhckxpbms9aXNaSFBDPyRodG1sLmZpbmQoJy5hdmF0YXItbGluazpmaXJzdCcpOiRodG1sLmZpbmQoJy56bS1pdGVtLWxpbmstYXZhdGFyOmZpcnN0JykKICAgICAgICAgICwgaHJlZj0kYXZhdGFyTGluay5hdHRyKCdocmVmJykKICAgICAgICBpZigoaHJlZnx8JycpPT0nJylyZXR1cm4KCiAgICAgICAgdmFyIHVzZXJJRD1ocmVmLnN1YnN0cig4KQogICAgICAgICAgLCB1c2VyTmFtZT1pc1pIUEM/JGF2YXRhckxpbmsudGV4dCgpOiRhdmF0YXJMaW5rLmF0dHIoJ3RpdGxlJykKICAgICAgICAgICwgJGJ0bkZvbGxvdz0kaHRtbC5maW5kKCdidXR0b25bZGF0YS1mb2xsb3ddJykKICAgICAgICAgICwgaGFzaElEPSEkYnRuRm9sbG93Lmxlbmd0aD8nJzokYnRuRm9sbG93LmF0dHIoJ2RhdGEtaWQnKQogICAgICAgICAgLCBmXz0kYnRuRm9sbG93Lmxlbmd0aCYmJGJ0bkZvbGxvdy5pcygnLnpnLWJ0bi11bmZvbGxvdycpCiAgICAgICAgICAsIF9mPSRidG5Gb2xsb3cubGVuZ3RoJiYkYnRuRm9sbG93LmlzKCdbZGF0YS1mb2xsb3dtZT0xXScpCiAgICAgICAgICAsIGNzc0Y9X2Z8fGZfPyd6Zy1pY29uIHJlbCAnOicnCiAgICAgICAgICAsICRjYXJ0RElWPWlaaGlodS5RdWlja0Jsb2NrLmdldENhcnRESVYoKQogICAgICAgICAgLCAkY2FydD0kY2FydERJVi5maW5kKCcubGlzdCcpCiAgICAgICAgICAsIHdobz0nLCcrdXNlcklEKycsJwogICAgICAgIDsKCiAgICAgICAgaWYoaGFzaElEPT0nJyl7CiAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBibG9ja2VkIG9yIHlvdSBibG9ja2VkCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmKCRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkJbaHJlZj0iJytocmVmKyciXScpLmxlbmd0aCl7CiAgICAgICAgICAgIHJldHVybjsgLy8gVXNlciBhbHJlYWR5IGluIGJsb2NrIGxpc3QKICAgICAgICB9CgogICAgICAgIHZhciAkdXNlcjJCPSQoJzxkaXY+Jyx7CiAgICAgICAgICAgICAgICAnY2xhc3MnOid1c2VyMkInKyhmXyYmJGNhcnRESVYuZmluZCgnLmRvIC51bmZvOmNoZWNrZWQnKS5sZW5ndGg/JyB1bmZvJzonJykKICAgICAgICAgICAgICAsICdocmVmJzpocmVmCiAgICAgICAgICAgICAgLCAndWlkJzpoYXNoSUQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J2J1dHRvbiBkZWwnCiAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgLCBjbGljazpmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgJHVzZXI9JCh0aGlzKS5jbG9zZXN0KCcudXNlcjJCJykKICAgICAgICAgICAgICAgICAgICAgICAgICAsICRjYXJ0RElWPSQoJyNpemhfYmxvY2tDYXJ0JykKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAkdXNlci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG51bTJCPSRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKS5sZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNoaWxkcmVuKCcuZG8nKS5hdHRyKCdpemhfbnVtMkInLG51bTJCPT0wPycwJzpudW0yQj45OTk/JzFrKyc6bnVtMkIpOwogICAgICAgICAgICAgICAgICAgICAgICBpZihudW0yQikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLnJlc2l6ZUJsb2NrQ2FydCgkY2FydERJVik7CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjYXJ0RElWLmNzcygnaGVpZ2h0JywnJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkudGV4dCgn6LWmJykKICAgICAgICAgICAgKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAkKCc8aT4nLHsKICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidzYXknCiAgICAgICAgICAgICAgICAgICwgJ2RhdGEtdGlwJzoncCR0JCcrdXNlcklECiAgICAgICAgICAgICAgICB9KS50ZXh0KCflhqTmnoknKQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOidzYXlfMSd9KQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOidzYXlfMid9KQogICAgICAgICAgICApLmFwcGVuZCgkKCc8aT4nLHsnY2xhc3MnOmNzc0Z9KQogICAgICAgICAgICApLmFwcGVuZCgKICAgICAgICAgICAgICAgICQoJzxhPicsewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6J25hbWUnCiAgICAgICAgICAgICAgICAgICwgaHJlZjpocmVmCiAgICAgICAgICAgICAgICAgICwgdGFyZ2V0OidfYmxhbmsnCiAgICAgICAgICAgICAgICB9KS50ZXh0KHVzZXJOYW1lKQogICAgICAgICAgICApLnNob3coKQogICAgICAgIDsKICAgICAgICBpZihmXyYmX2YpewogICAgICAgICAgICAkY2FydC5lcSgwKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2UgaWYoZl8pewogICAgICAgICAgICAkY2FydC5lcSgxKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2UgaWYoX2YpewogICAgICAgICAgICAkY2FydC5lcSgyKS5hcHBlbmQoJHVzZXIyQik7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgICRjYXJ0LmVxKDMpLmFwcGVuZCgkdXNlcjJCKTsKICAgICAgICB9CiAgICAgICAgdmFyIG51bTJCPSRjYXJ0RElWLmZpbmQoJy5saXN0IC51c2VyMkInKS5sZW5ndGg7CiAgICAgICAgJGNhcnRESVYuY2hpbGRyZW4oJy5kbycpLmF0dHIoJ2l6aF9udW0yQicsbnVtMkI9PTA/JzAnOm51bTJCPjk5OTk/JzEwaysnOm51bTJCKTsKICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5yZXNpemVCbG9ja0NhcnQoJGNhcnRESVYpOwogICAgfQogICAgdGhpcy5hZGRRdWlja0Jsb2NrID0gZnVuY3Rpb24oJGEpewogICAgICAgIHZhciAkdm90ZUluZm89JCgnLnptLWl0ZW0tdm90ZS1pbmZvJywkYSkKICAgICAgICBpZigkdm90ZUluZm8ubGVuZ3RoKXsKICAgICAgICAgICAgdmFyICR2b3RlcnM9JHZvdGVJbmZvLmNoaWxkcmVuKCcudm90ZXJzJykKICAgICAgICAgICAgaWYoJHZvdGVycy5sZW5ndGgpewogICAgICAgICAgICAgICAgdmFyIHM9WyfvvIwnLCR2b3RlSW5mby5hdHRyKCdkYXRhLXZvdGVjb3VudCcpLCfkuKrkuZ/kuI3og73lv43vvIzmnpzmlq3mkpUnXS5qb2luKCcnKQogICAgICAgICAgICAgICAgICAsIGFpZD0kYS5hdHRyKCdkYXRhLWFpZCcpfHwkYS5jaGlsZHJlbignW2l0ZW1wcm9wPSJaUmVhY3RvciJdJykuYXR0cignZGF0YS1pZCcpCiAgICAgICAgICAgICAgICAgICwgdXJsPVsnLycsJGEuYXR0cignZGF0YS10eXBlJyk9PSdwJz8ncG9zdCc6J2Fuc3dlcicsJy8nLGFpZCwnL3ZvdGVyc19wcm9maWxlJ10uam9pbignJykKICAgICAgICAgICAgICAgICQoJzxhPicse2hyZWY6J2phdmFzY3JpcHQ6OycsJ2NsYXNzJzondGV4dCd9KS50ZXh0KHMpLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICR0PSRhLmZpbmQoJy5hdXRob3ItaW5mbyA+IGEubmFtZSwuem0taXRlbS1hbnN3ZXItYXV0aG9yLWluZm8gPiBhLmF1dGhvci1saW5rJykKICAgICAgICAgICAgICAgICAgICBpZigkdCYmJHQubGVuZ3RoKXsKICAgICAgICAgICAgICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suVXNlcnMyQi5wdXNoKCR0KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tCbG9jay5pbjJCbG9ja0NhcnQodXJsKQogICAgICAgICAgICAgICAgfSkuYXBwZW5kVG8oJHZvdGVJbmZvKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKICAgIHRoaXMuYWRkUXVpY2tCbG9ja0luT25lQ29tbWVudCA9IGZ1bmN0aW9uKCRjbUl0ZW0pewogICAgICAgIHZhciAkd2hlcmU9JCgnLnptLWNvbW1lbnQtaGQnLCRjbUl0ZW0pOwogICAgICAgIGlmKCR3aGVyZS5maW5kKCcuaXpoLXF1aWNrLWJsb2NrLXBlbmQnKS5sZW5ndGgpcmV0dXJuOwogICAgICAgICQoJzxhPicsewogICAgICAgICAgICAnY2xhc3MnOidpemgtcXVpY2stYmxvY2stcGVuZCBpemgtYnV0dG9uJwogICAgICAgICAgLCBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgLCAnZGF0YS10aXAnOidzJGwk5bCG5q2k5Lq65YiX5YWl5YCZ5a6h5ZCN5Y2V5Lul5b6F5pS255uRJwogICAgICAgIH0pLnRleHQoJ+WAmeWuoScpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciAkZSA9ICQodGhpcykubmV4dCgpCiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLlVzZXJzMkIucHVzaCgkZSkKICAgICAgICAgICAgaVpoaWh1LlF1aWNrQmxvY2suaW4yQmxvY2tDYXJ0KCk7CiAgICAgICAgfSkucHJlcGVuZFRvKCR3aGVyZSkuaGlkZSgpOwogICAgfTsKICAgIHRoaXMuYWRkUXVpY2tCbG9ja0luQ29tbWVudExpc3QgPSBmdW5jdGlvbigkd2hlcmUpewogICAgICAgIC8vIFJlZ2lvbjog5b+r6YCf5bGP6JS9CiAgICAgICAgdmFyICRjbT0kd2hlcmUuaXMoJy56bS1jb21tZW50LWJveCcpPyR3aGVyZTokd2hlcmUuY2xvc2VzdCgnLnptLWNvbW1lbnQtYm94JykKICAgICAgICAgICwgJHU9JCgnLnptLWl0ZW0tY29tbWVudCcsJGNtKQogICAgICAgIDsKICAgICAgICAkdS5lYWNoKGZ1bmN0aW9uKGksZSl7CiAgICAgICAgICAgIGlaaGlodS5RdWlja0Jsb2NrLmFkZFF1aWNrQmxvY2tJbk9uZUNvbW1lbnQoJChlKSk7CiAgICAgICAgfSk7CiAgICAgICAgdmFyICRidG5RdWlja0Jsb2NrPSQoJzxhPicsewogICAgICAgICAgICAgICAgJ2NsYXNzJzonaXpoLXF1aWNrLWJsb2NrLXN3aXRjaCBpemgtYnV0dG9uJwogICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkdCTlvIDlp4vku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnCiAgICAgICAgICAgIH0pLnRleHQoJ+W/q+mAn+Wxj+iUvScpLmNzcyh7J21hcmdpbi1sZWZ0Jzo3fSkucHJlcGVuZFRvKCR3aGVyZSkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGlmKHRoaXMuZ2V0QXR0cmlidXRlKCdvbicpPT0nMScpewogICAgICAgICAgICAgICAgICAgICQoJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZCcpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoeydkYXRhLXRpcCc6J3MkdCTlvIDlp4vku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnLCdvbic6JzAnfSkucmVtb3ZlQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgICAgICQoJy56bS1jb21tZW50LWhkIC5pemgtcXVpY2stYmxvY2stcGVuZCcpLnNob3coKTsKICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoeydkYXRhLXRpcCc6J3MkdCTnu5PmnZ/ku47or4TorrrogIXkuK3pgInmi6nlsY/olL3lr7nosaEnLCdvbic6JzEnfSkuYWRkQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgOwogICAgICAgIGlmKCRjbS5pcygnLmVtcHR5JykpewogICAgICAgICAgICAkYnRuUXVpY2tCbG9jay5oaWRlKCk7CiAgICAgICAgfQogICAgICAgIC8vIFJlZ2lvbiBlbmQKICAgIH07CiAgICAKICAgIGlaaGlodS4kYm9keS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAkKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcjemgtdG9vbHRpcCcpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICB2YXIgJGE9JChldmVudC50YXJnZXQpLmZpbHRlcignI3poLXRvb2x0aXAtcGVvcGxlJykuZmluZCgnYVtuYW1lPWZvY3VzXScpCiAgICAgICAgICAgICAgLCBiaWQ9JGEuYXR0cignaWQnKQogICAgICAgICAgICAgICwgd2hvPScsJytiaWQrJywnCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoJGEuaXMoJy56Zy1idG4tdW5mb2xsb3cnKSYmaVpoaWh1LlF1aWNrQmxvY2suVW5mb2xsb3dlZC5Vc2Vycy5pbmRleE9mKHdobyk+PTApewogICAgICAgICAgICAgICAgJGEudGV4dCgn5YWz5rOoJykucmVtb3ZlQ2xhc3MoJ3pnLWJ0bi11bmZvbGxvdycpLmFkZENsYXNzKCd6Zy1idG4tZm9sbG93Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYoJGEuaXMoJy56Zy1idG4tZm9sbG93JykmJmlaaGlodS5RdWlja0Jsb2NrLlJlZm9sbG93ZWQuVXNlcnMuaW5kZXhPZih3aG8pPj0wKXsKICAgICAgICAgICAgICAgICRhLnRleHQoJ+WPlua2iOWFs+azqCcpLnJlbW92ZUNsYXNzKCd6Zy1idG4tZm9sbG93JykuYWRkQ2xhc3MoJ3pnLWJ0bi11bmZvbGxvdycpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIFF1aWNrRmF2bwogKi8KZnVuY3Rpb24gUXVpY2tGYXZvKGlaaGlodSkgewogICAgaWYgKCB0eXBlb2YgaVpoaWh1ID09PSAndW5kZWZpbmVkJyB8fCAhaVpoaWh1IHx8ICFpWmhpaHUuY29uZmlnWydRdWlja0Zhdm8nXSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaVpoaWh1LlF1aWNrRmF2byA9IHRoaXM7CiAgICAKICAgIHRoaXMuRGVmYXVsdENvdW50ID0gNDsKICAgIHRoaXMuUGlubmVkTGlzdCA9IGlaaGlodS5jb25maWdbJ1F1aWNrRmF2b1Bpbm5lZCddOwogICAgdGhpcy5jc3MgPSAKICAgICAgICBbJy5pemgtUGluNFF1aWNrRmF2b3twYWRkaW5nOjNweCA1cHggMDtmbG9hdDpyaWdodDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6NHB4O21hcmdpbi1yaWdodDoyZW07bGluZS1oZWlnaHQ6MS4yNTt9JwogICAgICAgICwnLml6aC1QaW40UXVpY2tGYXZvIC56bS1pdGVtLXRvcC1idG57dmlzaWJpbGl0eTp2aXNpYmxlO21hcmdpbjowIDRweDtmbG9hdDpyaWdodDt9JwogICAgICAgICwnZGl2Lml6aF9mYXZ7cG9zaXRpb246YWJzb2x1dGU7ei1pbmRleDo5OTk5O2Rpc3BsYXk6bm9uZTtib3JkZXI6MXB4IHNvbGlkICM5OTk5OTk7YmFja2dyb3VuZC1jb2xvcjojZmZmO2JvcmRlci1yYWRpdXM6NXB4IDVweCA1cHggMDttYXJnaW4tbGVmdDotMXB4O30nCiAgICAgICAgLCdkaXYuaXpoX2ZhdiAudGl0bGV7cGFkZGluZzowIDVweDtiYWNrZ3JvdW5kLWNvbG9yOiMwODc0YzQ7Y29sb3I6I2ZmZjtmb250LXdlaWdodDpib2xkO2ZvbnQtc2l6ZToxNXB4O3RleHQtYWxpZ246Y2VudGVyO2JvcmRlci1yYWRpdXM6M3B4IDNweCAwIDA7fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2e2Rpc3BsYXk6YmxvY2s7Y2xlYXI6Ym90aDtmbG9hdDtsZWZ0O3BhZGRpbmc6MCAzNnB4IDAgMjRweDtsaW5lLWhlaWdodDoyO30nCiAgICAgICAgLCdkaXYuaXpoX2ZhdiBhLmZhdiBpe3Bvc2l0aW9uOmFic29sdXRlO21hcmdpbi10b3A6MC41ZW07fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2IGkuc3Bpbm5lci1ncmF5e2xlZnQ6MDt9JwogICAgICAgICwnZGl2Lml6aF9mYXYgYS5mYXYgaS56LWljb24tY29sbGVjdHtsZWZ0OjEwcHg7dmlzaWJpbGl0eTpoaWRkZW47YmFja2dyb3VuZC1wb3NpdGlvbjotNTZweCAtMzZweDt9JwogICAgICAgICwnZGl2Lml6aF9mYXYgYS5mYXYuc2VsZWN0ZWQgaS56LWljb24tY29sbGVjdHt2aXNpYmlsaXR5OnZpc2libGU7fScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2OmhvdmVye3RleHQtZGVjb3JhdGlvbjpub25lfScKICAgICAgICAsJ2Rpdi5pemhfZmF2IGEuZmF2IHNwYW57ZmxvYXQ6cmlnaHQ7ZGlzcGxheTpibG9jazttYXJnaW4tcmlnaHQ6LTMycHh9JwogICAgICAgICwnLm1ldGEtaXRlbS5vbntwb3NpdGlvbjpyZWxhdGl2ZTt6LWluZGV4OjEwMDAwO2JhY2tncm91bmQtY29sb3I6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICM5OTk5OTk7Ym9yZGVyLXRvcC1jb2xvcjojZmZmO21hcmdpbjotMXB4IC04cHggLTFweCAtMXB4O3BhZGRpbmc6MCA3cHg7Ym9yZGVyLXJhZGl1czoycHggMnB4IDNweCAzcHg7fScKICAgICAgICAsJyddLmpvaW4oJ1xuJyk7CiAgICB0aGlzLmFkZFF1aWNrRmF2byA9IGZ1bmN0aW9uKCR2LCRhKXsKICAgICAgICBpZigkdi5sZW5ndGgpewogICAgICAgICAgICBpZigkYS5jaGlsZHJlbignLml6aF9mYXYnKS5sZW5ndGg8PTApewogICAgICAgICAgICAgICAgJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdpemhfZmF2JyB9KQogICAgICAgICAgICAgICAgCS5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnc3Bpbm5lci1ncmF5JyB9KSkKICAgICAgICAgICAgICAgIAkuYXBwZW5kKCcmbmJzcDvliqDovb3kuK0uLi4mbmJzcDsnKQogICAgICAgICAgICAgICAgCS5iaW5kKCdtb3VzZW92ZXInLCBmdW5jdGlvbigpewoJICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnNob3coKS5wYXJlbnQoKS5maW5kKCcubWV0YS1pdGVtW25hbWU9ZmF2b10nKS5hZGRDbGFzcygnb24nKTsKICAgICAgICAgICAgICAgIAl9KQogICAgICAgICAgICAgICAgCS5iaW5kKCdtb3VzZW91dCcsIGZ1bmN0aW9uKCl7CgkgICAgICAgICAgICAgICAgICAgICQodGhpcykuaGlkZSgpLnBhcmVudCgpLmZpbmQoJy5tZXRhLWl0ZW1bbmFtZT1mYXZvXScpLnJlbW92ZUNsYXNzKCdvbicpOwoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAuYXBwZW5kVG8oJGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR2LmJpbmQoJ21vdXNlZW50ZXInLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICB2YXIgJGE9aVpoaWh1LmdldEl0ZW0oJCh0aGlzKSkKICAgICAgICAgICAgICAgICAgLCAkbT0kKHRoaXMpLmFkZENsYXNzKCdvbicpLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKQogICAgICAgICAgICAgICAgICAsIGFpZD0kYS5hdHRyKCdkYXRhLWFpZCcpCiAgICAgICAgICAgICAgICAgICwgJG9wPSQodGhpcykub2Zmc2V0UGFyZW50KCkKICAgICAgICAgICAgICAgICAgLCBib3R0b20xPXBhcnNlSW50KCRvcC5jc3MoJ21hcmdpbi1ib3R0b20nKSkKICAgICAgICAgICAgICAgICAgLCBib3R0b20yPXBhcnNlSW50KCRhLmNzcygncGFkZGluZy1ib3R0b20nKSkKICAgICAgICAgICAgICAgICAgLCBwb3M9JCh0aGlzKS5wb3NpdGlvbigpCiAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAkYS5jaGlsZHJlbignLml6aF9mYXYnKS5jc3MoewogICAgICAgICAgICAgICAgICAgICdib3R0b20nOihpc05hTihib3R0b20xKT8wOmJvdHRvbTEpKyhpc05hTihib3R0b20yKT8wOmJvdHRvbTIpKyRvcC5oZWlnaHQoKS1wb3MudG9wCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOnBvcy5sZWZ0KyRtLnBvc2l0aW9uKCkubGVmdAogICAgICAgICAgICAgICAgfSkuc2hvdygpOwogICAgICAgICAgICAgICAgJC5nZXRKU09OKCcvY29sbGVjdGlvbnMvanNvbicsJC5wYXJhbSh7YW5zd2VyX2lkOmFpZH0pLGZ1bmN0aW9uKHJlc3VsdCxzdGF0dXMseGhyKXsKICAgICAgICAgICAgICAgICAgICB2YXIgYWlkPXRoaXMudXJsLnN1YnN0cih0aGlzLnVybC5pbmRleE9mKCdhbnN3ZXJfaWQ9JykrMTApCiAgICAgICAgICAgICAgICAgICAgICAsIHNlbD1wYWdlSXMuUXVlc3Rpb24/Jy56bS1pdGVtLWFuc3dlcicKICAgICAgICAgICAgICAgICAgICAgICAgICAgOnBhZ2VJcy5Ib21lPycuZmVlZC1pdGVtJwogICAgICAgICAgICAgICAgICAgICAgICAgICA6cGFnZUlzLkFuc3dlcj8nLnptLWl0ZW0tYW5zd2VyJwogICAgICAgICAgICAgICAgICAgICAgICAgICA6JycKICAgICAgICAgICAgICAgICAgICAgICwgJGE9JChzZWwrJ1tkYXRhLWFpZD0nK2FpZCsnXScpCiAgICAgICAgICAgICAgICAgICAgICAsICR2PSRhLmNoaWxkcmVuKCcuaXpoX2ZhdicpLmVtcHR5KCkuYXBwZW5kKCQoJzxkaXY+Jyx7J2NsYXNzJzondGl0bGUnLHRpdGxlOifku6XkuIvkuLrmnIDov5HpgInmi6nnmoTmlLbol4/lpLknfSkuYXBwZW5kKCflv6vpgJ/mlLbol48nKSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgaWYoJyc9PXNlbClyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgdmFyIGZhdkFsbD1yZXN1bHQubXNnWzBdCiAgICAgICAgICAgICAgICAgICAgICAsIGZhdlNlbD1yZXN1bHQubXNnWzFdCiAgICAgICAgICAgICAgICAgICAgICAsIG51bT1pWmhpaHUuUXVpY2tGYXZvLkRlZmF1bHRDb3VudAogICAgICAgICAgICAgICAgICAgICAgLCBmYXY9bmV3IEFycmF5KCkKICAgICAgICAgICAgICAgICAgICAgICwgZmF2Tm9ybWFsPW5ldyBBcnJheSgpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICQuZWFjaChmYXZBbGwsZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZJRD1lWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCBwaW5uZWQ9aVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0W2ZJRF0KICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBpZihwaW5uZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgIGZhdi5wdXNoKGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICBmYXZOb3JtYWwucHVzaChlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIG51bSAtPSBmYXYubGVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGlmKG51bSA+IDApewogICAgICAgICAgICAgICAgICAgICAgICBmYXY9ZmF2LmNvbmNhdChmYXZOb3JtYWwuc2xpY2UoMCxudW0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZmF2Tm9ybWFsLmxlbmd0aD0wOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKGZhdi5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZT1mYXYuc2hpZnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICwgZklEPWVbMF0KICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZOYW1lPWVbMV0KICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBmYXZOb3JtYWxbZklEXT1mTmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRmPSQoJzxhLz4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOidmYXYnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjonamF2YXNjcmlwdDo7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGFpZDphaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBmaWQ6ZklECiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS50ZXh0KGZOYW1lKS5jbGljayhmdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1PScvY29sbGVjdGlvbi8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGk9JGYuY2hpbGRyZW4oJzpmaXJzdCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRpLmhhc0NsYXNzKCdzcGlubmVyLWdyYXknKSlyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdSs9JGYuaGFzQ2xhc3MoJ3NlbGVjdGVkJyk/J3JlbW92ZSc6J2FkZCc7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGkuYXR0cignY2xhc3MnLCdzcGlubmVyLWdyYXknKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLnBvc3QodSwkLnBhcmFtKHtfeHNyZjokKCdpbnB1dFtuYW1lPV94c3JmXScpLnZhbCgpLGFuc3dlcl9pZDokKHRoaXMpLmF0dHIoJ2FpZCcpLGZhdmxpc3RfaWQ6JCh0aGlzKS5hdHRyKCdmaWQnKX0pLGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhY3Q9dGhpcy51cmwuc3Vic3RyaW5nKHRoaXMudXJsLmxhc3RJbmRleE9mKCcvJykrMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZpZD11dGlscy5nZXRQYXJhbUluUXVlcnkodGhpcy5kYXRhLCdmYXZsaXN0X2lkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGFpZD11dGlscy5nZXRQYXJhbUluUXVlcnkodGhpcy5kYXRhLCdhbnN3ZXJfaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgc2VsPXBhZ2VJcy5RdWVzdGlvbj8nLnptLWl0ZW0tYW5zd2VyJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOnBhZ2VJcy5Ib21lPycuZmVlZC1pdGVtJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOicnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkdmk9Jyc9PXNlbD9udWxsOiQoc2VsKydbZGF0YS1haWQ9JythaWQrJ10gLml6aF9mYXYgYVtmaWQ9JytmaWQrJ10nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaW5jPTA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCcnPT1zZWwpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihhY3Q9PSdyZW1vdmUnJiZyZXN1bHQubXNnPT0nT0snKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluYz0tMTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfWVsc2UgaWYoYWN0PT0nYWRkJyYmcmVzdWx0Lm1zZy5sZW5ndGgpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHZpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5jPTE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaW5jIT0wKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5jaGlsZHJlbignc3BhbicpLnRleHQocGFyc2VJbnQoJHZpLmNoaWxkcmVuKCdzcGFuJykudGV4dCgpKStpbmMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2aS5jaGlsZHJlbignOmZpcnN0JykuYXR0cignY2xhc3MnLCd6LWljb24tY29sbGVjdCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkucHJlcGVuZCgkKCc8aS8+Jyx7J2NsYXNzJzonei1pY29uLWNvbGxlY3QnfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4vPicpLnRleHQoZVszXSkpOwogICAgICAgICAgICAgICAgICAgICAgICAkZi5hcHBlbmRUbygkdi8qLmNoaWxkcmVuKHBpbm5lZD8nLnBpbm5lZCc6Jy5ub3JtYWwnKSovKTsKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICQuZWFjaChmYXZTZWwsZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoZmF2Tm9ybWFsW2VdKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHYuZmluZCgnYS5mYXZbZmlkPScrZSsnXScpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAkdi5iaW5kKCdtb3VzZWxlYXZlJyxmdW5jdGlvbigpewogICAgICAgICAgICAgICAgdmFyICRhPWlaaGlodS5nZXRJdGVtKCQodGhpcykucmVtb3ZlQ2xhc3MoJ29uJykpOwogICAgICAgICAgICAgICAgJGEuY2hpbGRyZW4oJy5pemhfZmF2JykuaGlkZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9OwoKICAgIGlaaGlodS4kYm9keS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKCQl2YXIgJGU9JChldmVudC50YXJnZXQpOwoJCWlmKCRlLmlzKCcubW9kYWwtZGlhbG9nJykpewoJCQkkZS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKCQkJCXZhciAkZT0kKGV2ZW50LnRhcmdldCkKICAgICAgICAgICAgICAgICAgLCAkZmF2TGlzdD0kZS5maW5kKCcuem0tZmF2by1saXN0LWNvbnRlbnQnKQogICAgICAgICAgICAgICAgOwoJCQkJaWYoJGZhdkxpc3QubGVuZ3RoKXsKCQkJCQl2YXIgJGZhdkl0ZW1zPSRmYXZMaXN0LmNoaWxkcmVuKCcuem0tZmF2by1saXN0LWl0ZW0tbGlua1tkYXRhLWxpZF0nKQogICAgICAgICAgICAgICAgICAgICAgLCBmdW5jUGluPWZ1bmN0aW9uKGUpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBpbm5lZD1lLmNoZWNrZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZT0kKGUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGY9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgO2lmKCEkZi5sZW5ndGgpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpZD0kZS5hdHRyKCdsaWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRjaGVja3M9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1jb250ZW50JykuZmluZCgnLml6aC1QaW40UXVpY2tGYXZvIC50X2pjaGtib3gnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHRpbWU9NTAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjc3NTdGFydD17cG9zaXRpb246J3JlbGF0aXZlJywnYmFja2dyb3VuZC1jb2xvcic6JyMwODc0QzQnLCd6LWluZGV4JzonMTAwJ30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBjc3NFbmQ9e3Bvc2l0aW9uOicnLCdiYWNrZ3JvdW5kLWNvbG9yJzonJywnei1pbmRleCc6Jyd9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgZnVuY1JvbGxVcD1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGI9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGE9JGIucHJldigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRhLmxlbmd0aHx8KCRhLmhhc0NsYXNzKCdwaW5uZWQnKSYmcGFyc2VJbnQoJGEuYXR0cignZGF0YS1saWQnKSk8cGFyc2VJbnQoJGIuYXR0cignZGF0YS1saWQnKSkpKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5hbmltYXRlKHtib3R0b206JGEub3V0ZXJIZWlnaHQoKX0sewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246dGltZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgc3RlcDpmdW5jdGlvbihub3cpeyRiLmNzcyhjc3NTdGFydCk7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY29tcGxldGU6ZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5jc3MoJC5leHRlbmQoe2JvdHRvbTowfSxjc3NFbmQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkYi5pbnNlcnRCZWZvcmUoJGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNSb2xsVXAoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGZ1bmNSb2xsRG93bj1mdW5jdGlvbigpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGE9JGUuY2xvc2VzdCgnLnptLWZhdm8tbGlzdC1pdGVtLWxpbmsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGI9JGEubmV4dCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoISRiLmxlbmd0aHx8KCEkYi5oYXNDbGFzcygncGlubmVkJykmJnBhcnNlSW50KCRiLmF0dHIoJ2luZGV4JykpPnBhcnNlSW50KCRhLmF0dHIoJ2luZGV4JykpKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuYW5pbWF0ZSh7dG9wOiRiLm91dGVySGVpZ2h0KCl9LHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOnRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIHN0ZXA6ZnVuY3Rpb24obm93KXskYS5jc3MoY3NzU3RhcnQpO30KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsIGNvbXBsZXRlOmZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuY3NzKCQuZXh0ZW5kKHt0b3A6MH0sY3NzRW5kKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGEuaW5zZXJ0QWZ0ZXIoJGIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNSb2xsRG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihwaW5uZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmLmFkZENsYXNzKCdwaW5uZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jUm9sbFVwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5yZW1vdmVDbGFzcygncGlubmVkJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY1JvbGxEb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpWmhpaHUuUXVpY2tGYXZvLlBpbm5lZExpc3RbbGlkXT1waW5uZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlscy5zZXRDZmcoJ1F1aWNrRmF2b1Bpbm5lZCcsaVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIDsKCQkJCQkkZmF2SXRlbXMuZWFjaChmdW5jdGlvbihpLGUpewoJCQkJCQl2YXIgbGlkPWUuZ2V0QXR0cmlidXRlKCdkYXRhLWxpZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkcGluPSQoJzxhLz4nLHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdjbGFzcyc6J2l6aC1QaW40UXVpY2tGYXZvJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdsaWQnOmxpZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICdkYXRhLXRpcCc6J3MkYiTkv53mjIHlnKjjgIzlv6vpgJ/mlLbol4/jgI3oj5zljZXpobbpg6jmmL7npLonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5hcHBlbmQoJCgnPHNwYW4vPicpLmFwcGVuZCgn572u6aG2JykuYWRkKCc8aS8+Jyx7J2NsYXNzJzonem0taXRlbS10b3AtYnRuJ30pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJCgnLnpnLWdyYXknLGUpKS5hdHRyKCdpbmRleCcsaSkKICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICBlLnNldEF0dHJpYnV0ZSgnaW5kZXgnLGkpOwogICAgICAgICAgICAgICAgICAgICAgICAkcGluLmJpbmQoJ2NsaWNrJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoZWNrZWQ9IXRoaXMuY2hlY2tlZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmNQaW4odGhpcyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0aGlzLmNoZWNrZWQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJ3NwYW4nKS50ZXh0KCflj5bmtojnva7pobYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdpJykuYWRkQ2xhc3MoJ3ptLWl0ZW0tdG9wLWJ0bi1jYW5jZWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJ3NwYW4nKS50ZXh0KCfnva7pobYnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdpJykucmVtb3ZlQ2xhc3MoJ3ptLWl0ZW0tdG9wLWJ0bi1jYW5jZWwnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGV2ZW50LnByZXZlbnREZWZhdWx0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5jYW5jZWxCdWJibGU9dHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfSlbMF0uY2hlY2tlZD1mYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoaVpoaWh1LlF1aWNrRmF2by5QaW5uZWRMaXN0W2xpZF0pewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHBpbi5jbGljaygpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCX0KCX0pOwoKICAgIHJldHVybiB0aGlzOwp9CgovKioKICogQGNsYXNzIFNlYXJjaGluZ0xpc3QKICovCmZ1bmN0aW9uIFNlYXJjaGluZ0xpc3QoaVpoaWh1KSB7CiAgICBpZiAoIHR5cGVvZiBpWmhpaHUgPT09ICd1bmRlZmluZWQnIHx8ICFpWmhpaHUpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgaVpoaWh1LlNlYXJjaGluZ0xpc3QgPSB0aGlzCiAgICAKICAgIHRoaXMuJHRvcFNlYXJjaCA9ICQoJyN6aC10b3Atc2VhcmNoLWZvcm0nKQogICAgdGhpcy4kdG9wU2VhcmNoSW5wdXQgPSAkKCcjemgtdG9wLXNlYXJjaC1mb3JtID4gaW5wdXQjcScpCiAgICBpZiAoIXRoaXMuJHRvcFNlYXJjaC5sZW5ndGgpIHJldHVybgoKICAgIHRoaXMuU2VhcmNoRW5naW5lT3V0c2lkZUxpc3QgPSB7CiAgICAgICAgJ2dvb2dsZSc6IHtpY29uOidodHRwczovL3d3dy5nb29nbGUuY29tL2Zhdmljb24uaWNvJyx1cmw6J2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vP3E9c2l0ZTp6aGlodS5jb20lMjB7MH0jcT1zaXRlOnpoaWh1LmNvbSt7MH0nfQogICAgICAsICdiYWlkdSc6IHtpY29uOidodHRwOi8vd3d3LmJhaWR1LmNvbS9mYXZpY29uLmljbycsdXJsOidodHRwOi8vd3d3LmJhaWR1LmNvbS9zP3dkPXNpdGU6emhpaHUuY29tJTIwezB9J30KICAgIH0KCiAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKHRoaXMuJHRvcFNlYXJjaFswXSxmdW5jdGlvbihldmVudCl7CiAgICAgICAgdmFyIF9hID0gZXZlbnQuYWRkZWROb2RlcyB8fCBbXQogICAgICAgIGlmICghX2EubGVuZ3RoKSByZXR1cm4KICAgICAgICB1dGlscy5vYnNlcnZlRE9NTm9kZUFkZGVkKF9hWzBdLGZ1bmN0aW9uKGV2ZW50KXtjb25zb2xlLmxvZyhpWmhpaHUuY29uZmlnWydTZWFyY2hFbmdpbmVPdXRzaWRlJ10pCiAgICAgICAgICAgIHZhciBfYSA9IGV2ZW50LmFkZGVkTm9kZXMgfHwgW251bGxdCiAgICAgICAgICAgICAgLCAkaXRlbSA9ICQoX2FbMF0pCiAgICAgICAgICAgICAgLCBzZW9LZXkgPSBpWmhpaHUuY29uZmlnWydTZWFyY2hFbmdpbmVPdXRzaWRlJ10gfHwgJ2JhaWR1JwogICAgICAgICAgICAgICwgc2VvID0gaVpoaWh1LlNlYXJjaGluZ0xpc3QuU2VhcmNoRW5naW5lT3V0c2lkZUxpc3Rbc2VvS2V5XSB8fCB7aWNvbjonJyx1cmw6Jyd9CiAgICAgICAgICAgICAgLCBzdHJTZWFyY2hVcmwgPSBzZW8udXJsLnJlcGxhY2UoL1x7MFx9L2csIGZ1bmN0aW9uKCl7cmV0dXJuIGlaaGlodS5TZWFyY2hpbmdMaXN0LiR0b3BTZWFyY2hJbnB1dC52YWwoKX0pCiAgICAgICAgICAgIGNvbnNvbGUubG9nKHNlb0tleSkKICAgICAgICAgICAgaWYgKCRpdGVtLmlzKCcuYWMtcm93W3JvbGU9b3B0aW9uXScpKXsKICAgICAgICAgICAgICAgIHZhciAkYSA9ICRpdGVtLmNoaWxkcmVuKCdhJykKICAgICAgICAgICAgICAgICAgLCBocmVmID0gJGEuYXR0cignaHJlZicpCiAgICAgICAgICAgICAgICAgICwgY3NzID0gJ2Zsb2F0OnJpZ2h0O2JhY2tncm91bmQtcG9zaXRpb246LTI4NHB4IC0ycHg7JwogICAgICAgICAgICAgICAgICAsICRhTmV3ID0gJCgnPGE+Jywge2NsYXNzOid6Zy1pY29uJyxzdHlsZTpjc3MsaHJlZjpocmVmLHRhcmdldDonX2JsYW5rJyxjbGljazpmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpCiAgICAgICAgICAgICAgICAgICAgfX0pCiAgICAgICAgICAgICAgICBpZiAoaHJlZi5pbmRleE9mKCcvc2VhcmNoPycpID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgJGFOZXcuY3NzKHttYXJnaW5Ub3A6JzAuNWVtJ30pCiAgICAgICAgICAgICAgICAgICAgJGl0ZW0uYXBwZW5kKCQoJzxhPicsIHtjbGFzczonaWNvbicsc3R5bGU6J21hcmdpbi10b3A6MC41ZW07ZmxvYXQ6bGVmdCcsaHJlZjpzdHJTZWFyY2hVcmwsdGFyZ2V0OidfYmxhbmsnLGNsaWNrOmZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICAgICAgICAgICAgICB9fSkuYXBwZW5kKCQoJzxpbWc+Jywge2JvcmRlcjowLHNyYzpzZW8uaWNvbix3aWR0aDoxNixoZWlnaHQ6MTZ9KSkpCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhyZWYuaW5kZXhPZignL3F1ZXN0aW9uLycpIDwgMCkgewogICAgICAgICAgICAgICAgICAgICRhTmV3LmNzcyh7bWFyZ2luVG9wOictMS41ZW0nfSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRpdGVtLmFwcGVuZCgkYU5ldykKICAgICAgICAgICAgfQogICAgICAgIH0pCiAgICB9KQoKICAgIHJldHVybiB0aGlzCn0KCi8qKgogKiBAY2xhc3MgVG9wTmF2CiAqLwpmdW5jdGlvbiBUb3BOYXYoaVpoaWh1KSB7CiAgICBpZiAoIHR5cGVvZiBpWmhpaHUgPT09ICd1bmRlZmluZWQnIHx8ICFpWmhpaHUgfHwgIWlaaGlodS5jb25maWdbJ1RvcE5hdkF1dG9Gb2xkJ10pIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQogICAgaVpoaWh1LlRvcE5hdiA9IHRoaXMKICAgIAogICAgdGhpcy4kdG9wTmF2ID0gJCgnYm9keSA+IC56dS10b3A6Zmlyc3QnKQogICAgICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICB0aGlzLnN0eWxlLnRvcCA9ICcwJwogICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgnaXpoLW1vdXNlb3ZlcicsICcxJykKICAgICAgICAgICAgJCgnI2l6aENTU19Ob3RpTnVtJykucmVtb3ZlKCkKICAgICAgICB9KQogICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgIHRoaXMuc2V0QXR0cmlidXRlKCdpemgtbW91c2VvdmVyJywgJzAnKQogICAgICAgICAgICBpWmhpaHUuVG9wTmF2LmZ1bmNGb2xkKCkKICAgICAgICB9KQogICAgaWYgKCF0aGlzLiR0b3BOYXYubGVuZ3RoKSByZXR1cm4KCiAgICB0aGlzLnRvcE5hdkhlaWdodCA9IHRoaXMuJHRvcE5hdi5oZWlnaHQoKSAtIDUKCiAgICB0aGlzLmZ1bmNGb2xkID0gZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhciBzY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDAKICAgICAgICAgICwgX3NlbGYgPSBpWmhpaHUuVG9wTmF2CiAgICAgICAgICAsIGlzTW91c2VPdmVyID0gJzEnID09PSAoX3NlbGYuJHRvcE5hdi5hdHRyKCdpemgtbW91c2VvdmVyJykgfHwgJycpCiAgICAgICAgICAsICRoZWFkID0gJCgnaGVhZDpmaXJzdCcpCiAgICAgICAgICAsICRjc3NOb3RpTnVtID0gJCgnI2l6aENTU19Ob3RpTnVtJykKICAgICAgICAgICwgJGZsb2F0aW5nQmFyID0gJCgnYm9keSA+IC5nb29nLXNjcm9sbGZsb2F0ZXItZmxvYXRpbmcnKQogICAgICAgIGlmIChzY3JvbGxUb3AgPT09IDApIHsKICAgICAgICAgICAgX3NlbGYuJHRvcE5hdi5jc3Moe3RvcDowfSkKICAgICAgICB9IGVsc2UgaWYgKCFpc01vdXNlT3ZlcikgewogICAgICAgICAgICBpZiAoc2Nyb2xsVG9wIDwgX3NlbGYudG9wTmF2SGVpZ2h0KSB7CiAgICAgICAgICAgICAgICBfc2VsZi4kdG9wTmF2LmNzcyh7dG9wOi1zY3JvbGxUb3B9KQogICAgICAgICAgICAgICAgJGZsb2F0aW5nQmFyLmNzcyh7bWFyZ2luVG9wOi1zY3JvbGxUb3B9KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3NlbGYuJHRvcE5hdi5jc3Moe3RvcDotX3NlbGYudG9wTmF2SGVpZ2h0fSkKICAgICAgICAgICAgICAgICRmbG9hdGluZ0Jhci5jc3Moe21hcmdpblRvcDotX3NlbGYudG9wTmF2SGVpZ2h0fSkKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2Nyb2xsVG9wID4gMjApIHsKICAgICAgICAgICAgICAgIGlmICghJGNzc05vdGlOdW0ubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgJCgnPHN0eWxlPicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6ICdpemhDU1NfTm90aU51bScKICAgICAgICAgICAgICAgICAgICAgICwgdHlwZTogJ3RleHQvY3NzJwogICAgICAgICAgICAgICAgICAgIH0pLmFwcGVuZFRvKCdoZWFkOmZpcnN0JykudGV4dCgnI3poLXRvcC1uYXYtY291bnQsI3poLXRvcC1uYXYtbmV3LXBte3Bvc2l0aW9uOmFic29sdXRlO3RvcDo0MHB4O2JvcmRlci1yYWRpdXM6MCAhaW1wb3J0YW50fS50b3AtbmF2LXByb2ZpbGUgLnp1LXRvcC1uYXYtdXNlcmluZm97b3ZlcmZsb3c6dmlzaWJsZSAhaW1wb3J0YW50fScpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAkY3NzTm90aU51bS5yZW1vdmUoKQogICAgfQoKICAgIGlaaGlodS4kd2luLnNjcm9sbCh0aGlzLmZ1bmNGb2xkKQoKICAgIHRoaXMub25Ob2RlQWRkZWQgPSBmdW5jdGlvbihldmVudCl7CiAgICAgICAgaVpoaWh1LlRvcE5hdi5mdW5jRm9sZCgpCiAgICAgICAgJC5lYWNoKGV2ZW50LnJlbW92ZWROb2RlcywgZnVuY3Rpb24oaSwgZSl7CiAgICAgICAgICAgIHZhciAkZmxvYXRpbmdCYXIgPSAkKGUpLmZpbHRlcignLmdvb2ctc2Nyb2xsZmxvYXRlcicpLmNzcyh7bWFyZ2luVG9wOicnfSkKICAgICAgICB9KQogICAgfQoKICAgIHJldHVybiB0aGlzCn0KCmFsbExpbmtzID0gZnVuY3Rpb24oX25hbWUsIF9saXN0U2VsLCBfbGlzdE5hbWUpIHsKICAgIHRoaXMubmFtZSA9IF9uYW1lCiAgICB0aGlzLmxpc3RTZWwgPSBfbGlzdFNlbAogICAgdGhpcy5saXN0TmFtZSA9IF9saXN0TmFtZQogICAgdGhpcy5kbGdJRCA9ICdpemgtZGxnLScgKyBfbmFtZQogICAgdGhpcy4kZGxnID0gbnVsbAogICAgdmFyIF9pbml0aWFsVGl0bGUgPSBfbGlzdE5hbWUgKyAn5Zyw5Z2A5riF5Y2VJwogICAgICAsIF9yZXN1bHQgPSBuZXcgQXJyYXkoKQogICAgICAsIF9sb2FkVGltZXMgPSAwCgogICAgLy/liIbmnpDlhoXlrrkKICAgIHZhciBwcm9jZXNzTm9kZSA9IGZ1bmN0aW9uKGNvbnRlbnQsJGRsZyl7CiAgICAgIHZhciAkcUN1cnJlbnQgPSBudWxsOwogICAgICAkKCcuem0taXRlbS1hbnN3ZXInLCBjb250ZW50KS5lYWNoKGZ1bmN0aW9uKGluZGV4LCBpdGVtKXsKICAgICAgICB2YXIgJGEgPSAkKGl0ZW0pCiAgICAgICAgICAsICRxID0gJGEuY2xvc2VzdCgiLnptLWl0ZW0iKS5jaGlsZHJlbigiaDIiKS5jaGlsZHJlbigiYSIpCiAgICAgICAgOwogICAgICAgIGlmKCRxLmxlbmd0aCl7CiAgICAgICAgICAkcUN1cnJlbnQ9JHE7CiAgICAgICAgfWVsc2UgaWYoJHFDdXJyZW50KXsKICAgICAgICAgICRxPSRxQ3VycmVudDsKICAgICAgICB9ZWxzZXsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdmFyIGhyZWZRdWVzdGlvbiA9IHVybC5kYXRhLmF0dHJbImJhc2UiXSArICRxLmF0dHIoImhyZWYiKS5yZXBsYWNlKHVybC5kYXRhLmF0dHJbImJhc2UiXSwnJyk7CiAgICAgICAgdmFyIG9iaiA9IHsKICAgICAgICAgICAgdGl0bGU6ICRxLnRleHQoKSwKICAgICAgICAgICAgLy9xdWVzdGlvblVybDogaHJlZlF1ZXN0aW9uLAogICAgICAgICAgICBhbnN3ZXJVcmw6IGhyZWZRdWVzdGlvbiArICgkYS5wYXJlbnQoKS5pcygiLnptLWl0ZW0tZmF2IikgPyAiL2Fuc3dlci8iICsgJGEuYXR0cigiZGF0YS1hdG9rZW4iKSA6ICIiKSwKICAgICAgICAgICAgYW5zd2VyQXV0aG9yOiAkYS5maW5kKCcuem0taXRlbS1hbnN3ZXItYXV0aG9yLXdyYXAgYVtocmVmXj0iL3Blb3BsZSJdJykudGV4dCgpLnRyaW0oKSwKICAgICAgICAgICAgc3VtbWFyeTogJGEuZmluZCgiLnptLWl0ZW0tYW5zd2VyLXN1bW1hcnkiKS5jaGlsZHJlbigpLnJlbW92ZSgpLmVuZCgpLnRleHQoKSwKICAgICAgICAgICAgY29udGVudDogJGEuZmluZCgiLnptLWVkaXRhYmxlLWNvbnRlbnQiKS5odG1sKCkKICAgICAgICB9OwogICAgICAgIF9yZXN1bHQucHVzaChvYmopOwogICAgICAgIHZhciBzdHJUaXRsZSA9IHV0aWxzLmZvcm1hdFN0cignKiDjgIp7dGl0bGV944CLJiMxMzsqIHthbnN3ZXJBdXRob3J977yaJiMxMzsqIHtzdW1tYXJ5fScsIG9iaikKICAgICAgICAgICwgc3RyVVJMID0gdXRpbHMuZm9ybWF0U3RyKCd7YW5zd2VyVXJsfScsIG9iaikKICAgICAgICAgICwgJGxpID0gJCgnPGxpPicpLmFwcGVuZCgkKCc8YT4nLCB7IGhyZWY6IHN0clVSTCwgdGl0bGU6IHN0clRpdGxlIH0pLnRleHQoc3RyVVJMKSkuY3NzKHsgJ2xpc3Qtc3R5bGUtdHlwZSc6ICdub25lJyB9KQogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsJGRsZykuYXBwZW5kKCRsaSk7CiAgICAgICAgdmFyIGNvdW50PV9yZXN1bHQubGVuZ3RoOwogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1pbmZvJywkZGxnKS50ZXh0KCfvvIjliqrlipvliqDovb3kuK0uLi7lt7LlvpfliLDorrDlvZUgJyArIGNvdW50ICsgJyDmnaHvvIknKTsKICAgICAgfSk7CiAgICB9OwogICAgICAgIAogICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbihwYWdlV2FudCxwYWdlTm93LCRkbGcpewogICAgICBpZiAoIXBhZ2VOb3cpcGFnZU5vdz0xOwogICAgICBpZigkZGxnLmlzKCc6aGlkZGVuJykpewogICAgICAgIHZhciBjb3VudD1fcmVzdWx0Lmxlbmd0aDsKICAgICAgICAkKCcuaXpoaWh1LWNvbGxlY3Rpb24taW5mbycsJGRsZykudGV4dCgn77yI5Yqg6L296KKr57uI5q2iLi4u5bey5b6X5Yiw6K6w5b2VICcgKyBjb3VudCArICcg5p2h77yJJyk7CiAgICAgICAgJCgnI3poLWdsb2JhbC1zcGlubmVyJykuaGlkZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAKICAgICAgaWYocGFnZVdhbnQ9PTEpewogICAgICAgICQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsJGRsZykuZW1wdHkoKTsKICAgICAgICAkKCcjemgtZ2xvYmFsLXNwaW5uZXInKS5zaG93KCk7CiAgICAgICAgX3Jlc3VsdC5sZW5ndGg9MDsKICAgICAgICBfbG9hZFRpbWVzKys7CiAgICAgICAgJCgnLml6aGlodS1jb2xsZWN0aW9uLWluZm8nLCRkbGcpLnRleHQoJycpOwogICAgICB9CiAgICAgIHZhciAkcGFnZXI9JChfbGlzdFNlbCkucGFyZW50KCkuZmluZCgnLnptLWludml0ZS1wYWdlcicpCiAgICAgICAgLCAkbGFzdFBhZ2U9JHBhZ2VyLmNoaWxkcmVuKCdzcGFuJykubGFzdCgpLnByZXYoKQogICAgICAgICwgdG90YWxDb3VudD0kcGFnZXIubGVuZ3RoPT0wPzE6TnVtYmVyKCRsYXN0UGFnZS50ZXh0KCkpCiAgICAgIDsKICAgICAgaWYocGFnZVdhbnQ+dG90YWxDb3VudCl7CiAgICAgICAgJCgnLml6aGlodS1jb2xsZWN0aW9uLWluZm8nLCRkbGcpLnRleHQoJ++8iOWKoOi9veWujOaIkO+8jOWFseW+l+WIsOiusOW9lSAnICsgX3Jlc3VsdC5sZW5ndGggKyAnIOadoe+8iScpOwogICAgICAgICQoJyN6aC1nbG9iYWwtc3Bpbm5lcicpLmhpZGUoKTsKICAgICAgICAkKCcuc2VsQWxsJywkZGxnKS5jbGljaygpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhZ2VOZXh0PXBhZ2VXYW50KzE7CiAgICAgIGlmKHBhZ2VXYW50PT1wYWdlTm93KXsKICAgICAgICBwcm9jZXNzTm9kZSgkKF9saXN0U2VsKS5odG1sKCksJGRsZyk7CiAgICAgICAgaGFuZGxlcihwYWdlTmV4dCxwYWdlTm93LCRkbGcpCiAgICAgIH1lbHNlewogICAgICAgIHZhciBfdXJsPXVybC5kYXRhLmF0dHJbJ2Jhc2UnXSt1cmwuZGF0YS5hdHRyWydwYXRoJ10rJz9wYWdlPScrcGFnZVdhbnQ7CiAgICAgICAgJC5hamF4KF91cmwse3R5cGU6J2dldCcsY29udGV4dDp7bG9hZFRpbWVzOl9sb2FkVGltZXN9fSkuZG9uZShmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgaWYodGhpcy5sb2FkVGltZXMhPV9sb2FkVGltZXMpcmV0dXJuOwogICAgICAgICAgcHJvY2Vzc05vZGUocmVzdWx0LCRkbGcpOwogICAgICAgICAgaGFuZGxlcihwYWdlTmV4dCxwYWdlTm93LCRkbGcpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy/liJ3lp4vljJblvLnlh7rmoYYKICAgIHRoaXMuaW5pdERpYWxvZyA9IGZ1bmN0aW9uKCl7CiAgICAgICAgdGhpcy4kZGxnPSQoJyMnK3RoaXMuZGxnSUQpOwogICAgICAgIHZhciByZXRWYWw9MDx0aGlzLiRkbGcubGVuZ3RoOwogICAgICAgIGlmKCFyZXRWYWwpewogICAgICAgICAgICB0aGlzLiRkbGcgPSAkKCc8ZGl2PicsIHsgaWQ6IHRoaXMuZGxnSUQsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2cgYWxsTGlua3MnLCB0YWJpbmRleDogJzAnLCBzdHlsZTogJ2Rpc3BsYXk6IG5vbmU7d2lkdGg6NTAwcHgnLCBuYW1lOiBfbmFtZSwgJ2xpc3RTZWwnOiBfbGlzdFNlbCB9KQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZSBtb2RhbC1kaWFsb2ctdGl0bGUtZHJhZ2dhYmxlJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgeyAnY2xhc3MnOiAnbW9kYWwtZGlhbG9nLXRpdGxlLXRleHQnIH0pLnRleHQoX2luaXRpYWxUaXRsZSkpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctdGl0bGUtdGV4dCBpemhpaHUtY29sbGVjdGlvbi1pbmZvJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZS1jbG9zZScKICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3poLWdsb2JhbC1zcGlubmVyJykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuaGlkZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5tb2RhbC1kaWFsb2cnKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy1jb250ZW50JyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctc2VjdGlvbicgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdpemhpaHUtY29sbGVjdGlvbi1saW5rcyB6Zy1mb3JtLXRleHQtaW5wdXQnLCB0YWJJbmRleDogJy0xJywgc3R5bGU6ICdoZWlnaHQ6MzAwcHg7b3ZlcmZsb3cteTpzY3JvbGw7b3V0bGluZTpub25lOycgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxmb3JtPicsIHsgYWN0aW9uOiAnaHR0cDovL2lsb3ZlemhpaHUuZHVhcHAuY29tL3NhdmVNZS5weScsIG1ldGhvZDogJ3Bvc3QnLCB0YXJnZXQ6ICdfYmxhbmsnLCBzdHlsZTogJ2Rpc3BsYXk6bm9uZScgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZXh0YXJlYT4nLCB7IHN0eWxlOiAid2lkdGg6IDEwMCU7IiwgbmFtZTogImxpbmtzIiwgJ2NsYXNzJzogIml6aGlodS1jb2xsZWN0aW9uLWxpbmtzLXBvc3QiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgbmFtZTogJ3RpdGxlJyB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnem0tY29tbWFuZCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICd6Zy1sZWZ0JyB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiAnemctYnRuLWJsdWUgcmVsb2FkJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCBocmVmOiAnamF2YXNjcmlwdDp2b2lkKDApOycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRkID0gJCh0aGlzKS5jbG9zZXN0KCcubW9kYWwtZGlhbG9nJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZXIoMSwgTnVtYmVyKHVybC5kYXRhLnBhcmFtLnF1ZXJ5WydwYWdlJ10pLCAkZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRleHQoJ+mHjeaWsOiOt+WPlicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWJ0bi1ibHVlIHNhdmUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgaHJlZjogJ2phdmFzY3JpcHQ6dm9pZCgwKTsnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGRsZyA9ICQodGhpcykuY2xvc2VzdCgnLm1vZGFsLWRpYWxvZy1jb250ZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rcyA9ICRkbGcuZmluZCgnLml6aGlodS1jb2xsZWN0aW9uLWxpbmtzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rc1Bvc3QgPSAkZGxnLmZpbmQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcy1wb3N0JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRsaW5rc1RpdGxlID0gJGxpbmtzUG9zdC5uZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmb3JtID0gJGxpbmtzUG9zdC5wYXJlbnQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgbGlua3MgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRsaW5rcy5maW5kKCdsaSBhJykuZWFjaChmdW5jdGlvbihpLCBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rcyArPSBlLmdldEF0dHJpYnV0ZSgnaHJlZicpICsgJ1xuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbGlua3NQb3N0LnZhbChsaW5rcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxpbmtzVGl0bGUudmFsKCQoJyN6aC1mYXYtaGVhZC10aXRsZSwuem0tcHJvZmlsZS1oZWFkZXItbWFpbiAudGl0bGUtc2VjdGlvbiBhLm5hbWUnKS50ZXh0KCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtLnN1Ym1pdCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGV4dCgn5L+d5a2YJykpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApLmFwcGVuZFRvKGRvY3VtZW50LmJvZHkpCiAgICAgICAgICAgICAgICAuZHJhZ2dhYmxlKHsgaGFuZGxlOiAnLm1vZGFsLWRpYWxvZy10aXRsZS1kcmFnZ2FibGUnIH0pCgogICAgICAgICAgICBpZih0aGlzLiRkbGcubGVuZ3RoKQogICAgICAgICAgICAgICAgcmV0VmFsID0gdHJ1ZQoKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJldFZhbAogICAgfQoKICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbigkZCkgewogICAgICAgIGlmICgkKCcjemgtZ2xvYmFsLXNwaW5uZXI6dmlzaWJsZScpLmxlbmd0aCkgcmV0dXJuCiAgICAgICAgaWYgKCEkZCkgJGQgPSB0aGlzLiRkbGcKICAgICAgICBpZiAoISRkKSByZXR1cm4KICAgICAgICBpZiAoISQoJy5pemhpaHUtY29sbGVjdGlvbi1saW5rcycsICRkKS5jaGlsZHJlbigpLmxlbmd0aCkgewogICAgICAgICAgICBoYW5kbGVyKDEsIE51bWJlcih1cmwuZGF0YS5wYXJhbS5xdWVyeVsncGFnZSddKSwgJGQpCiAgICAgICAgfQogICAgfQoKfQoKLyoqCiAqIOWbnuetlOmhtQogKi8KCiAgaWYocGFnZUlzLkFuc3dlcil7Cgp2YXIgJGxibFF1ZXN0aW9uTWV0YT0kKCcjemgtcXVlc3Rpb24tbWV0YS13cmFwJykvL3F1ZXN0aW9uX21ldGEKOwoKICAgIHZhciAkcXVlc3Rpb25XcmFwPSQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKTsKICAgICRxdWVzdGlvbldyYXAuY2hpbGRyZW4oJy5wYW5lbC1jb250YWluZXInKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB3aW5kb3cuaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgIH0pOwogICAgaWYod2luZG93LmlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgLy8kcXVlc3Rpb25XcmFwLmNoaWxkcmVuKCcubWV0YS1pdGVtW25hbWU9YWRkY29tbWVudF0nKS5wcmVwZW5kVG8oJHF1ZXN0aW9uV3JhcCk7CiAgICAgICAgd2luZG93LmlaaGlodS5Db21tZW50LnByb2Nlc3NDb21tZW50QnV0dG9uKCRxdWVzdGlvbldyYXApOwogICAgICAgIGlmKCEkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykubGVuZ3RoKXsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidpemhfYm94U2hhZG93JyxpZDonaXpoX1F1ZXN0aW9uU2hhZG93J30pLmNzcyh7CiAgICAgICAgICAgICAgICAnei1pbmRleCc6ICctMScKICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdyZWxhdGl2ZScKICAgICAgICAgICAgICAsICd0b3AnOiAtMjUKICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6IC0zMgogICAgICAgICAgICB9KS5wcmVwZW5kVG8oJ2JvZHk+Lnp1LW1haW46Zmlyc3QnKS5oaWRlKCk7CiAgICAgICAgfSAgIAogICAgfQoKICAgIC8vcHJvY2VzcyBlYWNoIGFuc3dlcgogICAgdmFyICRsaXN0QW5zd2Vycz0kKCcuem0taXRlbS1hbnN3ZXIsLmZlZWQtaXRlbScsJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCcpOwogICAgaWYoJGxpc3RBbnN3ZXJzJiYkbGlzdEFuc3dlcnMubGVuZ3RoKXsKICAgICAgICAkbGlzdEFuc3dlcnMuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCQoZSksbnVsbAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgZmFsc2UpOwogICAgICAgIH0pOwogICAgfQoKICAgICQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCcpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgIHZhciAkbmE9JChldmVudC50YXJnZXQpLmZpbHRlcignLnptLWl0ZW0tYW5zd2VyJyk7CiAgICAgICAgaWYoJG5hLmxlbmd0aCl7CiAgICAgICAgICAgIHdpbmRvdy5pWmhpaHUuQW5zd2VyLnByb2Nlc3NBbnN3ZXIoJG5hLG51bGwKICAgICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICAgLCBmYWxzZSk7CiAgICAgICAgfQogICAgfSk7CgogICAgdmFyICRjbT0kKCcuem0tY29tbWVudC1ib3gnLCRxdWVzdGlvbldyYXApOwogICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgCXZhciBmb2N1c05hbWUgPSBpWmhpaHUuQ29tbWVudC5zY3JvbGxGb2N1c0NvbW1lbnRPblBhZ2VMb2FkKCRjbSk7CgogICAgCWlaaGlodS5Db21tZW50Lm1ldGFTY3JvbGxUb1ZpZXdCb3R0b20oJGNtLmNsb3Nlc3QoJy56bS1pdGVtLW1ldGEnKSxmdW5jdGlvbigpewogICAgICAgICAgICBpWmhpaHUuQ29tbWVudC5wcm9jZXNzQ29tbWVudCgkY20sIGZvY3VzTmFtZSk7CiAgICAgICAgfSk7CiAgICB9CiAgfQoKLyoqCiAqIOaUtuiXj+mhtQogKi8KICBpZihwYWdlSXMuQ29sbGVjdGlvbil7CiAgICAvL+a3u+WKoOaMiemSrgogICAgJCgnI3poLWxpc3QtbWV0YS13cmFwJykKICAgICAgLmFwcGVuZCgkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6ICd6Zy1idWxsJyB9KS50ZXh0KCfigKInKSkKICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7IGhyZWY6ICdqYXZhc2NyaXB0OjsnLCBpZDogJ2dldEFsbExpbmtzJyB9KS50ZXh0KCflnLDlnYDmuIXljZUnKSk7CgogICAgdmFyIGJ0biA9ICQoJyNnZXRBbGxMaW5rcycpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIAogICAgLy/ms6jlhozngrnlh7vkuovku7YKICAgIGJ0bi5jbGljayhmdW5jdGlvbigpewogICAgICB2YXIgYWxsTGlua3NDb2xsZWN0aW9uPW5ldyBhbGxMaW5rcygnQ29sbGVjdGlvbnMnLCcjemgtbGlzdC1hbnN3ZXItd3JhcCcsJ+aUtuiXj+WkueWGheWuuScpOwoJICBpZighYWxsTGlua3NDb2xsZWN0aW9uLmluaXREaWFsb2coKSlyZXR1cm47CiAgICAgICQoJy5tb2RhbC1kaWFsb2ctYmcnKS5zaG93KCk7CiAgICAgIHZhciB5ID0gKCR3aW4uaGVpZ2h0KCkgLSBhbGxMaW5rc0NvbGxlY3Rpb24uJGRsZy53aWR0aCgpKSAvIDIKICAgICAgICAsIHggPSAoJHdpbi53aWR0aCgpIC0gYWxsTGlua3NDb2xsZWN0aW9uLiRkbGcud2lkdGgoKSkgLyAyCiAgICAgIDsKICAgICAgYWxsTGlua3NDb2xsZWN0aW9uLiRkbGcuY3NzKHsndG9wJzogeSwgJ2xlZnQnOiB4fSkuZmFkZUluKCdzbG93Jyk7CiAgICAgIGFsbExpbmtzQ29sbGVjdGlvbi5zdGFydCgpOwogICAgfSk7CiAgfQogIGlmKHBhZ2VJcy5BbnN3ZXJzKXsKICAgIC8v5re75Yqg5oyJ6ZKuCiAgICAkKCcuem0tcHJvZmlsZS1zZWN0aW9uLW5hbWUnKQogICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ3pnLWJ1bGwnIH0pLnRleHQoJ+KAoicpKQogICAgICAuYXBwZW5kKCQoJzxhPicsIHsgaHJlZjogJ2phdmFzY3JpcHQ6OycsIGlkOiAnZ2V0QWxsTGlua3MnIH0pLnRleHQoJ+WcsOWdgOa4heWNlScpKTsKCiAgICB2YXIgYnRuID0gJCgnI2dldEFsbExpbmtzJyk7CiAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgCiAgICAvL+azqOWGjOeCueWHu+S6i+S7tgogICAgYnRuLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgIHZhciBhbGxMaW5rc0Fuc3dlcnM9bmV3IGFsbExpbmtzKCdBbnN3ZXJzJywnI3poLXByb2ZpbGUtYW5zd2VyLWxpc3QnLCfnlKjmiLflm57nrZQnKTsKCSAgaWYoIWFsbExpbmtzQW5zd2Vycy5pbml0RGlhbG9nKCkpcmV0dXJuOwogICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuc2hvdygpOwogICAgICB2YXIgeSA9ICgkd2luLmhlaWdodCgpIC0gYWxsTGlua3NBbnN3ZXJzLiRkbGcud2lkdGgoKSkgLyAyCiAgICAgICAgLCB4ID0gKCR3aW4ud2lkdGgoKSAtIGFsbExpbmtzQW5zd2Vycy4kZGxnLndpZHRoKCkpIC8gMgogICAgICA7CiAgICAgIGFsbExpbmtzQW5zd2Vycy4kZGxnLmNzcyh7J3RvcCc6IHksICdsZWZ0JzogeH0pLmZhZGVJbignc2xvdycpOwogICAgICBhbGxMaW5rc0Fuc3dlcnMuc3RhcnQoKTsKICAgIH0pOwogIH0KCiAgaWYocGFnZUlzLk15Q29sbGVjdGlvbiYmd2luZG93LmlaaGlodS5RdWlja0Zhdm8pewogICAgdmFyICRmYXZJdGVtcz0kKCcjemgtZmF2bGlzdHMtd3JhcCcpLmNoaWxkcmVuKCcuem0taXRlbScpOwogICAgJGZhdkl0ZW1zLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgIH0pOwogIH0KCi8qCiAqIOmmlumhtQogKi8KICAgIHZhciAkdG9wc3Rvcnk9JCgnI2lzLXRvcHN0b3J5MicpCiAgICAgICwgaXNUb3BTdG9yeT0kdG9wc3RvcnkmJiR0b3BzdG9yeS5sZW5ndGgKICAgICAgLCBwcm9wRmVlZFR5cGU9J2RhdGEtdHlwZScvLzonZGF0YS1mZWVkdHlwZScKICAgICAgLCAkbGJsSG9tZVRpdGxlPSQoJyN6aC1ob21lLWxpc3QtdGl0bGUnKS8vYWN0aXZpdHlfY2FwdGlvbgogICAgICAsICRidG5OZXdBY3Rpdml0eT0kKCcjemgtbWFpbi1mZWVkLWZyZXNoLWJ1dHRvbicpLy9uZXdfYWN0aXZpdHkKICAgICAgLCAkZmVlZExpc3Q9JCgnLnpoLWdlbmVyYWwtbGlzdCcpLy9mZWVkX2xpc3QKICAgICAgLCAkdG9wTGlua0hvbWU9JCgnI3poLXRvcC1saW5rLWhvbWUnKQogICAgICAsICRmaWx0ZXI9Ly9pc1RvcFN0b3J5PwogICAgICAgICAgICAkKCc8c3Bhbj4nLCB7ICdjbGFzcyc6J2l6aC1mZWVkcy1maWx0ZXInIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgJ2NsYXNzJzogJ2l6aC1idXR0b24gaXpoLWZlZWRzLWZpbHRlci1vcHRpb24nLCAnc2hvd0ZlZWRzJzogJ3EnIH0pCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfpl67popgnKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdjbGFzcyc6ICdpemgtYnV0dG9uIGl6aC1mZWVkcy1maWx0ZXItb3B0aW9uJywgJ3Nob3dGZWVkcyc6ICdhJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnemctaWNvbicgfSkpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5Zue562UJykKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnY2xhc3MnOiAnaXpoLWJ1dHRvbiBpemgtZmVlZHMtZmlsdGVyLW9wdGlvbicsICdzaG93RmVlZHMnOiAncCxyJywgJ2RhdGEtdGlwJzogJ3MkdCTkuJPmoI/jgIHlnIbmoYwnIH0pCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uJyB9KSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCflhbbku5YnKQogICAgICAgICAgICAgICAgKQogICAgICAsICRmaWx0ZXJJbmZvPSQoJzxhPicseydjbGFzcyc6J2l6aC1mZWVkcy1maWx0ZXItaW5mbyBub3RoaW5nJyxocmVmOidqYXZhc2NyaXB0OnZvaWQoMCk7J30pLm9uKCdjbGljaycsZnVuY3Rpb24oKXskZmlsdGVyLnRyaWdnZXIoJGZpbHRlci5pcygnOmhpZGRlbicpfHwkZmlsdGVyLmF0dHIoJ2RvaW5nJyk9PSdoaWRlJz8nc2hvdyc6J2hpZGUnKTt9KQogICAgICAsIFNob3dGZWVkcz1mdW5jdGlvbih0eXBlLGVuYWJsZSl7CiAgICAgICAgICAgIHZhciBpZD0iaXpoQ1NTX0ZpbHRlckZlZWRfIit0eXBlCiAgICAgICAgICAgICAgLCBuZD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkKICAgICAgICAgICAgOwogICAgICAgICAgICBpZihlbmFibGUpewogICAgICAgICAgICAgICAgaWYobmQpbmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuZCk7CiAgICAgICAgICAgIH1lbHNlIGlmKGhlYWRzLmxlbmd0aCl7CiAgICAgICAgICAgICAgICBpZighbmQpewogICAgICAgICAgICAgICAgICAgIG5kPV9kb2MuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgICAgICAgICBuZC50eXBlPSd0ZXh0L2Nzcyc7CiAgICAgICAgICAgICAgICAgICAgbmQuaWQ9aWQ7CiAgICAgICAgICAgICAgICAgICAgbmQuYXBwZW5kQ2hpbGQoX2RvYy5jcmVhdGVUZXh0Tm9kZSgnLmZlZWQtaXRlbVsnK3Byb3BGZWVkVHlwZSsnXj0iJyt0eXBlKyciXXtkaXNwbGF5Om5vbmV9JykpOwogICAgICAgICAgICAgICAgICAgIGhlYWRzWzBdLmFwcGVuZENoaWxkKG5kKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8ve1JPVU5EVEFCTEVfQUREX1JFTEFURUQ6ICJyb3VuZHRhYmxlIixBUlRJQ0xFX1ZPVEVfVVA6ICJwb3N0X3ZvdGUiLEFSVElDTEVfQ1JFQVRFOiAicG9zdF9jcmVhdGUiLFJFQ09NTUVOREVEOiAiZmVlZF9yZWNvbW1lbmRlZCIsUVVFU1RJT05fRk9MTE9XOiAiZmVlZF9xdWVzdGlvbl9mb2xsb3ciLFFVRVNUSU9OX0NSRUFURTogImZlZWRfcXVlc3Rpb24iLEFOU1dFUl9WT1RFX1VQOiAiZmVlZF9hbnN3ZXJfdm90ZSIsQU5TV0VSX0NSRUFURTogImZlZWRfYW5zd2VyX2Fuc3dlciJ9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAsIHJlZnJlc2hGaWx0ZXJJbmZvPWZ1bmN0aW9uKCl7CiAgICAgICAgICAgIHZhciBjb3VudD0kZmVlZExpc3QuY2hpbGRyZW4oJy5mZWVkLWl0ZW06aGlkZGVuJykubGVuZ3RoCiAgICAgICAgICAgICAgLCBpbmZvPScgPui/h+a7pOmAiemhuTwnCiAgICAgICAgICAgIDsKICAgICAgICAgICAgaWYoY291bnQpewogICAgICAgICAgICAgICAgaW5mbz0n77yIJytjb3VudCsn5p2h5Yqo5oCB6KKr6ZqQ6JeP77yJJzsKICAgICAgICAgICAgICAgICRmaWx0ZXJJbmZvLnJlbW92ZUNsYXNzKCdub3RoaW5nJykuY3NzKHtkaXNwbGF5OicnfSk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGZpbHRlckluZm8uYWRkQ2xhc3MoJ25vdGhpbmcnKTsKICAgICAgICAgICAgfSAgIAogICAgICAgICAgICAkZmlsdGVySW5mby50ZXh0KGluZm8pOwogICAgICAgIH0KICAgICAgLCBmZWVkc0NvbHVtbnM9ZnVuY3Rpb24oKXsgLy8gSW1wbGVtZW50ZWQgYnkgbW9ybGV5LCBtb2RpZmllZCBieSB1bm9negogICAgICAgICAgICAvL+WKqOaAgeeahOexu+WeiwogICAgICAgICAgICB2YXIgZmVlZFR5cGVzID0gLy9pc1RvcFN0b3J5PwogICAgICAgICAgICAgICAgW3sKICAgICAgICAgICAgICAgICBpbmRleDogMCwKICAgICAgICAgICAgICAgICBuYW1lOiAn5YWo6YOoJywKICAgICAgICAgICAgICAgICBjb2RlTmFtZTogJycKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICBpbmRleDogMSwKICAgICAgICAgICAgICAgICBuYW1lOiAn6Zeu6aKYJywKICAgICAgICAgICAgICAgICBjb2RlTmFtZTogJ3EnCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgaW5kZXg6IDIsCiAgICAgICAgICAgICAgICAgbmFtZTogJ+WbnuetlCcsCiAgICAgICAgICAgICAgICAgY29kZU5hbWU6ICdhJwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgIGluZGV4OiAzLAogICAgICAgICAgICAgICAgIG5hbWU6ICfkuJPmoI8nLAogICAgICAgICAgICAgICAgIGNvZGVOYW1lOiAncCcKICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAKICAgICAgICAgICAgLy/oh6rlrprkuYkgQ1NTIOWIsCBoZWFkCiAgICAgICAgICAgIHZhciBzdHlsZXMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0eWxlcy5wdXNoKCcuemEtZmlsdGVye2Rpc3BsYXk6IGlubGluZS1ibG9jazttYXJnaW4tcmlnaHQ6MTBweDtjdXJzb3I6cG9pbnRlcjtjb2xvcjojOTk5O30nKTsKICAgICAgICAgICAgc3R5bGVzLnB1c2goJy56YS1maWx0ZXIuYWN0aXZle2NvbG9yOiMyNTk7fScpOwogICAgICAgICAgICBzdHlsZXMucHVzaCgnLnphLWZpbHRlcj4uemctbnVtLmhpZGV7ZGlzcGxheTpub25lO30nKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICQoJzxzdHlsZS8+JykudGV4dChzdHlsZXMuam9pbignJykpLmFwcGVuZFRvKCdoZWFkJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICB2YXIgJHpoSG9tZUxpc3RUaXRsZSA9ICRsYmxIb21lVGl0bGU7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+agueaNruexu+Wei+a3u+WKoOi/h+a7pOaMiemSriDliLAgI3poLWhvbWUtbGlzdC10aXRsZQogICAgICAgICAgICB2YXIgZmlsdGVyQnRucyA9IFtdCiAgICAgICAgICAgICAgLCBpID0gZmVlZFR5cGVzLmxlbmd0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgIGZpbHRlckJ0bnMucHVzaCgKICAgICAgICAgICAgICAgICAkKCc8c3Bhbj4nKS5hZGRDbGFzcygnemEtZmlsdGVyJykKICAgICAgICAgICAgICAgICAuYXR0cigndHlwZUluZGV4JywgZmVlZFR5cGVzW2ldLmluZGV4KQogICAgICAgICAgICAgICAgIC50ZXh0KGZlZWRUeXBlc1tpXS5uYW1lKQogICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgeyAnY2xhc3MnOiAnemctbnVtJyB9KS5hZGRDbGFzcygnaGlkZScpKQogICAgICAgICAgICAgICAgIC5vbignY2xpY2snLCB0b2dnbGVGZWVkVHlwZSkKICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbHRlckJ0bnMucmV2ZXJzZSgpOwogICAgICAgICAgICBmaWx0ZXJCdG5zWzBdLmFkZENsYXNzKCdhY3RpdmUnKTsKCiAgICAgICAgICAgICR6aEhvbWVMaXN0VGl0bGUuY29udGVudHMoKS5maWx0ZXIoZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgIHJldHVybiAoZSE9bnVsbCYmKGUubm9kZVZhbHVlfHwnJykuaW5kZXhPZign5pyA5paw5Yqo5oCBJyk+PTApCiAgICAgICAgICAgIH0pLnJlbW92ZSgpCiAgICAgICAgICAgICR6aEhvbWVMaXN0VGl0bGUuZmluZCgnaScpLmVxKDApLmFmdGVyKGZpbHRlckJ0bnMpLnJlbW92ZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgdmFyICR0YXJnZXRaZXJvID0gZmlsdGVyQnRuc1swXS5maW5kKCcuemctbnVtJykKICAgICAgICAgICAgICAsIGN1cmZlZWRUeXBlQ29kZU5hbWUgPSAnJwogICAgICAgICAgICAKICAgICAgICAgICAgZnVuY3Rpb24gdHlwZU1hdGNoKCRlbGVtKSB7CiAgICAgICAgICAgICBpZiAoY3VyZmVlZFR5cGVDb2RlTmFtZSA9PSAnJykgewogICAgICAgICAgICAgICAgICRlbGVtLnNob3coKTsKICAgICAgICAgICAgIH0gZWxzZSBpZiAoMCA8PSAkZWxlbS5hdHRyKHByb3BGZWVkVHlwZSkuaW5kZXhPZihjdXJmZWVkVHlwZUNvZGVOYW1lKSkgewogICAgICAgICAgICAgICAgICRlbGVtLnNob3coKTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgJGVsZW0uaGlkZSgpOwogICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+aMiemSruS6i+S7tgogICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVGZWVkVHlwZSgpIHsKICAgICAgICAgICAgIHZhciAkY2xpY2tlZCA9ICQodGhpcyk7CiAgICAgICAgICAgICAkY2xpY2tlZE51bSA9ICRjbGlja2VkLmZpbmQoJy56Zy1udW0nKTsKICAgICAgICAgICAgIC8vIOS6pOS6kuaViOaenAogICAgICAgICAgICAgZmlsdGVyQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHsKICAgICAgICAgICAgICAgICBpdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTsKICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgICRjbGlja2VkLmFkZENsYXNzKCdhY3RpdmUnKTsKICAgICAgICAgICAgCiAgICAgICAgICAgICBpZiAoJGNsaWNrZWQuYXR0cigndHlwZUluZGV4JykgPT0gMCkgewogICAgICAgICAgICAgICAgICQoJy56Zy1udW0nLCAnLnphLWZpbHRlcicpLnRleHQoJycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgIHZhciB0b3RhbFVucmVhZCA9IChwYXJzZUludCgkdGFyZ2V0WmVyby50ZXh0KCkpIHx8IDApIC0gKHBhcnNlSW50KCRjbGlja2VkTnVtLnRleHQoKSkgfHwgMCk7CiAgICAgICAgICAgICAgICAgaWYgKHRvdGFsVW5yZWFkICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFplcm8udGV4dCh0b3RhbFVucmVhZCk7CiAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgJHRhcmdldFplcm8udGV4dCgnJykuYWRkQ2xhc3MoJ2hpZGUnKTsKICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICRjbGlja2VkTnVtLnRleHQoJycpLmFkZENsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBjdXJmZWVkVHlwZUNvZGVOYW1lID0gZmVlZFR5cGVzWyRjbGlja2VkLmF0dHIoJ3R5cGVJbmRleCcpXS5jb2RlTmFtZTsKICAgICAgICAgICAgIC8vIOS/oeaBr+a1gei/h+a7pAogICAgICAgICAgICAgJCgnLmZlZWQtaXRlbScpLmVhY2goZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgdHlwZU1hdGNoKCQodGhpcykpOwogICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFR5cGVJbmRleEJ5Q29kZU5hbWUoY29kZU5hbWUpIHsKICAgICAgICAgICAgIHZhciBpID0gZmVlZFR5cGVzLmxlbmd0aDsKICAgICAgICAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICAgICAgICAgICBpZiAoY29kZU5hbWUgPT0gZmVlZFR5cGVzW2ldLmNvZGVOYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpOwogICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHZhciBNdXRhdGlvbk9ic2VydmVyID0gd2luZG93Lk11dGF0aW9uT2JzZXJ2ZXIgfHwgd2luZG93LldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CiAgICAgICAgICAgIAogICAgICAgICAgICAvL+ebkeWQrOaOqOmAgQogICAgICAgICAgICB2YXIgaGFzTmV3RmVlZCA9IGZhbHNlOwogICAgICAgICAgICAvL2NyZWF0ZSBhbiBvYnNlcnZlciBpbnN0YW5jZQogICAgICAgICAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHsKICAgICAgICAgICAgIGlmICggISEgcGFyc2VJbnQoJGJ0bk5ld0FjdGl2aXR5LnRleHQoKSkpIHsKICAgICAgICAgICAgICAgICBtdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICBpZiAobXV0YXRpb24udHlwZSA9PT0gJ2NoaWxkTGlzdCcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdIYXMgTmV3IEZlZWQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOacieaWsOaOqOmAgeWImeinpuWPkeS5iwogICAgICAgICAgICAgICAgICAgICAgICAgaGFzTmV3RmVlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAkYnRuTmV3QWN0aXZpdHkudGV4dCgnJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAkLndoZW4oJGJ0bk5ld0FjdGl2aXR5WzBdLmNsaWNrKCkpLmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGFzTmV3RmVlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy9wYXNzIGluIHRoZSB0YXJnZXQgbm9kZSwgYXMgd2VsbCBhcyB0aGUgb2JzZXJ2ZXIgb3B0aW9ucwogICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKAogICAgICAgICAgICAgJGJ0bk5ld0FjdGl2aXR5WzBdLCB7CiAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlCiAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8v55uR5ZCs5o+S5YWlCiAgICAgICAgICAgICRmZWVkTGlzdC5vbigiRE9NTm9kZUluc2VydGVkIiwgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgdmFyICRzZWxmID0gJChlLnRhcmdldCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAgaWYgKCRzZWxmLmhhc0NsYXNzKCdmZWVkLWl0ZW0nKSkgewogICAgICAgICAgICAgICAgIGlmIChoYXNOZXdGZWVkKSB7CiAgICAgICAgICAgICAgICAgICAgICRzZWxmLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgdmFyICR0YXJnZXQgPSBmaWx0ZXJCdG5zW2dldFR5cGVJbmRleEJ5Q29kZU5hbWUoJHNlbGYuYXR0cihwcm9wRmVlZFR5cGUpKV0uZmluZCgnLnpnLW51bScpOwogICAgICAgICAgICAgICAgICAgICAkdGFyZ2V0LnRleHQoKHBhcnNlSW50KCR0YXJnZXQudGV4dCgpKSB8fCAwKSArIDEpLnJlbW92ZUNsYXNzKCdoaWRlJyk7CiAgICAgICAgICAgICAgICAgICAgICR0YXJnZXRaZXJvLnRleHQoKHBhcnNlSW50KCR0YXJnZXRaZXJvLnRleHQoKSkgfHwgMCkgKyAxKS5yZW1vdmVDbGFzcygnaGlkZScpOwogICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgIHR5cGVNYXRjaCgkc2VsZik7CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAsIGhvbWVGZWVkcz1mdW5jdGlvbihpemhIb21lRmVlZHNDb2x1bW5zKXsKICAgICAgICAgICAgaWYgKGl6aEhvbWVGZWVkc0NvbHVtbnMpewogICAgICAgICAgICAgICAgZmVlZHNDb2x1bW5zKCk7CiAgICAgICAgICAgIH1lbHNlewogICAgICAgICAgICAgICAgJGZpbHRlci5jaGlsZHJlbignLml6aC1mZWVkcy1maWx0ZXItb3B0aW9uJykuYWRkQ2xhc3MoJ29uJykuY2xpY2soZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgIHZhciBpPTAKICAgICAgICAgICAgICAgICAgICAgICwgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgLCBmcz0kZS5hdHRyKCdzaG93RmVlZHMnKQogICAgICAgICAgICAgICAgICAgICAgLCBmYT1mcy5zcGxpdCgnLCcpCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICQoJy5pemgtZmVlZHMtZmlsdGVyLW9wdGlvbltzaG93RmVlZHM9IicrZnMrJyJdJykudG9nZ2xlQ2xhc3MoJ29uJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yKDtpPGZhLmxlbmd0aDtpKyspewogICAgICAgICAgICAgICAgICAgICAgICBTaG93RmVlZHMoZmFbaV0sJGUuaXMoJy5vbicpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVmcmVzaEZpbHRlckluZm8oKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaWYoJHRvcExpbmtIb21lLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgdmFyICRmaWx0ZXIyPSQoJzxkaXY+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3Moe3Bvc2l0aW9uOidhYnNvbHV0ZScsYm9yZGVyOicxcHggc29saWQgIzc3NycsYmFja2dyb3VuZENvbG9yOicjZmZmJ30pLmhpZGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkZmlsdGVyLmNsb25lKHRydWUsdHJ1ZSkuY3NzKHtkaXNwbGF5OidibG9jayd9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignc2hvdycsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaXMoJzpoaWRkZW4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuY3NzKHtkaXNwbGF5OicnLG9wYWNpdHk6MH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYW5pbWF0ZSh7b3BhY2l0eToxfSwnc2xvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vbignaGlkZScsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuZmFkZU91dCgnc2xvdycpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgJHRvcExpbmtIb21lLmFmdGVyKCRmaWx0ZXIyKS5wYXJlbnQoKQogICAgICAgICAgICAgICAgICAgICAgICAub24oJ21vdXNlZW50ZXInLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICwgJGY9JGUuY2hpbGRyZW4oKS5sYXN0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmLnRyaWdnZXIoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRmaWx0ZXJJbmZvLmZpbHRlcignLm5vdGhpbmcnKS5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZj0kZS5jaGlsZHJlbigpLmxhc3QoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGYudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZpbHRlckluZm8uZmlsdGVyKCcubm90aGluZycpLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZigkbGJsSG9tZVRpdGxlLmxlbmd0aCl7CiAgICAgICAgICAgICAgICAgICAgJGZpbHRlckluZm8uY3NzKHsKICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheTonbm9uZScKICAgICAgICAgICAgICAgICAgICAgICwgdGV4dERlY29yYXRpb246J25vbmUnCiAgICAgICAgICAgICAgICAgICAgICAsIGN1cnNvcjoncG9pbnRlcicKICAgICAgICAgICAgICAgICAgICB9KS5pbnNlcnRCZWZvcmUoaXNUb3BTdG9yeT8kdG9wc3Rvcnk6JCgnI2ZlZWQtdmVyJykpOwogICAgICAgICAgICAgICAgICAgICRsYmxIb21lVGl0bGUuY3NzKHtvdmVyZmxvdzonaGlkZGVuJ30pCiAgICAgICAgICAgICAgICAgICAgICAgIC5wcmVwZW5kKCRmaWx0ZXIpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vLmNoaWxkcmVuKCdpOmZpcnN0JykKICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAsICRmPSRlLmNoaWxkcmVuKCcuaXpoLWZlZWRzLWZpbHRlci1pbmZvLm5vdGhpbmcnKS5zdG9wKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRmLmlzKCc6aGlkZGVuJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGYuY3NzKHtkaXNwbGF5OicnLG9wYWNpdHk6MH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5hbmltYXRlKHtvcGFjaXR5OjF9LCdmYXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkZj0kZS5jaGlsZHJlbignLml6aC1mZWVkcy1maWx0ZXItaW5mby5ub3RoaW5nJykuc3RvcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZi5mYWRlT3V0KCdmYXN0Jyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICRmaWx0ZXIuY3NzKHttYXJnaW5MZWZ0Oi0kZmlsdGVyLndpZHRoKCksZGlzcGxheTonbm9uZSd9KQogICAgICAgICAgICAgICAgICAgICAgICAub24oJ3Nob3cnLGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCRlLmF0dHIoJ2RvaW5nJyk9PT0nc2hvdycpcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYXR0cignZG9pbmcnLCdzaG93Jykuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuaXMoJzpoaWRkZW4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5jc3Moe2Rpc3BsYXk6Jyd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUuYW5pbWF0ZSh7bWFyZ2luTGVmdDowfSwnc2xvdycsZnVuY3Rpb24oKXskKHRoaXMpLmNzcygnZGlzcGxheScsJycpLnJlbW92ZUF0dHIoJ2RvaW5nJyk7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignaGlkZScsZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkZT0kKHRoaXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJGUuYXR0cignZG9pbmcnKT09PSdoaWRlJylyZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hdHRyKCdkb2luZycsJ2hpZGUnKS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZS5hbmltYXRlKHttYXJnaW5MZWZ0Oi0kZmlsdGVyLndpZHRoKCl9LCdzbG93JyxmdW5jdGlvbigpeyQodGhpcykuY3NzKCdkaXNwbGF5Jywnbm9uZScpLnJlbW92ZUF0dHIoJ2RvaW5nJyk7fSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRlPSQodGhpcykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlLnRyaWdnZXIoJ3Nob3cnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJGU9JCh0aGlzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGUudHJpZ2dlcignaGlkZScpOwogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgICAgICAgICByZWZyZXNoRmlsdGVySW5mbygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgOwogICAgaWYocGFnZUlzLkhvbWV8fHBhZ2VJcy5EZWJ1dHMpewogICAgICAgICRmZWVkTGlzdC5maW5kKCcuZmVlZC1pdGVtJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCQoZSksbnVsbAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgaXpoQXV0aG9yTGlzdAogICAgICAgICAgICApOwogICAgICAgIH0pOwogICAgICAgICRmZWVkTGlzdC5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgdmFyICRpdGVtPSQoZXZlbnQudGFyZ2V0KTsKICAgICAgICAgICAgaWYoJGl0ZW0uaXMoJy5mZWVkLWl0ZW0nKSl7CiAgICAgICAgICAgICAgICB3aW5kb3cuaVpoaWh1LkFuc3dlci5wcm9jZXNzQW5zd2VyKCRpdGVtLG51bGwKICAgICAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JSZWFyJyk9PScxJwogICAgICAgICAgICAgICAgICAsICRib2R5LmF0dHIoJ2l6aEF1dGhvckxpc3QnKT09JzEnCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmVmcmVzaEZpbHRlckluZm8oKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIGlmIChwYWdlSXMuSG9tZSl7CiAgICAJdmFyIGJIb21lRmVlZHNDb2x1bW5zPXdpbmRvdy5pWmhpaHUuY29uZmlnWydIb21lRmVlZHNDb2x1bW5zJ10KICAgICAgICBpZiAoaXpoSG9tZU5vdGkmJiFiSG9tZUZlZWRzQ29sdW1ucwogICAgICAgICAmJiAkbGJsSG9tZVRpdGxlLmxlbmd0aAogICAgICAgICAmJiAkYnRuTmV3QWN0aXZpdHkubGVuZ3RoCiAgICAgICAgKXsKICAgICAgICAgICAgJGxibEhvbWVUaXRsZS5jc3MoewogICAgICAgICAgICAgICAgJ2Zsb2F0JzonbGVmdCcKICAgICAgICAgICAgICAsICdtYXJnaW4tYm90dG9tJzonMnB4JwogICAgICAgICAgICAgICwgJ2xpbmUtaGVpZ2h0JzonMzJweCcKICAgICAgICAgICAgICAsICd3aWR0aCc6JzEwMCUnCiAgICAgICAgICAgICAgfSkubmV4dCgpLmNzcygnY2xlYXInLCdib3RoJyk7CiAgICAgICAgICAgICRidG5OZXdBY3Rpdml0eS5jc3MoewogICAgICAgICAgICAgICAgJ2Zsb2F0JzoncmlnaHQnCiAgICAgICAgICAgICAgLCAnbWFyZ2luJzonMCcKICAgICAgICAgICAgICAsICdsaW5lLWhlaWdodCc6JzIycHgnCiAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRsYmxIb21lVGl0bGUpOwogICAgICAgIH0KICAgICAgICBob21lRmVlZHMoYkhvbWVGZWVkc0NvbHVtbnMpOwogICAgfQoKCi8qKgogKiDpl67popjpobUKICovCgogIGlmKHBhZ2VJcy5RdWVzdGlvbil7CgogICAgdmFyICRsYmxRdWVzdGlvbk1ldGE9JCgnI3poLXF1ZXN0aW9uLW1ldGEtd3JhcCcpLy9xdWVzdGlvbl9tZXRhCiAgICAgICwgJGxpc3RBbnN3ZXJzPSQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItd3JhcCwjemgtcXVlc3Rpb24tY29sbGFwc2VkLXdyYXAnKS5jaGlsZHJlbigpLy8kKCcuem0taXRlbS1hbnN3ZXInLCcjemgtc2luZ2xlLXF1ZXN0aW9uJykKICAgICAgLCBudW1BbnN3ZXJzQ291bnQ9JGxpc3RBbnN3ZXJzLmxlbmd0aAogICAgICAsICRidG5Db2xsYXBzZWRTd2l0Y2hlcj0kKCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLXN3aXRjaGVyJykKICAgICAgLCBudW1Db2xsYXBzZWRDb3VudD0hJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aHx8JGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmlzKCc6aGlkZGVuJyk/MDpwYXJzZUludCgkKCcjemgtcXVlc3Rpb24tY29sbGFwc2VkLW51bScpLnRleHQoKSkKICAgICAgLCBudW1BbnN3ZXJzQ291bnRUb3RhbD1udW1BbnN3ZXJzQ291bnQrbnVtQ29sbGFwc2VkQ291bnQKICAgICAgLCAkcmVwbHk9JCgnI3poLXF1ZXN0aW9uLWFuc3dlci1mb3JtLXdyYXAnKS8vcmVwbHlfZm9ybQogICAgOwogICAgaWYoJGxibFF1ZXN0aW9uTWV0YS5sZW5ndGgpewogICAgICAgIHZhciBzPW5ldyBBcnJheSgpCiAgICAgICAgICAsICRhPSQoJzxhPicpCiAgICAgICAgICAsICRjPSQoJzxzcGFuPicseydjbGFzcyc6J3pnLWJ1bGwnfSkudGV4dCgn4oCiJykKICAgICAgICAgICwgJHA9JGxibFF1ZXN0aW9uTWV0YS5jaGlsZHJlbignLnptLW1ldGEtcGFuZWwnKS5jaGlsZHJlbignYS5tZXRhLWl0ZW06bGFzdCcpCiAgICAgICAgICAsICRtPSQoJy56dS1hbnN3ZXItZm9ybS1kaXNhYmxlZC13cmFwOnZpc2libGUgPiBhJywnI3poLXF1ZXN0aW9uLWFuc3dlci1mb3JtLXdyYXAnKQogICAgICAgIDsKICAgICAgICBpZigkbS5sZW5ndGgpewogICAgICAgICAgICBzLnB1c2goJG0uYXR0cignaHJlZicpKTsKICAgICAgICAgICAgJGEudGV4dCgn5oiR55qE5Zue562UJyk7CiAgICAgICAgfWVsc2UgaWYoJHJlcGx5Lmxlbmd0aCl7CiAgICAgICAgICAgIHZhciBpZD0nbmV3X2Fuc3dlcicKICAgICAgICAgICAgICAsICRiPSQoJzxhPicse25hbWU6aWR9KS5iZWZvcmUoJHJlcGx5LmNoaWxkcmVuKCkuZmlyc3QoKSk7CiAgICAgICAgICAgIHMucHVzaCgnI2RyYWZ0Jyk7CiAgICAgICAgICAgICRhLnRleHQoJ+aIkeimgeWbnuetlCcpOwogICAgICAgIH0KICAgICAgICAkYy5pbnNlcnRBZnRlcigkcCk7CiAgICAgICAgJGEuYXR0cignaHJlZicscy5qb2luKCcnKSkuYXR0cigndGFyZ2V0JywnX3NlbGYnKQogICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJGMpOwogICAgfQogICAgaWYgKGl6aEF1dGhvckxpc3QmJgogICAgICAgIG51bUFuc3dlcnNDb3VudFRvdGFsPjEwMCYmCiAgICAgICAgY29uZmlybSgn6L+Z5Liq6Zeu6aKY55qE5Zue562U5pWw6L6D5aSa77yM5piv5ZCm5pqC5pe25YWz6Zet44CMaVpoaWh1IOWbnuetlOebruW9leOAje+8nycpKXsKICAgICAgICAvLyQoJyNpemhDU1NfY29tbWVudCcpLnJlbW92ZSgpOwogICAgICAgIC8vcmV0dXJuOwogICAgICAgIGl6aEF1dGhvckxpc3Q9ZmFsc2U7CiAgICAgICAgJGJvZHkuYXR0cignaXpoQXV0aG9yTGlzdCcsJzAnKTsKICAgIH0KICAgIC8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7CiAgICAKICAgIHZhciAkbGJsQW5zd2Vyc0NvdW50PSQoJyN6aC1xdWVzdGlvbi1hbnN3ZXItbnVtJykvL2Fuc3dlcnNfY291bnQKICAgICAgLCAkdW5vPSQoJzxkaXY+Jyx7J2NsYXNzJzondW5vJyxzdHlsZTonZmxvYXQ6bGVmdCd9KS8vaXpoX0F1dGhvcnNMaXN0CiAgICAgICwgJHBwVD0kKCc8c3Bhbj4nLHsnY2xhc3MnOidtZVQnLHN0eWxlOidkaXNwbGF5Om5vbmUnfSkvL2l6aF9BdXRob3JzTGlzdF9Ub3BTZWxmSW5kaWNhdG9yCiAgICAgICwgJGZybT0kKCc8ZGl2PicseydjbGFzcyc6J2ZyYW1lJ30pLy9pemhfQXV0aG9yc0xpc3RfZnJhbWUKICAgICAgLCAkcHBCPSQoJzxzcGFuPicseydjbGFzcyc6J21lQicsc3R5bGU6J2Rpc3BsYXk6bm9uZSd9KS8vaXpoX0F1dGhvcnNMaXN0X0JvdHRvbVNlbGZJbmRpY2F0b3IKICAgICAgLCAkcHA9JCgnPHVsPicseydjbGFzcyc6J3BwJ30pLy9pemhfQXV0aG9yc0xpc3RfVUwKICAgICAgLCAkcHBJPSQoJzxkaXY+JykKICAgIAogICAgOwoKICAgIHdpbmRvdy5pWmhpaHUuJHVub0Fuc3dlcnMgPSAkdW5vCi8qCiAgICAvL+etlOahiOaMieaXtumXtOaOkuW6jwogICAgaWYodXRpbHMuZ2V0Q2ZnKCdhbnN3ZXJfb3JkZXJCeVRpbWUnKSl7CiAgICAgIGNsaWVudC5jbGljaygnLnpoLWFuc3dlcnMtZmlsdGVyLXBvcHVwIGRpdltkYXRhLWtleT1hZGRlZF90aW1lXScpOwogICAgfQoqLyAgICAKICAgIHZhciAkcXVlc3Rpb25XcmFwPSQoJyN6aC1xdWVzdGlvbi1tZXRhLXdyYXAnKTsKICAgICRxdWVzdGlvbldyYXAuY2hpbGRyZW4oJy5wYW5lbC1jb250YWluZXInKS5iaW5kKCdET01Ob2RlSW5zZXJ0ZWQnLGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICB3aW5kb3cuaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJChldmVudC50YXJnZXQpKTsKICAgIH0pOwogICAgaWYod2luZG93LmlaaGlodS5Db21tZW50LlJpZ2h0Q29tbWVudCl7CiAgICAgICAgLy8kcXVlc3Rpb25XcmFwLmNoaWxkcmVuKCcubWV0YS1pdGVtW25hbWU9YWRkY29tbWVudF0nKS5wcmVwZW5kVG8oJHF1ZXN0aW9uV3JhcCk7CiAgICAgICAgd2luZG93LmlaaGlodS5Db21tZW50LnByb2Nlc3NDb21tZW50QnV0dG9uKCRxdWVzdGlvbldyYXApOwogICAgICAgIGlmKCEkKCcjaXpoX1F1ZXN0aW9uU2hhZG93JykubGVuZ3RoKXsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidpemhfYm94U2hhZG93JyxpZDonaXpoX1F1ZXN0aW9uU2hhZG93J30pLmNzcyh7CiAgICAgICAgICAgICAgICAnei1pbmRleCc6ICctMScKICAgICAgICAgICAgICAsICdwb3NpdGlvbic6ICdyZWxhdGl2ZScKICAgICAgICAgICAgICAsICd0b3AnOiAtMjUKICAgICAgICAgICAgICAsICdtYXJnaW4tbGVmdCc6IC0zMgogICAgICAgICAgICB9KS5wcmVwZW5kVG8oJ2JvZHk+Lnp1LW1haW46Zmlyc3QnKS5oaWRlKCk7CiAgICAgICAgfSAgIAogICAgfQoKICAgIC8vcHJvY2VzcyBlYWNoIGFuc3dlcgogICAgaWYoJGxpc3RBbnN3ZXJzJiYkbGlzdEFuc3dlcnMubGVuZ3RoKXsKICAgICAgICBpZihpemhBdXRob3JMaXN0KXsKICAgICAgICAgICAgJHVuby5hcHBlbmRUbygkYmFubmVyKTsKICAgICAgICAgICAgJHBwVC5hcHBlbmRUbygkdW5vKTsKICAgICAgICAgICAgJGZybS5hcHBlbmRUbygkdW5vKTsKICAgICAgICAgICAgJHBwLmFwcGVuZFRvKCRmcm0pOwogICAgICAgICAgICAkcHBCLmFwcGVuZFRvKCR1bm8pOwogICAgICAgICAgICAvL3Vuby5hcHBlbmRDaGlsZChwcEkpOwogICAgICAgICAgICAkdW5vLiRlbmRPZkxhc3RBPSQoJzxsaT4nKS5hZGRDbGFzcygnZW5kT2ZMYXN0QScpLmFwcGVuZFRvKCRwcCkKICAgICAgICB9CiAgICAgICAgJGxpc3RBbnN3ZXJzLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkKGUpLCRwcAogICAgICAgICAgICAgICwgaXpoQXV0aG9yUmVhcgogICAgICAgICAgICAgICwgaXpoQXV0aG9yTGlzdCk7CiAgICAgICAgfSk7CiAgICAgICAgaWYoJHJlcGx5LmNoaWxkcmVuKCcuenUtYW5zd2VyLWZvcm0tZGlzYWJsZWQtd3JhcCcpLmlzKCc6aGlkZGVuJykpewogICAgICAgICAgICB2YXIgJHBwbGE9JCgnPGE+Jyx7aHJlZjonI2RyYWZ0Jyx0YXJnZXQ6J19zZWxmJ30pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0YWJsZT4nLCB7ICdjbGFzcyc6ICdwbHVzJyB9KQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicpKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JykpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ25hbWUgZnVuYycgfSkudGV4dCgnLW5ldy0nKSkKICAgICAgICAgICAgICAsICRwcGw9JCgnPGxpPicpCiAgICAgICAgICAgICAgICAuYXBwZW5kKCRwcGxhKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKCRwcCkKICAgICAgICAgICAgOwogICAgICAgIH0KICAgIH0KICAgIHZhciByZXNpemVBdXRob3JMaXN0PWZ1bmN0aW9uKCRmKXsKICAgICAgICAvLyBBZGp1c3QgQXV0aG9yTGlzdCdzIHNpemUgYW5kIGxvY2F0ZSBpdHMgcG9zaXRpb24KICAgICAgICBpZighJGZ8fCEkZi5sZW5ndGgpcmV0dXJuOwogICAgICAgIHZhciBmcm09JGYuZ2V0KDApOwogICAgICAgIHZhciB3aWR0aD13aW5kb3cuaVpoaWh1LkFuc3dlci5wcFdpZHRoCiAgICAgICAgICAsIGhlaWdodD0kd2luLmhlaWdodCgpLSRtYWluLm9mZnNldCgpLnRvcC0zLSRmLnBvc2l0aW9uKCkudG9wOwogICAgICAgIGlmKGZybS5zY3JvbGxIZWlnaHQ+aGVpZ2h0KXsKICAgICAgICAgICAgJGYuaGVpZ2h0KGhlaWdodCk7CiAgICAgICAgICAgIHdpZHRoKz0yMDsKICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgJGYuaGVpZ2h0KCcnKTsKICAgICAgICB9CiAgICAgICAgJGYud2lkdGgod2lkdGgpOwogICAgfTsKICAgIGlmKGlzTmFOKG51bUNvbGxhcHNlZENvdW50KSludW1Db2xsYXBzZWRDb3VudD0wOwogICAgaWYoJGxpc3RBbnN3ZXJzLmxlbmd0aHx8bnVtQ29sbGFwc2VkQ291bnQpewogICAgICAgIGlmKGl6aEF1dGhvckxpc3QpewogICAgICAgICAgICAkdW5vLmNzcyh7CiAgICAgICAgICAgICAgICAnZmxvYXQnOidub25lJwogICAgICAgICAgICAgICwgJ2xlZnQnOjktJHVuby53aWR0aCgpCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZighJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aCYmIW51bUNvbGxhcHNlZENvdW50KQogICAgICAgICAgICAgICAgcmVzaXplQXV0aG9yTGlzdCgkZnJtKTsKICAgICAgICAgICAgJCgnPGRpdj4nLHsnY2xhc3MnOidtb2RhbC1kaWFsb2ctdGl0bGUnfSkuY3NzKHsKICAgICAgICAgICAgICAgICAgJ2JvcmRlci10b3AtbGVmdC1yYWRpdXMnOjAKICAgICAgICAgICAgfSkuaW5zZXJ0QmVmb3JlKCRwcFQpOwogICAgICAgICAgICAkdW5vLm1vdXNlb3ZlcihmdW5jdGlvbigpewogICAgICAgICAgICAgICAgcmVzaXplQXV0aG9yTGlzdCgkKCcuZnJhbWUnLHRoaXMpKTsKICAgICAgICAgICAgICAgICQodGhpcykuY3NzKCdsZWZ0JywnMCcpOwogICAgICAgICAgICB9KS5tb3VzZW91dChmdW5jdGlvbigpewogICAgICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2xlZnQnLDktJCh0aGlzKS53aWR0aCgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmKHdpbmRvdy5pWmhpaHUuQW5zd2VyLl9lKXsKICAgICAgICAgICAgICAgICR1bm8uY2hpbGRyZW4oJy5tZVQnKS5jc3MoJ2Rpc3BsYXknLDA+d2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCk/Jyc6J25vbmUnKTsKICAgICAgICAgICAgICAgICR1bm8uY2hpbGRyZW4oJy5tZUInKS5jc3MoJ2Rpc3BsYXknLCRmcm0uaGVpZ2h0KCk8d2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0VG9wLSRmcm0uc2Nyb2xsVG9wKCkrd2luZG93LmlaaGlodS5BbnN3ZXIuX2Uub2Zmc2V0SGVpZ2h0PycnOidub25lJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoJGJ0bkNvbGxhcHNlZFN3aXRjaGVyLmxlbmd0aCl7CiAgICAgICAgICAgIGlmKG51bUNvbGxhcHNlZENvdW50PjApewogICAgICAgICAgICAgICAgJCgnI3poLXF1ZXN0aW9uLWNvbGxhcHNlZC13cmFwJykuc2hvdygpLmJpbmQoJ0RPTU5vZGVJbnNlcnRlZCcsZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgICAgIHZhciAkYT0kKGV2ZW50LnRhcmdldCk7CiAgICAgICAgICAgICAgICAgICAgaWYoJGEuaXMoJy56bS1pdGVtLWFuc3dlcicpKXsKICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkYSwkcHAKICAgICAgICAgICAgICAgICAgICAgICAgICAsICRib2R5LmF0dHIoJ2l6aEF1dGhvclJlYXInKT09JzEnCiAgICAgICAgICAgICAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JMaXN0Jyk9PScxJwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnQgPSAkKCcuem0taXRlbS1hbnN3ZXJbaXpoX3Byb2Nlc3NlZD0xXScsJyN6aC1xdWVzdGlvbi1jb2xsYXBzZWQtd3JhcCcpLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY291bnQ9PW51bUNvbGxhcHNlZENvdW50KXsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2l6ZUF1dGhvckxpc3QoJGZybSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkYnRuQ29sbGFwc2VkU3dpdGNoZXJbMF0uY2xpY2soKTsKICAgICAgICB9CiAgICB9CgogICAgJCgnI3poLXF1ZXN0aW9uLWFuc3dlci13cmFwJykuYmluZCgnRE9NTm9kZUluc2VydGVkJyxmdW5jdGlvbihldmVudCl7CiAgICAgICAgdmFyICRuYT0kKGV2ZW50LnRhcmdldCkuZmlsdGVyKCcuem0taXRlbS1hbnN3ZXInKTsKICAgICAgICBpZigkbmEubGVuZ3RoKXsKICAgICAgICAgICAgd2luZG93LmlaaGlodS5BbnN3ZXIucHJvY2Vzc0Fuc3dlcigkbmEsJHBwCiAgICAgICAgICAgICAgLCAkYm9keS5hdHRyKCdpemhBdXRob3JSZWFyJyk9PScxJwogICAgICAgICAgICAgICwgJGJvZHkuYXR0cignaXpoQXV0aG9yTGlzdCcpPT0nMScKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9KTsKICAgIC8vY29uc29sZS5sb2coKG5ldyBEYXRlKCkpLmdldFRpbWUoKSk7CgogICAgdmFyICRjbT0kKCcuem0tY29tbWVudC1ib3gnLCRxdWVzdGlvbldyYXApOwogICAgaWYoJGNtLmxlbmd0aCAmJiAkY20uaXMoJzp2aXNpYmxlJykpewogICAgICAgIHZhciBmb2N1c05hbWUgPSBpWmhpaHUuQ29tbWVudC5zY3JvbGxGb2N1c0NvbW1lbnRPblBhZ2VMb2FkKCRjbSk7CiAgICAKICAgICAgICBpWmhpaHUuQ29tbWVudC5tZXRhU2Nyb2xsVG9WaWV3Qm90dG9tKCRjbS5jbG9zZXN0KCcuem0taXRlbS1tZXRhJyksZnVuY3Rpb24oKXsKICAgICAgICAgICAgaVpoaWh1LkNvbW1lbnQucHJvY2Vzc0NvbW1lbnQoJGNtLCBmb2N1c05hbWUpOwogICAgICAgIH0pOwogICAgfQogIH0KCi8qKgogKiDphY3nva7nlYzpnaIKICovCgogICAgdmFyICRidG5TZXR0aW5ncyA9ICQoJzxsaT4nKQogICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgaHJlZjogJ2phdmFzY3JpcHQ6dm9pZCgwKTsnLCB0YWJpbmRleDogJy0xJyB9KQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICd6Zy1pY29uIHpnLWljb24tZGQtc2V0dGluZ3MgaXpoaWh1LXNldHRpbmdzJyB9KSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2laaGlodScpCiAgICAgICAgICAgICkuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIHZhciAkc2V0dGluZ3MgPSAkKCcjaXpoLWRsZy1zZXR0aW5ncycpCiAgICAgICAgICAgICAgICAkKCcubW9kYWwtZGlhbG9nLWJnJykuc2hvdygpCiAgICAgICAgICAgICAgICAkKCcuaXpoLW9wdGlvbicsICcjaXpoLWRsZy1zZXR0aW5ncycpLmVhY2goZnVuY3Rpb24oaSwgZSl7CiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGUuZ2V0QXR0cmlidXRlKCduYW1lJykKICAgICAgICAgICAgICAgICAgICAgICwgdmFsdWUgPSB1dGlscy5nZXRDZmcoa2V5KQogICAgICAgICAgICAgICAgICAgICAgLCAkZSA9ICQoZSkKICAgICAgICAgICAgICAgICAgICBpZiAoJGUuaXMoJ2lucHV0OmNoZWNrYm94JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYodmFsdWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKGUpLmlDaGVjaygnY2hlY2snKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJGUuaXMoJ3NlbGVjdCcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGUudmFsdWUgPSB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAkc2V0dGluZ3MuY3NzKHsKICAgICAgICAgICAgICAgICAgICAnei1pbmRleCc6Jzk5JwogICAgICAgICAgICAgICAgICAsICdwb3NpdGlvbic6J2ZpeGVkJwogICAgICAgICAgICAgICAgICAsICd0b3AnOiAoJHdpbi5oZWlnaHQoKSAtICRzZXR0aW5ncy5oZWlnaHQoKSkgLyAyCiAgICAgICAgICAgICAgICAgICwgJ2xlZnQnOiAoJHdpbi53aWR0aCgpIC0gJHNldHRpbmdzLndpZHRoKCkpIC8gMgogICAgICAgICAgICAgICAgfSkuZmFkZUluKCdzbG93JykKICAgICAgICAgICAgfSkuaW5zZXJ0QmVmb3JlKCQoJ3VsI3RvcC1uYXYtcHJvZmlsZS1kcm9wZG93biBsaTpsYXN0JykpCiAgICAgICwgJGRsZ1NldHRpbmdzID0gJCgnPGRpdj4nLCB7IGlkOiAnaXpoLWRsZy1zZXR0aW5ncycsICdjbGFzcyc6ICdtb2RhbC1kaWFsb2cnLCB0YWJpbmRleDogJzAnLCBzdHlsZTogJ2Rpc3BsYXk6bm9uZTt3aWR0aDo2MDBweCd9KQogICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnbW9kYWwtZGlhbG9nLXRpdGxlIG1vZGFsLWRpYWxvZy10aXRsZS1kcmFnZ2FibGUnIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxzcGFuPicsIHsgJ2NsYXNzJzogJ21vZGFsLWRpYWxvZy10aXRsZS10ZXh0JyB9KS50ZXh0KCfphY3nva7pgInpobknKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNwYW4+JywgewogICAgICAgICAgICAgICAgICAgICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctdGl0bGUtY2xvc2UnCiAgICAgICAgICAgICAgICAgICwgY2xpY2s6IGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5tb2RhbC1kaWFsb2ctYmcnKS5oaWRlKCkKICAgICAgICAgICAgICAgICAgICAgICAgJCgnI2l6aC1kbGctc2V0dGluZ3MnKS5maXJzdCgpLmhpZGUoKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pKQogICAgICAgICAgICApCiAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7ICdjbGFzcyc6ICdtb2RhbC1kaWFsb2ctY29udGVudCcgfSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGRpdj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctc2VjdGlvbicgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGFibGU+JywgeyAnY2xhc3MnOiAndF9zZXRfdGInLCBib3JkZXI6IDAsIGNlbGxzcGFjaW5nOiAwLCBjZWxscGFkZGluZzogNSwgd2lkdGg6ICcxMDAlJyB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGhlYWQ+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgY29sc3BhbjogNiwgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCfvvIjmm7TmlLnlkI7orr7nva7lsIbnq4vliLvkv53lrZjvvIzkvYblj6rmnInlvZPpobXpnaLlho3mrKHmiZPlvIDml7bmiY3kvJrnlJ/mlYjvvIknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJLnByZXBlbmQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAkJJCgnPGI+JykudGV4dCgn5Yqf6IO95byA5YWzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAJCSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRib2R5PicsIHt9KQovKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5Zyo6aaW6aG155u05o6l5rWP6KeI5bi45Y676K+d6aKYJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICIifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0SG9tZVRvcGljcyIsIG5hbWU6ICJIb21lVG9waWNzIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+aUueWPmOe9kemhteagt+W8j+WkluingicpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JCog6aaW6aG16ZqQ6JeP5aSn5aS05YOPPGJyLz4qIOe8qei/m+aKleelqOaMiemSru+8iOmXrumimC/lm57nrZTpobXvvIk8YnIvPiog5oyJ6ZKu5Zu+5qCH5Yqo55S7ICJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lTGF5b3V0IiwgbmFtZTogIkhvbWVMYXlvdXQiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn6Ieq5Yqo5pS26LW35a+86Iiq5qCPJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQkKiDmu5rliqjpobXpnaLoh7PkuIvmlrnml7bvvIzoh6rliqjmlLbotbfpobbpg6jlr7zoiKrmoI8gIn0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFRvcE5hdkF1dG9Gb2xkIiwgbmFtZTogIlRvcE5hdkF1dG9Gb2xkIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+iwg+aVtOmmlumhteOAjOaWsOWKqOaAgeOAjeaPkOmGkuaMiemSricpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOaMquWIsCBUaW1lbGluZSDlj7PkuIrop5I8YnIvPuS4juagh+mimOOAjOacgOaWsOWKqOaAgeOAjeW5s+ihjCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lTm90aSIsIG5hbWU6ICJIb21lTm90aSIgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dHI+Jywge30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgY29sc3BhbjogNCwgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCflvIDlkK/jgIzpppbpobXliIbmoI/jgI0nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicsIHsgJ2NsYXNzJzogJ2ljb24gaWNvbi1oZWxwJywgJ2RhdGEtdGlwJzogInMkdCTlsIbpppbpobXliqjmgIHliIbnsbvljZXni6zmmL7npLrvvJo8YnIvPumXrumimOOAgeWbnuetlOOAgeS4k+agjyJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRIb21lRmVlZHNDb2x1bW5zIiwgbmFtZTogIkhvbWVGZWVkc0NvbHVtbnMiIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5bCG55So5oi35L+h5oGv5oyq5Yiw5Zue562U5LiL5pa5JykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICIifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0QXV0aG9yUmVhciIsIG5hbWU6ICJBdXRob3JSZWFyIiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+W8gOWQr+OAjOWPs+iIt+ivhOiuuuOAjScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOWcqOmhtemdouWPs+S+p+a1ruWKqOaYvuekuuaJk+W8gOeahOivhOiuuuWIl+ihqDxici8+5Zyo6aaW6aG144CB6Zeu6aKY44CB5Zue562U6aG15Lit55Sf5pWIIn0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFJpZ2h0Q29tbWVudCIsIG5hbWU6ICJTaG93Q29tbWVudCIgfSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyB3aWR0aDogMSwgbm93cmFwOiAnbm93cmFwJywgYWxpZ246ICdsZWZ0JyB9KS50ZXh0KCflhbPpl63ml7boh6rliqjljbflsY/oh7Plr7nlupTmnaHnm64nKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicsIHsgJ2NsYXNzJzogJ2ljb24gaWNvbi1oZWxwJywgJ2RhdGEtdGlwJzogInMkdCTku4Xlr7nlj7PoiLfor4TorrrnlJ/mlYgifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0UmlnaHRDb21tZW50X0F1dG9TY3JvbGxQYWdlV2hlbkNsb3NpbmciLCBuYW1lOiAiUmlnaHRDb21tZW50X0F1dG9TY3JvbGxQYWdlV2hlbkNsb3NpbmciIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5b+r6YCf5bGP6JS944CN77yI5Yqg5YWl6buR5ZCN5Y2VL+WPlua2iOWFs+azqO+8ieWKn+iDvScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOWcqOi1nuWQjOWIl+ihqOOAgeivhOiuuuWIl+ihqOS4reS9v+eUqCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGlucHV0PicsIHsgdHlwZTogImNoZWNrYm94IiwgJ2NsYXNzJzogIml6aC1vcHRpb24iLCBpZDogImlaaGlodV9zZXRRdWlja0Jsb2NrIiwgbmFtZTogIlF1aWNrQmxvY2siIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5b+r6YCf5pS26JeP44CN6I+c5Y2VJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQk6byg5qCH56e75LiK44CM5pS26JeP44CN5oyJ6ZKu5pe25pi+56S6In0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aW5wdXQ+JywgeyB0eXBlOiAiY2hlY2tib3giLCAnY2xhc3MnOiAiaXpoLW9wdGlvbiIsIGlkOiAiaVpoaWh1X3NldFF1aWNrRmF2byIsIG5hbWU6ICJRdWlja0Zhdm8iIH0pKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRyPicsIHt9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGNvbHNwYW46IDQsIGFsaWduOiAnbGVmdCcgfSkudGV4dCgn5byA5ZCv44CM5Zue562U55uu5b2V44CNJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHRkPicsIHsgYWxpZ246ICdyaWdodCd9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8aT4nLCB7ICdjbGFzcyc6ICdpY29uIGljb24taGVscCcsICdkYXRhLXRpcCc6ICJzJHQk5Zyo6Zeu6aKY6aG16Z2i5bem5L6n5o6p6JeP77yM6byg5qCH56e75LiK5pe25bGV5byAPGJyLz7lubblnKjlj7PkvqfljbPml7bmmL7npLrlm57nrZTpooTop4gifSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBhbGlnbjogJ3JpZ2h0J30pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpbnB1dD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0QXV0aG9yTGlzdCIsIG5hbWU6ICJBdXRob3JMaXN0IiB9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0cj4nLCB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8dGQ+JywgeyBjb2xzcGFuOiA0LCBhbGlnbjogJ2xlZnQnIH0pLnRleHQoJ+mAieaLqeOAjOWklumDqOaQnOe0ouW8leaTjuOAjScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGk+JywgeyAnY2xhc3MnOiAnaWNvbiBpY29uLWhlbHAnLCAnZGF0YS10aXAnOiAicyR0JOS9oOaHgueahCJ9KSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzx0ZD4nLCB7IGFsaWduOiAncmlnaHQnfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHNlbGVjdD4nLCB7IHR5cGU6ICJjaGVja2JveCIsICdjbGFzcyc6ICJpemgtb3B0aW9uIiwgaWQ6ICJpWmhpaHVfc2V0U2VhcmNoRW5naW5lT3V0c2lkZSIsIG5hbWU6ICJTZWFyY2hFbmdpbmVPdXRzaWRlIn0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8b3B0aW9uPicsIHsgdmFsdWU6J2dvb2dsZScgfSkudGV4dCgnR29vZ2xlJykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8b3B0aW9uPicsIHsgdmFsdWU6J2JhaWR1JyB9KS50ZXh0KCfnmb7luqYnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxkaXY+JywgeyAnY2xhc3MnOiAnemctbGVmdCcgfSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5b2T5YmN54mI5pys77yaJyt2ZXJzaW9uKyfvvJsnKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfmnIDlkI7mm7TmlrDvvJonK3VwZGF0ZURhdGUpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGJyPicpKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCfliLbkvZzvvJonKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxhPicsIHsgJ2RhdGEtdGlwJzogInAkdCR1bm9nengiLCBocmVmOiAiL3Blb3BsZS91bm9nengiIH0pLnRleHQoJ0DpkqLnm4Xpg63lrZAnKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn77yMJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkbGl1eW9uZzI1IiwgaHJlZjogIi9wZW9wbGUvbGl1eW9uZzI1IiB9KS50ZXh0KCdA5aSp54yqKOWImOWLhyknKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn77yMJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkbHVveHIiLCBocmVmOiAiL3Blb3BsZS9sdW94ciIgfSkudGV4dCgnQHl1a2lyb2NrJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ++8jCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnZGF0YS10aXAnOiAicCR0JG1vcmxheSIsIGhyZWY6ICIvcGVvcGxlL21vcmxheSIgfSkudGV4dCgnQOWiqOejiicpKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxicj4nKSkKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgn5oSf6LCi77yaJykKICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YT4nLCB7ICdkYXRhLXRpcCc6ICJwJHQkUGV0ZXJEZW5nIiwgaHJlZjogIi9wZW9wbGUvUGV0ZXJEZW5nIiB9KS50ZXh0KCdA6YKT5paH5Y2aJykpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJ++8jCcpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyAnZGF0YS10aXAnOiAicCR0JGNha3ZmY3d6IiwgaHJlZjogIi9wZW9wbGUvY2FrdmZjd3oiIH0pLnRleHQoJ0DmsLTkupHpgLgnKSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ3ptLWNvbW1hbmQnIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGE+JywgeyBpZDogJ2l6aFJlZnJlc2gnLCAnY2xhc3MnOiAnemctYnRuLWJsdWUnLCBocmVmOiAnamF2YXNjcmlwdDp2b2lkKDApOycgfSkudGV4dCgn5Yi35paw572R6aG1JykpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApLmFwcGVuZFRvKF9kb2MuYm9keSkuZHJhZ2dhYmxlKHtoYW5kbGU6ICcubW9kYWwtZGlhbG9nLXRpdGxlLWRyYWdnYWJsZSd9KQoKICAgICQoJy5pemgtb3B0aW9uJywgJGRsZ1NldHRpbmdzKS5lYWNoKGZ1bmN0aW9uKGksIGUpewogICAgICAgIHZhciBrZXkgPSBlLmdldEF0dHJpYnV0ZSgnbmFtZScpCiAgICAgICAgICAsICRjaGsgPSAkKGUpLmZpbHRlcignaW5wdXQ6Y2hlY2tib3gnKS5pQ2hlY2soewogICAgICAgICAgICAgICAgY2hlY2tib3hDbGFzczogJ2ljaGVja2JveF9zcXVhcmUtYmx1ZScKICAgICAgICAgICAgICAsIGluY3JlYXNlQXJlYTogJzIwJScgLy8gb3B0aW9uYWwKICAgICAgICAgICAgfSkuYmluZCgnaWZDaGFuZ2VkJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5jaGVja2VkCiAgICAgICAgICAgICAgICB1dGlscy5zZXRDZmcoa2V5LCB2YWx1ZSkKICAgICAgICAgICAgfSkKICAgICAgICAgICwgJHNlbCA9ICQoZSkuZmlsdGVyKCdzZWxlY3QnKS5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHV0aWxzLnNldENmZyhrZXksIHRoaXMudmFsdWUpCiAgICAgICAgICAgIH0pCiAgICB9KQogICAgJCgnI2l6aFJlZnJlc2gnKS5jbGljayhmdW5jdGlvbigpewogICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpCiAgICB9KQoKLyoKICog6K6+572uLeWxj+iUvQogKi8KaWYgKHBhZ2VJcy5TZXR0aW5nc0ZpbHRlcil7CiAgICB2YXIgYWxsPVtdCiAgICAgICwgJHNlY0Jsb2NrZWRVc2VycyA9ICQoJyNzZWN0aW9uLWJsb2NrZWQtdXNlcnMnKQogICAgICAsICRzZWNCbG9ja2VkVXNlcnNUaXRsZSA9ICRzZWNCbG9ja2VkVXNlcnMuY2hpbGRyZW4oJy5zZXR0aW5ncy1zZWN0aW9uLXRpdGxlOmZpcnN0JykuY2hpbGRyZW4oJ2gyOmZpcnN0JykKICAgICAgLCAkcG5sVW5CbG9ja2VkVXNlcnMgPSAkKCc8ZGl2PicpLmFwcGVuZFRvKCRzZWNCbG9ja2VkVXNlcnNUaXRsZSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdyaWdodCcKICAgICAgICB9KQogICAgICAsICRsYkZpbHRlckJsb2NrZWRVc2VycyA9ICQoJzxsYWJlbC8+JykuYXBwZW5kVG8oJHBubFVuQmxvY2tlZFVzZXJzKS5jc3MoewogICAgICAgICAgICBmbG9hdDogJ2xlZnQnCiAgICAgICAgfSkKICAgICAgLCAkdGJGaWx0ZXJCbG9ja2VkVXNlcnMgPSAkKCc8aW5wdXQvPicsIHsKICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWZvcm0tdGV4dC1pbnB1dCB6Zy1tcjE1JwogICAgICAgICAgLCBwbGFjZWhvbGRlcjogJ+eUqOaIt+WQjeaIluaYteensCcKICAgICAgICB9KS5hcHBlbmRUbygkcG5sVW5CbG9ja2VkVXNlcnMpLm9uKCdrZXl1cCcsIGZ1bmN0aW9uKGV2ZW50KXsKICAgICAgICAgICAgdmFyIGt3PXRoaXMudmFsdWUKICAgICAgICAgICAgICAsIG49MAogICAgICAgICAgICAgICwgJGxpc3RCbG9ja2VkVXNlcnM9JHNlY0Jsb2NrZWRVc2Vycy5maW5kKCcuYmxvY2tlZC11c2VycyA+IC5pdGVtID4gLmJvZHkgPiBhJykuZWFjaChmdW5jdGlvbihpLGUpewogICAgICAgICAgICAgICAgICAgIHZhciAkYSA9ICQoZSkKICAgICAgICAgICAgICAgICAgICAgICwgaHJlZiA9IGUuZ2V0QXR0cmlidXRlKCdocmVmJykgfHwgJycKICAgICAgICAgICAgICAgICAgICAgICwgdGV4dCA9IGUuaW5uZXJIVE1MCiAgICAgICAgICAgICAgICAgICAgICAsIG5vdE1hdGNoID0gKGhyZWYuaW5kZXhPZihrdykgPCAwICYmIHRleHQuaW5kZXhPZihrdykgPCAwKQogICAgICAgICAgICAgICAgICAgIGlmKCFub3RNYXRjaCl7CiAgICAgICAgICAgICAgICAgICAgICAgIG4rKwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkYS5jbG9zZXN0KCcuaXRlbScpLmNzcygnZGlzcGxheScsIG5vdE1hdGNoID8gJ25vbmUnIDogJycpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAkbGJGaWx0ZXJCbG9ja2VkVXNlcnMudGV4dChbbj9uKycgJzon5pegJywn5Lq65Yy56YWN77yaJ10uam9pbignJykpCiAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdsZWZ0JwogICAgICAgIH0pLnRyaWdnZXIoJ2tleXVwJykKICAgICAgLCBmdW5jVW5ibG9jaz1mdW5jdGlvbigpewogICAgICAgICAgICBpZihhbGwubGVuZ3RoPT0wKXtyZXR1cm59CiAgICAgICAgICAgIHZhciBlPWFsbC5zaGlmdCgpCiAgICAgICAgICAgICQucG9zdCgnL3NldHRpbmdzL3VuYmxvY2t1c2VyJywgJC5wYXJhbSh7CiAgICAgICAgICAgICAgICBfeHNyZjogJCgnaW5wdXRbbmFtZT1feHNyZl0nKS52YWwoKQogICAgICAgICAgICAgICwgdWlkOiBlLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpCiAgICAgICAgICAgIH0pKS5kb25lKGZ1bmN0aW9uKHJlc3VsdCl7CiAgICAgICAgICAgICAgICAkKGUpLnJlbW92ZSgpCiAgICAgICAgICAgIH0pLmZhaWwoZnVuY3Rpb24ocmVzdWx0KXsKICAgICAgICAgICAgICAgIGFsbC5wdXNoKGUpCiAgICAgICAgICAgIH0pLmFsd2F5cyhmdW5jdGlvbihyZXN1bHQpewogICAgICAgICAgICAgICAgJGxiRmlsdGVyQmxvY2tlZFVzZXJzLnRleHQoW2FsbC5sZW5ndGg/YWxsLmxlbmd0aCsnICc6J+aXoCcsJ+S6uuWMuemFje+8middLmpvaW4oJycpKQogICAgICAgICAgICAgICAgZnVuY1VuYmxvY2soKQogICAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgLCBoPSR0YkZpbHRlckJsb2NrZWRVc2Vycy5vdXRlckhlaWdodCgpCiAgICAgICwgJGJ0VW5CbG9ja2VkVXNlcnMgPSAkKCc8aW5wdXQvPicsIHsKICAgICAgICAgICAgJ2NsYXNzJzogJ3pnLWJ0biB6Zy1idG4tdW5mb2xsb3cnCiAgICAgICAgICAsIHR5cGU6ICdidXR0b24nCiAgICAgICAgICAsIHZhbHVlOiAn5Y+W5raI5bGP6JS9JwogICAgICAgIH0pLmFwcGVuZFRvKCRwbmxVbkJsb2NrZWRVc2Vycykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpewogICAgICAgICAgICAkKCcjc2VjdGlvbi1ibG9ja2VkLXVzZXJzID4gLnNldHRpbmdzLWl0ZW0gPiAuc2V0dGluZ3MtaXRlbS1jb250ZW50ID4gLmJsb2NrZWQtdXNlcnMgPiAuaXRlbScpLmVhY2goZnVuY3Rpb24oaSxlKXsKICAgICAgICAgICAgICAgIHZhciAkZSA9ICQoZSkKICAgICAgICAgICAgICAgIGlmKCRlLmlzKCc6dmlzaWJsZScpKXsKICAgICAgICAgICAgICAgICAgICBhbGwucHVzaChlKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICBmdW5jVW5ibG9jaygpCiAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgZmxvYXQ6ICdsZWZ0JwogICAgICAgIH0pLmhlaWdodChoKQogICAgJGxiRmlsdGVyQmxvY2tlZFVzZXJzLmNzcygnbGluZS1oZWlnaHQnLCBoKydweCcpCn0KCnZhciBmaXJzdFJ1biA9IHBhcnNlSW50KHV0aWxzLmdldFZhbHVlKCdpemhfZnInLCcxJykpOwoKZnVuY3Rpb24gX0ZSc2hvdygpewppZihmaXJzdFJ1bj4wICYmIGRvY3VtZW50LmRvbWFpbj09J3poaWh1LmNvbScpewogICAgdmFyIHRib3hsZWZ0PTA7CiAgICB2YXIgYWNjaXRlbTE9ICQoJyN6aC10b3AtaW5uZXIgZGl2LnRvcC1uYXYtcHJvZmlsZSAuenUtdG9wLW5hdi11c2VyaW5mbycpOwogICAgaWYoYWNjaXRlbTEubGVuZ3RoPjApewogICAgICAgIHRib3hsZWZ0ID0gYWNjaXRlbTEub2Zmc2V0KCkubGVmdDsKICAgIH0KICAgIGlmKHRib3hsZWZ0PjApewogICAgICAgICQoJzxkaXY+JywgeyBpZDogJ2laaGlodV90Ym94JywgJ2NsYXNzJzogJ3RfZnJzaG93JyB9KS5hcHBlbmRUbygnYm9keS56aGknKS5oaWRlKCkKICAgICAgICAgICAgLmFwcGVuZCgkKCc8ZGl2PicsIHsgJ2NsYXNzJzogJ3RfdHh0c2hvdyB0X3Rib3gnIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCfmhJ/osKLkvb/nlKgnKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8Yj4nKS50ZXh0KCdpWmhpaHUnKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPGJyIC8+JykpCiAgICAgICAgICAgICAgICAuYXBwZW5kKCfmgqjlj6/pgJrov4foj5zljZXjgJBpWmhpaHXjgJHlr7nlip/og73ov5vooYzorr7nva4nKQogICAgICAgICAgICAgICAgLmFwcGVuZCgkKCc8YnIgLz4nKSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoJCgnPHM+JykKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCQoJzxpPicpKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICApOwogICAgICAgICQoJyNpWmhpaHVfdGJveCcpLmNzcygnbGVmdCcsdGJveGxlZnQtMTAwKS5zaG93KCkubW91c2VlbnRlcihmdW5jdGlvbigpewogICAgICAgICAgICB1dGlscy5zZXRWYWx1ZSgnaXpoX2ZyJywnMCcpOwogICAgICAgICAgICAvL19NZW51KCk7CiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9Cn0KICAgIApzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7CiAgICBfRlJzaG93KCk7Cn0sMTAwMCk7CgoKICBjb25zb2xlLmxvZygnaVpoaWh1ICcrdmVyc2lvbisnIHN0YXJ0ZWQuJyk7CiAgLy9jb25zb2xlLmxvZyh3aW5kb3cuaVpoaWh1KTsKICAvL2NvbnNvbGUubG9nKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkpOwovL30pOwo="}],"settings":{"configMode":100,"editor_autoLint":true,"editor_autoLintMaxLen":"50000","editor_autoSave":false,"editor_easySave":true,"editor_electricChars":true,"editor_enabled":true,"editor_fontSize":"150","editor_highlightTrailingWhitespace":true,"editor_indentUnit":"4","editor_indentWithTabs":"spaces","editor_keyMap":"vim","editor_lineWrapping":false,"editor_tabMode":"smart","editor_theme":"monokai","enabled":true,"i18n":"zh_CN","script_blacklist_server":[{"rules":["/https?:\\/\\/userscripts\\.org\\/scripts\\/(source|version)/(102614).*\\.user\\.js/"],"severity":"2"},{"name":"SaveFrom.net helper","reason":"Shows advertisements","rules":["/https?:\\/\\/sf-addon\\.com\\/.*\\/.*\\.user\\.js/","/https?:\\/\\/.*\\.sf-helper\\.com\\/.*\\.user\\.js/"],"severity":"3"}]}}